<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan Azure Identity Support Blog</title>
  
  <subtitle>日本マイクロソフトの Azure Active Directory と AD FS に関するサポート情報のブログです。</subtitle>
  <link href="https://jpazureid.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpazureid.github.io/blog/"/>
  <updated>2023-04-26T02:57:31.531Z</updated>
  <id>https://jpazureid.github.io/blog/</id>
  
  <author>
    <name>Azure Identity Support Japan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ハイブリッド Azure AD 参加を再構成する</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/haadj-re-registration/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/haadj-re-registration/</id>
    <published>2023-04-24T00:00:00.000Z</published>
    <updated>2023-04-26T02:57:31.531Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure &amp; Identity サポート チームの長谷川です。</p><p>この記事では、対象デバイスのハイブリッド Azure AD 参加 (略称 HAADJ) を再構成する手順を紹介します。</p><span id="more"></span><p>HAADJ を構成完了後、たとえばなんらか Azure AD 上から誤ってデバイス オブジェクトを削除してしまう場合があるかと思います。削除後、再度 Azure AD Connect (略称 AADC) でデバイス オブジェクトが同期されると [Azure Portal (portal.azure.com)] &gt; [Azure Active Directory] &gt; [デバイス] &gt; [すべてのデバイス] で対象のデバイス オブジェクトが表示されるようになりますが、[登録済み] の項目が「保留中」のまま遷移しない状態になります。「保留中」から登録日に遷移させるためにはデバイスで HAADJ を再構成する必要があるものの、実際のデバイス側は既に HAADJ の構成が完了しているため、そのままでは HAADJ を再構成する動作が生じません。こういった場合に、本ブログを参考に HAADJ を再構成いただけると幸いです。</p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ol><li><a href="#anchor1">注意事項</a></li><li><a href="#anchor2">事前準備: Windows Hello for Business のリセット</a></li><li><a href="#anchor3">事前準備: Intune の登録解除</a></li><li><a href="#anchor4">HAADJ 再構成: 既存情報のクリア</a></li><li><a href="#anchor5">HAADJ 再構成: 改めて構成</a></li><li><a href="#anchor6">事後確認: Intune の登録</a></li><li><a href="#anchor7">事後作業: WHfB の再プロビジョニング</a></li></ol><h2 id="anchor1">1. 注意事項</h2><p>本手順は Azure AD でデバイスを認証する「Sync Join」「マネージド」「クラウド認証」などと呼ばれる構成方法にのみ適用可能です。</p><p>この構成方法は、オンプレミスの Active Directory サーバーから AADC を介して Azure AD にデバイス オブジェクトを同期し、Azure AD でデバイスを認証して HAADJ としてデバイスを構成するものです。もしも AD FS でクレーム ルールを使用してデバイスを認証し、Azure AD にデバイスを登録して HAADJ を構成している場合はこの手順は利用できません。</p><p>なお、再度 HAADJ を構成するためにはそのデバイス上での管理者権限と、デバイスがオンプレミスの Active Directory にアクセスできる環境 (社外にデバイスがある場合は、オンプレミス AD 環境への VPN 接続) が必要です。</p><h2 id="anchor2">2. 事前準備: Windows Hello for Business のリセット</h2><p><strong>Windows Hello for Business (略称 WHfB) を利用していない場合はこの手順はスキップください。</strong></p><ol><li><p>端末にサインインします。</p></li><li><p><strong>ユーザー権限</strong> でコマンド プロンプトを起動します (管理者として実行から起動しないようご注意ください)。</p></li><li><p>以下のコマンドを実行して、WHfB の情報をリセットします。</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">certutil -deletehellocontainer</span><br></pre></td></tr></table></figure></li><li><p>次のコマンドを実行し、<code>NgcSet : NO</code> となっていることを確認します。</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dsregcmd /status</span><br></pre></td></tr></table></figure></li></ol><h2 id="anchor3">3. 事前準備: Intune の登録解除</h2><p><strong>Intune 登録していなければスキップください。</strong></p><ol><li><p>[Microsoft Intune admin center (endpoint.microsoft.com)] &gt; [デバイス] &gt; [すべてのデバイス] から該当デバイスを検索し、存在する場合は対象デバイスを開いて [削除] ボタンをクリックして削除します (削除完了するまでに少し時間がかかります)。</p></li><li><p>対象のデバイス上で、[PowerShell] を <strong>管理者権限</strong> で実行します。</p></li><li><p>以下のコマンドを実行し、Enrollment ID (GUID の形式となる想定) が表示されるかを確認します。 <strong><span style="color: red; ">(表示されない場合は以下の 4. から 7. の手順は実施しないでください)</span></strong>****</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-ChildItem HKLM:\Software\Microsoft\Enrollments | ForEach-Object &#123;Get-ItemProperty $_.pspath&#125; | where-object &#123;$_.DiscoveryServiceFullURL&#125; | Foreach-Object &#123;$_.PSChildName&#125;</span><br></pre></td></tr></table></figure></li><li><p>以下のコマンドを実行し、Enrollment ID を変数に格納します。</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$EnrollmentGUID = Get-ChildItem HKLM:\Software\Microsoft\Enrollments | ForEach-Object &#123;Get-ItemProperty $_.pspath&#125; | where-object &#123;$_.DiscoveryServiceFullURL&#125; | Foreach-Object &#123;$_.PSChildName&#125;</span><br></pre></td></tr></table></figure></li><li><p>以下のコマンドを実行し削除対象のレジストリを変数に格納します。(長いですが 1 行のコマンドです)</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$RegistryKeys = &quot;HKLM:\SOFTWARE\Microsoft\Enrollments&quot;, &quot;HKLM:\SOFTWARE\Microsoft\Enrollments\Status&quot;,&quot;HKLM:\SOFTWARE\Microsoft\EnterpriseResourceManager\Tracked&quot;, &quot;HKLM:\SOFTWARE\Microsoft\PolicyManager\AdmxInstalled&quot;, &quot;HKLM:\SOFTWARE\Microsoft\PolicyManager\Providers&quot;,&quot;HKLM:\SOFTWARE\Microsoft\Provisioning\OMADM\Accounts&quot;, &quot;HKLM:\SOFTWARE\Microsoft\Provisioning\OMADM\Logger&quot;, &quot;HKLM:\SOFTWARE\Microsoft\Provisioning\OMADM\Sessions&quot;</span><br></pre></td></tr></table></figure></li><li><p>以下のコマンドを実行し、デバイス登録情報に関するレジストリを削除します。</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">foreach ($Key in $RegistryKeys) &#123;if (Test-Path -Path $Key) &#123;Get-ChildItem -Path $Key | Where-Object &#123;$_.Name -match $EnrollmentGUID&#125; | Remove-Item -Recurse -Force -Confirm:$false -ErrorAction SilentlyContinue&#125;&#125;</span><br></pre></td></tr></table></figure></li><li><p>以下のコマンドを実行し、デバイス登録のタスクを削除します。 <strong><span style="color: red; ">変数 $EnrollmentGUID がブランクの状態で以下のコマンドを実行すると必要なタスクも削除されるため注意してください。</span></strong></p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-ScheduledTask | Where-Object &#123;$_.Taskpath -match $EnrollmentGUID&#125; | Unregister-ScheduledTask -Confirm:$false</span><br></pre></td></tr></table></figure></li></ol><h2 id="anchor4">4. HAADJ 再構成: 既存情報のクリア</h2><p>実際に HAADJ の再登録を行うに際して既存の情報をクリアしておきます。</p><ol><li><p>対象のデバイスにて <strong>管理者権限</strong> でコマンド プロンプトを起動し、次のコマンドで HAADJ を解除します。</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dsregcmd /leave</span><br></pre></td></tr></table></figure></li><li><p>次のコマンドで <code>AzureAdJoined : NO</code> となっていることを確認します。</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dsregcmd /status</span><br></pre></td></tr></table></figure></li><li><p>オンプレミスの Active Directory にて、[Active Directory ユーザーとコンピューター] を開き、[表示(V)] &gt; [拡張機能(V)] を有効にします。(すでに有効であればスキップしてください)</p><p> <img src="/blog/azure-active-directory/haadj-re-registration/haadj-re-registration4-3.png"></p></li><li><p>[Active Directory ユーザーとコンピューター] にて対象のコンピューター アカウントを探し、右クリックから [プロパティ] を開きます (誤ったオブジェクトを操作しないよう直接対象のコンピューター アカウントを探すことをお勧めします。)</p><p> <img src="/blog/azure-active-directory/haadj-re-registration/haadj-re-registration4-4.png"></p></li><li><p>[属性エディター] から [userCertificate] を選択し、[編集(E)] を選択します。</p><p> <img src="/blog/azure-active-directory/haadj-re-registration/haadj-re-registration4-5.png"></p></li><li><p>[削除(R)] してから [OK] を選択します。</p><p> <img src="/blog/azure-active-directory/haadj-re-registration/haadj-re-registration4-6.png"></p></li><li><p>[userCertificate] が &lt;未設定&gt; となっていることを確認したら [OK] を選択して閉じます。</p><p> <img src="/blog/azure-active-directory/haadj-re-registration/haadj-re-registration4-7.png"></p></li><li><p>AADC の同期 (既定では 30 分間隔) を待ち、[Azure Portal (portal.azure.com)] &gt; [Azure Active Directory] &gt; [デバイス] &gt; [すべてのデバイス] にて対象のデバイス オブジェクトが削除されていることを確認します。</p></li></ol><h2 id="anchor5">5. HAADJ 再構成: 改めて構成</h2><p>以下の手順で実際に再構成を行います。</p><ol><li><p>対象のデバイスを再起動したのち、対象のユーザーでサインインします。</p></li><li><p>対象のデバイスがオンプレミスの Active Directory にアクセスできるネットワーク環境に接続していることを確認します (社内ネットワーク環境に接続するなど)。</p></li><li><p><strong>管理者権限</strong> でタスク スケジューラを起動し [タスク スケジューラ ライブラリ] &gt; [Microsoft] &gt; [Windows] &gt; [Workplace Join] を開きます。</p></li><li><p>[Automatic-Device-Join] を 右クリックし [実行する(R)] を選択します。</p><p> <img src="/blog/azure-active-directory/haadj-re-registration/haadj-re-registration5-4.png"></p></li><li><p>オンプレミスの Active Directory にて対象のコンピューター アカウントに userCertificate に値が書き込まれたことを確認します (上記「4. HAADJ 再構成: 既存情報のクリア」の 3 から 5 の手順を参考)。</p><p> <img src="/blog/azure-active-directory/haadj-re-registration/haadj-re-registration5-5.png"></p></li><li><p>AADC の同期 (既定では 30 分間隔) を経て [Azure Portal (portal.azure.com)] &gt; [Azure Active Directory] &gt; [デバイス] &gt; [すべてのデバイス] に対象のデバイス オブジェクトが同期されたことを確認します。</p><p> <img src="/blog/azure-active-directory/haadj-re-registration/haadj-re-registration5-6.png"></p></li><li><p>Azure AD への同期を確認後、再度 [Automatic-Device-Join] を実行します。(3 から 4 の手順を参考)</p></li><li><p>コマンド プロンプトを起動し次のコマンドを実行し <code>AzureAdJoined : YES</code> となっていることを確認します。</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dsregcmd /status</span><br></pre></td></tr></table></figure></li><li><p>[Azure Portal (portal.azure.com)] &gt; [Azure Active Directory] &gt; [デバイス] &gt; [すべてのデバイス] で対象のデバイス オブジェクトの [登録済み] の項目が「保留中」から現在の日付に遷移したことを確認します。</p><p> <img src="/blog/azure-active-directory/haadj-re-registration/haadj-re-registration5-9.png"></p></li><li><p>対象デバイスにて 画面のロック &gt; アンロック をすることで プライマリ更新トークン (PRT) を取得します。(すぐにアンロックしていただいて問題ありません)</p></li><li><p>対象のデバイスにて対象の <strong>ユーザー権限</strong> でコマンド プロンプトを起動し、次のコマンドを実行して <code>AzureAdPrt : YES</code> となっていることを確認します (管理者として実行から起動しないようご注意ください)。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dsregcmd /status</span><br></pre></td></tr></table></figure></li></ol><h2 id="anchor6">6. 事後確認: Intune の登録</h2><p><strong>この手順は Intune 登録しなければ不要です。</strong> また、反映に時間がかかることがあります。</p><ol><li> [Azure Portal (portal.azure.com)] &gt; [Azure Active Directory] &gt; [デバイス] &gt; [すべてのデバイス] で対象のデバイス オブジェクトの [MDM] の項目に値が入り [準拠している] が「はい」となっていることを確認します。</li><li>[Microsoft Intune admin center (endpoint.microsoft.com)] &gt; [デバイス] &gt; [すべてのデバイス] から該当デバイスを検索し対象デバイスの [対応] の項目が「準拠している」となっていることを確認します。</li></ol><h2 id="anchor7">7. 事後作業: WHfB の再プロビジョニング</h2><p><strong>WHfB を利用していなければ不要です。</strong></p><ol><li>端末を再起動します。</li><li>対象のユーザーでサインインすると WHfB のプロビジョニングが自動的に始まりますのでウィザードに沿ってセットアップします (ウィザードの中で多要素認証が要求されます)。</li></ol><h2 id="おわりに"><a href="#おわりに" class="headerlink" title="おわりに"></a>おわりに</h2><p>以上、HAADJ の再構成手順が運用の助けになると嬉しく思います。製品動作に関する正式な見解や回答については、お客様環境などを十分に把握したうえでサポート部門より提供しますので、ぜひ弊社サポート サービスをご利用ください。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは、Azure &amp;amp; Identity サポート チームの長谷川です。&lt;/p&gt;
&lt;p&gt;この記事では、対象デバイスのハイブリッド Azure AD 参加 (略称 HAADJ) を再構成する手順を紹介します。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Troubleshooting" scheme="https://jpazureid.github.io/blog/tags/Troubleshooting/"/>
    
    <category term="Hybrid Azure AD Join" scheme="https://jpazureid.github.io/blog/tags/Hybrid-Azure-AD-Join/"/>
    
  </entry>
  
  <entry>
    <title>「破壊的 PIN リセット」と「非破壊的 PIN リセット」の違い</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/non-destructive-pin-reset/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/non-destructive-pin-reset/</id>
    <published>2023-04-23T00:00:00.000Z</published>
    <updated>2023-04-26T02:57:31.727Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure &amp; Identity サポート チームの長谷川です。</p><p>この記事では、Windows Hello for Business における「破壊的 PIN リセット」と「非破壊的 PIN リセット」の違いについて、公開情報を補足する形で説明します。基本的には、次の公開情報に記載のある通りですが、本記事でもう少しわかりやすい説明を目指します。「破壊的 PIN リセット」と「非破壊的 PIN リセット」の意味についても下記資料に説明がございますのでご覧ください。</p><p><a href="https://learn.microsoft.com/ja-jp/windows/security/identity-protection/hello-for-business/hello-feature-pin-reset?tabs=intune">暗証番号 (PIN) のリセット</a></p><h2 id="PIN-をリセットした後のユーザー体験に違いはあるか？"><a href="#PIN-をリセットした後のユーザー体験に違いはあるか？" class="headerlink" title="PIN をリセットした後のユーザー体験に違いはあるか？"></a>PIN をリセットした後のユーザー体験に違いはあるか？</h2><p>「破壊的 PIN リセット」と「非破壊的 PIN リセット」の運用中の動作としては、ハイブリッド Azure AD 参加デバイスにおいて PIN をリセットした場合、その後に Azure AD Connect (略称 AADC) による同期が必要かどうかが大きな違いです。</p><p>キー信頼の環境で「破壊的 PIN リセット」を実行した場合、PIN がリセットされた後に AADC を介して Azure AD から オンプレミスの AD ユーザーに対して msDS-KeyCredentialLink 属性への書き戻しが行われます。これが完了するまで、新しい PIN で Windows にサインインすることはできません。つまり、キー信頼の環境で「破壊的 PIN リセット」を実行した場合、新しい PIN を利用するためには AADC の同期 (既定で 30 分間隔) を待つ必要があります。</p><p>一方、「非破壊的 PIN リセット」ではオンプレミス AD ユーザーの msDS-KeyCredentialLink 属性の値が変更されません。このため、AADC の同期を待つことなく新しい PIN ですぐにサインインすることができます。このように、「破壊的 PIN リセット」と「非破壊的 PIN リセット」では、PIN リセット後の待ち時間に違いがあります。</p><h2 id="PIN-のリセット手順に違いはあるか？"><a href="#PIN-のリセット手順に違いはあるか？" class="headerlink" title="PIN のリセット手順に違いはあるか？"></a>PIN のリセット手順に違いはあるか？</h2><p>いいえ、PIN のリセット手順に違いはありません。「破壊的 PIN リセット」と「非破壊的 PIN リセット」は、どちらも同じ手順になります。これは、<a href="https://learn.microsoft.com/en-us/windows/security/identity-protection/hello-for-business/hello-feature-pin-reset?tabs=intune#using-pin-reset">Using PIN reset</a> の公開情報にも記載があります。</p><blockquote><p>英語: Destructive and non-destructive PIN reset use the same steps for initiating a PIN reset.<br>日本語: 破壊的および非破壊的な PIN リセットでは、PIN リセットを開始するために同じ手順を使用します。</p></blockquote><p>よって、<a href="https://learn.microsoft.com/ja-jp/windows/security/identity-protection/hello-for-business/hello-feature-pin-reset?tabs=intune#reset-pin-from-settings">設定からの PIN のリセット</a> に従って次の手順で PIN をリセットした場合、「破壊的 PIN リセット」と「非破壊的 PIN リセット」のどちらになるかは構成 (後述) に依存します。</p><blockquote><ol><li>別の資格情報を使用してWindows 10にサインインします。  </li><li>[設定] を開き、[アカウントの&gt;サインイン オプション] を選択します。  </li><li>[PIN (Windows Hello)PIN を忘れた場合] &gt; を選択し、指示に従います。</li></ol></blockquote><h2 id="「破壊的-PIN-リセット」と「非破壊的-PIN-リセット」のどちらの動作になるか？"><a href="#「破壊的-PIN-リセット」と「非破壊的-PIN-リセット」のどちらの動作になるか？" class="headerlink" title="「破壊的 PIN リセット」と「非破壊的 PIN リセット」のどちらの動作になるか？"></a>「破壊的 PIN リセット」と「非破壊的 PIN リセット」のどちらの動作になるか？</h2><p>PIN 回復機能の有効/無効で、「破壊的 PIN リセット」と「非破壊的 PIN リセット」のどちらの動作になるかが変わります。</p><p>PIN 回復機能が有効/無効であるかの確認方法は、<a href="https://learn.microsoft.com/ja-jp/windows/security/identity-protection/hello-for-business/hello-feature-pin-reset?tabs=intune#confirm-that-pin-recovery-policy-is-enforced-on-the-devices">PIN 回復ポリシーがデバイスに適用されていることを確認する</a> の公開情報にまとめられています。</p><blockquote><p>PIN リセット構成は、コマンド ラインから dsregcmd /status を実行することで表示できます。この状態は、CanReset 行項目としてユーザー状態セクションの出力の下にあります。CanReset が DestructiveOnly と報告された場合、破壊的 PIN リセットのみが有効になります。CanReset で DestructiveAndNonDestructive が報告された場合、非破壊 PIN リセットが有効になります。</p></blockquote><h2 id="次のようなエラー画面が表示された場合どうしたらよいか？"><a href="#次のようなエラー画面が表示された場合どうしたらよいか？" class="headerlink" title="次のようなエラー画面が表示された場合どうしたらよいか？"></a>次のようなエラー画面が表示された場合どうしたらよいか？</h2><p>次の画像のような、エラーコード CAA20004 かつサーバー メッセージが AADSTS650052 で Microsoft Pin Reset Service Production のエラーが表示される場合があります。</p><p><img src="/blog/azure-active-directory/non-destructive-pin-reset/non-destructive-pin-reset-CAA20004.png"></p><p>この場合、<a href="https://learn.microsoft.com/ja-jp/windows/security/identity-protection/hello-for-business/hello-feature-pin-reset?tabs=intune#enable-the-microsoft-pin-reset-service-in-your-azure-ad-tenant">Azure AD テナントで Microsoft PIN リセット サービスを有効にする</a> の公開情報に沿って “PIN リセット サービス” と “PIN リセット クライアント” という 2 つのサービスの登録作業を行うことでエラーが解消されるかご確認ください。</p><blockquote><p>PIN をリモートでリセットするには、Azure Active Directory テナントに次の 2 つのアプリケーションを登録する必要があります。<br>・PIN リセット サービス<br>・PIN リセット クライアント</p></blockquote><p>上記の補足が PIN リセットの活用に役立つと嬉しく思います。上記以外で PIN のリセットに関して不明点がある場合は、是非弊社サポートまでお問い合わせください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure &amp;amp; Identity サポート チームの長谷川です。&lt;/p&gt;
&lt;p&gt;この記事では、Windows Hello for Business における「破壊的 PIN リセット」と「非破壊的 PIN リセット」の違いについて、公開情報を補足する形で</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Windows Hello for Business" scheme="https://jpazureid.github.io/blog/tags/Windows-Hello-for-Business/"/>
    
    <category term="PIN" scheme="https://jpazureid.github.io/blog/tags/PIN/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD B2C の認可コードと更新トークンのサイズが増加します</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/azure-ad-b2c-authorization-code-and-refresh-token-size-increase/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/azure-ad-b2c-authorization-code-and-refresh-token-size-increase/</id>
    <published>2023-04-20T20:00:00.000Z</published>
    <updated>2023-04-26T02:57:31.323Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 高田 です。</p><p>本記事は、2023 年 3 月 17 日に米国の Microsoft Entra (Azure AD) の Discussion で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad/azure-ad-b2c-authorization-code-and-refresh-token-size-increase/m-p/3770890">Azure AD B2C authorization code and refresh token size increase update</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p><a href="https://www.microsoft.com/ja-jp/security/business/identity-access/azure-active-directory-external-identities">Microsoft Entra (Azure Active Directory)</a> では、継続的なセキュリティ改善の取り組みの一環として、Azure AD B2C に対し、アプリケーションに返される OAuth 2.0 (および OpenID Connect) の応答フォーマットの変更を展開しました。この結果、Azure AD B2C が発行する認可コードと更新トークンのサイズが増加します。これにより、アプリケーションが OAuth 2.0 の認可コードをクエリ文字列パラメーターまたは URL フラグメントとして受け入れるように構成されている場合、ユーザーに影響が生じる可能性があります。具体的には以下のような場合が挙げられます。</p><ul><li>Internet Explorer などの古いウェブ ブラウザーを使用しているユーザーは、URL の長さの制限に抵触する可能性がある。</li><li>アプリケーションを Web サーバー上で実行している場合、特にアプリが長い URL 文字数を許容しないファイアウォールやリバース プロキシの背後にある場合、URL の長さの制限に抵触する可能性がある。</li></ul><p>OAuth 2.0 (および OpenID Connect) プロトコルでは、認可コードがアプリケーションに返される方法を、3 つの応答モード (response_mode) にて指定可能です。<strong>query</strong> および <strong>fragment</strong> モードでは、それぞれ認可コードがクエリ パラメーターおよび URL フラグメントとして返されます。<strong>form_post</strong> モードでは、応答のパラメータは HTML のフォームの値としてエンコードされ、HTML 本文にエンコードされて HTTP POST メソッドで送信されます。詳細については、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory-b2c/authorization-code-flow">Azure Active Directory B2CのOAuth 2.0 認可コード フロー</a> の記事をご確認ください。</p><p>認可コードと更新トークンのサイズが増加した結果、URL が長くなることで問題が生じた場合、これを解消するためには以下を検討ください。</p><ul><li>Web アプリケーションの場合、アプリケーションに最も安全にトークンを渡せるよう、OAuth 2.0 の response_mode を form_post に設定する。</li><li>認可コード フローと PKCE を使用するシングル ページ アプリケーションでは、アプリケーションに渡されるクレームの数を減らす。Azure AD B2C の <a href="https://learn.microsoft.com/ja-jp/azure/active-directory-b2c/configure-user-input?pivots=b2c-user-flow#provide-optional-claims-to-your-app">ユーザー フロー</a> および <a href="https://learn.microsoft.com/ja-jp/azure/active-directory-b2c/configure-user-input?pivots=b2c-custom-policy#include-a-claim-in-the-token">カスタム ポリシー</a> で、アプリケーションにとって不要なクレームがあれば、それらを削除します。<a href="https://learn.microsoft.com/ja-jp/azure/active-directory-b2c/userinfo-endpoint?pivots=b2c-custom-policy">UserInfo エンドポイント</a> を使用して、認証されたユーザーに関するクレームを返すこともご検討ください。これにより、認可コードと更新トークンのサイズが最小化され、事象を回避できると想定されます。</li><li>この変更は、モバイル アプリやデスクトップ アプリなど、デバイスにインストールされたアプリには影響しないと想定されます。</li></ul><p>この変更は、上述のとおり更新トークンのサイズにも影響します。MSAL ライブラリは、トークンを取得した後に <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/develop/msal-acquire-cache-tokens">キャッシュ</a> します。インメモリ キャッシュや <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/develop/msal-net-token-cache-serialization?tabs=aspnet#distributed-token-caches">分散トークン キャッシュ</a> を使用している Web アプリケーションでは、キャッシュの仕組みがより大きい更新トークンのサイズを処理できることを確認するか、前節で説明したように更新トークンのサイズを極力小さくするようご対応ください。</p><p>Yoel</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 高田 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 3 月 17 日に米国の Microsoft Entra (Azure AD) の Discussion で公開された &lt;a href=&quot;https://tec</summary>
      
    
    
    
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
    <category term="Azure AD B2C" scheme="https://jpazureid.github.io/blog/tags/Azure-AD-B2C/"/>
    
  </entry>
  
  <entry>
    <title>2023 State of Cloud Permissions Risks レポートを公開しました</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/2023-state-of-cloud-permissions-risks-report-now-published/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/2023-state-of-cloud-permissions-risks-report-now-published/</id>
    <published>2023-04-18T00:00:00.000Z</published>
    <updated>2023-04-26T02:57:31.259Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 五十嵐 です。</p><p>本記事は、2023 年 3 月 28 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/2023-state-of-cloud-permissions-risks-report-now-published/ba-p/1061397">2023 State of Cloud Permissions Risks report now published</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>組織がマルチクラウドのインフラを受け入れ、採用するようになったことで、3 つの主要なクラウド プラットフォーム: Microsoft Azure, アマゾン ウェブ サービス (AWS), Google Cloud Platform (GCP) において ID のアクセス許可の数が増加しています。この変化はイノベーションの新たな機会をもたらす一方で、組織がこれまで直面したことのない新たなアクセス許可に関する課題をもたらしています。</p><p>本日は、<a href="https://aka.ms/CloudPermissionsRisksReport">2023 State of Cloud Permissions Risks レポート</a> を発表できることを大変うれしく思います。本レポートでは、マルチクラウドのインフラにおける ID とアクセス許可にまつわる主要なリスク所見を取り上げています。</p><p><img src="/blog/azure-active-directory/2023-state-of-cloud-permissions-risks-report-now-published/2023-state-of-cloud-permissions-risks-report-now-published.png"></p><p>今年は、ワークロード ID とスーパー管理者について、驚くべき知見が見つかりました。これらのリスクを見て、改善策を探っていきましょう:</p><p><strong>ワークロード ID</strong></p><p>今日のマルチクラウドの世界では、マルチクラウドのインフラにアクセスするのはもはや人間の ID だけではありません。アプリ、VM、スクリプト、コンテナ、サービスなど、クラウド上で動作するワークロード ID の数は指数関数的に増加しており、今や人間の ID の数を 10 対 1 で上回っています。</p><p>さらに、非アクティブなワークロード ID の平均割合は 80% に上っており、これは 2021 年から倍増しており、付与されたアクセス許可のうちワークロード ID が使用しているのは 5% 未満です。このリスクを低減するために、最近 Microsoft Entra ワークロード ID 内で <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/reports-monitoring/recommendation-remove-unused-apps">アプリの正常性に関する推奨事項</a> のプレビューを開始し、非アクティブなアプリや期限切れの認証情報を簡単に特定できるようにしました。</p><p>クラウド インフラにアクセスするワークロード ID が増加する中、組織はそのアクセスを監視し、侵害のリスクを低減することが重要です。</p><p><strong>スーパー管理者</strong></p><p>スーパー管理者は、すべてのアクセス許可とすべてのリソースにアクセスできる人間またはワークロードの ID です。スーパー管理者はサービスに対する構成の作成と変更、ID の追加と削除、データへのアクセスと削除さえも行うことができます。これは非常に強すぎる権限ですが、私たちの調査では、このスーパー管理者に付与された権限のうち、実際に使用されているのは 2% 未満であり、スーパー管理者の 40% はワークロード ID であることが判明しました。</p><p>監視されないまま放置されたこれらの ID は、侵害された場合、アクセス許可が悪用される重大なリスクとなります。</p><h2 id="マルチクラウドにおける権限のリスクの管理と修復"><a href="#マルチクラウドにおける権限のリスクの管理と修復" class="headerlink" title="マルチクラウドにおける権限のリスクの管理と修復"></a>マルチクラウドにおける権限のリスクの管理と修復</h2><p>アクセス許可のギャップを解消し、権限の誤用のリスクを減らすには、組織が最小特権の原則を実施する必要があります。これは、マルチクラウド環境におけるすべての人間およびワークロードの ID に対して一貫して行われる必要があります。組織は、クラウド インフラストラクチャ エンタイトルメント管理 (CIEM) ソリューションを採用し、マルチクラウドにまたがるすべての一意なユーザーおよびワークロード ID の活動を継続的に発見、修復、監視することによって、クラウド規模でこれを実現することが必要です。</p><p>マイクロソフトの CIEM ソリューションである Microsoft Entra Permissions Management は以下の 3 つの方法でクラウド上のアクセス許可に起因したマルチクラウドの攻撃範囲の拡大を防ぎます:</p><ol><li>発見する: アクセス許可のリスクを評価し、どのような ID がいつ、どこで、何をしたかを特定します。</li><li>修復する: 最小特権の原則を実現するために、必要に応じた Just-In-Time の権限付与を行います。</li><li>監視する: セキュリティの脅威を防ぐために、クラウド上での権限の使用状況を継続的に監視します。</li></ol><p>Microsoft Entra Permission Management を通じ、弊社ではマルチクラウド環境全体で特に懸念されるアクセス許可のリスクを特定するためのマルチクラウドのリスク評価を無料で提供しています。マルチクラウドでのアクセス許可のリスクについての詳細は、<a href="https://aka.ms/CloudPermissionsRisksReport">2023 State of Cloud Permissions Risks レポート</a> をダウンロードしてご覧ください。また、今すぐ無料のリスク評価を開始することでインフラの安全確保への第一歩を踏み出してください。</p><ul><li>2023 State of Cloud Permissions Risks レポートは <a href="https://aka.ms/CloudPermissionsRisksReport">こちら</a></li><li>クラウド権限リスクが組織に与える影響について詳しくは <a href="https://aka.ms/PermissionRisksInfographic">こちら</a></li><li>Microsoft Entra Permission Management について詳しくは <a href="https://www.microsoft.com/ja-jp/security/business/identity-access/microsoft-entra-permissions-management">こちら</a> </li><li><a href="https://aka.ms/TryPermissionsManagement">マルチクラウドのリスク評価を無料で開始しましょう！</a> </li></ul><p>Alex Simons (@Alex_A_Simons)<br>Corporate Vice President of Program Management<br>Microsoft Identity Division</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 五十嵐 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 3 月 28 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techc</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD DS におけるカスタム属性がパブリック プレビューになりました</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/custom-attribute-aadds-preview/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/custom-attribute-aadds-preview/</id>
    <published>2023-04-17T00:00:00.000Z</published>
    <updated>2023-04-26T02:57:31.487Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。 Azure ID チームの小出です。</p><p>本記事は、2023 年 3 月 30 日に公開されました <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/custom-attributes-for-azure-active-directory-domain-services-now/ba-p/3778049">Custom attributes for Azure Active Directory Domain Services now in Public Preview</a> の記事を日本語に意訳した内容になります。ご不明点などございましたらお気軽にサポートまでお問い合わせください。</p><hr><p>皆さん、こんにちは！</p><p>今日は、Azure Active Directory Domain Services (Azure AD DS) インスタンスの新しい機能拡張をご紹介します。 </p><p><img src="/blog/azure-active-directory/custom-attribute-aadds-preview/custom-attribute-aadds-preview1.png"></p><p>この新機能により、Azure AD DS マネージド ドメインで、カスタム属性を使用することができるようになります。 </p><h2 id="カスタム属性-パブリック-プレビュー"><a href="#カスタム属性-パブリック-プレビュー" class="headerlink" title="カスタム属性 (パブリック プレビュー)"></a>カスタム属性 (パブリック プレビュー)</h2><p>様々な理由から、企業はレガシー アプリのコードを修正しない、または修正できないことがよくあります。これらのレガシー アプリでは、ディレクトリのカスタム従業員 ID などのカスタム属性を利用し、アプリの LDAP 呼び出しでこれらの属性を活用している場合もあると思います。Azure Active Directory (Azure AD) は、これらの拡張ユーザー属性を onPremisesExtensionAttributes という属性セットに格納し (Azure AD Connect 経由で構成した場合)、拡張アプリ属性を Directory Extensions という機能に格納しています。しかしながら、これら 2 つの拡張セットはどちらも、以前は Azure AD Domain Services に同期されていませんでした。  </p><p>Azure AD DS で Azure AD からカスタム属性/拡張機能を同期できるようにすることで、これまで移行できなかったカスタム属性/拡張機能に依存するアプリをすべて移行できるようになり、より多くのお客様に Azure AD DS をご利用いただけるようになりました。</p><p><img src="/blog/azure-active-directory/custom-attribute-aadds-preview/custom-attribute-aadds-preview2.png"></p><p>カスタム属性の詳細については、こちらのドキュメントを参照ください: <a href="https://learn.microsoft.com/ja-jp/azure/active-directory-domain-services/concepts-custom-attributes">Azure AD Domain Services のカスタム属性の作成と管理</a></p><p>Azure AD DS は、今後も多くの発表を控えています！Azure ADですべてのアプリをよりシンプルに管理できるようにするため、最新のアップデートにご注目ください。</p><p>いつもどおり、皆様からのフィードバックや提案をお待ちしております。ご意見がございましたら、Twitter (<a href="https://twitter.com/azuread">@AzureAD</a>) までお寄せください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。 Azure ID チームの小出です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 3 月 30 日に公開されました &lt;a href=&quot;https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-bl</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD のメンバー ユーザーとゲスト ユーザー</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/member-and-guest-user/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/member-and-guest-user/</id>
    <published>2023-04-16T01:00:00.000Z</published>
    <updated>2023-04-26T02:57:31.647Z</updated>
    
    <content type="html"><![CDATA[<div class="alert is-info"><p class="alert-title">Note</p><p>本記事は Technet Blog の更新停止に伴い <a href="https://blogs.technet.microsoft.com/jpazureid/2017/12/12/azuread-member-guest/">https://blogs.technet.microsoft.com/jpazureid/2017/12/12/azuread-member-guest/</a> の内容を移行したものです。</p><p>元の記事の最新の更新情報については、本内容をご参照ください。</p></div><div class="alert is-info"><p class="alert-title">Note</p><p>2017/12/12: 本記事の初版を投稿</p><p>2018/02/26: Microsoft Connect のリタイアに伴い MSOnline モジュールのダウンロードができなくなったため記載を変更</p><p>2018/10/31: メンバーとゲストの既定のアクセス許可の比較情報のリンクを追加</p><p>2023/04/16: Msol コマンドのリタイアに伴い Microsoft Graph コマンドでの実施方法に更新  </p></div><p>こんにちは、Azure &amp; Identity サポート チームの三輪です。</p><p>Azure AD に所属しているユーザーの種類として、下記のように「メンバー」と「ゲスト」があります。今回は、こちらのユーザーの種類について説明します。</p><p><img src="/blog/azure-active-directory/member-and-guest-user/member-and-guest-new.png"></p><h2 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h2><p>下記のように、個人アカウントや別テナントの職場または学校アカウント (組織アカウント) を追加した (Azure AD B2B の機能を利用した) 場合に、ユーザーの種類が「ゲスト」として追加されます。</p><p><img src="/blog/azure-active-directory/member-and-guest-user/personal-work-account.png"></p><p>これ以外の Azure のサブスクリプションのサインアップで利用した個人アカウントや組織内のドメイン (上記の例の場合: contso.com) をユーザー名 (例: <a href="mailto:&#116;&#x65;&#115;&#x74;&#x40;&#x63;&#x6f;&#110;&#116;&#x6f;&#x73;&#x6f;&#46;&#99;&#111;&#109;">&#116;&#x65;&#115;&#x74;&#x40;&#x63;&#x6f;&#110;&#116;&#x6f;&#x73;&#x6f;&#46;&#99;&#111;&#109;</a>) に持つユーザーは「メンバー」として登録されます。また、現在は利用できないクラシック ポータル (旧ポータル) より追加した外部ユーザーについては「メンバー」として登録されております。</p><h2 id="詳細"><a href="#詳細" class="headerlink" title="詳細"></a>詳細</h2><p>既定ではゲスト ユーザーに対しては、 Azure AD のデータへのアクセスが制限されています。このため、ゲスト ユーザーで Azure AD テナントにサインインした場合、招待された Azure AD のユーザーの一覧を参照することはできませんし、各種設定の参照および変更も制限されています。もちろん、サブスクリプションに対する権限を付与していない場合は、サブスクリプションのリソースを操作することもできません。一般ユーザーとゲスト ユーザーがそれぞれできること (アクセス許可の比較) は、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/users-default-permissions#compare-member-and-guest-default-permissions">こちら</a>をご参照ください。</p><p><img src="/blog/azure-active-directory/member-and-guest-user/access-denied-new.png"></p><p><img src="/blog/azure-active-directory/member-and-guest-user/no-access-permission-new.png"></p><p>ゲストに対するアクセス制限は、[すべてのユーザー] - [ユーザー設定] - [外部コラボレーションの設定を管理します] と辿り [ゲストのアクセス制限] で変更できます。この設定が “ゲスト ユーザーは、ディレクトリ オブジェクトのプロパティとメンバーシップへのアクセスが制限されます” (既定値) の場合には「ゲスト」の操作は上記のように制限されています。外部コラボレーションの設定については、<a href="https://jpazureid.github.io/blog/azure-active-directory/external-collaboration-setting-b2b-access/">こちら</a> をご参照ください。</p><p><img src="/blog/azure-active-directory/member-and-guest-user/guest-users-permissions-are-limited1-new.png"></p><p><img src="/blog/azure-active-directory/member-and-guest-user/guest-users-permissions-are-limited2-new.png"></p><p>ユーザーの属性については、Azure ポータル上での操作、または PowerShell の実行により、メンバーからゲスト、またその逆についても変更が可能です。ゲストからメンバーに変更する際は「ゲスト」に対して行っていた制御の対象外のユーザーとなるため、セキュリティ ポリシーに沿った対応や特定のユーザーに絞った設定変更をお勧め致します。</p><h2 id="ユーザー-タイプの変更手順"><a href="#ユーザー-タイプの変更手順" class="headerlink" title="ユーザー タイプの変更手順"></a>ユーザー タイプの変更手順</h2><h3 id="Azure-ポータル上の操作で該当ユーザーを-ゲストからメンバーに変更する手順"><a href="#Azure-ポータル上の操作で該当ユーザーを-ゲストからメンバーに変更する手順" class="headerlink" title="Azure ポータル上の操作で該当ユーザーを ゲストからメンバーに変更する手順"></a>Azure ポータル上の操作で該当ユーザーを ゲストからメンバーに変更する手順</h3><ol><li>管理者権限で Azure ポータルにサインインします。</li><li>Azure Active Directory を開き、[ユーザー] を開きます。</li><li>ユーザー タイプを変更したいユーザーを開きます。</li><li>[プロパティの編集] をクリックします。<br>ユーザーの種類のタブを [メンバー] に変更し、[保存] をクリックします。</li></ol><h3 id="PowerShell-を実行して該当ユーザーをゲストからメンバーに変更する手順"><a href="#PowerShell-を実行して該当ユーザーをゲストからメンバーに変更する手順" class="headerlink" title="PowerShell を実行して該当ユーザーをゲストからメンバーに変更する手順"></a>PowerShell を実行して該当ユーザーをゲストからメンバーに変更する手順</h3><p>この作業を実施するためには、Azure AD 用の PowerShell を利用する必要がありますが、 PowerShell を利用する際には Microsoft アカウントではなく、組織アカウントでのグローバル管理者が必要です (Azure AD の PowerShell については <a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement3/">リンク</a> も参照ください)。そのために次の手順で実施する必要があります。</p><ol><li>Azure AD のグローバル管理者アカウントを作成する (※すでに組織アカウントのグローバル管理者が存在する場合はスキップ)</li><li>PowerShell を実行し、該当ユーザーを Guest から Member に変更する</li></ol><p>まず、1. の手順として、Azure AD のグローバル管理者アカウントを作成します。すでに組織アカウントのグローバル管理者が存在する場合はスキップください。</p><ol><li>[ユーザー] - [＋新しいユーザー] と辿り、 [ 新しいユーザーの作成]  をクリックします。</li><li>ユーザー名と名前欄に admin などの任意の値を入力します。</li><li>[役割]をクリックし、ディレクトリ ロール欄で “グローバル管理者” を選択し、 [選択] をクリックします。</li><li>“パスワードを表示” をクリックし、パスワードを控えて [作成] をクリックします。</li></ol><p>次に、2. の手順として、PowerShell を実行し、該当ユーザーを Guest から Member に変更します。以下の手順を順に実行ください。</p><ol><li><p>PowerShell を起動します。</p><p> ※ モジュールの入手方法については、弊社<a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement3/">ブログ</a> をご参照ください。Graph PowerShell SDK のモジュールの利用をお願いします。</p></li><li><p>以下のコマンドを実行します。</p><p> Connect-MgGraph -Scope “User.ReadWrite.All”</p></li><li><p>資格情報の入力を求められるため、1 で作成したアカウントの情報を入力します。パスワードの変更が求められるはずですので、パスワードを新しく設定します。</p></li><li><p>以下のコマンドを実行して、対象ユーザーの UserPrincipalName および UserType 属性値を確認します。</p> <figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-MgUser</span> <span class="literal">-All</span> <span class="literal">-Property</span> UserPrincipalName,UserType | <span class="built_in">Format-Table</span> UserPrincipalName,UserType</span><br></pre></td></tr></table></figure><p> 出力例:</p> <figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">UserPrincipalName                             UserType</span><br><span class="line">user_live.com<span class="comment">#EXT#@contoso.onmicrosoft.com    Guest  -&gt; 「Guest」 であることが確認できます。</span></span><br></pre></td></tr></table></figure></li><li><p>以下のコマンドを実行して、対象ユーザーの UserType を 「Member」 に変更します。</p> <figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Update-MgUser</span> <span class="literal">-UserId</span> &lt;対象ユーザーの オブジェクトID または UserPrincipalName&gt; <span class="literal">-UserType</span> Member</span><br></pre></td></tr></table></figure><p> 実行例:</p> <figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Update-MgUser</span> <span class="literal">-UserId</span> user_live.com<span class="comment">#EXT#@contoso.onmicrosoft.com -UserType Member</span></span><br></pre></td></tr></table></figure></li><li><p>再度以下のコマンドを実行して、対象ユーザーの UserType を確認します。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-MgUser</span> <span class="literal">-All</span> <span class="literal">-Property</span> UserPrincipalName,UserType | <span class="built_in">Format-Table</span> UserPrincipalName,UserType</span><br></pre></td></tr></table></figure><p>出力例:</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">UserPrincipalName                             UserType</span><br><span class="line">user_live.com<span class="comment">#EXT#@contoso.onmicrosoft.com    Member  -&gt; 変更されたことを確認します。</span></span><br></pre></td></tr></table></figure></li></ol><p>なお、「Member」から「Guest」に変更する場合は、UserType に「Guest」を指定します。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Update-MgUser</span> <span class="literal">-UserId</span> &lt;対象ユーザーの オブジェクトID または UserPrincipalName&gt; <span class="literal">-UserType</span> Guest</span><br></pre></td></tr></table></figure><p>上記内容が少しでも皆様の参考となりますと幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;alert is-info&quot;&gt;&lt;p class=&quot;alert-title&quot;&gt;Note&lt;/p&gt;&lt;p&gt;本記事は Technet Blog の更新停止に伴い &lt;a href=&quot;https://blogs.technet.microsoft.com/jpazure</summary>
      
    
    
    
    
    <category term="Azure AD B2B" scheme="https://jpazureid.github.io/blog/tags/Azure-AD-B2B/"/>
    
  </entry>
  
  <entry>
    <title>Azure ポータルへのアクセス制限</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/access-restriction-azure-portal/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/access-restriction-azure-portal/</id>
    <published>2023-04-16T00:30:00.000Z</published>
    <updated>2023-04-26T02:57:31.295Z</updated>
    
    <content type="html"><![CDATA[<div class="alert is-info"><p class="alert-title">Note</p><p>本記事は Technet Blog の更新停止に伴い <a href="https://blogs.technet.microsoft.com/jpazureid/2017/12/29/azuread-portal/">https://blogs.technet.microsoft.com/jpazureid/2017/12/29/azuread-portal/</a> の内容を移行したものです。</p><p>元の記事の最新の更新情報については、本内容をご参照ください。</p></div><div class="alert is-info"><p class="alert-title">Note</p><p>2017-12-29: 本記事の初版を投稿</p><p>2023-04-16: MSOL コマンドのリタイアに伴い内容を全体的に更新</p></div><p>こんにちは、Azure &amp; Identity サポート チームの三輪です。</p><p>今回は、一般ユーザーに対して Azure ポータルへのアクセスを制限する方法について紹介します。</p><p>Azure ポータル (<a href="https://portal.azure.com/">https://portal.azure.com</a>) には、サブスクリプションの有無によらずログインすることが可能です。この動作変更により、ユーザーが簡単に Azure に対してアクセスできるようになっています。</p><p>Azure ポータルからは、そのログインしたユーザーが所属する Azure AD ディレクトリにアクセスすることができ、このとき Azure AD に対しての管理者権限を持たない一般ユーザーであっても、既定では Azure AD に登録されているユーザーの一覧を参照できるようになっています。これは <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/users-default-permissions">ドキュメント</a> にも記載されていることで、一般ユーザーは他のユーザーの基本情報を見ることが可能であり、この動作自体は Azure AD で想定されるものです。</p><p>Azure ポータルへ一般ユーザーがアクセスできたとしても、一般ユーザーの権限以上のことはできません。例えば、テナントやユーザーの構成を変更したり、詳細を確認することはできません。上述のとおり、他のユーザーの一覧 (基本情報) を確認することは既定で可能ですが、これは Office 365 を利用する中で他のユーザーを参照できるのと同等です。Azure AD は組織内のユーザーの認証とコラボレーションを促進するディレクトリ サービスであるため、他のユーザーが参照できることはその機能の一部であり問題ではありません。</p><p>Azure ポータルへのアクセスを制限しても、ユーザーは Office 365 のサービス (Exchange や Teams) を利用して他のユーザーの情報を確認可能であることにご注意ください。また、Azure AD 以外の項目、例えば仮想マシンなどのリソースに対しては、サブスクリプションの権限を明示的に付与しない限りは、各ユーザーは参照することもできませんのでご安心ください。</p><p>ただし、上記を踏まえてもお客様の運用形態によっては、Azure ポータル上やその他の方法で他のユーザーの一覧が見えてしまうことが運用上好ましくない場合もあると思います。今回は、このような一般ユーザーによる他のユーザーの参照や管理ツールへのアクセスをできる限り制限する方法についておまとめしました。</p><h2 id="Azure-ポータルを含めた-Azure-の管理ツール全般へのアクセスを制限する方法"><a href="#Azure-ポータルを含めた-Azure-の管理ツール全般へのアクセスを制限する方法" class="headerlink" title="Azure ポータルを含めた Azure の管理ツール全般へのアクセスを制限する方法"></a>Azure ポータルを含めた Azure の管理ツール全般へのアクセスを制限する方法</h2><p>Azure ポータルやその他 Azure CLI など管理ツールへのアクセスを限られたユーザーのみに制限する方法としては、条件付きアクセスの機能を利用することがおすすめです。条件付きアクセスの機能を利用するためには Azure AD Premium (P1 or P2) のライセンスが制御対象のユーザー分必要となります。</p><ol><li><p>Azure ポータル (<a href="https://portal.azure.com/">https://portal.azure.com</a>) に管理者のアカウントでアクセスします。</p></li><li><p>[セキュリティ] から [条件付きアクセス] – [ポリシー] の順にクリックします。</p></li><li><p>上部 [+ 新しいポリシー] をクリックします。</p></li><li><p>[名前] にポリシーの名前を入力します。</p></li><li><p>ポリシーを割り当てるユーザーまたはグループを選択します。</p><p> この時、ポリシーを全ての管理者に割り当てないようご注意ください。全ての管理者がポリシーの制限を受け、Azure ポータルにアクセスすることができなくなります。結果として、設定解除もできなくなるというお問い合わせを過去に複数いただいております。</p></li><li><p>[クラウド アプリ] では 「アプリを選択」にチェックを入れます。</p></li><li><p>[選択] では、[Microsoft Azure Management] アプリケーションを検索し、選択します。</p><p>追加の条件を設定する場合は [条件] にてポリシーが適用される条件を選択します。条件を選択しない場合、すべてのアクセスが対象となります。</p></li><li><p>[アクセス制御] の [許可] で「アクセスのブロック」を選択して、[選択] をクリックします。</p></li><li><p>即時ポリシーを有効化する場合には、ポリシーの有効化で [オン] を選択し、[作成] をクリックします。</p></li></ol><p>該当ユーザーで Azure ポータルへアクセスすると下記の画面が表示され、アクセスがブロックされます。</p><p><img src="/blog/azure-active-directory/access-restriction-azure-portal/access-restricted.png"></p><div class="alert is-important"><p class="alert-title">重要</p><p><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-conditional-access-cloud-apps#microsoft-azure-management">Microsoft Azure Management</a> は複数のサービスが対象となっており、これへのアクセスをブロックすると、Azure ポータル以外にも Azure CLI などを利用したサブスクリプションへのアクセスがブロックされる点にご留意ください。</p></div><h2 id="Azure-AD-管理ポータルへのアクセスを制限する方法"><a href="#Azure-AD-管理ポータルへのアクセスを制限する方法" class="headerlink" title="Azure AD 管理ポータルへのアクセスを制限する方法"></a>Azure AD 管理ポータルへのアクセスを制限する方法</h2><p>これは Azure AD の管理者 (グローバル管理者または制限付き管理者) を与えられていないユーザーによるポータル内 [Azure Active Directory] へのアクセスを制限する方法です。以下の手順で構成いただけます。本設定は、Azure ポータル上のアクセス制限になるため、設定完了後も PowerShell や Azure CLI を使用すれば、ユーザーの一覧は参照できます。</p><ol><li>グローバル管理者として Azure ポータル (<a href="https://portal.azure.com/">https://portal.azure.com</a>) にサインインします。</li><li>[Azure Active Directory] を開きます。</li><li>表示されたメニューから [ユーザー設定] をクリックします。</li><li>右側にある [管理ポータル] - [Azure AD 管理ポータルへのアクセスを制限する] の項目で [はい] を選択します。</li><li>上にある [保存] をクリックします。</li></ol><p>※ 上記 4. で [はい] を選択することで管理者以外の一般ユーザーは、Azure ポータル内での [Azure Active Directory] にアクセスしようとすると、下記の画面が表示されアクセス権がなくなります。</p><p><img src="/blog/azure-active-directory/access-restriction-azure-portal/no-access.png"></p><h2 id="Microsoft-Graph-API-でユーザーの一覧を取得できなくする方法"><a href="#Microsoft-Graph-API-でユーザーの一覧を取得できなくする方法" class="headerlink" title="Microsoft Graph API でユーザーの一覧を取得できなくする方法"></a>Microsoft Graph API でユーザーの一覧を取得できなくする方法</h2><p>上述のとおり、Azure AD では他のユーザーの一覧 (基本情報) を確認することが既定で可能であり、これは想定される動作です。ただし、学校など運用形態によっては、コマンドなどでユーザーが他のユーザーを一覧で取得できることが好ましくない状況もあると存じます。この場合、以下の設定を使用することで、他のユーザーの読み取りをある程度制限可能です。本設定をご利用の際は検証用のテナントで動作を確認したうえで、運用テナントでの利用を検討ください。</p><p>この設定を有効にするためには、Azure AD 用の PowerShell を利用する必要があります。PowerShell を利用する際には組織アカウントのグローバル管理者が必要です (Azure AD の PowerShell については <a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement3/">リンク</a> も参照ください)。</p><ol><li><p>PowerShell を開き、下記のコマンドでグローバル管理者で Azure AD に接続します。</p> <figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Connect-MgGraph</span> <span class="literal">-Scopes</span> Policy.ReadWrite.Authorization</span><br></pre></td></tr></table></figure></li><li><p>下記コマンドで現在の設定を確認します。    </p>  <figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">(<span class="built_in">Get-MgPolicyAuthorizationPolicy</span>).DefaultUserRolePermissions | <span class="built_in">fl</span></span><br></pre></td></tr></table></figure><p> AllowedToReadOtherUsers が該当の設定になります。 True になっていることを確認します。</p><p> <img src="/blog/azure-active-directory/access-restriction-azure-portal/ps-1.png"></p></li><li><p>下記コマンドで他のユーザーの情報を取得させないように設定します。</p> <figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$params</span>=<span class="selector-tag">@</span>&#123;</span><br><span class="line">    defaultUserRolePermissions = <span class="selector-tag">@</span>&#123;</span><br><span class="line">    allowedToReadOtherUsers = <span class="variable">$false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">Update-MgPolicyAuthorizationPolicy</span> <span class="literal">-BodyParameter</span> <span class="variable">$params</span></span><br></pre></td></tr></table></figure></li><li><p>再度、下記コマンドで他のユーザーの情報を取得させないように設定されたか確認します。</p> <figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">(<span class="built_in">Get-MgPolicyAuthorizationPolicy</span>).DefaultUserRolePermissions | <span class="built_in">fl</span></span><br></pre></td></tr></table></figure><p> AllowedToReadOtherUsers が False に変更されたことを確認します。</p><p> <img src="/blog/azure-active-directory/access-restriction-azure-portal/ps-2.png"></p></li></ol><h2 id="補足-ゲスト-ユーザーのアクセス権"><a href="#補足-ゲスト-ユーザーのアクセス権" class="headerlink" title="補足: ゲスト ユーザーのアクセス権"></a>補足: ゲスト ユーザーのアクセス権</h2><p>外部から追加したゲスト ユーザーについては既定で Azure AD へのアクセスが制限されています。ゲストとメンバー の違いについては、<a href="https://jpazureid.github.io/blog/azure-active-directory/member-and-guest-user/">こちら</a> を参照ください。</p><h2 id="補足-Azure-サブスクリプションの作成権限の制御"><a href="#補足-Azure-サブスクリプションの作成権限の制御" class="headerlink" title="補足: Azure サブスクリプションの作成権限の制御"></a>補足: Azure サブスクリプションの作成権限の制御</h2><p>既定では Azure ポータルにユーザーがサインインすることで、自由に新規サブスクリプションを作成することが可能です。ここで作成されるサブスクリプションはそのユーザーが新たに自身のクレジット カードを登録して利用するものです。つまり、会社のサブスクリプションのリソースや課金観点において影響はありません。</p><p>Azure AD のグローバル管理者においては下記の設定で、自身が管理する Azure AD に紐づく全サブスクリプションを確認可能です。</p><ol><li>グローバル管理者として Azure ポータル (<a href="https://portal.azure.com/">https://portal.azure.com</a>) にサインインします。</li><li>左側のメニューから [Azure Active Directory] をクリックします。</li><li>表示されたメニューから [プロパティ] をクリックします。</li><li>[Azure リソースのアクセス管理] より、[すべての Azure サブスクリプションおよび管理グループへのアクセスを管理できます] を [はい] に設定します。</li><li>上にある [保存] をクリックします。</li></ol><p>上記内容が少しでも皆様の参考となりますと幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;alert is-info&quot;&gt;&lt;p class=&quot;alert-title&quot;&gt;Note&lt;/p&gt;&lt;p&gt;本記事は Technet Blog の更新停止に伴い &lt;a href=&quot;https://blogs.technet.microsoft.com/jpazure</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
  </entry>
  
  <entry>
    <title>MSOnline / AzureAD PowerShell から Graph PowerShell SDK への移行について 4_ユーザー管理</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement4/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement4/</id>
    <published>2023-04-14T00:00:00.000Z</published>
    <updated>2023-04-26T02:57:31.379Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure Identity サポート チームの小出です。</p><p>この記事は、この記事は、MSOnline / AzureAD モジュール廃止について、<a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement1/">1. 概要編</a>、<a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement2/">2. 移行導入編</a>、<a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement3/">3. インストール・接続編</a> の続きとして連載しています。</p><p>4 回目となる今回からは、具体的に、新しい Microsoft Graph PowerShell SDK を使用したユーザーの管理方法についてご案内します。以前、<a href="https://jpazureid.github.io/blog/azure-active-directory/operating-license-with-microsoft-graph/">こちらの記事</a> にて、ライセンス管理についてご案内させていただきましたが、今回はユーザー管理に特化してご紹介します。まだモジュールをインストールしていない場合や、 Connect-MgGraph コマンドを使用した接続方法が分からない場合などは、本シリーズの 2 と 3 をご確認ください。</p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ol><li><a href="#idx1">ユーザーの取得</a><ul><li><a href="#idx1-1">テナントの全ユーザーを取得したい</a></li><li><a href="#idx1-2">特定のユーザーを取得したい</a></li><li><a href="#idx1-3">ゲスト ユーザーのみを取得したい)</a></li><li><a href="#idx1-4">アカウントが有効なゲスト ユーザーのみを取得したい)</a></li><li><a href="#idx1-5">特定のユーザーの extensionAttribute の値を取得したい</a></li><li><a href="#idx1-6">削除済みユーザーを取得したい</a></li></ul></li><li><a href="#idx2">ユーザーの作成</a></li><li><a href="#idx3">ユーザーの削除</a></li><li><a href="#idx4">削除済みユーザーの完全削除と復元</a></li><li><a href="#idx5">ユーザーの属性を更新する</a></li><li><a href="#idx6">よくある質問</a></li></ol><hr><h2 id="idx1">1. ユーザーの取得</h2><p>これまでユーザー情報の取得にし使用していた Get-MsolUser や Get-AzureADUser コマンドは、 Get-MgUser コマンドに置き換えられます。ここでは様々なシナリオでユーザーを取得する方法についてご紹介します。</p><h3 id="idx1-1">テナントの全ユーザーを取得したい</h3><p>全てのユーザーを取得するには、-All オプションを使用します。Get-AzureADUser コマンドでは、-All $true とする必要がありましたが、新しいコマンドでは -All のみで動作します。-All を指定しない場合は、100 ユーザーなど一部の結果のみが返されます。 ユーザー数の非常に多い環境では -All オプションをつけると大量の結果が表示されますのでご注意ください。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgUser -All</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-1.png"></p><h3 id="idx1-2">特定のユーザーを取得したい</h3><p>これまでのコマンドと同様に、 ObjectID や UPN を指定することで取得が可能です。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgUser -UserId admin@m365x219253.onmicrosoft.com</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-2.png"></p><p>上記で気になった方もいると思いますが、Usertype の中身が空になっていることにお気づきでしょうか。Get-MsolUser コマンドや Get-AzureADUser コマンドでは、何も指定しなくても、すべての属性の情報が一括で出力されていました。</p><p> Microsoft Graph Powershell SDK では、属性によって下記のような特徴がある点を理解しておくと、「入れたはずの値が表示されない」といった混乱を避けることができます。</p><ul><li>Microsoft Graph PowerShell SDK にはバージョンがあり、v1.0 で取得できる属性値 beta でしか取得できない属性値がある</li><li>Property オプションを使用して明示的に指定しないと、結果に表示されないものがある</li></ul><p>そのため、たとえば下記のように実行すると、Usertype 属性が取得できるようになります。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgUser -UserId admin@m365x219253.onmicrosoft.com -Property Id,Displayname,Mail,UserPrincipalName,Usertype</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-3.png"></p><p>これは、| format-list を利用したときも同様で、| format-list 自体は新しいモジュールでも機能しますが、下記のように、必要な情報が出てこないことがあります。</p><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-4.png"></p><p>AccountEnabled に値が入っていない！と疑問に思うかもしれませんが、Usertype と同様に下記のように実行すると、AccountEnabled の値も取得することが可能です。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgUser -UserId 30a4a94b-9bca-4141-94d2-2dd0e2cc341b -Property Id,Displayname,Mail,UserPrincipalName,Usertype,AccountEnabled | fl</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-5.png"></p><p>もしくは、上記にて紹介した -Property オプションを使用したうえで、さらに Select を使用すると、表示される属性と値をカスタマイズできます。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgUser -UserId 2e7c8a97-ab50-4e53-b193-be3ff9ddc6aa -Property Id,Displayname,Mail,UserPrincipalName,Usertype,AccountEnabled | select displayname,accountenabled</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-6.png"></p><p>次に、-Filter オプションをはじめとするオプションを活用できます。よくお問い合わせをいただく取得方法についてご案内します。</p><h3 id="idx1-3">ゲスト ユーザーのみを取得したい</h3><p>特定の条件を満たすユーザーのみを取得したい場合は -Filter オプションを使用します。usertype が Guest となっているユーザーをフィルターして表示しています。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgUser -All  -Filter &quot;usertype eq &#x27;Guest&#x27;&quot; -Property Id,displayname,Mail,Userprincipalname,Usertype</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-7.png"></p><h3 id="idx1-4">アカウントが有効なゲスト ユーザーのみを取得したい</h3><p>-Filter の条件を 2 つ以上記載したいときは and でつなげると利用できます。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgUser -Filter &quot;accountEnabled eq true and usertype eq &#x27;Guest&#x27;&quot;</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-8.png"></p><h3 id="idx1-5">特定のユーザーの extensionAttribute の値を取得したい</h3><p>ExtensionAttribute1 などの属性は、ユーザーの onpremisesExtensionAttributes の配下に用意されているので、下記のように実行して取得します。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(get-mguser -UserId 4e6bc6e4-d6e7-4bd8-9079-3393e12dcec3).onpremisesExtensionAttributes | fl</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-9.png"></p><p>こちらは beta のみ対応しておりますので、Connect-MgGraph での接続後、本コマンド実行前に Select-Mgprofile -name beta にてベータに切り替えを実施ください。</p><h3 id="idx1-6">削除済みユーザーを取得したい</h3><p>削除済みのオブジェクトを取得するコマンドは、Get-MgDirectoryDeletedItem です。-DirectoryObjectID オプションに microsoft.graph.user と記載すると、削除されたユーザー オブジェクトが返されます (これらは、いわゆるごみ箱にある状態のユーザーで、30 日後に完全に削除されると参照できなくなります)。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(Get-MgDirectoryDeletedItem -DirectoryObjectId microsoft.graph.user).AdditionalProperties.value</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-10.png"></p><p>利用可能なパラメーターは Filter 以外にもありますが、各属性によってサポートされるオプションが異なります。下記のような公開情報を確認いただき、使用したい属性とオプションがサポートされているか、あらかじめご確認ください。</p><ul><li><a href="https://learn.microsoft.com/ja-jp/graph/api/resources/user?view=graph-rest-1.0#properties">user リソースの種類 - プロパティ</a></li><li><a href="https://learn.microsoft.com/ja-jp/graph/api/user-list?view=graph-rest-1.0&tabs=powershell#optional-query-parameters">ユーザーを一覧表示する - オプションのクエリ パラメーター</a></li></ul><h2 id="idx2">2. ユーザーの作成</h2><p>下記のように必要なパラメーターを記載して、 New-Mguser を使用すると新しいユーザーを作成できます。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$params = @&#123;</span><br><span class="line">AccountEnabled = $true</span><br><span class="line">DisplayName = &quot;Adele Vance22&quot;</span><br><span class="line">MailNickname = &quot;AdeleV22&quot;</span><br><span class="line">UserPrincipalName = &quot;AdeleV22@m365x61971868.onmicrosoft.com&quot;</span><br><span class="line">PasswordProfile = @&#123;</span><br><span class="line">ForceChangePasswordNextSignIn = $true</span><br><span class="line">Password = &quot;xWwvJ]6NMw+bWH-d11&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">New-MgUser -BodyParameter $params</span><br></pre></td></tr></table></figure><p>もしくは、下記のように直接 New-Mguser コマンド内で必要な情報を記載することも可能です。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$PasswordProfile = @&#123;</span><br><span class="line">  Password = &#x27;Passw0rd&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">New-MgUser -DisplayName &#x27;Rene Magi&#x27; -PasswordProfile $PasswordProfile -AccountEnabled -MailNickName &#x27;ReneMagi&#x27; -UserPrincipalName &#x27;ReneMagi@m365x61971868.onmicrosoft.com&#x27;</span><br></pre></td></tr></table></figure><p>以下の公開情報も併せてご確認ください。</p><ul><li><a href="https://learn.microsoft.com/ja-jp/powershell/module/microsoft.graph.users/new-mguser?view=graph-powershell-1.0">New-MgUser</a></li><li><a href="https://learn.microsoft.com/ja-jp/graph/api/user-post-users?view=graph-rest-1.0&tabs=http">ユーザーを作成する</a></li></ul><h2 id="idx3">3. ユーザーの削除</h2><p>Remove-MgUser コマンドにて削除可能です。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Remove-MgUser -UserId 282f0fb7-06a6-4a86-b3d5-01569d7393a1</span><br></pre></td></tr></table></figure><h2 id="idx4">4. 削除済みユーザーの完全削除と復元</h2><p>削除されたユーザーは、30 日間の間、削除済みユーザーとして一時的に保存されます。30 日以内であれば、誤って削除してしまった場合でもこれらのユーザーを復元することが可能です。復元したい場合、 Restore-MgDirectoryDeletedItem コマンドを使用します。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Restore-MgDirectoryDeletedItem -DirectoryObjectId 282f0fb7-06a6-4a86-b3d5-01569d7393a1</span><br></pre></td></tr></table></figure><p><a href="https://learn.microsoft.com/ja-jp/graph/api/directory-deleteditems-restore?view=graph-rest-1.0&tabs=http">削除済みアイテムを復元する</a> の公開情報も併せてご確認ください。</p><p>完全に削除したい場合、Remove-MgDirectoryDeletedItem コマンドを使用します。こちらのコマンドを実行すると、オブジェクトは完全に削除され復元できなくなるためご留意ください。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Remove-MgDirectoryDeletedItem -DirectoryObjectId 282f0fb7-06a6-4a86-b3d5-01569d7393a1</span><br></pre></td></tr></table></figure><p><a href="https://learn.microsoft.com/ja-jp/graph/api/directory-deleteditems-delete?view=graph-rest-1.0&tabs=powershell">アイテムを完全に削除する</a> の公開情報も併せてご確認ください。</p><h2 id="idx5">5. ユーザーの属性を更新する</h2><p>Update-Mguser コマンドを利用して更新が可能です。たとえばユーザーの displayname とその他のメール (Othermails) を更新したい場合は下記のように実行します。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Update-MgUser -UserId 2e7c8a97-ab50-4e53-b193-be3ff9ddc6aa -DisplayName test1228a -OtherMails @(&quot;bob@contoso.com&quot;, &quot;admin@m365x219253.onmicrosoft.com&quot;)</span><br></pre></td></tr></table></figure><p>一般的には上記のように、変更したい属性を指定して、新しい値を指定すれば更新できます。</p><p>時折ご質問をいただくものとして、extensionattribute 関連の属性を更新したいといったお問い合わせがよくあるため、以下に手順を例として案内します。 Extensionattribute の値を更新したい場合、事前に beta に切り替えてからコマンドを実行ください。</p><ol><li><p>Connect-MgGraph にて接続します。</p></li><li><p>beta バージョンへ切り替えます。</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Select-MgProfile -Name &quot;beta&quot;</span><br></pre></td></tr></table></figure></li><li><p>Get-Mguser コマンドを実行して、ユーザーの情報を取得します。</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(Get-MgUser -UserId 4e6bc6e4-d6e7-4bd8-9079-3393e12dcec3).onpremisesExtensionAttributes | fl</span><br></pre></td></tr></table></figure><p> 以下の画面では、ユーザーの ExtensionAttribute1 の値に test という文字列が入っていることが確認できます。</p><p> <img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-11.png"></p></li><li><p>以下のコマンドを実行して、たとえば ExtensionAttribute1 の値を test2 に更新します。</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Update-MgUser -UserId 4e6bc6e4-d6e7-4bd8-9079-3393e12dcec3 -OnPremisesExtensionAttributes @&#123;&quot;ExtensionAttribute1&quot;=&#x27;test2&#x27;&#125;</span><br></pre></td></tr></table></figure></li><li><p>値が test2 に更新されたことを確認します。</p><p> <img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-12.png"></p></li></ol><h2 id="idx6">6. よくある質問</h3><p>Q. Set-MsolUser コマンドで実施できた StrongAuthenticationRequirements の有効化や、StrongAuthenticationMethod を無効化する代替案はありますか？</p><p>A. いいえ、現状新しい Microsoft Graph PowerShell SDK では対応していません。<a href="https://learn.microsoft.com/ja-jp/graph/api/resources/authenticationmethods-overview?view=graph-rest-1.0">公開情報</a> にも記載があります。</p><blockquote><p>この機能は現在、StrongAuthenticationMethods プロパティを使用して、MSOL Set-MsolUser コマンドレットを使用してのみサポートされています。</p></blockquote><p>StrongAuthenticationMethod プロパティは、”ユーザーごとの MFA” の機能で利用される項目ですが、この機能はレガシーとなり、現在は条件付きアクセスでの管理を推奨しております。そのため、ユーザーごとの MFA を利用している場合、今後は条件付きアクセスで MFA を要求する形に移行することをお勧めいたします。条件付きアクセスにてユーザーに MFA を要求すると、そのユーザー次回サインイン時に自動的に MFA の登録を求められます。例えば、条件付きアクセスにてすべてのアプリに対して MFA を要求するように構成すると、これは “ユーザーごとの MFA” の機能において、ユーザーの MFA の状態を “有効” にするのと同じ意味になります。このため、現在 “ユーザーごとの MFA” の機能において、ユーザーの MFA の状態を “有効” にすることで MFA を構成している場合は、条件付きアクセスにてすべてのアプリに対して MFA を要求するように構成ください。</p><p>一方で、MFA の再登録を要求する場合は、<a href="https://learn.microsoft.com/en-us/graph/api/resources/authenticationmethods-overview?view=graph-rest-1.0">公開情報 (英語)</a> に記載があり、Microsoft Graph API (PowerShell SDK) を利用して、利用可能なすべての認証方法を個別に削除するというのが今後の正しい代替方法となります。</p><p>基本的なユーザー管理コマンドについて案内していますが、もし利用方法が不明なコマンドがございましたらお気軽にお問い合わせを起票ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure Identity サポート チームの小出です。&lt;/p&gt;
&lt;p&gt;この記事は、この記事は、MSOnline / AzureAD モジュール廃止について、&lt;a href=&quot;https://jpazureid.github.io/blog/azure-ac</summary>
      
    
    
    
    
    <category term="PowerShell" scheme="https://jpazureid.github.io/blog/tags/PowerShell/"/>
    
    <category term="Microsoft Graph" scheme="https://jpazureid.github.io/blog/tags/Microsoft-Graph/"/>
    
  </entry>
  
  <entry>
    <title>カスタム クレーム プロバイダーで認証フローをカスタマイズ！</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/</id>
    <published>2023-04-13T03:00:00.000Z</published>
    <updated>2023-04-26T02:57:31.491Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 五十嵐 です。</p><p>本記事は、2023 年 3 月 20 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/customize-your-authentication-flows-with-custom-claims-providers/ba-p/2464388">Customize your authentication flows with custom claims providers!</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>Microsoft Entra の一部である Azure Active Directory (Azure AD) においてカスタム クレーム プロバイダーのパブリック プレビューを発表できることを大変うれしく思います。</p><p>カスタム クレーム プロバイダーを使うと、認証フローの最中に API を呼び出してカスタム クレームをトークンにマッピングすることができます。API の呼び出しは、ユーザーがすべての認証要求を完了した後で、トークンがアプリへ発行される直前に実行されます。アプリが想定どおり機能するために、アプリに送信されるトークンに追加のクレームを返す必要があるというシナリオを多くのお客様から伺いました。これらのクレームを外部のシステムから取得するのは、以下のような理由が挙げられます:</p><ul><li>機密性の高い属性をオンプレミスで管理しており、Active Directory Federation Services やその他のフェデレーション サービスを使用して Azure AD にクレームを渡す必要がある。</li><li>規制上、これら機密性の高い属性を Azure AD に同期させることができない。</li><li>属性が外部データベースに格納されており、複雑な RBAC モデルを保有している。</li><li>アプリを所有していない、または認証後にこれらの属性を取得するようにアプリを変更することができない。</li></ul><p>カスタム クレーム プロバイダーを使用すると、外部システムからクレームを取得し、トークンに直接発行することができます。LDAP や SQL など、あらゆるデータ ストアと連携することもできます。カスタム クレーム プロバイダーは、OpenID および SAML アプリに設定でき、従業員や外部の ID を認証するシナリオで機能します。</p><p>Contoso 社の人事アプリを使って設定方法を紹介したいと思います。このシナリオでは、Contoso 社は人事アプリを Active Directory Federation Services から切り離し、Azure AD で直接認証することを検討しています。人事アプリは、オンプレミスの Active Directory に保存されているトークンに、ユーザーの社員番号が返されることを想定しています。 </p><p>Contoso 社はカスタム クレーム プロバイダーを構成し、このデータを取得して認証時にトークンに挿入することがで切るようになります。Contoso 社の Azure AD 側の設定を始めてみましょう。 </p><p>まず、[<strong>エンタープライズ アプリケーション</strong>] メニューで、Contoso の管理者は [<strong>カスタム認証拡張機能</strong>] を選択後、[<strong>カスタム拡張機能の作成</strong>] を選択します。</p><p><img src="/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/customize-your-authentication-flows-with-custom-claims-providers1.png"></p><p>そして [<strong>TokenIssuanceStart</strong>] を選択し、[<strong>次へ</strong>] を選択します。 </p><p><img src="/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/customize-your-authentication-flows-with-custom-claims-providers2.png"></p><p>管理者は、Contoso 社の API の [<strong>名前</strong>] [<strong>対象 URL</strong>] [<strong>説明</strong>] を入力し、[<strong>次へ</strong>] を選択します。API エンドポイントは、LDAP 検索を使用して Active Directory と通信し、ユーザーの社員番号を取得することになります。</p><p><img src="/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/customize-your-authentication-flows-with-custom-claims-providers3.png"></p><p>次に、Contoso 社の管理者は、カスタム拡張機能がどのようにして自社の API に認証するかを設定できます。[<strong>アプリの登録を新規作成する</strong>] を選択し、[<strong>名前</strong>] を入力し、[<strong>次へ</strong>] を選択します。Contoso 社の API を認証するために、クライアント資格情報を使用します。Contoso 社は Azure Functions アプリを使用して API をホストしているため、このアプリ登録が自動的に API を保護するために使用されます。</p><p><img src="/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/customize-your-authentication-flows-with-custom-claims-providers4.png"></p><p>そして、API から返される属性名をカスタム拡張機能に設定します。Contoso 社の API は、<strong>employeeNumber</strong> という属性を返します。管理者は [<strong>要求名</strong>] に <strong>employeeNumber</strong> を入力し、[<strong>次へ</strong>] を選択します。</p><p><img src="/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/customize-your-authentication-flows-with-custom-claims-providers5.png"></p><p><img src="/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/customize-your-authentication-flows-with-custom-claims-providers6.png"></p><p>次に、カスタム クレーム プロバイダーを使用して、人事アプリ登録のクレームをマッピングしてみましょう。Contoso 社の管理者は、[<strong>エンタープライズ アプリケーション</strong>] メニューに移動して 人事アプリを選択し、[<strong>シングル サインオン</strong>] &gt; [<strong>属性とクレーム</strong>] で [<strong>編集</strong>] を選択します。</p><p><img src="/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/customize-your-authentication-flows-with-custom-claims-providers7.png"></p><p>Contoso 社の管理者は、カスタム クレーム プロバイダーを構成して、カスタム拡張機能から社員番号を取得するためのクレーム マッピングを作成する必要があります。</p><p>[<strong>詳細設定</strong>] メニューを展開し、［<strong>設定</strong>］を選択します。</p><p><img src="/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/customize-your-authentication-flows-with-custom-claims-providers8.png"></p><p>管理者は、[<strong>カスタム クレーム プロバイダー</strong>] を選択し、先に作成したカスタム拡張機能を選択し、[<strong>保存</strong>] します。</p><p><img src="/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/customize-your-authentication-flows-with-custom-claims-providers9.png"></p><p>最後に、管理者は [<strong>新しいクレームの追加</strong>] を選択し、トークンに発行されるクレームの [<strong>名前</strong>] を入力します。次に [<strong>ソース</strong>] にて [<strong>属性</strong>] を選択し、[<strong>ソース属性</strong>] をプルダウンから選択します (<strong>customClaimsProvider.attributeName</strong> という形式)。そして [<strong>保存</strong>] します。</p><p><img src="/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/customize-your-authentication-flows-with-custom-claims-providers10.png"></p><p>これですべての設定が完了しました。ユーザーが Contoso 人事アプリへのサインインを完了すると、カスタム拡張機能がトリガーされます。カスタム クレーム プロバイダーはカスタム拡張機能を使用して、トークンに社員番号を追加します。</p><p>以下はそのフローを示す図です。</p><p><img src="/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/customize-your-authentication-flows-with-custom-claims-providers11.png"></p><p>より詳細なビデオ チュートリアルは以下からご覧いただけます: <a href="https://youtu.be/BYOMshjlwbc">https://youtu.be/BYOMshjlwbc</a></p><p>カスタム クレーム プロバイダーは、カスタム拡張機能のまだ最初の利用シナリオの一つでしかありません。今後もカスタム拡張機能のイベントを追加でリリースしていきますので、認証フローをさらにカスタマイズすることができるようになります。</p><p>カスタム拡張機能については <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/develop/custom-extension-overview">こちら</a>、カスタム クレーム プロバイダーについては <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/develop/custom-claims-provider-overview">こちら</a> で詳しく説明しています。カスタム クレーム プロバイダーのセットアップを開始するには、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/develop/custom-extension-get-started?tabs=azure-portal">こちら</a> をご覧ください。</p><p>いつものとおり、皆様のご意見、ご感想、ご提案をお聞かせください。<a href="https://feedback.azure.com/d365community/forum/22920db1-ad25-ec11-b6e6-000d3a4f0789">Azure AD フォーラム</a> で共有するか、以下にコメントください。皆様からのご連絡をお待ちしております。</p><p>よろしくお願いします。</p><p>Alex Simons (@Alex_A_Simons)<br>Corporate VP of Program Management<br>Microsoft Identity Division</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 五十嵐 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 3 月 20 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techc</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>MSOnline / AzureAD PowerShell から Graph PowerShell SDK への移行について 1_概要</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement1/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement1/</id>
    <published>2023-04-13T00:00:00.000Z</published>
    <updated>2023-04-26T02:57:31.375Z</updated>
    
    <content type="html"><![CDATA[<div class="alert is-info"><p class="alert-title">Note</p><p>2022-10-03: 本記事の初版を投稿</p><p>2023-04-13: MSOL/AzureAD PowerShell の最新の廃止情報を反映</p></div><p>こんにちは、 Azure ID チームの小出です。</p><p>今回は、MSOnline (以降 MSOL) および Azure AD PowerShell の廃止スケジュールについてご案内します。</p><p>以前より、下記の弊社ブログにて、本内容については案内を行っていますが、情報のアップデートにより、複数の記事に分かれてしまうなどわかりにくくなっている状況でした。そこで今回は、現時点での最新情報と実施いただきたいこと、関連記事の URL などをまとめてご紹介します。</p><h2 id="最新情報-2023-4-13-最終更新-のまとめ"><a href="#最新情報-2023-4-13-最終更新-のまとめ" class="headerlink" title="最新情報 (2023/4/13 最終更新) のまとめ"></a>最新情報 (2023/4/13 最終更新) のまとめ</h2><h3 id="MSOL-Azure-AD-PowerShell-のライセンス割り当て関連のコマンド"><a href="#MSOL-Azure-AD-PowerShell-のライセンス割り当て関連のコマンド" class="headerlink" title="MSOL / Azure AD PowerShell のライセンス割り当て関連のコマンド"></a>MSOL / Azure AD PowerShell のライセンス割り当て関連のコマンド</h3><p>ライセンス割り当てに関する MSOL / Azure AD PowerShell コマンド（Set-MsolUserLicense や Set-AzureADUserLicense など）は、2023/3/31 にすでに廃止されました。まだこのコマンドを利用しているお客様は、早急に新しいコマンドに移行ください。これらのコマンドは今後予告なく動作しなくなります。</p><p>新しいコマンドでのライセンス割り当て方法は、<a href="https://jpazureid.github.io/blog/azure-active-directory/operating-license-with-microsoft-graph/">本ブログ記事</a> にてサンプルを用意しておりますので、併せてご確認ください。</p><ul><li>廃止日を 2022/6/30 や 2022/8/26 などと記載している情報もありますが、ライセンス割り当てに関する MSOL / Azure AD PowerShell コマンドの廃止日は 2023/3/31 です。それ以降の延長はなく 2023/3/31 にすでに廃止されました。</li><li>2023/3/31 を過ぎると MSOL / Azure AD のライセンス割り当ての PowerShell コマンドは予告なく使用できなくなる見込みです。2023/4/1 以降も引き続きテナントによっては動作はする可能性はあり、2023/4/13 現在、弊社検証環境では引き続き Set-MsolUserLicense コマンドでのライセンス付与は実施できています。しかし、いつ利用できなくなってもおかしくない状況です。</li><li>2022/11/1 以降に新しく作成するテナントでは、MSOL / Azure AD PowerShell コマンドによるライセンス割り当て関連のコマンドが、テナント作成時点から正常に動作しません。</li></ul><p>対象となるコマンドの詳細は、<a href="https://jpazureid.github.io/blog/azure-active-directory/migrate-your-apps-to-access-the-license-managements/">こちらの記事</a>の下記該当箇所をご確認ください。</p><table>  <thead>    <tr>      <th>既存のコマンド (2023 年 3 月 31 日以降に利用できなくなる操作)</th>      <th>今後推奨される Microsoft Graph PowerShell および API</th>    </tr>  </thead>  <tbody>    <tr>      <td><a href ="https://docs.microsoft.com/ja-jp/powershell/module/msonline/?view=azureadps-1.0" target="_blank">MSOnline Powershell</a>      <br/>・Set-MsolUserLicense      <br/>・New-MsolUser (-LicenseAssignment か -LicenseOptions を指定)</td>      <td rowspan="2">Microsoft Graph PowerShell      <br/>・<a href="https://docs.microsoft.com/ja-jp/powershell/module/microsoft.graph.users.actions/set-mguserlicense?view=graph-powershell-1.0" target="_blank">Set-MgUserLicense</a>      </td>    </tr>    <tr>      <td><a href="https://docs.microsoft.com/en-us/powershell/azure/active-directory/overview?view=azureadps-2.0">Azure AD Powershell</a>      <br/>・Set-AzureADUserLicense      </td>    </tr>    <tr>      <td>Azure AD Graph API (graph.windows.net)      <br/>・assignLicense</td>      <td>Microsoft Graph API      <br/>・<a href="https://docs.microsoft.com/ja-jp/graph/api/user-assignlicense?view=graph-rest-1.0&tabs=http">assignLicense</a></td>    </tr>      </tbody></table><h3 id="MSOL-Azure-AD-PowerShell-のライセンス割り当て関連「以外」のコマンドについて"><a href="#MSOL-Azure-AD-PowerShell-のライセンス割り当て関連「以外」のコマンドについて" class="headerlink" title="MSOL / Azure AD PowerShell のライセンス割り当て関連「以外」のコマンドについて"></a>MSOL / Azure AD PowerShell のライセンス割り当て関連「以外」のコマンドについて</h3><p>ライセンス割り当てに関するコマンド以外（例: Connect-MsolService や Get-AzureADUser など）は、2023 年 6 月 30 日 に廃止となる予定です。MSOnline モジュール、AzureAD モジュールだけでなく、 AzureADPreview モジュールのコマンドも廃止されます。</p><p>対象となるコマンドは、Connect-MsolService や Get-AzureADUser コマンドだけでなく、 MSOL や AzureAD がつくコマンドすべてです。各モジュールのコマンド一覧は、下記公開情報にて紹介しています。</p><p><a href="https://learn.microsoft.com/ja-jp/powershell/module/msonline/?view=azureadps-1.0#msonline">MSOnline モジュールのコマンド一覧</a><br><a href="https://learn.microsoft.com/en-us/powershell/module/azuread/?view=azureadps-2.0&preserve-view=true">Azure AD モジュールのコマンド一覧（一般提供版）</a><br><a href="https://learn.microsoft.com/en-us/powershell/module/azuread/?view=azureadps-2.0-preview&preserve-view=true">Azure AD モジュールのコマンド一覧（プレビュー版）</a></p><ul><li>廃止予定日までは、これまでと同様にコマンドを利用可能です。</li><li>廃止後は、動作の保証はされません。マイクロソフトは任意のタイミングで、MSOL / Azure AD (Preview) PowerShell の動作を停止する権利を有します。</li><li>ただし、マイクロソフトは使用状況を確認し、お客様が 3 つの PowerShell モジュールから移行するための猶予を提供した上で、これらモジュールの利用を停止させる予定です。</li><li>従来の MSOL / AzureAD モジュールのコマンドでは実施できた操作が、Microsoft Graph API では実施できないものがあります。こうした操作を行う MSOL / Azure AD モジュールのコマンドも最終的には廃止されますが、Microosft Graph API への移行先がないものについては 2023/6/30 を過ぎてすぐにコマンドが利用できなくなることはありません。Microsoft Graph でこれら API の代替の機能が提供されない限り、API およびコマンドレットを停止させることはありません。</li><li>新しいモジュールのコマンドや代替 API があるものについては、2023/6/30 を過ぎるとすぐに利用できなくなる可能性があるため、引き続き早めに移行ください。</li><li>2023/6/30 を過ぎても引き続き利用できるコマンド一覧の情報、実際に動作しなくなる具体的なコマンド一覧の情報などはありません。</li></ul><h2 id="いまできること・確認すること"><a href="#いまできること・確認すること" class="headerlink" title="いまできること・確認すること"></a>いまできること・確認すること</h2><ol><li>現在利用しているコマンド・スクリプトなどを確認する。<a href="https://jpazureid.github.io/blog/azure-active-directory/how-to-determine-depreacated-azuread-msol/">こちらの記事</a>をもとに、MSOL や Azure AD の PowerShell コマンドを利用していないか確認する</li><li>MSOL や Azure AD の PowerShell コマンドを利用している場合、<a href="https://docs.microsoft.com/en-us/powershell/microsoftgraph/azuread-msoline-cmdlet-map?view=graph-powershell-1.0">こちらの公開情報</a> にて対応するコマンドを探す</li><li>既存のスクリプトの書き換え、コマンドの置き換えを実施し、新しいモジュールで動作するよう修正する</li><li>利用中の MSOL や Azure AD コマンドの置き換えとなるものが見つからない、想定したように動作しない場合は、お問い合わせください</li></ol><h2 id="本廃止に関する弊社ブログ記事リンク"><a href="#本廃止に関する弊社ブログ記事リンク" class="headerlink" title="本廃止に関する弊社ブログ記事リンク"></a>本廃止に関する弊社ブログ記事リンク</h2><h3 id="アップデート情報-英語記事翻訳"><a href="#アップデート情報-英語記事翻訳" class="headerlink" title="アップデート情報 (英語記事翻訳)"></a>アップデート情報 (英語記事翻訳)</h3><p><a href="https://jpazureid.github.io/blog/azure-active-directory/migrate-your-apps-to-access-the-license-managements/">Azure AD Graph および MSOnline での従来のライセンスの割り当て方法が廃止され Microsoft Graph によるライセンス管理に変わります</a><br><a href="https://jpazureid.github.io/blog/azure-active-directory/azure-ad-change-management-simplified/">Azure AD の変更管理を簡素化します</a><br><a href="https://jpazureid.github.io/blog/azure-active-directory/Microsoft-Entra-change-announcements-September-2022-train/#Azure-AD%E3%80%81Azure-AD-Preview%E3%80%81MSOnline-PowerShell-%E3%81%AE%E5%BB%83%E6%AD%A2%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">Microsoft Entra の変更管理のアナウンス (2022 年 9 月の状況)</a><br><a href="https://jpazureid.github.io/blog/azure-active-directory/microsoft-entra-change-announcements-march-2023-train/">Microsoft Entra の変更のアナウンス (2023 年 3 月の状況)</a></p><h3 id="既存モジュール使用状況について"><a href="#既存モジュール使用状況について" class="headerlink" title="既存モジュール使用状況について"></a>既存モジュール使用状況について</h3><p><a href="https://jpazureid.github.io/blog/azure-active-directory/how-to-determine-depreacated-azuread-msol/">Azure AD Graph / MSOnline PowerShell モジュール利用状況の調べ方</a></p><h3 id="新しいモジュールへの移行導入"><a href="#新しいモジュールへの移行導入" class="headerlink" title="新しいモジュールへの移行導入"></a>新しいモジュールへの移行導入</h3><p><a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement2/">MSOnline / AzureAD PowerShell から Graph PowerShell SDK への移行について 2_移行導入編</a><br><a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement3/">MSOnline / AzureAD PowerShell から Graph PowerShell SDK への移行について 3_インストール・接続編</a></p><h3 id="新しいモジュールの使用方法-ライセンスに関する操作について"><a href="#新しいモジュールの使用方法-ライセンスに関する操作について" class="headerlink" title="新しいモジュールの使用方法 (ライセンスに関する操作について)"></a>新しいモジュールの使用方法 (ライセンスに関する操作について)</h3><p><a href="https://jpazureid.github.io/blog/azure-active-directory/operating-license-with-microsoft-graph/">Microsoft Graph PowerShell SDK を使用したライセンス管理操作の紹介</a></p><h3 id="新しいモジュールの使用方法-ライセンス以外の操作について"><a href="#新しいモジュールの使用方法-ライセンス以外の操作について" class="headerlink" title="新しいモジュールの使用方法 (ライセンス以外の操作について)"></a>新しいモジュールの使用方法 (ライセンス以外の操作について)</h3><p><a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement4/">MSOnline / AzureAD PowerShell から Graph PowerShell SDK への移行について 4_ユーザー管理</a><br><a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement5/">MSOnline / AzureAD PowerShell から Graph PowerShell SDK への移行について 5_グループ管理</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;alert is-info&quot;&gt;&lt;p class=&quot;alert-title&quot;&gt;Note&lt;/p&gt;&lt;p&gt;2022-10-03: 本記事の初版を投稿&lt;/p&gt;&lt;p&gt;2023-04-13: MSOL/AzureAD PowerShell の最新の廃止情報を反映&lt;/p&gt;</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="PowerShell" scheme="https://jpazureid.github.io/blog/tags/PowerShell/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD テナントの追加・変更・削除</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/add-modify-delete-directory/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/add-modify-delete-directory/</id>
    <published>2023-04-07T00:00:00.000Z</published>
    <updated>2023-04-26T02:57:31.299Z</updated>
    
    <content type="html"><![CDATA[<div class="alert is-info"><p class="alert-title">Note</p><p>本記事は Technet Blog の更新停止に伴い <a href="https://blogs.technet.microsoft.com/jpazureid/2018/01/16/azuread-operation/">TechNet Blog</a> の内容を移行したものです。元の記事の最新の更新情報については、本内容をご参照ください。</p></div><div class="alert is-info"><p class="alert-title">Note</p><p>2018-01-16: 本記事の初版を投稿</p><p>2023-04-07: “管理者以外のユーザーによるテナントの作成を制限する” 機能を追記して全体を更新</p></div><p>こんにちは、Azure &amp; Identity サポート チームの小出です。この記事はもともと 2018 年 1 月に公開されましたが、直近で新しいプレビューが開始されたことに伴い情報を追記して更新しております。</p><p>今回は下記の 3 つについて紹介します。</p><ul><li>Azure AD テナントの追加手順</li><li>Azure AD テナントの変更手順</li><li>Azure AD テナントの削除手順</li></ul><p>まずは、簡単に Azure AD テナントについて説明します。</p><p>Azure AD テナントは、Azure や Office 365 などの Microsoft クラウド サービスに組織がサインアップしたときに作成されます (もう少し平易な言い方をすると、Office 365 など Azure AD テナントが必須のサービスの新規利用を開始した時点で自動的に作成されます)。Azure AD テナントに存在しているユーザーは、その Azure AD テナントに紐づいているクラウド サービスにサインインして利用することが可能です。Azure AD テナントや Azure AD ディレクトリという言葉が出てきますが、どちらも同じ意味とお考えいただいて結構です。</p><p><img src="/blog/azure-active-directory/add-modify-delete-directory/user-access-o365-subscription.png"></p><h2 id="Azure-AD-テナントの追加手順"><a href="#Azure-AD-テナントの追加手順" class="headerlink" title="Azure AD テナントの追加手順"></a>Azure AD テナントの追加手順</h2><p>冒頭で、クラウド サービスにサインアップした際に Azure AD テナントが作成されると書きましたが、Azure AD テナントを個別に追加することも可能です。下記の手順で、Azure AD Free (無料) テナントを作成できます</p><ol><li><p><a href="https://portal.azure.com/">https://portal.azure.com</a> にアクセスし、任意の管理者アカウントでサインインします。</p></li><li><p>ポータル画面左上のナビゲーションの [Azure Active Directory] をクリックします。</p></li><li><p>表示された画面上で [テナントの管理] をクリックし、[+ 作成] を選択します。</p></li><li><p>[ディレクトリの作成] 画面の下記の項目に入力します。</p><ul><li>テナントの種類を選択する: Azure Active Directory</li><li>組織名: 任意の組織名を入力</li><li>初期ドメイン名: &lt;組織&gt; のドメイン名を入力</li><li>場所: 組織が存在する場所を選択</li></ul></li><li><p>[作成] をクリックします。</p></li><li><p>作成が完了すると、”新しいディレクトリを管理するにはここをクリックします” が表示するので、クリックします。</p></li><li><p>新しく作成したディレクトリの画面に切り替わります。</p></li></ol><p>作成操作を行ったユーザーが新しく作成した Azure AD テナントの管理者となります。</p><h3 id="一般ユーザーに対するテナント作成の制限機能"><a href="#一般ユーザーに対するテナント作成の制限機能" class="headerlink" title="一般ユーザーに対するテナント作成の制限機能"></a>一般ユーザーに対するテナント作成の制限機能</h3><p>上記記載の Azure AD テナント作成操作については、以前は管理者側で制限することができず、一般ユーザーであっても新しいテナントを自由に作成できていました。しかしながら、2023 年に一般ユーザーに対して「新しいテナントの作成を制限する」機能が用意されました。このため、下記を利用することで一般ユーザーによるテナントの作成を制限することが可能です。</p><p><img src="/blog/azure-active-directory/add-modify-delete-directory/tenantcreation.png"></p><p>[管理者以外のユーザーによるテナントの作成を制限する (プレビュー)] の設定を “はい” にした場合、グローバル管理者もしくはテナント作成者ロールをもつユーザーのみが、上記操作を行えるようになります。この設定はその他の機能には特に影響ないほか、操作を行ったテナントと新規テナントは全く別物となりますので、設定が同期されてしまうなど相互に影響しあうこともございません。</p><h2 id="Azure-AD-テナントの変更手順"><a href="#Azure-AD-テナントの変更手順" class="headerlink" title="Azure AD テナントの変更手順"></a>Azure AD テナントの変更手順</h2><p>Azure AD テナントは必ず xxxxx.onmicrosoft.com という名前を持ち、この初期ドメイン名を後から変更することはできません。そのため、Azure AD テナントの初期ドメイン名を例えば contoso.onmicrosoft.com にしたい場合は、上記の「Azure AD の追加手順」の手順に従い、Azure AD を一から新規に作成する必要があります。</p><p>なお、Azure AD の組織名 (よく “既定のディレクトリ” と表示されている名称) については下記の手順で変更可能です。</p><ol><li><p><a href="https://portal.azure.com/">https://portal.azure.com</a> にアクセスし、管理者アカウントでサインインします。</p></li><li><p>ポータル画面左上のナビゲーションの [Azure Active Directory] をクリックします。</p></li><li><p>[プロパティ] をクリックします。</p></li><li><p>[名前] の項目に新しい組織名を入力します。</p><p> 例: 既定のディレクトリ –&gt; コントソ株式会社</p></li><li><p>[保存] を押します。</p></li><li><p>少し時間を空けて再度サインインすると、名前が変更されます。</p></li></ol><p>また、ご利用の Azure サブスクリプションを新規で作成した Azure AD に紐づけたいというような要件がある場合には、<a href="https://learn.microsoft.com/ja-jp/azure/role-based-access-control/transfer-subscription">サブスクリプションの譲渡</a> の方法もご覧ください。</p><h2 id="Azure-AD-テナントの削除手順"><a href="#Azure-AD-テナントの削除手順" class="headerlink" title="Azure AD テナントの削除手順"></a>Azure AD テナントの削除手順</h2><p>手動で作成した Azure AD テナントについては削除が可能です。テナントを削除するためには、以下のような前提条件があります。</p><ul><li>Azure のご契約時に自動的に作成されたディレクトリ (既定のディレクトリ) ではない。</li><li>ディレクトリにユーザーが存在しない (最後の一名の管理者は除く)。</li><li>連携するアプリケーションが存在しない。</li><li>サブスクリプションが紐づいていない。</li><li>など</li></ul><p>テナントの削除手順は以下のとおりです。</p><ol><li><a href="https://portal.azure.com/">https://portal.azure.com</a> にアクセスし、管理者アカウントでサインインします。</li><li>ポータル画面左上のナビゲーションの [Azure Active Directory] をクリックします。</li><li>表示された画面上で [テナントの管理] をクリックし、[ディレクトリの削除] をクリックします。</li><li>前提条件のチェック完了後に [削除] をクリックします。</li></ol><p>削除時に前提条件のチェックが走るため、すべての条件をクリアすることでテナントの削除が可能となります。前提条件に抵触している場合は、下記のように ! の警告が表示され削除を進めることができません。</p><p><img src="/blog/azure-active-directory/add-modify-delete-directory/new6.png"></p><p><img src="/blog/azure-active-directory/add-modify-delete-directory/new7.png"></p><p>なお、Azure のサインアップ時に自動作成された Azure AD テナント (既定のディレクトリ) やセルフサインアップ テナントについては削除が想定されていません。そのディレクトリはもう利用することはないという場合には、そのディレクトリから一名の管理者を除く他のすべてのユーザーを削除する方法で対応ください。テナントは残りますが、実質的に利用できない (利用しても意味のない) テナントとなりますので、削除と同等の結果になります。</p><ol><li><p><a href="https://portal.azure.com/">https://portal.azure.com</a> にアクセスし、管理者アカウントでサインインします。</p></li><li><p>ポータル画面左上のナビゲーションの [Azure Active Directory] をクリックします。</p></li><li><p>[ユーザーとグループ] – [すべてのユーザー] をクリックします。</p></li><li><p>[＋新しいユーザー] をクリックします。</p></li><li><p>ユーザー名を入力し、ロールでは「グローバル管理者」を選択します (最後の一名のアカウントを作成します)。</p><p> 例) 削除対象のディレクトリ名が contoso.onmicrosoft.com の場合: <a href="mailto:&#116;&#x65;&#x6d;&#x70;&#64;&#x63;&#x6f;&#110;&#111;&#x74;&#x6f;&#x73;&#x6f;&#46;&#x6f;&#110;&#109;&#x69;&#x63;&#x72;&#111;&#x73;&#111;&#102;&#116;&#46;&#x63;&#x6f;&#109;">&#116;&#x65;&#x6d;&#x70;&#64;&#x63;&#x6f;&#110;&#111;&#x74;&#x6f;&#x73;&#x6f;&#46;&#x6f;&#110;&#109;&#x69;&#x63;&#x72;&#111;&#x73;&#111;&#102;&#116;&#46;&#x63;&#x6f;&#109;</a></p></li><li><p>手順 5. で作成したグローバル管理者のアカウントで <a href="https://portal.azure.com/">https://portal.azure.com</a> にサインインします。</p></li><li><p>[すべてのユーザー] まで移動して、その他のすべてのアカウントをこのテナントから削除します。</p></li></ol><p>削除されたユーザーで、対象のテナントにアクセスができないことを確認ください。</p><h2 id="補足"><a href="#補足" class="headerlink" title="補足"></a>補足</h2><p>複数の Azure AD テナントは完全に独立したリソースとして管理されます。そのため、Azure AD テナント間の連携が必要なシナリオの場合は、Azure AD B2B の利用をします。B2B については下記の記事を合わせてご参照ください。</p><p><a href="https://blogs.technet.microsoft.com/jpazureid/2017/12/12/about-azure-ad-b2b/">Azure AD B2B とは</a></p><p>上記内容が少しでも皆様の参考となりますと幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;alert is-info&quot;&gt;&lt;p class=&quot;alert-title&quot;&gt;Note&lt;/p&gt;&lt;p&gt;本記事は Technet Blog の更新停止に伴い &lt;a href=&quot;https://blogs.technet.microsoft.com/jpazure</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD における入れ子 (ネスト) グループへの権限付与について</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/nesting-group/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/nesting-group/</id>
    <published>2023-04-06T23:00:00.000Z</published>
    <updated>2023-04-26T02:57:31.707Z</updated>
    
    <content type="html"><![CDATA[<div class="alert is-info"><p class="alert-title">Note</p><p>本記事は Technet Blog の更新停止に伴い <a href="https://blogs.technet.microsoft.com/jpazureid/2019/02/06/nesting-group/">TechNet Blog</a> の内容を移行したものです。元の記事の最新の更新情報については、本内容をご参照ください。</p></div><div class="alert is-info"><p class="alert-title">Note</p><p>2019-02-06: 本記事の初版を投稿</p><p>2023-04-07: 最新の公開情報リンクへの差し替えなど更新</p></div><p>こんにちは、 Azure Identity の平形です。</p><p>今回は Azure AD における入れ子 (ネスト) グループの対応状況についてお伝え致します。本記事は記事はは当初 2019 年 2 月に公開されましたが、その後 Azure ポータルのメニューなどが変更されたため、内容を最新版に更新いたしました。</p><h2 id="入れ子のグループとは"><a href="#入れ子のグループとは" class="headerlink" title="入れ子のグループとは"></a>入れ子のグループとは</h2><p>そもそも入れ子のグループとは、グループの中にグループを所属させているグループを指します。以下の図をご覧ください。</p><p><img src="/blog/azure-active-directory/nesting-group/333.jpg"></p><p>この場合はグループ A が入れ子のグループです。グループ A の中にはグループ B とユーザー B が含まれています。そしてユーザー A はグループ B に含まれている状態ですが、実際の挙動としてユーザー A はグループ A に含まれていると考えて良いかどうかが今回のテーマです。</p><p>例えば、アクセス権限をグループ A に割り当てた場合、ユーザー A に対してもアクセス権限が割り当てられることが期待されますが、 Azure AD の機能によっては必ずしもそうならず、いくつかの制限事項があります。ここではよくお問い合わせ頂く制限事項についてご紹介します。</p><h2 id="Azure-AD-における入れ子グループの制限"><a href="#Azure-AD-における入れ子グループの制限" class="headerlink" title="Azure AD における入れ子グループの制限"></a>Azure AD における入れ子グループの制限</h2><p>主にお問い合わせ頂く機能の中で、現時点では以下の機能については入れ子グループに対応していません。</p><ul><li>グループ ベースのライセンス付与</li><li>エンタープライズ アプリケーションのユーザーおよびグループの割り当て</li></ul><p>上記はグループに直接所属しているユーザーにのみ機能が割り当てられます。一方、条件付きアクセスの機能でグループを条件として設定した場合、入れ子のグループにも対応しており、上の例でいえばグループ A を対象とした条件付きアクセス ポリシーは、ユーザー A も対象になります。</p><p>実際のシナリオを考えてみましょう。グループ A に対して例えば Office 365 E3 のライセンスを割り当てた場合、先程の図のパターンに当てはめると以下のような結果になります。</p><p>例: グループ A に権限を割り当てた場合</p><p><img src="/blog/azure-active-directory/nesting-group/ssssss.jpg"></p><p>ユーザー A はグループ A の直属のメンバーでは無いため、グループ A にライセンスを割り当てても、配下のグループ B に所属しているユーザー A に対してはライセンスが付与されません。ユーザー B はグループ A の直接のメンバーであるため、問題なく権限が割り当てられます。このシナリオは Office 365 E3 のライセンスを割り当てた場合としましたが、エンタープライズ アプリケーションの割り当ての場合にも同様の動作となります。</p><h2 id="参考情報"><a href="#参考情報" class="headerlink" title="参考情報"></a>参考情報</h2><p>Azure Active Directory のライセンス管理にグループを使用する際のシナリオ、制限、および既知の問題<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/users-groups-roles/licensing-group-advanced">https://docs.microsoft.com/ja-jp/azure/active-directory/users-groups-roles/licensing-group-advanced</a></p><p>SaaS アプリケーションへのアクセスをグループで管理する<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/users-groups-roles/groups-saasapps">https://docs.microsoft.com/ja-jp/azure/active-directory/users-groups-roles/groups-saasapps</a></p><p>Azure AD サービスの制限と制約 (表内グループの項目でも、本記事に記載の内容を確認できます。)<br><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/enterprise-users/directory-service-limits-restrictions">https://learn.microsoft.com/ja-jp/azure/active-directory/enterprise-users/directory-service-limits-restrictions</a></p><h2 id="備考"><a href="#備考" class="headerlink" title="備考"></a>備考</h2><p>グループの入れ子については多くのお客様よりフィードバックをいただいており、弊社開発部門も実装を検討しています。</p><p><a href="https://feedback.azure.com/d365community/idea/fa8991c1-b125-ec11-b6e6-000d3a4f0789">https://feedback.azure.com/d365community/idea/fa8991c1-b125-ec11-b6e6-000d3a4f0789</a></p><p>上記のフィードバックサイトは開発部門が閲覧しており、フィードバックが多い機能や要望は今後の Azure 機能拡張の参考にしています。</p><p>グループの入れ子については、階層が深い場合や、グループの入れ子構造がループしている場合の検出など技術的に考慮すべき部分もあり現状はサポートされていない機能が多い状況です。グループの入れ子に対応していないことで不便さを感じられている方は、是非上記のフィードバック サイトから投票ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;alert is-info&quot;&gt;&lt;p class=&quot;alert-title&quot;&gt;Note&lt;/p&gt;&lt;p&gt;本記事は Technet Blog の更新停止に伴い &lt;a href=&quot;https://blogs.technet.microsoft.com/jpazure</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
  </entry>
  
  <entry>
    <title>[調査に有効な採取情報] Azure AD に関する問題全般</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/troubleshoot-azure-ad/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/troubleshoot-azure-ad/</id>
    <published>2023-04-06T22:00:00.000Z</published>
    <updated>2023-04-26T02:57:31.827Z</updated>
    
    <content type="html"><![CDATA[<div class="alert is-info"><p class="alert-title">Note</p><p>本記事は Technet Blog の更新停止に伴い <a href="https://blogs.technet.microsoft.com/jpazureid/2017/10/24/%e8%aa%bf%e6%9f%bb%e3%81%ab%e6%9c%89%e5%8a%b9%e3%81%aa%e6%8e%a1%e5%8f%96%e6%83%85%e5%a0%b1-azure-ad-%e3%81%ab%e9%96%a2%e3%81%99%e3%82%8b%e5%95%8f%e9%a1%8c%e5%85%a8%e8%88%ac/">TechNet Blog</a> の内容を移行したものです。元の記事の最新の更新情報については、本内容をご参照ください。</p></div><div class="alert is-info"><p class="alert-title">Note</p><p>2017-10-24: 本記事の初版を投稿</p><p>2023-04-07: 古い情報を最新のものに更新</p></div><p>こんにちは、Azure &amp; Identity サポート チームの小出です。</p><p>今回は Azure AD に関する問題についてサポートに問い合わせる際に問い合わせに含めることを推奨する情報についてご紹介します。本記事は 2017-10-24 に投稿されたものですが、古い情報を更新し改めて案内しております。</p><p>ここでご紹介する情報は、Azure AD が関係するようなお問い合わせではおおむねどのようなケースにおいても調査に必要になる情報となります。エラーが発生する、正しく動作しないなどの理由でお問い合わせを起票する際には、下記情報も併せてお寄せください。</p><h2 id="お問い合わせ起票時に注意すること"><a href="#お問い合わせ起票時に注意すること" class="headerlink" title="お問い合わせ起票時に注意すること"></a>お問い合わせ起票時に注意すること</h2><p>お問い合わせ起票時に「高度な診断設定」を「はい」に設定すると、Azure サポートでは、お客様のデータ プライバシーに配慮をしつつ、トラブル シューティングに必要な範囲でデータセンター上からお客様環境の情報へアクセスを行うことができます。これにより、お客様にて手動で情報を抽出し、弊社に送信いただくといった手間が省けます。</p><p>トラブル シューティングのお問い合わせの場合、この診断設定が許可されていないと、お客様から連携いただいたログ以外の情報を確認することができません。周辺日時や関連のログなどを確認し、迅速に解決策をご案内できるよう、トラブル シューティングのお問い合わせでは可能な限り、こちらで「はい」を選択していただくことをお勧めいたします。</p><p>詳細を確認されたい場合、下記参考情報もご利用ください。</p><ul><li><a href="https://jpaztech.github.io/blog/information/How-to-inquiry-to-the-Azure-Support/">お問い合わせの発行方法について</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/azure-portal/supportability/how-to-create-azure-support-request#advanced-diagnostic-information-logs">詳細診断情報ログ</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/azure-portal/supportability/how-to-manage-azure-support-request#allow-collection-of-advanced-diagnostic-information">高度な診断情報の収集を許可</a></li></ul><h2 id="お問い合わせ時に合わせて提供いただくと有効な情報"><a href="#お問い合わせ時に合わせて提供いただくと有効な情報" class="headerlink" title="お問い合わせ時に合わせて提供いただくと有効な情報"></a>お問い合わせ時に合わせて提供いただくと有効な情報</h2><p>a) 問題が起きているテナント及び問題に関係しているテナントの Tenant ID か初期ドメイン (******.onmicrosoft.com)</p><p>上記情報は Azure ポータルから問題の発生しているテナントのユーザーでお問い合わせを発行された場合にはサポートにて確認できるので不要です。</p><p>b) 作業対象のユーザーや問題が発生しているユーザーの情報 (UPN、メンバーかゲスト ユーザーか、どのテナントのユーザーか)</p><p>c) 問題ステップ記録 (PSR) ツール情報</p><p>問題ステップ記録ツール (以降、PSR) は、クリックした場所の説明や、表示される画面のスクリーン ショット、その日時などを自動的にキャプチャするツールです。PSR 情報から得られた各オペレーションの実行日時を元に、後述の各種情報から調査・追跡を行うために採取していただきます。PSR の取得手順については後述します。</p><p>d) エラー コード</p><p>下記のようなエラー コードがあるとサポート エンジニアは同様のエラーが出力された事例の調査ができます。また、開発エンジニアの確認が必要になるケースでもエラー コードを元に大まかな要因を特定できる可能性があります。</p><blockquote><p>AADSTS65005: Invalid resource. The client has requested access to a resource which is not listed in the requested permissions in the client’s application registration. Client app ID: f1764360-e0ec-4446-911e-cd6fc0d4dd61. Resource value from request: . Resource app ID: 00000002-0000-0000-c000-000000000000. List of valid resources from app registration: .</p></blockquote><blockquote><p>Exception mapped to interrupt error code: Microsoft.AzureAD.Telemetry.Diagnostics.ServiceException: AADSTS65001: The user or administrator has not consented to use the application with ID ‘box.net’ named ‘Windows Azure Active Directory’. Send an interactive authorization request for this user and resource.</p></blockquote><p>e) Trace ID、または Correlation ID と Timestamp のセット</p><p>サインインなどに失敗し、エラー画面が出力される際に、Trace ID か Correlation ID と Timestamp のセットが出力されることがあります。下記のような Trace ID か Correlation ID と Timestamp のセットが含まれる画面ショットがあると、その情報をもとに Azure のプラットフォーム側のログを確認できます。</p><blockquote><p>Trace ID: 5c19f807-1e0b-489e-ae3b-26c975a20500</p></blockquote><p>もしくは</p><blockquote><p>Correlation ID: e9065a31-0768-44bf-b762-c9e37c9fd8d0</p></blockquote><p>および</p><blockquote><p>Timestamp: 2017-09-12 06:32:13Z</p></blockquote><h2 id="PSR-を採取する手順"><a href="#PSR-を採取する手順" class="headerlink" title="PSR を採取する手順"></a>PSR を採取する手順</h2><p>問題ステップ記録ツールの利用手順は以下のとおりです。以下の手順で、PSR 情報の記録を開始します。不要な情報の採取を避けるために、全ての不要なウィンドウを事前に閉じておくことをお勧めいたします。以下の手順で PSR を起動します。</p><ol><li><p>Windows ボタンを右クリックして [ファイル名を指定して実行] にて psr.exe と入力し、[OK] をクリックします。</p></li><li><p>“問題ステップ記録ツール” が起動しましたら、右端の ▼ をクリックし、表示されるメニューから [設定]をクリックします。</p></li><li><p>“保存する最新の取り込み画像数” を 25 から 100 に変更し、OK をクリックします。</p></li></ol><p>以下の手順で PSR 情報の記録を開始します。</p><ol start="4"><li><p>“問題ステップ記録ツール” の画面を前面に出します。</p></li><li><p>[記録の開始] をクリックします。</p></li><li><p>“問題ステップ記録ツール” の画面を最小化します。</p></li></ol><p>  ※ 目的の画面が隠れないように、必ず最小化します。</p><ol start="7"><li>事象の発生を確認します</li></ol><div class="alert is-info"><p class="alert-title">Note</p><p>Azure ポータルや Office ポータルなどで操作する場合には言語設定を一時的に英語にしておくことを推奨します。ここで取得する情報をグローバルの開発担当エンジニアやデータセンターエンジニアが確認する可能性があるためです。</p></div><ol start="8"><li>PSR 情報の記録を停止します</li></ol><p>以下の手順で PSR 情報の記録を停止して採取します。</p><ol start="9"><li><p>“問題ステップ記録ツール” の画面を前面に出します。</p></li><li><p>[記録の停止] をクリックします。</p></li><li><p>ファイルの保存場所、ファイル名を指定し、保存致します。</p></li><li><p>作成されました ZIP ファイルをお問い合わせ時に提供下さい。</p></li></ol><p>ここで案内しました情報を事前に取得し、お問い合わせと合わせてご提供いただくことで次のようなメリットがあります。</p><ul><li>お問い合わせに対する回答・問題解決をより迅速にすることができます。</li><li>後々、問題が再現できなくなり、問題発生時の情報がないために、問題の発生要因を追及できなくなるケースが減らせます。</li><li>サポート エンジニアより情報採取を案内される分のやり取りを減らせます。</li></ul><p>上記内容が参考となりましたら幸いです。問題によっては、再現頻度が少ないなどのことから、上記情報の提供が難しい場合もあるかと思います。この場合は、まずは可能な限りの詳細を把握したうえで、お問い合わせを発行いただいてもかまいません。その際はサポートエンジニアから詳細をお伺いし、必要な情報採取の詳細をガイドさせていただきます。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;alert is-info&quot;&gt;&lt;p class=&quot;alert-title&quot;&gt;Note&lt;/p&gt;&lt;p&gt;本記事は Technet Blog の更新停止に伴い &lt;a href=&quot;https://blogs.technet.microsoft.com/jpazure</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD B2B ゲスト ユーザーの連絡先情報の更新方法について</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/update-B2B-user-address/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/update-B2B-user-address/</id>
    <published>2023-04-06T21:00:00.000Z</published>
    <updated>2023-04-26T02:57:31.831Z</updated>
    
    <content type="html"><![CDATA[<div class="alert is-info"><p class="alert-title">Note</p><p>2020-10-22: 本記事の初版を投稿</p><p>2023-04-07: ポータル上の画面が変更されたことに伴い新しい画面ショットの案内を追記し更新</p></div><p>こんにちは、Azure Identity サポート チームの小田です。</p><p>今回は、Azure AD B2B ゲストユーザーの連絡先情報（電子メール / 連絡用メールアドレス）の更新方法についてご案内いたします。</p><p>Azure AD テナントにて別組織のユーザーを招待しますと、テナントにゲスト ユーザーが作成されます。ゲスト ユーザーの連絡先情報（電子メール / 連絡用メールアドレス）には、招待したときに指定した E メール アドレスが設定され、これらは Azure 側からの通知メール (計画メンテナンスなど) の宛先として使用されます。</p><p>ゲスト ユーザーが招待を承諾した後で、そのユーザーの実体が登録されているホーム テナント側で E メール アドレスの変更があった場合、そのユーザーをゲストとして登録しているリソース テナント側では、E メール アドレスの変更は反映されません。</p><p>そのため、ゲスト ユーザーがホーム テナント側で持っている属性値 (E メール アドレス等) を修正する場合、これまではゲスト ユーザーを一旦削除して「再招待」を実施するか、Microsoft Graph API、Exchange 管理センター、または Exchange Online PowerShell 経由で更新する必要がありました。</p><p>しかしながら、2020 年 10 月現在、ゲスト ユーザーの連絡先情報（電子メール / 連絡用メールアドレス）は、Azure AD 管理センターにて編集可能になりました。再招待を実施することなく、ゲスト ユーザーのメール アドレスの変更を変更する具体的な手順は、下記のとおりです。</p><h2 id="変更手順"><a href="#変更手順" class="headerlink" title="変更手順"></a>変更手順</h2><ol><li>Azure ポータル <a href="https://portal.azure.com/">(https://portal.azure.com/)</a> にアクセスし、グローバル管理者もしくはユーザー管理者にてサインインします。</li><li>[Azure Active Directory] - [ユーザー] - [すべてのユーザー] - [編集対象のゲストユーザー] をクリックし、[プロパティ] を開きます。</li><li>[編集] をクリックし、「連絡先情報」を編集します。</li></ol><p><img src="/blog/azure-active-directory/update-B2B-user-address/address-update-in-AzurePortal.png"></p><ol start="4"><li>[保存] をクリックします。</li></ol><h2 id="変更手順-新しいプレビュー画面の場合"><a href="#変更手順-新しいプレビュー画面の場合" class="headerlink" title="変更手順 (新しいプレビュー画面の場合)"></a>変更手順 (新しいプレビュー画面の場合)</h2><p>Azure ポータルでは現在、ユーザーの画面については新しいプレビュー画面を利用可能です。新しい画面を利用している場合は、下記手順をご利用ください。</p><p>なお、従来の画面の “電子メール” は新しい画面の “メール” の項目に該当し、 “連絡用メール アドレス” は “その他のメール” の項目が該当します。</p><ol><li>Azure ポータル <a href="https://portal.azure.com/">(https://portal.azure.com/)</a> にアクセスし、グローバル管理者もしくはユーザー管理者にてサインインします。</li><li>[Azure Active Directory] - [ユーザー] - [すべてのユーザー] - [編集対象のゲストユーザー] をクリックし、[プロパティ] を開きます。</li><li>[編集] をクリックし、「連絡先情報」のタブを開きます。”メール” および “その他のメール”を編集します。</li></ol><p><img src="/blog/azure-active-directory/update-B2B-user-address/address-update-in-aad2.png"></p><ol start="4"><li>[保存] をクリックします。</li></ol><h2 id="参考情報"><a href="#参考情報" class="headerlink" title="参考情報"></a>参考情報</h2><p>Azure Active Directory B2B コラボレーション ユーザーのプロパティ<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/external-identities/user-properties#can-i-update-a-guest-users-email-address">https://docs.microsoft.com/ja-jp/azure/active-directory/external-identities/user-properties#can-i-update-a-guest-users-email-address</a></p><p>Changelog for Microsoft Graph<br><a href="https://docs.microsoft.com/en-us/graph/changelog">https://docs.microsoft.com/en-us/graph/changelog</a></p><p>なお、Azure ポータルでは、ゲスト ユーザーだけではなく、組織内ユーザーに対しても E メール アドレスを変更することが可能です。組織内のユーザーは、Exchange Online のライセンスが割り当たっている可能性もありますので、このような場合は、 Exchange Online 側で E メールアドレス操作を実施ください。</p><p>上記内容が少しでも参考となりますと幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;alert is-info&quot;&gt;&lt;p class=&quot;alert-title&quot;&gt;Note&lt;/p&gt;&lt;p&gt;2020-10-22: 本記事の初版を投稿&lt;/p&gt;&lt;p&gt;2023-04-07: ポータル上の画面が変更されたことに伴い新しい画面ショットの案内を追記し更新&lt;/</summary>
      
    
    
    
    
    <category term="Azure AD B2B" scheme="https://jpazureid.github.io/blog/tags/Azure-AD-B2B/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Entra の最新情報</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/microsoft-entra-updates-you-may-have-missed/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/microsoft-entra-updates-you-may-have-missed/</id>
    <published>2023-04-06T00:00:00.000Z</published>
    <updated>2023-04-26T02:57:31.695Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 小出 です。</p><p>本記事は、2023 年 3 月 24 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/microsoft-entra-updates-you-may-have-missed/ba-p/2967449">microsoft-entra-updates-you-may-have-missed</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>マイクロソフトの第 2 四半期は、Microsoft Entra のセキュリティ機能のアップデートが行われ、また、組織のセキュリティ態勢を改善するためのセキュリティ分野の幅広い機能領域で一般提供の発表が行われた年でした。</p><p>以下にて、新しく追加された機能のリストをご案内しています。発表された内容を見逃した場合や、マイクロソフトが追加した内容を素早く確認したい場合は、以下のリストをご利用ください。これらのアップデートはエリアごとに整理されており、興味のある分野を簡単に見つけて確認することができます。</p><h2 id="ID-の保護"><a href="#ID-の保護" class="headerlink" title="ID の保護"></a>ID の保護</h2><ul><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-conditional-access-cloud-apps#authentication-context">条件付きアクセスの認証コンテキスト</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-connect-staged-rollout#enable-staged-rollout">段階的なロールアウトを利用した CBA のテスト</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/reports-monitoring/concept-sign-ins">サインイン ログで NPS 拡張機能と AD FS MFA アダプターの MFA イベントを表示する</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/identity-protection/concept-identity-protection-risks#user-linked-detections">ディレクトリの異常な変更に基づくユーザー侵害の検出</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/how-to-mfa-server-migration-utility">Azure 多要素認証 (MFA) サーバー移行</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/howto-conditional-access-session-lifetime#require-reauthentication-every-time">Intune 登録時の強制再認証とリスクのあるサインイン/ユーザーへの対応機能</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/identity-protection/concept-identity-protection-risks">ユーザーを対象とした認証後の異常行動検知</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/identity-protection/concept-workload-identity-risk#workload-identity-risk-detections">サービス プリンシパルの異常な資格情報の変更を検出する</a></li></ul><h2 id="ID-の刷新"><a href="#ID-の刷新" class="headerlink" title="ID の刷新"></a>ID の刷新</h2><ul><li><a href="https://learn.microsoft.com/ja-jp/azure/role-based-access-control/conditions-overview">Azure Blob Services の属性ベースのアクセス制御 - ABAC</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/external-identities/direct-federation">単一の SAML/WS-Fed ベースの IdP を複数のドメインで構成する</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/devices/device-management-azure-portal#configure-device-settings">全ユーザーの Bitlocker セルフサービス リカバリーをブロックする</a>  </li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/roles/admin-units-members-add">管理単位でグループを作成する</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/recover-from-deletions#administrative-units">管理単位とデバイスの論理削除について</a> </li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-connect-fed-group-claims">正規表現を使ってトークン要求のグループ名をフィルタリングして変換する</a>  </li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/develop/active-directory-saml-claims-customization#claim-transformations">アプリケーションの統合と移行のための複数値に対するクレーム変換</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/roles/administrative-units">デバイスの管理単位でのサポート</a></li></ul><h2 id="Identity-Governance"><a href="#Identity-Governance" class="headerlink" title="Identity Governance"></a>Identity Governance</h2><ul><li><a href="https://learn.microsoft.com/ja-jp/azure/lighthouse/how-to/create-eligible-authorizations">Azure Lighthouse のための PIM における権限ある認可について</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/app-provisioning/on-premises-application-provisioning-architecture">オンプレミスのアプリケーションにユーザーをプロビジョニングする</a>  </li></ul><h2 id="パスワードレス"><a href="#パスワードレス" class="headerlink" title="パスワードレス"></a>パスワードレス</h2><ul><li><a href="https://learn.microsoft.com/ja-jp/windows/security/identity-protection/hello-for-business/hello-hybrid-cloud-kerberos-trust">Windows Hello for Business (WHFB) のクラウド信頼性</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/howto-authentication-temporary-access-pass">AADJ デバイスの Windows Web サインインを一時アクセス パスのみ使用するよう制限する</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/howto-authentication-passwordless-phone#multiple-accounts-on-ios">iOS 端末の複数パスワードレス電話サインインについて</a></li></ul><h2 id="外部-ID-B2B-amp-B2C"><a href="#外部-ID-B2B-amp-B2C" class="headerlink" title="外部 ID (B2B &amp; B2C)"></a>外部 ID (B2B &amp; B2C)</h2><ul><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/external-identities/reset-redemption-status">ゲストユーザーの引き換えステータスをリセットする</a></li></ul><h2 id="過去に発表されたアップデート"><a href="#過去に発表されたアップデート" class="headerlink" title="過去に発表されたアップデート"></a>過去に発表されたアップデート</h2><p>さらに、マイクロソフトは以前、当社のセキュリティ サービスを強化するためのいくつかのアップデートを発表しました。これらのアップデートには、証明書ベースの認証、FIPS 140 への準拠、Microsoft Authenticator アプリの高度な機能などが含まれています。これらのアップデートとその機能の詳細については、以下のリンクをご確認ください。</p><ul><li><a href="https://jpazureid.github.io/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile/">モバイル端末での Azure AD 証明書ベース認証 (CBA) (サポート チームによる翻訳)</a></li><li><a href="https://jpazureid.github.io/blog/azure-active-directory/microsoft-brings-fips-140-compliance/">Microsoft Authenticator が FIPS 140 に準拠しました (サポート チームによる翻訳)</a></li><li><a href="https://jpazureid.github.io/blog/azure-active-directory/defend-your-users-from-mfa-fatigue-attacks/">Microsoft Authenticator の MFA 疲労攻撃対策 - 数値の一致による MFA が 有効化されます (サポート チームによる翻訳)</a></li><li><a href="https://jpazureid.github.io/blog/azure-active-directory/ca-filter-for-apps/">アプリの条件付きアクセス フィルターがパブリック プレビューになりました (サポート チームによる翻訳)</a></li><li><a href="https://jpazureid.github.io/blog/azure-active-directory/microsoft-entra-workload-id-ga/">Microsoft Entra ワークロード ID の一般提供 (サポート チームによる翻訳)</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 小出 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 3 月 24 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Entra の変更のアナウンス (2023 年 3 月の状況)</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/microsoft-entra-change-announcements-march-2023-train/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/microsoft-entra-change-announcements-march-2023-train/</id>
    <published>2023-04-03T00:00:00.000Z</published>
    <updated>2023-04-26T02:57:31.683Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 高田 です。</p><p>本記事は、2023 年 3 月 31 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/microsoft-entra-change-announcements-march-2023-train/ba-p/2967448">Microsoft Entra Change Announcements – March 2023 Train</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>本日は、3 月分の機能変更と重大な変更について紹介します。これらの変更は、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/whats-new">リリースノート</a> や電子メールでもお伝えしています。また、お客様が新しい Entra 管理センターでライフサイクルの変更 (廃止、サポート終了、サービスの重大な変更) を管理しやすくするための取り組みも続けています。さらに今後、新機能のリリースをこのブログ記事の一部として掲載し、既存機能の変更と新機能の両方を 1 つのリストで確認できるようにする予定です。</p><p>2023 年 3 月の変更は以下のとおりです。</p><h2 id="セキュリティの改善"><a href="#セキュリティの改善" class="headerlink" title="セキュリティの改善"></a>セキュリティの改善</h2><h3 id="番号の一致機能に関するメッセージ-センターへの投稿内容の更新"><a href="#番号の一致機能に関するメッセージ-センターへの投稿内容の更新" class="headerlink" title="番号の一致機能に関するメッセージ センターへの投稿内容の更新"></a>番号の一致機能に関するメッセージ センターへの投稿内容の更新</h3><p>Microsoft Authenticator アプリの番号の一致機能は、2022 年 11 月に GA しました。Microsoft Authenticator のプッシュ通知を利用しているユーザーに番号の一致機能をスムーズに展開するために、まだ展開の制御機能 (Azure Portal の管理画面と Microsoft Graph API から利用可能) を利用されていない場合は、ぜひ活用されることをお勧めします。弊社では以前、2023 年 2 月 27 日から Microsoft Authenticator のプッシュ通知のすべての利用者に対して、管理者用の設定を削除し、テナント全体で番号の一致機能を強制すると発表していました。しかしながら、お客様の声に耳を傾けた結果、管理者用の設定を利用できる期間をあと数週間延長することにいたしました。組織は、<strong>2023 年 5 月 8 日</strong> まで、既存の展開の制御設定を使用して、組織で番号の一致機能を展開することができます。マイクロソフトは、2023 年 5 月 8 日以降、Microsoft Authenticator のプッシュ通知を利用するすべてのユーザーに対して、番号の一致機能の強制を開始する予定です。また、その日以降、番号の一致に関する管理者用の設定機能を削除する予定です。</p><p>お客様側で 2023 年 5 月 8 日より前にすべてのユーザーに Microsoft Authenticator プッシュ通知の番号一致機能を有効にしない場合、マイクロソフト側でこの変更を強制的に展開しますが、その間、ユーザーのサインイン時の動作が一貫性のないものになる可能性があります。すべてのユーザーで一貫した動作とするために、事前に Microsoft Authenticator のプッシュ通知の番号一致機能を有効にすることを強くお勧めします。詳細については、以下をご覧ください。</p><ul><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/how-to-mfa-number-match">多要素認証 (MFA) 通知で数値の一致を使用する方法 - 認証方法ポリシー</a></li><li><a href="https://jpazureid.github.io/blog/azure-active-directory/defend-your-users-from-mfa-fatigue-attacks/">Microsoft Authenticator の MFA 疲労攻撃対策 - 数値の一致による MFA が 有効化されます</a></li></ul><h3 id="Azure-Multifactor-Authentication-MFA-Server"><a href="#Azure-Multifactor-Authentication-MFA-Server" class="headerlink" title="Azure Multifactor Authentication (MFA) Server"></a>Azure Multifactor Authentication (MFA) Server</h3><p>2024 年 9 月 30 日より、展開済みの Azure Multifactor Authentication (MFA) Server は、多要素認証 (MFA) リクエストに応答しなくなり、お客様の組織では認証に失敗する可能性があります。認証機能の利用を中断させず、サポートされた状態を維持するため、お客様におかれましては、最新の <a href="https://www.microsoft.com/en-us/download/details.aspx?id=55849">Azure MFA Server の更新</a> に含まれる移行ユーティリティを使用して、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/how-to-migrate-mfa-server-to-azure-mfa-user-authentication">ユーザーの認証データをクラウド ベースの Azure MFA サービスに移行</a> ください。詳しくは、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/how-to-migrate-mfa-server-to-azure-mfa-user-authentication">Azure MFA Server の移行</a> をご覧ください。</p><h3 id="システムが推奨する認証方式の有効化"><a href="#システムが推奨する認証方式の有効化" class="headerlink" title="システムが推奨する認証方式の有効化"></a>システムが推奨する認証方式の有効化</h3><p>現在、さまざまな認証方式をユーザーが選んだ既定の方法として選択できるようになっています。しかし、すべての認証方式が同じレベルのセキュリティを提供するわけではありません。特にフィッシングに強い認証方法の代わりに、安全性の低い認証方法が選択された場合には、組織に潜在的なリスクが生じます。</p><p>これに対処するため、MFA にシステムが推奨する認証方式 (システム優先 MFA 機能) を導入します。この機能が有効になると、MFA の実行時に、ユーザーの登録した認証方法のうち最も安全な認証方法が、第二認証要素として要求されるようになります。これにより、より安全な方法が登録され利用可能な場合でも、ユーザーが指定した既定の方法が選択され、常にその方法が最初に要求されるという、以前の機能が置き換えられます。この機能は、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/concept-system-preferred-multifactor-authentication?branch=pr-en-us-227476#enable-system-preferred-mfa">Microsoft Graph API</a> を使用することで、<strong>本日より利用可能</strong> です。この機能を有効にすると、ユーザーは、利用可能な最も推奨された認証方法を使用してサインインするよう促されます。詳しくは、<a href="https://learn.microsoft.com/en-us/azure/active-directory/authentication/concept-system-preferred-multifactor-authentication?branch=pr-en-us-227476">システム優先多要素認証の記事</a> ご確認ください。</p><h3 id="条件付きアクセスの「承認されたクライアント-アプリが必要です」の廃止"><a href="#条件付きアクセスの「承認されたクライアント-アプリが必要です」の廃止" class="headerlink" title="条件付きアクセスの「承認されたクライアント アプリが必要です」の廃止"></a>条件付きアクセスの「承認されたクライアント アプリが必要です」の廃止</h3><p><strong>2026 年 3 月 31 日に、Azure Active Directory (Azure AD) 条件付きアクセスの 「承認されたクライアント アプリを要求する」の制御が提供終了となり、適用されなくなります。</strong> この日までに、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-conditional-access-grant#require-app-protection-policy">アプリの保護ポリシーが必要</a> の制御に移行して使用を開始する必要があります。<a href="https://learn.microsoft.com/en-us/azure/active-directory/conditional-access/concept-conditional-access-grant#require-app-protection-policy">アプリの保護ポリシーが必要</a> は「承認されたクライアント アプリを要求する」の機能をすべて備えており、加えて以下のような利点もありますので、この恩恵を得るために、早めに移行することをお勧めします。</p><ul><li>対応する Intune ポリシーも検証される。</li><li>ユーザーにアクセスが許可される前に適用される。</li><li>セキュリティが強化されている。</li></ul><p>サービスの利用が中断されるのを避けるため、<strong>2026 年 3 月 31 日までに Azure AD の条件付きアクセスで「アプリ保護ポリシーが必要」の制御を利用する</strong>よう <a href="http://aka.ms/RetireApprovedClientApp">移行</a> ください。ご質問がある場合は、<a href="http://aka.ms/ApprovedClientAppRetirementQA">Microsoft Q&amp;A</a> でコミュニティの専門家にもご質問ください。</p><h3 id="従来の多要素認証-MFA-およびセルフサービス-パスワード-リセット-SSPR-ポリシーにおける認証方法の管理の廃止"><a href="#従来の多要素認証-MFA-およびセルフサービス-パスワード-リセット-SSPR-ポリシーにおける認証方法の管理の廃止" class="headerlink" title="従来の多要素認証 (MFA) およびセルフサービス パスワード リセット (SSPR) ポリシーにおける認証方法の管理の廃止"></a>従来の多要素認証 (MFA) およびセルフサービス パスワード リセット (SSPR) ポリシーにおける認証方法の管理の廃止</h3><p><strong>2024 年 9 月 30 日</strong> 以降、従来の <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/howto-mfa-mfasettings#verification-methods">MFA</a> および <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/concept-sspr-howitworks#authentication-methods">SSPR</a> ポリシーで認証方法を管理することはできなくなります。組織は、パスワードレス、多要素認証、セルフサービス パスワード リセットを含むすべての認証方法を一元的に管理できる、統合された認証方法のポリシーに管理方法を <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/how-to-authentication-methods-manage">移行する</a> 必要があります。詳しくは、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/concept-authentication-methods-manage">Azure AD の認証方式を管理する</a> をご覧ください。</p><h3 id="Azure-AD-で-IPv6-がサポート"><a href="#Azure-AD-で-IPv6-がサポート" class="headerlink" title="Azure AD で IPv6 がサポート"></a>Azure AD で IPv6 がサポート</h3><p>以前、弊社では Microsoft Azure AD に IPv6 サポートを導入し、お客様が IPv4、IPv6、またはデュアル スタックのエンドポイントを経由してAzure AD のサービスにアクセスできるようにする計画を <a href="https://jpazureid.github.io/blog/azure-active-directory/ipv6-coming-to-azuread/">発表</a> しました。改めて、<strong>2023 年 3 月 31 日</strong> から段階的に Azure AD サービスに IPv6 サポートを導入し始めることをここでお知らせします。</p><p>ネットワークが IPv6 をサポートしていない場合、設定やポリシーを変更するためにアクションは必要はありません。ほとんどのお客様にとって、IPv4 の利用が完全に消えることはないため、Azure AD の機能やサービスにおいて IPv6 を必須としたり、IPv4 を非優先としたりすることは計画していません。Azure AD における IPv6 有効化に関する追加ガイダンスは、こちらの覚えやすいリンク (<a href="https://aka.ms/azureadipv6">https://aka.ms/azureadipv6</a>) で引き続き共有していきます。</p><h2 id="ユーザー体験の改善"><a href="#ユーザー体験の改善" class="headerlink" title="ユーザー体験の改善"></a>ユーザー体験の改善</h2><h3 id="利用規約のユーザー体験を刷新"><a href="#利用規約のユーザー体験を刷新" class="headerlink" title="利用規約のユーザー体験を刷新"></a>利用規約のユーザー体験を刷新</h3><p><strong>2023 年 7 月</strong> より、以下の利用規約のエンドユーザー体験を最新の PDF ビューアーに刷新し、URL を <a href="https://account.activedirectory.windowsazure.com/">https://account.activedirectory.windowsazure.com</a> から <a href="https://myaccount.microsoft.com/">https://myaccount.microsoft.com</a> に移行します。</p><ul><li>以前に承認された利用規約を閲覧する</li><li>サインインの流れの一環として利用規約を承認または拒否する</li></ul><p>機能が削除されることはありません。新しい PDF ビューアには機能が追加されますが、エンドユーザーからの見た目の変化は限定的である旨も将来のアップデートで通知される予定です。特定のドメインのみを通信の許可リストに入れている場合、利用規約が期待どおりに機能するためには、許可リストにドメイン「myaccount.microsoft.com」および「*.myaccount.microsoft.com」が含まれていることを確認ください。詳細については、<a href="https://aka.ms/touuiupdate">https://aka.ms/touuiupdate</a> をご覧ください。</p><h3 id="My-Groups-のユーザー体験の向上"><a href="#My-Groups-のユーザー体験の向上" class="headerlink" title="My Groups のユーザー体験の向上"></a>My Groups のユーザー体験の向上</h3><p>新しく改良された <strong>My Groups</strong> のユーザー体験が <a href="https://myaccount.microsoft.com/groups">myaccount.microsoft.com/groups</a> で利用可能でとなり、<strong>2023 年 5 月</strong> に古い画面は廃止となる予定です。以前の URL (<strong>mygroups.microsoft.com</strong>) にアクセスすると、<strong>myaccount.microsoft.com/groups</strong> の新しい画面にユーザーをリダイレクトします。</p><p>My Groups では、エンド ユーザーが参加するグループの検索、所有するグループの管理、既存のグループ メンバーシップの管理など、グループを簡単に管理することができます。また、お客様からのフィードバックに基づき、以下のような機能も追加されました:</p><ul><li>グループとグループ メンバーの一覧での並び替えとフィルタリング</li><li>巨大なグループに対するグループ メンバーの全リスト</li><li>メンバー追加の要求に対して概要ページで対応可能</li></ul><p>本日、ユーザーの皆様は、自身で <strong>myaccount.microsoft.com/groups</strong> に切り替えることで、新しい My Groups の恩恵を得ることができます。新旧の画面間のナビゲーションは、各サイトの通知バナーから利用できます。</p><p>注意: “セルフサービス グループ管理” の管理者用の設定は、新しい My Groups で利用できなくなり、<strong>2023 年 5 月</strong> に <strong>廃止</strong> される予定です。管理者は、グループの所有者やユーザーが My Groups にアクセスしたり利用したりすることを制限できなくなります。ただし、管理者は引き続き <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/enterprise-users/groups-self-service-management">こちら</a> に記載されている設定を使用して、エンド ユーザーが M365 とセキュリティ グループを作成する権限を制御することが可能です。</p><p><strong>この変更はすべてのお客様で自動的に行われ、お客様側での操作は必要はありません。</strong> 詳しくは、<a href="https://support.microsoft.com/ja-jp/account-billing/update-your-groups-info-in-the-my-apps-portal-bc0ca998-6d3a-42ac-acb8-e900fb1174a4">My Apps ポータルでグループ情報を更新する</a> をご覧ください。</p><h3 id="My-Apps-ポータルの改善"><a href="#My-Apps-ポータルの改善" class="headerlink" title="My Apps ポータルの改善"></a>My Apps ポータルの改善</h3><p>貴社にて <strong>myapps.microsoft.com</strong> を使用してアプリの検索やアクセスを行っており、ネットワークにおいて特定の証明書やドメインのみを許可している場合、今後もアプリに期待どおりアクセスできるように、許可リストを更新する必要があります。弊社では、パフォーマンスと耐障害性を向上させるために、アプリの起動に新しいエンドポイントを導入しました。アプリにアクセスした際の要求は、新しいドメインである <strong>launcher.myapps.microsoft.com</strong> に今後送られます。</p><p>現在、お客様が <strong>myapps.microsoft.com/signin</strong> または <strong>account.activedirectory.windowsazure.com/applications/signin</strong> のディープ リンクを使用しており、加えて特定の証明書のみを許可している場合、許可リストを更新して <strong>myapplications.microsoft.com</strong> の証明書も許可リストに含める必要があります。特定のドメインまたは IP アドレスのみを許可している場合は、<strong>launcher.myapps.microsoft.com</strong> を含むように許可リストを更新する必要もあります。My Apps ポータルが期待どおりに動作するために、<strong>2023 年 6 月 30 日</strong> までに許可リストを更新ください。</p><p>証明書の許可リストを更新する必要があるかどうかを簡単に確認するには、<a href="https://myapplications.microsoft.com/">https://myapplications.microsoft.com</a> にアクセスください。期待どおりに読み込まれる場合は対応の必要はありません。問題が発生した場合は更新が必要です。</p><p>過去に My Apps の証明書を許可した経緯があるのであれば、今回も同様に My Apps から返される新しい証明書を許可するように同じように対応する必要があります。許可リストに登録する必要がある My Apps の証明書の取得処理は、使用しているブラウザによって異なります。Edge の場合、URL バーの左側にある鍵のアイコンを選択します。次に、ドロップダウンから「接続がセキュリティで保護されています」と表示されたオプションを選択します。「接続がセキュリティで保護されています」の詳細で、証明書のアイコンを選択すると、証明書の詳細を含む証明書ビューアーが開きます。その他の情報については、<a href="https://learn.microsoft.com/ja-jp/microsoft-365/enterprise/urls-and-ip-address-ranges?view=o365-worldwide">Office 365 の URL と IP アドレスの範囲</a> をご覧ください。</p><h3 id="My-Apps-Secure-Sign-in-Extension"><a href="#My-Apps-Secure-Sign-in-Extension" class="headerlink" title="My Apps Secure Sign-in Extension"></a>My Apps Secure Sign-in Extension</h3><p>2023 年 5 月より、<a href="https://support.microsoft.com/en-us/account-billing/sign-in-and-start-apps-from-the-my-apps-portal-2f3b1bae-0e5a-4a86-a33e-876fbd2a4510">My Apps Secure Sign-in Extension</a> は、<a href="https://developer.chrome.com/docs/extensions/mv3/intro/mv3-overview/">Chromium の新しい Manifest Version 3 フォーマット</a> に対応するためにアップデートされる予定です。この拡張機能を使用しているいくつかの機能でアップデートが発生しますが、現時点ではお客様側で対処の必要はありません。これらのアップデートは以下のとおりです: </p><ul><li>Azure Marketplace または Azure AD アプリケーション ギャラリーからの一部の SAML アプリで利用可能だった、オプションの機能である <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/manage-apps/one-click-sso-tutorial">SAML シングル サインオンのワン クリックのアプリ構成</a> は、<strong>2023 年 5 月</strong> に提供が停止される予定です。この機能を使用して以前に構成されたすべてのアプリケーションは、引き続き動作し続けるため、現時点では追加の対応は必要ありません。</li><li>My Apps のアプリ検索の機能は、MyApps のすべてのアプリを横断的に検索するようになり、新しく起動の機能も提供されます。検索クエリを入力すると、My Apps ポータルが新しいタブで開き、検索クエリがアプリの一覧に適用されるようになりました。そして、検索結果からアプリを起動することが可能となります。拡張機能の画面として、最近使ったものの表示がなくなります。  </li><li>App Proxy のリンク変換機能で、動的かつセッションごとのルールが使用されるようになりました。これにより、1 テナントあたり上限として 2250 の一意なリンク変換の制限が導入されます。</li></ul><p><a href="https://microsoftedge.microsoft.com/addons/detail/my-apps-secure-signin-ex/gaaceiggkkiffbfdpmfapegoiohkiipl?hl=en-gb">Edge アドオン</a> または <a href="https://chrome.google.com/webstore/detail/my-apps-secure-sign-in-ex/ggjhpefgjjfobnfoldnjipclpcfbgbhl?hl=en-US">Chrome エクステンション</a> の最新バージョンを使用していることを確認ください。なお、この拡張機能の Firefox 版のサポートは 2021 年 9 月に終了しています。</p><h3 id="Azure-AD-管理センターから-Microsoft-Entra-管理センターにリダイレクトされる"><a href="#Azure-AD-管理センターから-Microsoft-Entra-管理センターにリダイレクトされる" class="headerlink" title="Azure AD 管理センターから Microsoft Entra 管理センターにリダイレクトされる"></a>Azure AD 管理センターから Microsoft Entra 管理センターにリダイレクトされる</h3><p><strong>2023 年 4 月 1 日</strong> より、Azure AD Admin Center (<a href="https://aad.portal.azure.com]">https://aad.portal.azure.com</a>) へのアクセスは Microsoft Entra Admin Center (<a href="https://entra.microsoft.com/">https://entra.microsoft.com</a>) にリダイレクトされます。新しい管理センター内からは、これまでどおり Azure AD の管理タスクをすべて完了することができます。管理機能へ中断なくアクセス出来るようにするために、必要に応じてファイアウォール規則を更新ください。ファイアウォール規則の詳細は、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/active-directory-faq#----------------------microsoft-entra---------url-------------------">こちら</a> をご覧ください。</p><p><strong>2023 年 4 月 1 日以降も Azure AD の管理ポータルにアクセスできるのでしょうか？</strong></p><ul><li>Azure AD 管理センター (<a href="https://aad.portal.azure.com/">https://aad.portal.azure.com</a>) は、<strong>2023 年 5 月</strong>まで機能を継続します。  </li><li>Azure ポータル (<a href="https://portal.azure.com/">https://portal.azure.com</a>) でも、Azure のお客様向けに Azure AD の提供を継続します。</li></ul><p>詳細は、<a href="https://jpazureid.github.io/blog/azure-active-directory/new-admin-center-unifies-azure-ad-with-other-identity-and-access-product/">新しい管理センターにおける Azure AD および他の ID とアクセス製品の統合</a> をご確認ください。</p><h2 id="開発者の体験の向上"><a href="#開発者の体験の向上" class="headerlink" title="開発者の体験の向上"></a>開発者の体験の向上</h2><h3 id="Azure-AD-Graph-API"><a href="#Azure-AD-Graph-API" class="headerlink" title="Azure AD Graph API"></a>Azure AD Graph API</h3><p>Azure AD Graph から Microsoft Graph へのスムーズな移行をお客様にお約束することを改めてお伝えしたいと思います。<a href="https://jpazureid.github.io/blog/azure-active-directory/Microsoft-Entra-change-announcements-September-2022-train/">以前に発表した</a> ように、Azure AD Graph は <strong>2023 年 6 月 30 日</strong> まで利用可能です。弊社はこの日以降にいつでもサービスを停止する権利を有していますが、利用状況を監視し、お客様が API から移行するための十分な時間を提供したうえで、停止措置を行うようにいたします。その間、セキュリティ関連の修正を含めた Azure AD Graph のサポートを提供し続けますが、Azure AD Graph に依存した状態で運用環境を構成することは非推奨とします。すべての新機能と特徴は、<a href="https://docs.microsoft.com/ja-jp/graph/overview">Microsoft Graph </a> でのみ提供されます。すべてのお客様が、Microsoft Graph へ移行することを強く推奨します。詳しくは、<a href="https://docs.microsoft.com/ja-jp/graph/migrate-azure-ad-graph-overview">Azure AD Graph アプリを Microsoft Graph に移行する</a> をご覧ください。</p><h3 id="Azure-AD-Preview-と-MSOnline-PowerShell-の廃止"><a href="#Azure-AD-Preview-と-MSOnline-PowerShell-の廃止" class="headerlink" title="Azure AD (Preview) と MSOnline PowerShell の廃止"></a>Azure AD (Preview) と MSOnline PowerShell の廃止</h3><p>Azure AD、Azure AD Preview、MSOnline の 3 つの PowerShell モジュールのサポート期間の終了が近づいており、廃止予定日が <strong>2023 年 6 月 30 日</strong> であることを改めてお知らせしたいと思います。Azure AD API の状況によっては、2023 年 6 月 30 日以降、一部のコマンドレットが動作しなくなる可能性があります。弊社は、使用状況を確認し、お客様が 3 つの PowerShell モジュールから移行するための猶予を提供した上で、これらモジュールの利用を停止させる予定です。Microsoft Graph でこれら API の代替の機能が提供されない限り、API およびコマンドレットを停止させることはありません。</p><p>利用停止までは、セキュリティ関連の更新をサポートし続ける予定です。弊社はこれからも Microsoft Graph PowerShell SDK に対して、全ての PowerShell 関連の機能改善を行う予定であり、お客様においても移行を継続することを推奨します。</p><p>詳しくは、<a href="https://learn.microsoft.com/ja-jp/powershell/microsoftgraph/migration-steps?view=graph-powershell-1.0">Azure AD PowerShell から Microsoft graph PowerShell SDK への移行</a> のドキュメントをご覧ください。</p><h3 id="ライセンス割り当て-API-PowerShell-の廃止"><a href="#ライセンス割り当て-API-PowerShell-の廃止" class="headerlink" title="ライセンス割り当て API/PowerShell の廃止"></a>ライセンス割り当て API/PowerShell の廃止</h3><p><strong>既存テナント</strong> の Azure AD Graph および MSOnline PowerShell ライセンス割り当て API と PowerShell コマンドレットの廃止予定日が <strong>2023 年 3 月 31 日</strong> であることを改めてお知らせします。2022 年 11 月 1 日以降に作成された <strong>新規テナント</strong> では、これら API とコマンドレットは既に動作しません。</p><p><a href="https://jpazureid.github.io/blog/azure-active-directory/migrate-your-apps-to-access-the-license-managements/">Azure AD Graph および MSOnline での従来のライセンスの割り当て方法が廃止され Microsoft Graph によるライセンス管理に変更される</a> および <a href="https://learn.microsoft.com/ja-jp/powershell/microsoftgraph/azuread-msoline-cmdlet-map?view=graph-powershell-1.0">Azure AD と MSOnline コマンドレットに対応する Microosft Graph PowerShell を見つける</a> のガイダンスに従って、Microsoft Graph への移行を速やかに行うことを推奨します。</p><p>以下は、弊社からの変更管理についての連絡予定の概要です。</p><table><thead><tr><th><strong>カテゴリ</strong></th><th><strong>定義</strong></th><th><strong>連絡の予定</strong></th></tr></thead><tbody><tr><td>製品の廃止の連絡</td><td><strong>機能、性能、または製品を特定の期間後に廃止</strong>することを指します。<br/><br/>これは、一般的に、新たなお客様に対してサービスや機能の提供を停止し、廃止予定の機能に対して技術的面での投資が削減されることを意味します。最終的には、EOL (end-of-life) の状態に至り、すべてのお客様に対してサービスや機能の提供が停止されます。</td><td>年に 2 回 (3 月、9 月)</td></tr><tr><td>製品の既存の動作に影響を与える変更および機能変更のお知らせ</td><td><strong>既存の動作に影響を与える変更</strong>: 継続的な運用のためにお客様が何らかの操作や変更を行わない場合、既存のユーザーおよびパートナー体験に影響が生じると想定される変更です。<br/><strong>機能の変更</strong>: 既存の ID の機能に対する変更であり、お客様側での作業は必要はありませんが、ユーザー体験に変化が生じます。多くは、UI/UX (ユーザー インターフェイスおよびユーザー体験) への変更です。<br/>これらの変更は一般的に頻繁に発生するため、より頻繁に弊社からの通知が必要となります。</td><td>年に 4 回 (3 月、6 月、9 月、11 月)</td></tr></tbody></table><p>毎月の更新については、リリースノートのページでご確認ください: <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/whats-new">Azure Active Directory の新着情報</a></p><p>いつものように、フィードバックや提案をお待ちしています。以下のコメントまたは <a href="https://feedback.azure.com/d365community/forum/22920db1-ad25-ec11-b6e6-000d3a4f0789">Azure AD feedback forum</a> でご意見をお聞かせください。また、Microsoft Q&amp;A で、質問、未解決の問題や機能に関するご要望を #AzureADChangeManagementMar2023Train のタグを使用して送信することも可能です。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 高田 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 3 月 31 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD B2B とは</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/what-is-b2b/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/what-is-b2b/</id>
    <published>2023-03-31T15:00:00.000Z</published>
    <updated>2023-04-26T02:57:31.831Z</updated>
    
    <content type="html"><![CDATA[<div class="alert is-info"><p class="alert-title">Note</p><p>本記事は Technet Blog の更新停止に伴い <a href="https://blogs.technet.microsoft.com/jpazureid/2017/12/12/about-azure-ad-b2b/">TechNet Blog</a> の内容を移行したものです。元の記事の最新の更新情報については、本内容をご参照ください。</p></div><div class="alert is-info"><p class="alert-title">Note</p><p>2017-12-12: 本記事の初版を投稿</p><p>2023-04-01: 画面ショットや Azure ポータル上のメニューの変更に伴い内容を更新</p></div><p>こんにちは、Azure &amp; Identity サポート チームの三輪です。</p><p>今回は Azure AD B2B (Business-To-Business) コラボレーション機能 (以下、Azure AD B2B) について紹介します。この記事はもともと 2017 年 12 月に公開されましたが、その後 Azure ポータルのメニューなどが変更されたため、内容を最新版に更新いたしました</p><p>Azure AD B2B の概要については、公開ドキュメントである <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/active-directory-b2b-what-is-azure-ad-b2b">B2B コラボレーションの概要</a> をまずご覧ください。</p><p>Azure AD B2B と聞くと、もしかしたら小難しく聞こえるかもしれませんが、要は他の Azure AD テナント上のユーザーを自テナントに追加 (招待) する機能のことです。具体的には、Azure AD を利用する中で、次のような要望がでてくることがあります。</p><ul><li>会社間 (Azure AD テナント間) で自社が公開しているリソースを共有したい</li><li>別の Azure AD テナントに紐づいているリソースを使用したい</li><li>ひとりの管理者で、複数の Azure AD テナントを管理したい 等</li></ul><p>このような連携が必要な時に利用する機能が、今回紹介する Azure AD B2B になります。</p><h2 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h2><p>Azure サブスクリプションは必ず 1 つの Azure AD テナントに関連付けられています。通常、このサブスクリプションが紐づく Azure AD テナントに所属しているユーザーのみがそのサブスクリプション内のリソースを管理可能です。</p><p><img src="/blog/azure-active-directory/what-is-b2b/subscription-user.png"></p><p>では、複数の Azure AD テナントがある場合はどのようになるでしょうか。この場合、そのままでは別の Azure AD テナント B からテナント A へアクセスしたり、別の Azure AD テナント A に関連付けられているサブスクリプションに Azure AD テナント B のユーザーが管理操作をおこなったりすることはできません。</p><p><img src="/blog/azure-active-directory/what-is-b2b/subscription-user-inaccessible.png"></p><p>こんな時、Azure AD B2B を利用することで、自身の Azure AD テナントに他テナントのユーザーを招待することで、ユーザー本体は別の Azure AD テナントに所属しながら、招待した側のテナントのリソースを利用することが可能となります。</p><p><img src="/blog/azure-active-directory/what-is-b2b/invite-user-to-tenant.png"></p><h2 id="詳細"><a href="#詳細" class="headerlink" title="詳細"></a>詳細</h2><p>別の Azure AD テナントのユーザーを自テナントに招待する方法で多く利用されるものを 2 つ紹介します。</p><h3 id="1-ゲスト-ユーザーの直接的な招待"><a href="#1-ゲスト-ユーザーの直接的な招待" class="headerlink" title="1. ゲスト ユーザーの直接的な招待"></a>1. ゲスト ユーザーの直接的な招待</h3><p>明示的に別の Azure AD テナントのユーザー (または outlook.com や gmail.com など外部アカウント) を招待し追加する操作です。Azure ポータルのメニューより [Azure Active Directory] – [ユーザーとグループ] – [すべてのユーザー] – [新しいユーザー] の順に進みます。下記、[外部ユーザーの招待] からユーザーの E メール アドレス (もしくは Azure AD の UPN) を追加します。指定されたユーザーに招待 E メールが送られますので、E メールを受け取ったユーザーは、その E メールのリンクからウィザードを完了する必要があります。</p><p><img src="/blog/azure-active-directory/what-is-b2b/screenshot-new-guest-user-new.png"></p><h3 id="2-RBAC-アクセス制御-IAM-によるユーザーの招待"><a href="#2-RBAC-アクセス制御-IAM-によるユーザーの招待" class="headerlink" title="2. RBAC (アクセス制御 IAM) によるユーザーの招待"></a>2. RBAC (アクセス制御 IAM) によるユーザーの招待</h3><p>RBAC を用いて、Azure サブスクリプションに紐づけられている Azure AD テナント上のユーザーに対してアクセス許可を割り当てることができます。では、RBAC でアクセス権を割り当てるときに別の Azure AD テナントのユーザーを指定したい時には、先に 1 の作業を実施しておく必要があるのでしょうか？</p><p>いいえ、もしアクセス許可を割り当てようとしているユーザーがそのテナントに存在していない場合には、RBAC の設定時に自動的に 1 のユーザー招待も併せて行われます。手順としては、Azure ポータルの [サブスクリプション] – [サブスクリプション名] – [アクセス制御 (IAM)] の順にお進みください。下記、[追加] から別の Azure AD テナントのユーザーを追加することができます。指定された E メール アドレスには、招待 E メールが送られ、その E メールよりウィザードを完了する流れは同様になりますが、同時にサブスクリプションに対するロールが割り当てられます。</p><p><img src="/blog/azure-active-directory/what-is-b2b/screenshot-iam-new.png"></p><h2 id="よくあるお問い合わせ"><a href="#よくあるお問い合わせ" class="headerlink" title="よくあるお問い合わせ"></a>よくあるお問い合わせ</h2><p><span style="color:blue">Q</span>. B2B の機能以外で Azure AD 間の連携を行うことは可能ですか？</p><p><span style="color:red">A</span>. いいえ、テナント間での連携を行いたい場合は、Azure AD B2B を利用することが基本です。Azure AD のテナント間同機の仕組みでも、Azure AD B2B の仕組みが利用されています。Azure AD B2B の機能は Azure AD のテナント同士を連携するものではなく、 Azure AD テナントと別の Azure AD テナントのユーザーを連携する機能とお考えください。</p><p><span style="color:blue">Q</span>. 別の Azure AD テナントに登録されたアプリケーションを利用するのに、Azure AD B2B の機能を利用できますか？</p><p><span style="color:red">A</span>. はい、B2B の機能で要件を満たせます。Azure AD B2B の機能で別の Azure AD テナントのユーザーを自テナントに招待することで、その招待されたユーザーが 自テナント (自社の Azure AD テナント) 上のアプリケーションを利用することが可能となります。</p><h2 id="おわりに"><a href="#おわりに" class="headerlink" title="おわりに"></a>おわりに</h2><p>今回は、Azure AD B2B に関する概要について紹介しました。Azure AD B2B に関するトラブルや Azure AD B2B 完了後のトラブル、または招待 E メールを利用しない方法などの記事も必要に応じて参照ください。また、それでも問題が解決しない場合は、弊社サポートまで遠慮なくお問い合わせください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;alert is-info&quot;&gt;&lt;p class=&quot;alert-title&quot;&gt;Note&lt;/p&gt;&lt;p&gt;本記事は Technet Blog の更新停止に伴い &lt;a href=&quot;https://blogs.technet.microsoft.com/jpazure</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="RBAC" scheme="https://jpazureid.github.io/blog/tags/RBAC/"/>
    
    <category term="Azure AD B2B" scheme="https://jpazureid.github.io/blog/tags/Azure-AD-B2B/"/>
    
  </entry>
  
  <entry>
    <title>招待したユーザーが利用できない</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/azuread-b2b-troubleshooting/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/azuread-b2b-troubleshooting/</id>
    <published>2023-03-26T01:00:00.000Z</published>
    <updated>2023-04-26T02:57:31.367Z</updated>
    
    <content type="html"><![CDATA[<div class="alert is-info"><p class="alert-title">Note</p><p>本記事は Technet Blog の更新停止に伴い <a href="https://blogs.technet.microsoft.com/jpazureid/2017/11/27/azuread-b2b-troubleshooting/">TechNet Blog</a> の内容を移行したものです。元の記事の最新の更新情報については、本内容をご参照ください。</p></div><div class="alert is-info"><p class="alert-title">Note</p><p>2017-11-27: 本記事の初版を投稿</p><p>2023-03-26: 画面ショットや Azure ポータル上のメニューの変更に伴い内容を更新</p></div><p>こんにちは、Azure &amp; Identity サポート チームの 小出 と 三輪 です。</p><p>本記事では Azure AD に招待したはずのユーザーが利用できない際の確認ポイントについて説明します。この記事はもともと 2017 年 11 月に公開されましたが、その後 Azure ポータルのメニューなどが変更されたため、内容を最新版に更新いたしました。</p><p>Azure AD へのユーザー招待は、明示的に Azure Active Directory の管理画面からゲスト ユーザーを追加した場合だけでなく、その追加したユーザーが Azure AD にすでに追加済みでなければ、Azure のサブスクリプションに対して “所有者” や “仮想マシン共同作成者” の役割を追加したときにも行われます。</p><p>ユーザーを招待した後には、招待されたユーザー側でその招待の受諾処理を行う必要があり、それが完了していないと、役割を割り当てたもののサブスクリプションの利用ができないというような状況になります。そのような状況の場合は、まずはじめに Azure ポータルにて招待状況を確認しましょう。</p><h2 id="Azure-ポータルでの招待状況の確認方法"><a href="#Azure-ポータルでの招待状況の確認方法" class="headerlink" title="Azure ポータルでの招待状況の確認方法"></a>Azure ポータルでの招待状況の確認方法</h2><p>招待操作を行ったテナントの管理者権限を持つユーザーで Azure ポータルにサインインし、[Azure Active Directory] – [ユーザー] – [すべてのユーザー] から該当のゲスト ユーザーを選択します。</p><p>[プロパティ] のタブで「外部ユーザーの状態」(赤枠) の項目が「保留中の承諾」の場合は、招待メールは送信されているものの、該当のユーザーが招待を受け付け操作を完了していない状態を示します。招待を受けたユーザーは送信された E メールに含まれる [招待の承諾] のリンクをクリックしてウィザードを完了させる必要があります。</p><p>なお、招待 E メールが届いていない場合、緑枠部分の「B2B コラボレーション」の [管理（招待の再送信/状態のリセット）] から招待 E メールの再送も可能です。</p><p><img src="/blog/azure-active-directory/azuread-b2b-troubleshooting/new1.png"></p><p><img src="/blog/azure-active-directory/azuread-b2b-troubleshooting/new2.png"></p><p>招待 E メールは下記のようなメールです。</p><p>アドレス: <a href="mailto:&#105;&#110;&#x76;&#x69;&#x74;&#101;&#x73;&#64;&#109;&#x69;&#x63;&#x72;&#111;&#x73;&#111;&#x66;&#116;&#x2e;&#x63;&#x6f;&#x6d;">&#105;&#110;&#x76;&#x69;&#x74;&#101;&#x73;&#64;&#109;&#x69;&#x63;&#x72;&#111;&#x73;&#111;&#x66;&#116;&#x2e;&#x63;&#x6f;&#x6d;</a><br>件名: 組織内のアプリケーションにアクセスするための &lt;招待者&gt; さんからの招待</p><p><img src="/blog/azure-active-directory/azuread-b2b-troubleshooting/new3.png"></p><div class="alert is-info"><p class="alert-title">Note</p><p>件名に招待者の名前がない場合、ProxyAddresses 属性に値が入っていないユーザーで招待操作を行ったことが考えられます。この場合、特定のユーザー名の代わりにテナント名が記載されます。</p></div><p>もし、招待されたユーザーが E メールを利用できない場合や、E メール ボックスの作成前の場合は、招待の再送信後に表示される下記、「招待 URL ※」をコピーして、何らかの手段でその URL を招待されたユーザーにお渡しください。招待されたユーザーは、その URL にブラウザーからアクセスすることで招待の完了作業を進めることができます。</p><p>※ URL にアクセスして招待の完了作業を進めても、招待 E メールの「招待の承諾」を押す場合と同等の操作になります。</p><p><img src="/blog/azure-active-directory/azuread-b2b-troubleshooting/new4.png"></p><p>招待された外部ユーザーの状態が 「保留中の承諾」 ではなく、「承諾済み」となっている場合は、ユーザーの招待は完了しています。</p><p>「承諾済み」の状態で、期待したサブスクリプションの操作や Azure AD テナントの確認ができない場合は、適切なアカウントや Azure AD を選択できていない可能性がありますので、一度 <a href="https://jpazureid.github.io/blog/azure-active-directory/subscription-azuread/">サブスクリプションが見えない</a> の内容をご確認ください。</p><p>なお、招待 E メールに含まれるリンクをクリックし、ウィザードを進めた結果、次のような「表示するアプリはありません。 このコレクションを非表示にする」との画面が表示されることがありますが、こちらは問題なく招待が完了していますのでご安心ください。</p><p><img src="/blog/azure-active-directory/azuread-b2b-troubleshooting/new5.png"></p><p>これは、特に割り当てられたアプリケーションがないことを意味しており、招待自体は正常に完了したことを示します。</p><h2 id="おわりに"><a href="#おわりに" class="headerlink" title="おわりに"></a>おわりに</h2><p>上記内容でもご要望の動作が完了しない場合は、ぜひ弊社サポート サービスをご利用ください。その際は下記の情報を事前にご提供いただけると幸いです。</p><ul><li>招待操作を行ったテナント名 (例: xxx.onmicrosoft.com)</li><li>招待操作を行ったユーザー名 (例: <a href="mailto:&#x78;&#x78;&#120;&#x40;&#99;&#x6f;&#110;&#116;&#x6f;&#115;&#x6f;&#x2e;&#x63;&#111;&#109;">&#x78;&#x78;&#120;&#x40;&#99;&#x6f;&#110;&#116;&#x6f;&#115;&#x6f;&#x2e;&#x63;&#111;&#109;</a>)</li><li>招待操作を行った時刻</li><li>招待されるユーザーの E メールアドレス (例: <a href="mailto:&#x78;&#x78;&#120;&#x40;&#x66;&#97;&#98;&#114;&#x69;&#107;&#97;&#x6d;&#x2e;&#x63;&#111;&#109;">&#x78;&#x78;&#120;&#x40;&#x66;&#97;&#98;&#114;&#x69;&#107;&#97;&#x6d;&#x2e;&#x63;&#111;&#109;</a>)</li><li>問題となっている状況の詳細と画面ショット</li></ul><p>例としては、「招待 E メールが届かない」、「招待 E メールは届くが招待の操作が完了しない」、「招待は完了したが、その後に目的のリソースにアクセスできない」などが挙げられます。それぞれ、上記の情報を添えてお問い合わせを発行いただけますと幸いです。</p><p>また、招待 E メールを使用しないユーザーの追加や CSV を使用した一括招待の方法については、<a href="https://jpazureid.github.io/blog/azure-active-directory/b2bfaq/">Azure における ゲスト ユーザー招待 (B2B) のよくある質問</a> を参照ください。招待 E メールを使用しないユーザーの追加方法についても同様にこの記事の「よくある質問」をご確認ください。</p><p>Azure AD B2B で活用いただける PowerShell サンプルは <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/external-identities/code-samples?tabs=http">Azure Active Directory B2B コラボレーション コードと PowerShell サンプル</a> にまとめられておりますので、併せてご参照ください。</p><p>上記内容が少しでも皆様の参考となりますと幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;alert is-info&quot;&gt;&lt;p class=&quot;alert-title&quot;&gt;Note&lt;/p&gt;&lt;p&gt;本記事は Technet Blog の更新停止に伴い &lt;a href=&quot;https://blogs.technet.microsoft.com/jpazure</summary>
      
    
    
    
    
    <category term="Azure AD B2B" scheme="https://jpazureid.github.io/blog/tags/Azure-AD-B2B/"/>
    
  </entry>
  
  <entry>
    <title>より安全な国家を実現するための ID の技術革新</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/identity-innovation-for-a-more-secure-nation/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/identity-innovation-for-a-more-secure-nation/</id>
    <published>2023-03-26T00:00:00.000Z</published>
    <updated>2023-04-26T02:57:31.615Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 星野 です。</p><p>本記事は、2023 年 2 月 28 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/identity-innovation-for-a-more-secure-nation/ba-p/2365670">Identity Innovation for a More Secure Nation</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>毎秒 1,000 件以上の ID 攻撃 (※ 1) が発生しており、政府機関は史上最も厳しいサイバーセキュリティ環境の中で国民に向けサービスを提供しています。インフラに対する国家規模の攻撃から個人情報の漏洩まで、サイバー攻撃のすべてのエコシステムにおいて、政府が市民の自由を守る行為それ自体が、このような脅威者の格好のターゲットとなっています。拡大するセキュリティの脅威により、連邦政府機関とその最も重要なデータが危険にさらされているのです。</p><p>Microsoft Entra の 1 サービスである Azure Active Directory のフィッシング耐性のある多要素認証 (MFA) のような最近の技術革新により、政府機関のお客様はサイバーセキュリティのガイドラインと規制を順守しながら、政策目標を達成することができます。</p><p>2022 年 1 月、パスワードレスでフィッシング耐性のある多要素認証 (MFA) を使用するよう省庁に指示する国家安全保障の覚書 (<a href="https://www.nsa.gov/Press-Room/News-Highlights/Article/Article/2904637/president-biden-signs-cybersecurity-national-security-memorandum/">NSM-8</a>) が発表されました。各機関は 2023 年 1 月に準拠の期限を迎えました。私たちは、公共への奉仕を目指すこれら多くの機関に対して、この目標達成を支援する重要な機能を提供できることを嬉しく思っています。</p><h2 id="最新の強力な認証が生み出す信頼"><a href="#最新の強力な認証が生み出す信頼" class="headerlink" title="最新の強力な認証が生み出す信頼"></a>最新の強力な認証が生み出す信頼</h2><p>サイバーセキュリティの向上に関する大統領令 (EO 14028) および NSM-8 への対応として、マイクロソフトは、各機関が以下のことを実現するにあたり役立つ強力な認証方式を開発しました。</p><h3 id="レガシーなオンプレミス連携サーバーの脅威とコストを取り除く"><a href="#レガシーなオンプレミス連携サーバーの脅威とコストを取り除く" class="headerlink" title="レガシーなオンプレミス連携サーバーの脅威とコストを取り除く"></a>レガシーなオンプレミス連携サーバーの脅威とコストを取り除く</h3><p>米国連邦政府機関ならびに米国国防総省で使用されている Common Access Card (CAC) や Personal Identity Verification (PIV) カードなどの証明書を使った <strong>Certificate-Based Authentication (CBA)</strong> で、ユーザーを安全に認証することができます。これにより、レガシーなオンプレミス IT インフラに関連する攻撃リスクやコストを削減しながら、CBA をサポートできます。</p><h3 id="適切なリソースに適切な-MFA-方式を使用する"><a href="#適切なリソースに適切な-MFA-方式を使用する" class="headerlink" title="適切なリソースに適切な MFA 方式を使用する"></a>適切なリソースに適切な MFA 方式を使用する</h3><p>最新で使いやすく、フィッシングに強い認証方式を展開しましょう。<strong>条件付きアクセスの認証強度機能</strong>により、フィッシング耐性のある MFA に移行しながら、重要な資産を確実に保護しセキュリティを向上させることができます。</p><h3 id="政府機関を超えた連携を促進する"><a href="#政府機関を超えた連携を促進する" class="headerlink" title="政府機関を超えた連携を促進する"></a>政府機関を超えた連携を促進する</h3><p>フィッシング耐性のある認証 (Azure Active Directory CBA、FIDO2、Windows Hello for Business など) と条件付きアクセスの認証強度を<strong>テナント間のアクセス ポリシー</strong>と組み合わせることで、コンプライアンスを維持しながら、他の政府機関や商業パートナー/請負業者との、あらゆる Microsoft サービスでの安全なコラボレーションをクラウド上で実現できます。</p><h2 id="マイクロソフトがお手伝いできること"><a href="#マイクロソフトがお手伝いできること" class="headerlink" title="マイクロソフトがお手伝いできること"></a>マイクロソフトがお手伝いできること</h2><p>公務員が働く環境では、最新の ID ツールおよびモビリティを使用して柔軟に仕事を行うことが必要です。最高レベルのセキュリティを実現しながらも生産性を最大化し、ID への攻撃を心配することなく国民への奉仕に集中できるようにする必要があります。</p><p>私たちは、最も深刻なセキュリティの脅威からも、データと ID を確実に保護できる強力な認証 ID ソリューションを活用し、政府機関とのパートナーシップを継続していくことを誇りに思います。</p><p>サイバーセキュリティの向上に関する大統領令 (EO 14028) およびフィッシング耐性のある MFA の実装におけるマイクロソフトの取り組みについては、こちらをご覧ください。</p><ul><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/howto-authentication-passwordless-deployment?source=recommendations">Azure Active Directory でパスワードレス認証のデプロイを計画する</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/howto-mfa-getstarted">Azure Active Directory の多要素認証のデプロイを計画する</a></li><li>(英語/ 米国事例) <a href="https://www.microsoft.com/en-us/security/blog/2022/02/17/us-government-sets-forth-zero-trust-architecture-strategy-and-requirements/">US Government sets forth Zero Trust architecture strategy and requirements.</a></li></ul><p>Alex Weinert (<a href="https://twitter.com/Alex_T_Weinert">@Alex_T_Weinert</a>)<br>VP Director of Identity Security, Microsoft</p><p>※ 1: 2022 年の Azure AD の認証ログデータより</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 星野 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 2 月 28 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>MSOnline / AzureAD PowerShell から Graph PowerShell SDK への移行について 5_グループ管理</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement5/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement5/</id>
    <published>2023-03-12T00:00:00.000Z</published>
    <updated>2023-04-26T02:57:31.383Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure Identity サポート チームの三輪です。</p><p>この記事は、MSOnline / AzureAD モジュール廃止について、下記シリーズの続きとして連載しています。</p><p><a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement1/">1_概要編</a><br><a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement2/">2_移行導入編</a><br><a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement3/">3_インストール・接続編</a><br><a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement4/">4_ユーザー管理</a></p><p>5 回目となる今回は、グループ管理についてご紹介します。</p><p>まだモジュールをインストールしていない場合や、 Connect-MgGraph コマンドを使用した接続方法が分からない場合などは、本シリーズの 2 と 3 をご確認ください。</p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ol><li><a href="#idx1">グループの取得</a><ul><li><a href="#idx1-1">テナントの全グループを取得する場合</a></li><li><a href="#idx1-2">特定のグループを取得する場合</a></li><li><a href="#idx1-3">特定の条件に合うグループを取得する場合</a></li></ul></li><li><a href="#idx2">グループ メンバーの取得</a><ul><li><a href="#idx2-1">特定のグループのユーザーを取得する場合</a></li><li><a href="#idx2-2">２つのグループに共通するメンバー</a></li></ul></li><li><a href="#idx3">グループ メンバーの追加および削除</a><ul><li><a href="#idx3-1">グループ メンバーの追加</a></li><li><a href="#idx3-2">グループ メンバーの削除</a></li></ul></li><li><a href="#idx4">特定のユーザーが所属するグループ一覧の取得</a></li></ol><hr><h2 id="idx1">1. グループの取得</h2><p>以前、グループ情報を取得するのに利用していた Get-AzureADGroup や Get-MsolGroup は、Get-MgGroup コマンドに置き換わります。以下にいくつかのシナリオをベースに例を紹介いたします。</p><h3 id="idx1-1">テナントの全グループを取得する場合</h3><p>-All オプションを使用します。Get-AzureADGroup コマンドでは、 -All $true とする必要がありましたが、新しいコマンドでは -All のみで動作します。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgGroup -All</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement5/azuread-module-retirement5-1.png"></p><h3 id="idx1-2">特定のグループを取得する場合</h3><p>ObjectID を指定することで特定のグループの情報を取得が可能です。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgGroup -GroupId 027926f5-a926-464b-89b0-8c4cb1eebb5b</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement5/azuread-module-retirement5-2.png"></p><h3 id="idx1-3">特定の条件に合うグループを取得する場合</h3><p>Get-MgUser コマンドと同様に、-Filter オプション等を活用して、条件に合致するグループのみを表示させることが可能です。以下に例をご紹介します。</p><p>DisplayName が特定の文字列から始まるグループのみを取得する場合</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgGroup -All -Filter &quot;startsWith(DisplayName,&#x27;A&#x27;)&quot;</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement5/azuread-module-retirement5-3.png"></p><p>Teams が有効となっているグループのみを取得する場合</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgGroup -All -Filter &quot;(resourceProvisioningOptions/any(c:c eq &#x27;Team&#x27;))&quot;</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement5/azuread-module-retirement5-4.png"></p><p>利用可能なパラメーターは Filter 以外にもありますが、各属性によってサポートされるオプションが異なります。下記のような公開情報を確認いただき、使用したい属性とオプションがサポートされているか、あらかじめご確認ください。</p><ul><li><a href="https://learn.microsoft.com/ja-jp/graph/api/resources/group?view=graph-rest-1.0#properties">group リソースの種類 - Microsoft Graph v1.0 | Microsoft Learn</a>  </li><li><a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.graph.groups/get-mggroup?view=graph-powershell-1.0">Get-MgGroup (Microsoft.Graph.Groups) | Microsoft Learn</a>  </li><li><a href="https://learn.microsoft.com/ja-jp/graph/api/group-list?view=graph-rest-1.0&tabs=powershell">グループの一覧表示 - Microsoft Graph v1.0 | Microsoft Learn</a></li></ul><h2 id="idx2">2. グループ メンバーの取得</h2><p>グループに所属するメンバーは、Get-MgGroup コマンドにで取得可能です。</p><h3 id="idx2-1">指定したグループのメンバーを取得する</h3><p>Get-MgGroupMember コマンドを用い、グループの ObjectID を指定します。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgGroupMember -All -GroupId 027926f5-a926-464b-89b0-8c4cb1eebb5b</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement5/azuread-module-retirement5-5.png"></p><p>グループに所属するメンバーの Id 以外の情報を取得したい場合は、以下のように additionalproperties を用いてメンバー情報を取得することが可能です。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(Get-MgGroupMember -All -GroupId 027926f5-a926-464b-89b0-8c4cb1eebb5b).additionalproperties.displayName</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement5/azuread-module-retirement5-6.png"></p><p>グループに所属するメンバーの Id と 表示名等、任意の複数の情報を取得したい場合には、以下のようにして抽出することも可能です。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgGroupMember -All -GroupId 027926f5-a926-464b-89b0-8c4cb1eebb5b|%&#123; [pscustomobject]@&#123;UserId = $_.id; displayName = $_.additionalproperties.displayName&#125; &#125;</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement5/azuread-module-retirement5-7.png">  </p><h3 id="idx2-2">２つのグループに共通するメンバー</h3><p>コマンドを組み合わせることで、2 つのグループに共通するユーザーのみを抽出することも可能です。以下の例では CommonMemberIds に共通するメンバーのリストが格納されます。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$groupAMembers = Get-MgGroupMember -GroupId dbf376f0-142d-4ed3-845e-e899a7f1cbca -All</span><br><span class="line">$groupBMembers = Get-MgGroupMember -GroupId 607357fb-df96-4593-8429-dcc86654afee -All</span><br><span class="line">$CommonMemberIds = @()</span><br><span class="line">foreach ($groupAMemberId in $groupAMembers.Id) &#123;</span><br><span class="line">    if ($groupBMembers.Id.Contains($groupAMemberId)) &#123;</span><br><span class="line">        $CommonMemberIds += $groupAMemberId</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement5/azuread-module-retirement5-8.png"></p><p>また、GroupA のメンバーではあるが、GroupB のメンバーではないユーザーを取得する際には、以下のようにスクリプトに ”!” を追加して抽出します。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$groupAMembers = Get-MgGroupMember -GroupId dbf376f0-142d-4ed3-845e-e899a7f1cbca -All</span><br><span class="line">$groupBMembers = Get-MgGroupMember -GroupId 607357fb-df96-4593-8429-dcc86654afee -All</span><br><span class="line">$NCommonMemberIds = @()</span><br><span class="line">foreach ($groupAMemberId in $groupAMembers.Id) &#123;</span><br><span class="line">    if (!$groupBMembers.Id.Contains($groupAMemberId)) &#123;</span><br><span class="line">        $NCommonMemberIds += $groupAMemberId</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以下の公開情報も併せてご確認ください。</p><ul><li><a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.graph.groups/get-mggroupmember?view=graph-powershell-1.0">Get-MgGroupMember (Microsoft.Graph.Groups) | Microsoft Learn</a>  </li><li><a href="https://learn.microsoft.com/ja-jp/graph/api/group-list-members?view=graph-rest-1.0&tabs=powershell">メンバーを一覧表示する - Microsoft Graph v1.0 | Microsoft Learn</a>  </li></ul><p>※ Get-MgGroupMember コマンドで取得できるのは、グループのダイレクト メンバーの一覧です。入れ子になったグループ内メンバーを含むすべてのメンバーを推移的に取得したい場合には、Get-MgGroupTransitiveMember を使用します。</p><ul><li><a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.graph.groups/get-mggrouptransitivemember?view=graph-powershell-1.0">Get-MgGroupTransitiveMember (Microsoft.Graph.Groups) | Microsoft Learn</a>  </li><li><a href="https://learn.microsoft.com/ja-jp/graph/api/group-list-transitivemembers?view=graph-rest-1.0&tabs=powershell">グループの推移性のメンバーを一覧表示する - Microsoft Graph v1.0 | Microsoft Learn</a></li></ul><h2 id="idx3">3. グループ メンバーの追加および削除</h2><h3 id="idx3-1">グループ メンバーの追加</h3><p>グループ メンバーの追加には New-MgGroupMember を用い、-GroupId としてグループの ObjectID を、-DirectoryObjectId として追加したいメンバーの ObjectID を指定します。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">New-MgGroupMember -GroupId &#x27;872648e7-b23a-4328-bd46-f1bd431c2354&#x27; -DirectoryObjectId &#x27;8a7c50d3-fcbd-4727-a889-8ab232dfea01&#x27;</span><br></pre></td></tr></table></figure><p>複数のユーザーを 1 つのグループに追加したい場合には、追加したいユーザーの ObjectID の一覧を作成し、-DirectoryObjectId として作成したユーザーの一覧を参照させます。</p><p>追加したいユーザーの ObjectID 一覧の csv ファイル例:</p><p><img src="/blog/azure-active-directory/azuread-module-retirement5/azuread-module-retirement5-9.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$GroupId = &quot;872648e7-b23a-4328-bd46-f1bd431c2354&quot;</span><br><span class="line">Import-CSV &quot;C:\Temp\Users.csv&quot; | ForEach &#123;New-MgGroupMember -GroupId $GroupId -DirectoryObjectId $_.ObjectId&#125;</span><br></pre></td></tr></table></figure><p>また、ユーザーの Object ID の代わりに ユーザーの UPN を使用したい場合には、<a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement4/">4_ユーザー管理操作の紹介</a> で紹介した Get-MgUser コマンドと組み合わせて、以下のようにスクリプトを作成することも可能です。</p><p><img src="/blog/azure-active-directory/azuread-module-retirement5/azuread-module-retirement5-10.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$GroupId = &quot;872648e7-b23a-4328-bd46-f1bd431c2354&quot;</span><br><span class="line">Import-CSV &quot;C:\Temp\Users.csv&quot; | ForEach &#123;</span><br><span class="line">    $UserId = (Get-MgUser -UserId $_.UserPrincipalName).id</span><br><span class="line">    New-MgGroupMember -GroupId $GroupId -DirectoryObjectId $UserId</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以下の公開情報も併せてご確認ください。</p><ul><li><a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.graph.groups/new-mggroupmember?view=graph-powershell-1.0">New-MgGroupMember (Microsoft.Graph.Groups) | Microsoft Docs</a>  </li><li><a href="https://learn.microsoft.com/ja-jp/graph/api/group-post-members?view=graph-rest-1.0&tabs=http">メンバーを追加する - Microsoft Graph v1.0 | Microsoft Learn</a>  </li></ul><h3 id="idx3-2">グループ メンバーの削除</h3><p>グループ メンバーの削除には Remove-MgGroupMemberByRef を用い、グループの ObjectID および削除したいユーザーの Object ID を指定してグループ メンバーを削除します。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Remove-MgGroupMemberByRef -GroupId &#x27;872648e7-b23a-4328-bd46-f1bd431c2354&#x27; -DirectoryObjectId &#x27;8a7c50d3-fcbd-4727-a889-8ab232dfea01&#x27;</span><br></pre></td></tr></table></figure><p>グループ メンバー削除に関しても、グループ メンバーの追加と同様、CSV ファイルを利用してのメンバーの一括削除や Get-MgUser とコマンドを組み合わせての UPN 指定によるメンバー削除が可能です。</p><p>以下の公開情報も併せてご確認ください。</p><ul><li><a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.graph.groups/remove-mggroupmemberbyref?view=graph-powershell-1.0">Remove-MgGroupMemberByRef (Microsoft.Graph.Groups) | Microsoft Docs</a>  </li><li><a href="https://learn.microsoft.com/ja-jp/graph/api/group-delete-members?view=graph-rest-1.0&tabs=http">メンバーを削除する - Microsoft Graph v1.0 | Microsoft Learn</a>  </li></ul><h2 id="idx4">4. 特定のユーザーが所属するグループ一覧の取得</h2><p>特定のユーザーが所属するグループ一覧を取得するには、Get-MgUserMemberOf を用い、ユーザーの ObjectID または UPN を指定します。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgUserMemberOf -UserId de673304-dcaf-4bfd-9acb-4f2abb937948</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement5/azuread-module-retirement5-11.png"></p><p>ユーザーが所属するグループの表示名も一緒に出力したい場合は、以下のように additionalproperties から displayName が取得できます。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgUserMemberOf -UserId &quot;de673304-dcaf-4bfd-9acb-4f2abb937948&quot; | %&#123;</span><br><span class="line">    [pscustomobject]@&#123;</span><br><span class="line">        Id = $_.id</span><br><span class="line">        displayName = $_.additionalproperties[&#x27;displayName&#x27;]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement5/azuread-module-retirement5-12.png"></p><p>以下の公開情報も併せてご確認ください。</p><p><a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.graph.users/get-mgusermemberof?view=graph-powershell-1.0">Get-MgUserMemberOf (Microsoft.Graph.Users) | Microsoft Learn</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure Identity サポート チームの三輪です。&lt;/p&gt;
&lt;p&gt;この記事は、MSOnline / AzureAD モジュール廃止について、下記シリーズの続きとして連載しています。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://jpazureid.g</summary>
      
    
    
    
    
    <category term="PowerShell" scheme="https://jpazureid.github.io/blog/tags/PowerShell/"/>
    
    <category term="Microsoft Graph" scheme="https://jpazureid.github.io/blog/tags/Microsoft-Graph/"/>
    
  </entry>
  
</feed>
