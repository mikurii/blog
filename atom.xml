<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan Azure Identity Support Blog</title>
  
  <subtitle>日本マイクロソフトの Azure Active Directory と AD FS に関するサポート情報のブログです。</subtitle>
  <link href="https://jpazureid.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpazureid.github.io/blog/"/>
  <updated>2022-10-29T08:06:47.716Z</updated>
  <id>https://jpazureid.github.io/blog/</id>
  
  <author>
    <name>Azure Identity Support Japan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>CSP プログラムにおけるパートナーセンターから顧客テナントにアクセスする際の条件付きアクセス ポリシーについて - 「外部ユーザーの種類の指定」による解決方法</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/new-capolicy-for-csp-account/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/new-capolicy-for-csp-account/</id>
    <published>2022-10-30T15:00:00.000Z</published>
    <updated>2022-10-29T08:06:47.716Z</updated>
    
    <content type="html"><![CDATA[<div class="alert is-info"><p class="alert-title">Note</p><p>本記事内では、顧客テナントに対して代理管理者権限を持つ、CSP パートナー テナントのアカウントを、「CSP アカウント」と記載します。</p></div><p>こんにちは。Azure &amp; Identity サポート チームの栗井です。</p><p>今年 2022 年の 7 月に公開した下記ブログ記事について、大変ありがたいことに、多くのお客様・CSP パートナーにご好評いただいております。</p><ul><li><a href="https://jpazureid.github.io/blog/azure-active-directory/capolicy-for-csp-account/">CSP プログラムにおけるパートナーセンターから顧客テナントにアクセスする際の条件付きアクセス ポリシーについて</a></li></ul><p>このブログ記事の趣旨は「顧客テナントで作成した条件付きアクセス ポリシーが、意図せず CSP パートナーのアカウントによるアクセスを阻害してしまう」という問題に対して、ポリシーの構成を工夫することでいかに回避するか ? という方法をご提案することでした。</p><p>ここで朗報です ! このたびプレビュー機能として公開された「外部ユーザーの種類の指定 (仮称)」を利用することで、この問題の根本的な解決が可能になりました。手順はよりシンプル・簡単です。</p><p>おかげさまで前述のブログ記事は、公開からほんの 3 ヶ月過ぎであるにもかかわらず、その役目を引退してもらうこととなりそうです (気合いを入れて執筆した自信作なのですが)。</p><h2 id="前提-条件付きアクセス-ポリシーが-CSP-アカウントをブロックしてしまう問題について"><a href="#前提-条件付きアクセス-ポリシーが-CSP-アカウントをブロックしてしまう問題について" class="headerlink" title="前提 : 条件付きアクセス ポリシーが CSP アカウントをブロックしてしまう問題について"></a>前提 : 条件付きアクセス ポリシーが CSP アカウントをブロックしてしまう問題について</h2><p>詳細については、<a href="https://jpazureid.github.io/blog/azure-active-directory/capolicy-for-csp-account/">前述のブログ記事</a>を参照ください。本記事では概要のみご紹介します。</p><p>CSP パートナー テナントに所属するアカウントは、代理管理者権限を持つ場合、パートナー センター (<a href="https://partner.microsoft.com/">https://partner.microsoft.com</a>) 経由で、リセラー関係を結ぶ顧客のテナントに対しての特権アクセス (グローバル管理者相当) が可能です。</p><p>顧客テナントで有効化されている条件付きアクセス ポリシーにおいて、割り当て対象として “すべてのユーザー” もしくは “すべてのゲスト ユーザー” が選択されている場合、CSP アカウントによるアクセスに対してもポリシーが適用されます。</p><p>この動作が原因による「CSP アカウントによる顧客テナントへのアクセスが、意図せずブロックされてしまう」というご相談を、これまで多くの CSP パートナーから頂いていました。</p><h2 id="解決策-外部ユーザーの種類の指定による、CSP-アカウントに対してのポリシー適用を回避"><a href="#解決策-外部ユーザーの種類の指定による、CSP-アカウントに対してのポリシー適用を回避" class="headerlink" title="解決策 : 外部ユーザーの種類の指定による、CSP アカウントに対してのポリシー適用を回避"></a>解決策 : 外部ユーザーの種類の指定による、CSP アカウントに対してのポリシー適用を回避</h2><h3 id="新機能-外部ユーザーの種類の指定"><a href="#新機能-外部ユーザーの種類の指定" class="headerlink" title="新機能 : 外部ユーザーの種類の指定"></a>新機能 : 外部ユーザーの種類の指定</h3><p>現在、条件付きアクセス ポリシーのユーザー割り当て設定画面をご覧いただくと、”ゲストまたは外部ユーザー” 項目の真下に、下記の選択肢が表示されます。</p><p><img src="new-capolicy-for-csp-account%5Cexternalusers.png">  </p><p>上記はいずれも、ゲスト・外部ユーザーの種類を示します。これまでは “ゲストまたは外部ユーザー” という選択肢によって一括りにされていたのですが、より詳細な種類を指定したポリシーの構成が可能になりました。</p><p>それぞれの選択肢の説明については、<a href="https://learn.microsoft.com/en-us/azure/active-directory/external-identities/authentication-conditional-access#assigning-conditional-access-policies-to-external-user-types-preview">公開情報の記載 (現在英語版のみ)</a> をご参照ください。</p><h3 id="“サービス-プロバイダー-ユーザー-プレビュー-”-の選択による-CSP-アカウントの指定"><a href="#“サービス-プロバイダー-ユーザー-プレビュー-”-の選択による-CSP-アカウントの指定" class="headerlink" title="“サービス プロバイダー ユーザー (プレビュー)” の選択による CSP アカウントの指定"></a>“サービス プロバイダー ユーザー (プレビュー)” の選択による CSP アカウントの指定</h3><p><strong>上記 6 つの選択肢のうち、”サービス プロバイダー ユーザー (プレビュー)” は、CSP アカウントによるアクセスを示します。</strong><br>この選択肢を利用することで、任意の条件付きアクセス ポリシーにおいて、CSP アカウントによるアクセスを割り当て対象外として明示的に指定することができます。</p><ol><li><p>顧客テナントにおいて、該当の条件付きアクセス ポリシーの設定画面を開きます。</p></li><li><p>[対象] &gt; [ユーザーとグループ] を開きます。</p></li><li><p>[対象外] タブを開き、下記のように構成します。</p><ul><li>“ゲストまたは外部ユーザー” にチェックマークを入れます。</li><li>“サービス プロバイダー ユーザー” にチェックマークを入れます。<br><img src="new-capolicy-for-csp-account%5Cexclude-serviceproviders.png">  </li></ul></li><li><p>ポリシーを保存します。</p></li></ol><p>手順はたったのこれだけです。</p><p>2022 年 10 月末時点で、外部ユーザーの種類の指定は、プレビューの機能です。<br>プレビュー期間の終了後は、<a href="https://jpazureid.github.io/blog/azure-active-directory/capolicy-for-csp-account/">CSP プログラムにおけるパートナーセンターから顧客テナントにアクセスする際の条件付きアクセス ポリシーについて</a> の一部内容を、本記事に統合をすることも検討中です。</p><p>上記内容が少しでも皆様の参考となりますと幸いです。ご不明な点がございましたら、弊社サポートまでお気軽にお問い合わせください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;alert is-info&quot;&gt;&lt;p class=&quot;alert-title&quot;&gt;Note&lt;/p&gt;&lt;p&gt;本記事内では、顧客テナントに対して代理管理者権限を持つ、CSP パートナー テナントのアカウントを、「CSP アカウント」と記載します。&lt;/p&gt;&lt;/div&gt;
</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Conditional Access" scheme="https://jpazureid.github.io/blog/tags/Conditional-Access/"/>
    
    <category term="条件付きアクセス" scheme="https://jpazureid.github.io/blog/tags/%E6%9D%A1%E4%BB%B6%E4%BB%98%E3%81%8D%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9/"/>
    
  </entry>
  
  <entry>
    <title>Entra Verified ID による Verified Coupons ( 認証クーポン ) のプレビュー</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/preview-for-verified-coupons-with-entra-verified-id/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/preview-for-verified-coupons-with-entra-verified-id/</id>
    <published>2022-10-29T00:00:00.000Z</published>
    <updated>2022-10-29T08:06:47.764Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 三輪 です。 </p><p>本記事は、2022 年 09 月 15 日に米国の Azure Active Directory Identity Blog で公開された<a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/preview-for-verified-coupons-with-entra-verified-id/ba-p/3627342">Preview for verified coupons with Entra Verified ID - Microsoft Tech Community</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>こんにちは。 </p><p>Entra Verified ID が一般公開（GA）されてから 30 日余りが経ちました。この夏、弊社にインターンとして参加している Emilia Borisova が開発した最新のアップデート: Verified Coupons (使用例 : 限定イベントのチケットなど) をご紹介します。  </p><p>Ankur Patel<br>Head of Product, Microsoft Entra Verified ID </p><hr><p>Decentralized Identity チームでインターンをしている Emilia Borisova と申します。インターン期間中に私が設計および開発した機能がプレビューとして利用できるようになりましたのでお知らせしたいと思います。この機能は、1 日、1 ユーザー、1 資格情報ごとに、Verified ID の提示回数に制限を設定するための機能です。このようなアプローチは、旅行、医療、小売など様々なシーンで、割引やチケットの検証機能や、差別化された体験への扉を開くと考えています。  </p><h2 id="使用例：Verified-IDでコーヒー1杯を無料にする"><a href="#使用例：Verified-IDでコーヒー1杯を無料にする" class="headerlink" title="使用例：Verified IDでコーヒー1杯を無料にする"></a>使用例：Verified IDでコーヒー1杯を無料にする</h2><p><img src="/blog/azure-active-directory/preview-for-verified-coupons-with-entra-verified-id/blog1027_1.png"></p><p>学生の皆さんの一週間のスタートを応援するため、Woodgrove Cofee では、毎週月曜日にコーヒー 1 杯を無料で提供するようなシナリオが考えられます。レジで学生証を提示すると、毎週 1 杯のコーヒーが無料になります。Woodgrove Coffee は、追加でコーヒーを購入しようとする学生向けに、来週も来るように通知することができます。クーポンと同じように直感的に使えるこの機能は、Verified ID の定義を広げ、その無限の可能性をさらに際立たせています。 </p><h2 id="どのように機能するか"><a href="#どのように機能するか" class="headerlink" title="どのように機能するか"></a>どのように機能するか</h2><p>開発者は <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/verifiable-credentials/get-started-request-api?tabs=http">Entra Verified ID APIs</a> を使用して、特定の資格情報を提示できる回数をプログラムによって指定することができます。下の画像は、1 回しか使用できない Verified ID に対して、フィールド “maxAllowedPresentationsCount (最大提示可能回数)” を 1 に設定したリクエストの例です。このように、1 つのプロパティ値を変更するだけで、シームレスに利用でき、提示回数制限の変更にも柔軟に対応することができます。また、顧客に最適なオファーを提供するため、アプリ側で提示回数の値をプログラム的に設定することができます。 </p><p><img src="/blog/azure-active-directory/preview-for-verified-coupons-with-entra-verified-id/blog1027_2.png"></p><p>この機能をお試しになりたい方は、<a href="https://forms.office.com/pages/responsepage.aspx?id=v4j5cvGGr0GRqy180BHbR-d_8gHWMzVMqsi_IPVB0vlUQllOVjNUTFZMRktNWFRYOFZGTEZKMTBBUy4u">こちら</a> から参加を申請ください。</p><h2 id="ご意見をお待ちしています"><a href="#ご意見をお待ちしています" class="headerlink" title="ご意見をお待ちしています"></a>ご意見をお待ちしています</h2><p>皆様からのご意見を楽しみにしております。これからも Twitter (@AzureAD) および <a href="https://feedback.azure.com/d365community/forum/22920db1-ad25-ec11-b6e6-000d3a4f0789">Azure Feedback Forum</a> よりフィードバックを頂けますと幸いです。Microsoft Entra Verified ID のドキュメントは <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/verifiable-credentials/">こちら</a> です。</p><p><a href="https://www.linkedin.com/in/emilia-borisova/">Emilia Borisova</a><br>Software Engineering Intern<br>Microsoft Identity Division</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 三輪 です。 &lt;/p&gt;
&lt;p&gt;本記事は、2022 年 09 月 15 日に米国の Azure Active Directory Identity Blog で公開された&lt;a href=&quot;https://techc</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Authenticator の MFA 疲労攻撃対策</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/defend-your-users-from-mfa-fatigue-attacks/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/defend-your-users-from-mfa-fatigue-attacks/</id>
    <published>2022-10-18T15:00:00.000Z</published>
    <updated>2022-10-29T08:06:47.512Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Azure Identity サポート チームの栗井です。</p><p>Microsoft Identity Security のディレクター Alex Weinert によって、昨今脅威が指摘されている MFA 疲労攻撃と、対策としての Microsoft Authenticator の強化機能についての下記ブログ記事が公開されました。</p><p><a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/defend-your-users-from-mfa-fatigue-attacks/ba-p/2365677">Defend your users from MFA fatigue attacks - Microsoft Tech Community</a></p><p>上記記事に記載の一部内容と、私共日本側のサポート チーム宛にお客様からお問い合わせいただく内容等をふまえ、本記事を執筆しました。</p><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>昨今は多くのお客様の環境において、パスワード “のみ” による認証は十分にセキュアではないという認識が高まり、多要素認証 (MFA) などの導入による認証の強化が行われています。この動向に伴って、<strong>MFA の疲労攻撃 (別名、MFA スパム)</strong> の報告が増えています。</p><p><img src="/blog/azure-active-directory/defend-your-users-from-mfa-fatigue-attacks/Karen_Walker_1-1664319621345.png"> </p><p>MFA 疲労攻撃とは、攻撃者が繰り返し何度も MFA 要求を発生させ、その要求を受け取ったユーザーが誤って MFA 要求を承認することを狙った手口です。</p><p>なぜこのような手口が通用するのかというと、音声通話への応答やプッシュ通知の承諾といった単純な MFA 承認方法では、ユーザーが一連の認証の流れ (コンテキスト) の中にいなくても、承諾を完了できてしまえるからです。突然、何の脈絡もなくスマートフォンにプッシュ通知が来たとして、ユーザーが承諾ボタンを押してしまうと攻撃者に侵入を許してしまうことになります。</p><p>例えば私の Microsoft Authenticator に、突然 MFA のプッシュ通知が発生したと仮定します。アプリには「サインインを承認しますか ? (拒否 / 承認)」という選択肢が表示されます。私はこのサインインに身に覚えがないので「拒否」を押下しますが、まだ IT リテラシーの高くない利用者や、たまたまそのタイミングでクラウド アプリにサインインを試行している人であれば、誤って「承認」を選択してしまう可能性もあります。また、攻撃者が繰り返しサインインを試行してプッシュ通知を行うと、ユーザーには複数の通知が届き、どれが自身の意図したプッシュ通知か判断できなくなります。MFA 疲労攻撃は、このような「ユーザーの誤操作」を狙った攻撃です。</p><p>この攻撃が成り立つのは、一連の認証操作において、認証の流れ (コンテキスト) が考慮されていないためです。実際に画面の前でサインインをしていなくても、Microsoft Authenticator 上で「承認」を押すことが “できてしまう” という点が問題です。音声通話 MFA も仕組みは同様です (自身が認証操作をしているか否かにかかわらず、認証要求の電話に対して、シャープ “#” ボタンを押下してしまえば承認できてしまう)。</p><p>本記事ではこのような「MFA の誤承認」からユーザーを保護するための、Microsoft Authenticator における MFA 強化の機能についてご紹介します。</p><h2 id="1-「プッシュ通知に番号の一致が必要」機能によって-MFA-の誤承認発生を防止"><a href="#1-「プッシュ通知に番号の一致が必要」機能によって-MFA-の誤承認発生を防止" class="headerlink" title="1. 「プッシュ通知に番号の一致が必要」機能によって MFA の誤承認発生を防止"></a>1. 「プッシュ通知に番号の一致が必要」機能によって MFA の誤承認発生を防止</h2><p>Microsoft Authenticator の「プッシュ通知に番号の一致が必要」を有効化すると、MFA の際に、「サインイン画面に表示される 2 桁の数字を、Microsoft Authenticator の画面に入力する」という操作が要求されます。</p><p>仮にユーザーの手元の Microsoft Authenticator に、見知らぬ MFA 要求が通知された場合であっても、ユーザーはこれを許可することができません。なぜならユーザーは画面の前におらず、Microsoft Authenticator に入力するための正しい数字を知りようがないからです。この仕組みによって、ユーザーが MFA 要求を誤承認するリスクを大幅に抑えることができます。</p><p><img src="/blog/azure-active-directory/defend-your-users-from-mfa-fatigue-attacks/number-matching.png">  </p><p>「プッシュ通知に番号の一致が必要」の機能は 2022 年 10 月現在の時点でプレビュー機能です。数か月以内に予定している一般公開 (GA) の後は、すべてのユーザーに自動で有効化することを予定しています。</p><p>本機能は 2021 年 11 月にリリースされ、すでに 1 万近くの組織に導入されています。また「番号の一致」は、Microsoft Authenticator を利用したパスワードレス サインインの手段としてもご利用いただくことができます。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/how-to-mfa-number-match">公開情報: 多要素認証 (MFA) 通知で数値の一致を使用する方法 (プレビュー) - 認証方法ポリシー</a></p><h2 id="2-ユーザーが不正アクセスを判断できるように、MFA-要求にサインイン情報を表示"><a href="#2-ユーザーが不正アクセスを判断できるように、MFA-要求にサインイン情報を表示" class="headerlink" title="2. ユーザーが不正アクセスを判断できるように、MFA 要求にサインイン情報を表示"></a>2. ユーザーが不正アクセスを判断できるように、MFA 要求にサインイン情報を表示</h2><p>「プッシュ通知とパスワードレス通知に地理的な場所を表示する」の機能を有効化すると、サインインの発生元の IP アドレスに基づいた位置情報が Microsoft Authenticator の画面に表示されます。また「プッシュ通知とパスワードレス通知にアプリケーション名を表示する」の機能を有効化すると、サインイン先のアプリケーションの名前も表示されます。</p><p>例えば、ユーザー自身が名古屋にいるのに、サインイン元の位置情報が「ブラジル / リオデジャネイロ」と表示された場合、ユーザーは「この MFA 要求はおかしいかも？」と、一瞬手を止めて不正アクセスを疑うきっかけになることが期待されます。</p><p>これらの機能も、2022 年 10 月現在の時点でプレビュー機能です。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/how-to-mfa-additional-context">公開情報: Microsoft Authenticator 通知で追加のコンテキストを使用する方法 (プレビュー) - 認証方法ポリシー</a></p><p>なお、上記の機能がすべて有効化の対象となっているユーザーでは、Authenticator 宛の MFA 要求は、下記画像のようになります。</p><ul><li>アクセス先のアプリケーションが表示されます。下記例では “App: Azure Portal” と表示されています。</li><li>アクセス元の位置情報が “Location : Tokyo Japan” と、地図と合わせて表示されます。</li><li>MFA 要求の承認のため、数字の入力が要求されます。</li></ul><p><img src="/blog/azure-active-directory/defend-your-users-from-mfa-fatigue-attacks/mfarequest.png">  </p><h2 id="3-Azure-AD-Identity-Protection-の機能もぜひご活用を"><a href="#3-Azure-AD-Identity-Protection-の機能もぜひご活用を" class="headerlink" title="3. Azure AD Identity Protection の機能もぜひご活用を"></a>3. Azure AD Identity Protection の機能もぜひご活用を</h2><p>上記の各種 Microsoft Authenticator の強化機能をすぐに導入することが難しい場合は、Azure AD Identity Protection の機能もぜひご活用ください。Azure AD Identity Protection の導入によって、リスクのあるサインイン パターンや侵害された可能性のあるユーザーが検知され、不正アクセスを防止することができます。</p><p>例えば攻撃者が、馴染みのない場所からのサインインを試み、MFA の実施に失敗した場合、攻撃対象のユーザーのアカウントは「ユーザー リスク有り」と判定されます。不正な MFA 要求を繰り返し発生させる攻撃者は、すでにユーザーのパスワードを把握しています。漏洩したパスワードを継続的に利用することは望ましくないので、まずはパスワードの変更が必要です。</p><p>管理者はユーザー リスクの検知を Azure ポータルから確認し、ユーザーにパスワード変更を要求することができます。パスワードをリセットすることで、攻撃者は古いパスワードを利用した攻撃ができなくなります。また、ユーザー リスクの評価値は自動で低減されます。</p><p>管理者によるリスクの確認およびパスワード変更の手間を省略したい場合、Azure AD Identity Protection の「ユーザー リスク ポリシー」を構成いただくことで、リスクのあるユーザーを自動でセルフサービス パスワード リセット (SSPR) に遷移させることもできます。</p><ul><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/identity-protection/howto-identity-protection-configure-risk-policies">公開情報: リスク ポリシーを構成して有効にする - Azure Active Directory Identity Protection</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/howto-conditional-access-policy-risk-user">公開情報: 条件付きアクセス - 危険なユーザーに対してパスワード変更を必須にする</a></li></ul><h2 id="強化された-Microsoft-Authenticator-の機能を試してみよう"><a href="#強化された-Microsoft-Authenticator-の機能を試してみよう" class="headerlink" title="強化された Microsoft Authenticator の機能を試してみよう"></a>強化された Microsoft Authenticator の機能を試してみよう</h2><p>以下では、Azure ポータルで強化された MS Authenticator の機能を有効化 + 検証する手順をご紹介します。</p><ol><li><p>セキュリティ グループを作成</p><ul><li>管理者のアカウントで Azure ポータルにアクセスし、[Azure Active Directory] &gt; [グループ] から、新しいグループを作成します。グループの種類は “セキュリティ” を選択ください。</li><li>「数字の一致」機能を構成する対象のユーザーをグループのメンバーとして追加します。検証段階では、検証用ユーザーのみをグループに追加ください。<br>本説明内では “Number matching test” という表示名のセキュリティ グループを仮定します。</li></ul></li><li><p>Microsoft Authenticator の認証方法ポリシーを構成</p><ul><li><p>管理者のアカウントで Azure ポータルにアクセスし、下記に進みます。</p><p>  [Azure Active Directory] &gt; [セキュリティ] &gt; [認証方法] &gt; [ポリシー]</p></li><li><p>認証メソッド一覧から “Microsoft Authenticator” を選択します。[基本] タブの “有効にする” の現在の設定値が “いいえ” となっていることをご確認の上、以降の手順にお進みください。</p></li><li><p>[基本] タブの “有効にする” の設定値を “はい” にします。</p><p>  “ターゲット” では “ユーザーの選択” を選択し、”ユーザーとグループの追加” から “Number matching test” を選択します。</p></li><li><p>[構成] タブを開きます。</p></li><li><p>[プッシュ通知に番号の一致が必要 (プレビュー)] と [プッシュ通知とパスワードレス通知にアプリケーション名を表示する (プレビュー)] と [プッシュ通知とパスワードレス通知に地理的な場所を表示する (プレビュー)] それぞれの設定項目で、下記のように構成します。</p><ul><li>状態 : 有効</li><li>ターゲット - 含める : “Number matching test” グループを追加</li></ul></li></ul></li><li><p>該当のユーザーに対して MFA を有効化</p><p> 上記の Microsoft Authenticator の認証方法ポリシー設定は、MFA が要求された際のアプリ上での動作をカスタマイズする項目です。ユーザーに対しての MFA 要求の有効化は、別途構成する必要があります。MFA の有効化方法は複数ありますが、本記事では条件付きアクセス ポリシーによる有効化の手順を記載します。</p><ul><li><p> [Azure Active Directory] &gt; [セキュリティ] に進みます </p></li><li><p> [条件付きアクセス] &gt; [ポリシー] に進みます</p></li><li><p>[+ 新しいポリシー] を押下し、以下の内容でポリシーを構成します</p><ul><li><p>[名前] : 任意のポリシーの名前をご入力ください</p></li><li><p>[割り当て] : </p><ul><li>[ユーザーまたはワークロード ID] : “Number matching test” グループを指定</li><li>[クラウド アプリまたは操作] : “すべてのクラウド アプリ” もしくは何らかの特定のアプリケーションを指定</li></ul></li><li><p>[アクセス制御] :</p><ul><li>[許可] : アクセス権の付与 – “多要素認証を要求する” を選択</li></ul></li></ul></li><li><p>[ポリシーの有効化] を [オン] にし、[保存] を押して設定を反映します</p></li></ul><p> 上記を設定後、 “Number matching test” に所属するユーザーによって何らかのアプリケーションにアクセスいただくことで、強化された Microsoft Authenticator の MFA 機能が動作することをご確認ください。設定にあたってのご不明点やご相談事項などございましたら、弊社サポート チームまでお問い合わせください。</p></li></ol><p>Microsoft Authenticator の優れた点の 1 つは、今後もさらなる進化および多様化が懸念されるセキュリティ攻撃に対して、いち早く対応できるよう継続的に開発および投資を行っていることです。 Microsoft Authenticator が企業にとって、最も安全かつ便利で費用対効果の高い認証方法であり続けるために、今後もさらに多くの機能強化を続けて参ります。</p><p>各種 MFA 強化の機能の一般公開 (GA) にあたって、利用者の皆様の生のご意見やフィードバックはとても重要です。MFA 疲労攻撃に関する英語記事 (後述)、もしくは <a href="https://feedback.azure.com/d365community/forum/22920db1-ad25-ec11-b6e6-000d3a4f0789">Azure フィードバック サイト</a> まで、ぜひご意見をお寄せいただけますと幸いです。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/defend-your-users-from-mfa-fatigue-attacks/ba-p/2365677">(再掲) Defend your users from MFA fatigue attacks - Microsoft Tech Community | Published Sep 28 2022</a></li><li><a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/new-microsoft-authenticator-security-features-are-now-available/ba-p/2464386">New Microsoft Authenticator security features are now available! - Microsoft Tech Community | Published Nov 18 2021</a></li><li><a href="https://feedback.azure.com/d365community/forum/22920db1-ad25-ec11-b6e6-000d3a4f0789">Microsoft Azure  |  Share your Ideas - Azure Active Directory</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。Azure Identity サポート チームの栗井です。&lt;/p&gt;
&lt;p&gt;Microsoft Identity Security のディレクター Alex Weinert によって、昨今脅威が指摘されている MFA 疲労攻撃と、対策としての Microsoft </summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD (Microsoft Entra) の新しいリージョンの発表 - 日本</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/Announcing-a-New-Azure-AD-part-of-Microsoft-Entra-region-in-Japan/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/Announcing-a-New-Azure-AD-part-of-Microsoft-Entra-region-in-Japan/</id>
    <published>2022-10-17T00:00:00.000Z</published>
    <updated>2022-10-29T08:06:47.312Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 竜 です。</p><p>本記事は、2022 年 10 月 13 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/announcing-a-new-azure-ad-part-of-microsoft-entra-region-in/ba-p/2967453">Announcing a New Azure AD, part of Microsoft Entra, region in Japan</a> を意訳したものになります。</p><hr><p>公共機関や民間企業がワークフローの改善、非効率性の低減、従業員の能力向上を目的としてクラウドの利用を拡大し続ける中、データの所在地やプライバシー、コンプライアンス、およびセキュリティに対する懸念が高まっています。Microsoft は、国や地域に特化した 50 以上の一連のサービスを通じて、すべての組織において、これらの懸念に対応することに取り組んでいます。  </p><p>2022 年 10 月より日本の Microsoft のお客様が、日本国内の弊社基盤を通じて Microsoft Entra の一部である Azure Active Directory (Azure AD) の機能にアクセスできるようになったことを本日発表します。これにより、日本に拠点を置くお客様の Azure AD のデータを他のグローバル リージョンに保持していた仕組みが置き換わります。Azure AD は、月間アクティブ ユーザー数 5 億人以上、50 万人以上の顧客数、1 日の認証回数は 450 億回を誇り、世界中の組織や個人の主要なセキュリティおよびプライバシーの要件に対応することで、より多くのことを成し遂げるよう可能にします。ゼロ トラストのフレームワークを採用した Microsoft の ID およびアクセス管理ソリューションは、企業や個人が目標を達成するための安全なプラットフォームを提供します。 </p><p>2022 年 10 月より、認証、コア ディレクトリ ストレージ、プレミアム機能ストレージが日本から利用できるようになり、すべての新規顧客が Azure AD のデータを日本に保存できるようになります。日本から発信される認証リクエストも、日本で処理され扱われることになります (詳細は、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/active-directory-data-storage-japan">Azure Active Directory での日本の顧客のための顧客データ ストレージ</a> をご覧ください)。これは、ヘルスケア、金融サービス、政府機関などの業界において特に重要であり、各国の規制要件を支援すると同時に、もう一段階の信頼性と柔軟性を提供することになります。</p><p>既存のお客様については、引き続き Azure AD のデータを現在の場所に保存します。今後、その Azure AD データを日本に移行するための計画を発表する予定です。日本での Azure AD データの保管は、現在、追加料金なしで提供されます。 </p><p>今回の ID における日本リージョンの開設により、Microsoft は、拡大する顧客ベースの進化するプライバシー、障害回復力、および地域固有のデータ要件に対応するためのコミットメントを強化することになります。Microsoft は、既に 60 以上のデータセンター地域を発表しており、140 ヶ国以上で Azure を利用できるなど、他のクラウド プロバイダーよりも多くのリージョンを有しています。Azure は 100 以上の法令に対応し、どのクラウド サービス提供者よりも包括的なコンプライアンス対応を提供いたします。</p><p>今回のアップデートにより、日本のお客様のデジタル トランスフォーメーションのさらなる加速に貢献できることを期待しています。弊社は、信頼できるクラウドの原則とコンプライアンスにおけるリーダーシップに引き続き取り組み、世界中のすべてのお客様に、ご自身のアプリケーションのコンプライアンスを達成するために必要なセキュリティ基盤を提供いたします。  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 竜 です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 10 月 13 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>MSOnline / AzureAD PowerShell から Graph PowerShell SDK への移行について 1_概要</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement1/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement1/</id>
    <published>2022-10-03T00:00:00.000Z</published>
    <updated>2022-10-29T08:06:47.420Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure ID チームの小出です。</p><p>今回は、MSOnline (以降 MSOL) および Azure AD PowerShell の廃止スケジュールについてご案内します。</p><p>以前より、下記の弊社ブログにて、本内容については案内を行っていますが、情報のアップデートにより、複数の記事に分かれてしまうなどわかりにくくなっている状況でした。</p><p>そこで今回は、現時点での最新情報と実施いただきたいこと、関連記事の URL などをまとめてご紹介します。</p><h2 id="最新情報-2022-10-3-最終更新-についてのまとめ"><a href="#最新情報-2022-10-3-最終更新-についてのまとめ" class="headerlink" title="最新情報 (2022/10/3 最終更新) についてのまとめ"></a>最新情報 (2022/10/3 最終更新) についてのまとめ</h2><h3 id="MSOL-Azure-AD-PowerShell-のライセンス割り当て関連のコマンドについて"><a href="#MSOL-Azure-AD-PowerShell-のライセンス割り当て関連のコマンドについて" class="headerlink" title="MSOL / Azure AD PowerShell のライセンス割り当て関連のコマンドについて"></a>MSOL / Azure AD PowerShell のライセンス割り当て関連のコマンドについて</h3><p>ライセンス割り当てに関する MSOL / Azure AD PowerShell コマンド（Set-MsolUserLicense や Set-AzureADUserLicense など）は、 2023/3/31 に利用できなくなる見込みです。</p><ul><li>廃止日を 2022/6/30 や 2022/8/26 などと記載している情報もありますが、廃止日は 2023/3/31 に延期されました。</li><li>現時点での予定では 2023/3/31 を過ぎると MSOL / Azure AD のライセンス割り当ての PowerShell コマンドは使用できなくなる見込みです。2023/4/1 以降も引き続き動作はする可能性はありますが、それ以降はいつ使えなくなってもおかしくない状況になる見込みです。</li><li>2022/11/1 以降に新しく作成するテナントでは、MSOL / Azure AD PowerShell コマンドによるライセンス割り当て関連のコマンドが、テナント作成時点から正常に動作しない見込みです。</li></ul><p>対象となるコマンドの詳細は、<a href="https://jpazureid.github.io/blog/azure-active-directory/migrate-your-apps-to-access-the-license-managements/">こちらの記事</a>の下記該当箇所をご確認ください。</p><table>  <thead>    <tr>      <th>既存のコマンド (2023 年 3 月 31 日以降に利用できなくなる操作)</th>      <th>今後推奨される Microsoft Graph PowerShell および API</th>    </tr>  </thead>  <tbody>    <tr>      <td><a href ="https://docs.microsoft.com/ja-jp/powershell/module/msonline/?view=azureadps-1.0" target="_blank">MSOnline Powershell</a>      <br/>・Set-MsolUserLicense      <br/>・New-MsolUser (-LicenseAssignment か -LicenseOptions を指定)</td>      <td rowspan="2">Microsoft Graph PowerShell      <br/>・<a href="https://docs.microsoft.com/ja-jp/powershell/module/microsoft.graph.users.actions/set-mguserlicense?view=graph-powershell-1.0" target="_blank">Set-MgUserLicense</a>      </td>    </tr>    <tr>      <td><a href="https://docs.microsoft.com/en-us/powershell/azure/active-directory/overview?view=azureadps-2.0">Azure AD Powershell</a>      <br/>・Set-AzureADUserLicense      </td>    </tr>    <tr>      <td>Azure AD Graph API (graph.windows.net)      <br/>・assignLicense</td>      <td>Microsoft Graph API      <br/>・<a href="https://docs.microsoft.com/ja-jp/graph/api/user-assignlicense?view=graph-rest-1.0&tabs=http">assignLicense</a></td>    </tr>      </tbody></table><h3 id="MSOL-Azure-AD-PowerShell-のライセンス割り当て関連「以外」のコマンドについて"><a href="#MSOL-Azure-AD-PowerShell-のライセンス割り当て関連「以外」のコマンドについて" class="headerlink" title="MSOL / Azure AD PowerShell のライセンス割り当て関連「以外」のコマンドについて"></a>MSOL / Azure AD PowerShell のライセンス割り当て関連「以外」のコマンドについて</h3><p>ライセンス割り当てに関するコマンド以外（例: Connect-MsolService や Get-AzureADUser など）は、2023 年 6 月 30 日 に廃止となる予定です。(2022/10/3 更新）</p><ul><li>廃止予定日までは、これまでと同様にコマンドを利用可能です。</li><li>廃止後は、動作の保証はされませんが、動作し続けるコマンド・動作しなくなるコマンドの双方がある見込みです。実際に動作しなくなる具体的なコマンドの情報などはありません。</li></ul><h2 id="いまできること・確認すること"><a href="#いまできること・確認すること" class="headerlink" title="いまできること・確認すること"></a>いまできること・確認すること</h2><ol><li>現在利用しているコマンド・スクリプトなどを確認する。<a href="https://jpazureid.github.io/blog/azure-active-directory/how-to-determine-depreacated-azuread-msol/">こちらの記事</a>をもとに、MSOL や Azure AD の PowerShell コマンドを利用していないか確認する</li><li>MSOL や Azure AD の PowerShell コマンドを利用している場合、<a href="https://docs.microsoft.com/en-us/powershell/microsoftgraph/azuread-msoline-cmdlet-map?view=graph-powershell-1.0">こちらの公開情報</a> にて対応するコマンドを探す</li><li>既存のスクリプトの書き換え、コマンドの置き換えを実施し、新しいモジュールで動作するよう修正する</li><li>利用中の MSOL や Azure AD コマンドの置き換えとなるものが見つからない、想定したように動作しない場合は、お問い合わせください</li></ol><h2 id="本廃止に関する弊社ブログ記事リンク"><a href="#本廃止に関する弊社ブログ記事リンク" class="headerlink" title="本廃止に関する弊社ブログ記事リンク"></a>本廃止に関する弊社ブログ記事リンク</h2><h3 id="アップデート情報（英語記事翻訳）"><a href="#アップデート情報（英語記事翻訳）" class="headerlink" title="アップデート情報（英語記事翻訳）"></a>アップデート情報（英語記事翻訳）</h3><p><a href="https://jpazureid.github.io/blog/azure-active-directory/migrate-your-apps-to-access-the-license-managements/">Azure AD Graph および MSOnline での従来のライセンスの割り当て方法が廃止され Microsoft Graph によるライセンス管理に変わります</a><br><a href="https://jpazureid.github.io/blog/azure-active-directory/azure-ad-change-management-simplified/">Azure AD の変更管理を簡素化します</a><br><a href="https://jpazureid.github.io/blog/azure-active-directory/Microsoft-Entra-change-announcements-September-2022-train/#Azure-AD%E3%80%81Azure-AD-Preview%E3%80%81MSOnline-PowerShell-%E3%81%AE%E5%BB%83%E6%AD%A2%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">Microsoft Entra の変更管理のアナウンス (2022 年 9 月の状況)</a></p><h3 id="既存モジュール使用状況について"><a href="#既存モジュール使用状況について" class="headerlink" title="既存モジュール使用状況について"></a>既存モジュール使用状況について</h3><p><a href="https://jpazureid.github.io/blog/azure-active-directory/how-to-determine-depreacated-azuread-msol/">Azure AD Graph / MSOnline PowerShell モジュール利用状況の調べ方</a></p><h3 id="新しいモジュールへの移行導入"><a href="#新しいモジュールへの移行導入" class="headerlink" title="新しいモジュールへの移行導入"></a>新しいモジュールへの移行導入</h3><p><a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement2/">MSOnline / AzureAD PowerShell から Graph PowerShell SDK への移行について 2_移行導入編</a><br><a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement3/">MSOnline / AzureAD PowerShell から Graph PowerShell SDK への移行について 3_インストール・接続編</a></p><h3 id="新しいモジュールの使用方法（ライセンスに関する操作について）"><a href="#新しいモジュールの使用方法（ライセンスに関する操作について）" class="headerlink" title="新しいモジュールの使用方法（ライセンスに関する操作について）"></a>新しいモジュールの使用方法（ライセンスに関する操作について）</h3><p><a href="https://jpazureid.github.io/blog/azure-active-directory/operating-license-with-microsoft-graph/">Microsoft Graph PowerShell SDK を使用したライセンス管理操作の紹介</a></p><h3 id="新しいモジュールの使用方法（ライセンス以外の操作について）"><a href="#新しいモジュールの使用方法（ライセンス以外の操作について）" class="headerlink" title="新しいモジュールの使用方法（ライセンス以外の操作について）"></a>新しいモジュールの使用方法（ライセンス以外の操作について）</h3><p>今後アップデート次第更新します。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure ID チームの小出です。&lt;/p&gt;
&lt;p&gt;今回は、MSOnline (以降 MSOL) および Azure AD PowerShell の廃止スケジュールについてご案内します。&lt;/p&gt;
&lt;p&gt;以前より、下記の弊社ブログにて、本内容については案内を行っ</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="PowerShell" scheme="https://jpazureid.github.io/blog/tags/PowerShell/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Entra の変更管理のアナウンス (2022 年 9 月の状況)</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/Microsoft-Entra-change-announcements-September-2022-train/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/Microsoft-Entra-change-announcements-September-2022-train/</id>
    <published>2022-10-02T00:00:00.000Z</published>
    <updated>2022-10-29T08:06:47.324Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 竜 です。</p><p>本記事は、2022 年 09 月 30 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/microsoft-entra-change-announcements-september-2022-train/ba-p/2967454">Microsoft Entra change announcements – September 2022 train</a> を意訳したものになります。</p><hr><p>皆さん、こんにちは。</p><p>2022 年 3 月に、お客様がより展開の計画を立てやすくするよう、<a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/azure-ad-change-management-simplified/ba-p/2967456">簡素化された変更管理プロセスを発表</a> し、6 月には Microsoft の ID とアクセスの機能をすべて包含する新しい製品群として <a href="https://www.microsoft.com/security/blog/2022/05/31/secure-access-for-a-connected-worldmeet-microsoft-entra/">Microsoft Entra を発表</a> しました。</p><p>前回の発表以降、弊社では Azure Active Directory (Azure AD) の継続的な改善、<a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/public-preview-enhanced-quot-my-apps-quot-experience/ba-p/3118022">さらにユーザー体験が向上した My Apps</a> のパブリック プレビューのリリース、そして <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/microsoft-entra-permissions-management-is-now-generally/ba-p/3290630">Microsoft Entra Permissions Management</a> や <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/microsoft-entra-verified-id-now-generally-available/ba-p/3295506">Microsoft Entra Verified ID</a> の一般提供開始などを行ってきました。</p><p>ID とアクセス管理の製品群の拡大に合わせて、Microsoft Entra のすべての機能を含めるよう、変更管理のプロセスもその範囲を広げてまいりました。本日は機能変更および既存の動作に影響を与える変更について、9 月の状況をご紹介します。</p><p>これらの変更は、四半期ごとに、ブログ、リリース ノート、そして電子メールにてお客様にお伝えしています。また、お客様が、<a href="https://entra.microsoft.com/#home">Entra ポータル</a> 内でライフ サイクルの変更 (廃止、提供停止、および既存の動作に影響を与える変更) により簡単に対応できるよう継続して取り組んでいます。 </p><p>以下に、「年 2 回の製品の廃止」および「年 4 回の機能変更および既存の動作に影響を与える変更」の連絡予定について情報をまとめました。</p><table><thead><tr><th><strong>カテゴリ</strong></th><th><strong>定義</strong></th><th><strong>連絡の予定</strong></th></tr></thead><tbody><tr><td>製品の廃止の連絡</td><td><strong>機能、性能、または製品を特定の期間後に廃止</strong>することを指します。これは、一般的に、新たなお客様に対してサービスや機能の提供を停止し、廃止予定の機能に対して技術的面での投資が削減されることを意味します。最終的には、EOL (end-of-life) の状態に至り、すべてのお客様に対してサービスや機能の提供が停止されます。</td><td>年に 2 回 (3 月、9 月)</td></tr><tr><td>製品の機能変更および既存の動作に影響を与える変更のお知らせ</td><td><strong>既存の動作に影響を与える変更</strong>: 継続的な運用のためにお客様が何らかの操作や変更を行わない場合、既存のユーザーおよびパートナー体験に影響が生じると想定される変更です。<br><strong>機能の変更</strong>: 既存の ID の機能に対する変更であり、お客様側での作業は必要はありませんが、ユーザー体験に変化が生じます。多くは、UI/UX (ユーザー インターフェイスおよびユーザー体験) への変更です。<br><br>これらの変更は一般的に頻繁に発生するため、より頻繁に弊社からの通知が必要となります。</td><td>年に 4 回 (3 月、6 月、9 月、11 月)</td></tr></tbody></table><p>以下に、2022 年 9 月分として発表された機能変更の一覧をご紹介します。</p><h2 id="Azure-MFA-Server-について"><a href="#Azure-MFA-Server-について" class="headerlink" title="Azure MFA Server について"></a>Azure MFA Server について</h2><p>2024 年 9 月 30 日以降、Azure Multi-Factor Authentication (MFA) Server は、多要素認証 (MFA) のサービスを停止するため、MFA Server を利用した認証が失敗する状況となります。認証が中断なく処理され、サポートされた状態を維持するためには、最新の <a href="https://www.microsoft.com/en-us/download/details.aspx?id=55849">Azure MFA Server のアップデート</a> に含まれる MFA Server 移行ツールを使用して、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/how-to-migrate-mfa-server-to-azure-mfa-user-authentication">ユーザーの認証データをクラウド ベースの Azure MFA サービスに移行する</a> 必要があります。詳細は「<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/how-to-migrate-mfa-server-to-azure-mfa">MFA Server から Azure AD Multi-Factor Authentication に移行する</a>」をご参照ください。</p><h2 id="Graph-サービス-エンドポイントでの-HTTP-2-の有効化について"><a href="#Graph-サービス-エンドポイントでの-HTTP-2-の有効化について" class="headerlink" title="Graph サービス エンドポイントでの HTTP/2 の有効化について"></a>Graph サービス エンドポイントでの HTTP/2 の有効化について</h2><p>2023 年 9 月 15 日より、Microsoft Graph のエンジニアリング チームは、Graph サービスのエンドポイントにおいて HTTP/2 のサポートを開始する予定です。既存の HTTP/1.1 バージョンのサポートに加えて、HTTP/2 のサポートが追加される予定です。Microsoft Graph のエンドポイントで HTTP/2 が有効になると、HTTP/2 をサポートするクライアントは、Microsoft Graph にリクエストを行う際に、このバージョンをネゴシエートするようになります。HTTP/2 の改善はパフォーマンスに焦点を当てたもので、遅延や帯域およびリソース消費 (参考: <a href="https://http2.github.io/">https://http2.github.io</a>) の低下に加え、多重化や並列化、バイナリ エンコーディングとヘッダー圧縮による効率化も含まれています。これらの利点により、Microsoft Graph クライアントとお客様に大きな価値をもたらすことが期待されます。また、HTTP/2 は HTTP/1.1 と完全に後方互換性があり、クライアント アプリケーションでコード変更は特に必要ないと期待されます。なお、稀な事例として、アプリケーションが Header キーの大文字と小文字を区別せずに比較する HTTP の仕様に準拠していない場合に、一部のクライアント アプリケーションで悪影響が発生する可能性があります。  </p><h2 id="Azure-AD-Graph-API-について"><a href="#Azure-AD-Graph-API-について" class="headerlink" title="Azure AD Graph API について"></a>Azure AD Graph API について</h2><p>Azure AD Graph は、<strong>2023 年 6 月 30 日</strong> まで <strong>継続して</strong> 機能する予定です。これは、当初の Azure AD Graph API の <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/update-your-applications-to-use-microsoft-authentication-library/ba-p/1257363">廃止の発表</a> から 3 年後となります。Azure サービスにおける廃止の <a href="https://learn.microsoft.com/ja-jp/lifecycle/">ガイドライン</a> に基づき、2023 年 6 月 30 日以降は、事前通知なく Azure AD Graph の提供を停止する可能性があります。弊社では 2023 年 6 月 30 日以降に Azure AD Graph の提供を停止することとなりますが、すべてのお客様が移行を完了し、運用環境のアプリケーションが Azure AD Graph を利用しないようにしたいと考えています。新機能の開発は  <a href="https://learn.microsoft.com/ja-jp/graph/overview">Microsoft Graph</a> に対してのみ行われます。今後も Azure AD Graph のセキュリティ関連の修正は引き続きサポートしますが、Microsoft Graph への移行を推奨します。詳細は「<a href="https://learn.microsoft.com/ja-jp/graph/migrate-azure-ad-graph-overview">Azure AD Graph アプリをMicrosoft Graphに移行する</a>」を参照ください。</p><h2 id="Azure-Active-Directory-Authentication-Library-ADAL-のサポート終了-end-of-life-について"><a href="#Azure-Active-Directory-Authentication-Library-ADAL-のサポート終了-end-of-life-について" class="headerlink" title="Azure Active Directory Authentication Library (ADAL) のサポート終了 (end-of-life) について"></a>Azure Active Directory Authentication Library (ADAL) のサポート終了 (end-of-life) について</h2><p><a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/azure-ad-change-management-simplified/ba-p/2967456">以前発表しました</a> ように、ADAL のサポート終了 (end-of-life) は 2022 年 12 月 31 日です。ADAL を使用したアプリは引き続き動作しますが、サポートやセキュリティ修正は end-of-life 以降は提供されません。また、ADAL の end-of-life 前に、ADAL の機能リリースや、新しいプラットフォーム バージョンへの対応予定もございません。このため、Microsoft Authentication Library (MSAL) への移行を優先することを推奨します。詳細は「<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/develop/msal-migration">Microsoft Authentication Library (MSAL) へのアプリケーションの移行</a>」をご参照ください。</p><h2 id="ライセンスの割り当て-API-PowerShell-の廃止について"><a href="#ライセンスの割り当て-API-PowerShell-の廃止について" class="headerlink" title="ライセンスの割り当て API/PowerShell の廃止について"></a>ライセンスの割り当て API/PowerShell の廃止について</h2><p><strong>既存のテナント</strong> における、Azure AD Graph および MSOnline PowerShell における <strong>ライセンスの割り当て</strong> API および PowerShell コマンドレットの廃止は、2023 年 3 月 31 日に延長されました。2022 年 11 月 1 日以降に作成された <strong>新しいテナント</strong> では、これらの API と PowerShell コマンドレットは最初から機能しなくなる予定です。Microsoft Graph からライセンス管理 API にアクセスするためにアプリを移行するためには、<a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/migrate-your-apps-to-access-the-license-managements-apis-from/ba-p/2464366">“Migrate your apps to access the license managements APIs from Microsoft Graph”</a> と <a href="https://learn.microsoft.com/en-us/powershell/microsoftgraph/azuread-msoline-cmdlet-map?view=graph-powershell-1.0">“Find Azure AD and MSOnline cmdlets in Microsoft Graph PowerShell”</a> のガイダンスに沿って、MS Graph への移行を優先することを推奨します。</p><h2 id="Azure-AD、Azure-AD-Preview、MSOnline-PowerShell-の廃止について"><a href="#Azure-AD、Azure-AD-Preview、MSOnline-PowerShell-の廃止について" class="headerlink" title="Azure AD、Azure AD Preview、MSOnline PowerShell の廃止について"></a>Azure AD、Azure AD Preview、MSOnline PowerShell の廃止について</h2><p>引き続きお客様の移行作業をサポートするために、3 つの PowerShell モジュール (Azure AD、Azure AD Preview、MSOnline) の廃止予定日を 2023 年 6 月 30 日まで延長いたしました。この 3 つのモジュールは、セキュリティ アップデートが提供された場合に更新の必要が生じますが、それを除き、廃止予定日までお客様側の対応は特段なく継続して機能します。Azure AD API の状況によっては、2023 年 6 月 30 日以降、一部のコマンドレットが動作しなくなる可能性があることにご注意ください。今後、PowerShell におけるすべての投資は Microsoft Graph PowerShell SDK に対して行われるため、Microsoft Graph PowerShell SDK への移行を継続することを推奨します。また、弊社では Azure AD Graph および MSOnline モジュールに依存する既存のスクリプトおよび PowerShell プロセスを、Microsoft Graph PowerShell SDK に移行するためのツールおよびドキュメントの作成にも取り組んでいます。詳細は、<a href="https://learn.microsoft.com/en-us/powershell/microsoftgraph/azuread-msoline-cmdlet-map?view=graph-powershell-1.0">“Find Azure AD and MSOnline cmdlets in Microsoft Graph PowerShell”</a> と <a href="https://learn.microsoft.com/en-us/powershell/microsoftgraph/migration-steps?view=graph-powershell-1.0">“Upgrade from Azure AD PowerShell to Microsoft Graph PowerShell”</a> をご参照ください。</p><h2 id="Azure-AD-Domain-Services-クラシック仮想ネットワークのサポートについて"><a href="#Azure-AD-Domain-Services-クラシック仮想ネットワークのサポートについて" class="headerlink" title="Azure AD Domain Services クラシック仮想ネットワークのサポートについて"></a>Azure AD Domain Services クラシック仮想ネットワークのサポートについて</h2><p>以前発表したように、2017 年に Azure AD Domain Services (Azure AD DS) が Azure Resource Manager ネットワークでホスト可能になりました。それ以降、弊社では Azure Resource Manager の最新の機能を使用して、より安全なサービスを構築してきました。今後クラシック デプロイは Azure Resource Manager デプロイに完全に移行するため、Azure AD DS クラシック仮想ネットワークのデプロイは 2023 年 3 月 1 日に廃止される予定です。クラシック仮想ネットワークからの Azure AD DS の移行についての詳細は「<a href="https://learn.microsoft.com/ja-jp/azure/active-directory-domain-services/migrate-from-classic-vnet">クラシック仮想ネットワーク モデルから Resource Manager への Azure Active Directory Domain Services の移行</a>」をご参照ください。</p><p>毎月の更新については、リリースノートのページでご確認ください: <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/whats-new">Azure Active Directory の新着情報</a></p><p>いつものように、フィードバックや提案をお待ちしています。以下のコメントまたは <a href="https://feedback.azure.com/d365community/forum/22920db1-ad25-ec11-b6e6-000d3a4f0789">Azure AD feedback forum</a> でご意見をお聞かせください。また、Microsoft Q&amp;A で、質問、未解決の問題や機能に関するご要望を #AzureADChangeManagementSept2022Train のタグを使用して送信することも可能です。</p><p><a href="https://ignite.microsoft.com/ja-JP/home">10 月 12 日から 10 月 14 日</a> の間に開催される Microsoft Ignite でも、Microsoft Entra のニュースをお届けします。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 竜 です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 09 月 30 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>MSOnline / AzureAD PowerShell から Graph PowerShell SDK への移行について 2_移行導入編</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement2/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement2/</id>
    <published>2022-09-20T00:00:00.000Z</published>
    <updated>2022-10-29T08:06:47.420Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure ID チームの小出です。</p><p><a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement1/">1_概要編</a>の記事はすでにご覧いただけましたでしょうか。<br>最新のアップデートは、この記事にて随時アップデートを行う予定です。</p><p>今回は、 Graph PowerShell SDK モジュールへの移行について、実際に新しいモジュールを使用するにあたり、前提となる新旧モジュールの違いと、新しいコマンドの探し方をご案内します。</p><h2 id="新旧モジュールの主な違い"><a href="#新旧モジュールの主な違い" class="headerlink" title="新旧モジュールの主な違い"></a>新旧モジュールの主な違い</h2><p>以前の MSOnline / Azure AD モジュールと、新しい Microsoft Graph PowerShell SDK モジュールには、下記のような違いがあります。</p><p>インストールや接続面の違いについては、次回記事に詳細を記載予定ですので、併せてご確認ください。</p><table><thead><tr><th>項目</th><th>MSOnline / AzureAD モジュール</th><th>Microsoft Graph PowerShell SDK</th></tr></thead><tbody><tr><td>コマンドの命名規則</td><td>V1: xxx-Msolxxx (例： Get-MsolUser) <br> V2: xxx-AzureADxxx (例： Get-AzureADUser)</td><td>xxx-Mgxxx (例: Get-MgUser)</td></tr><tr><td>インストール後のモジュール</td><td>MSOnline / AzureAD モジュールがそれぞれインストールされる</td><td>既定では Microsoft.Graph.xxxx のようなサブ モジュールが 38 個インストールされる</td></tr><tr><td>必要な権限</td><td>ユーザーに割り当てられている AzureAD ロール</td><td>User.Read.All などのアクセス許可 および Azure AD ロール（一部のコマンド）</td></tr><tr><td>Connect コマンド実行時の認証画面</td><td>必ずサインイン画面が表示される</td><td>2 回目以降は表示されないことがある</td></tr><tr><td>サインインが完了した時の表示</td><td>サインインしたアカウントの情報が表示される</td><td>Welcome To Microsoft Graph! のメッセージが表示される（サインインしたユーザーの情報を確認する場合、 Get-Mgcontext のコマンド実行が必要）</td></tr><tr><td>PowerShell プロンプトを閉じた時の挙動</td><td>セッションが終了し、新しい PowerShell プロンプトを開いた際には再度サインインが必要</td><td>キャッシュが残るため、事前に Disconnect-MgGraph コマンドで明示的に切断する必要がある。<br> 新しい PowerShell プロンプトを開いた際には、Connect コマンドの実行は必要だが、ユーザー名やパスワードの入力画面が表示されないことがある</td></tr><tr><td>公開情報</td><td>コマンドごとに用意（ <a href="https://docs.microsoft.com/ja-jp/powershell/module/azuread/get-azureaduser?view=azureadps-2.0">Get-AzureADUser</a>）</td><td>コマンドごとに用意 + Graph API の公開情報も利用可能  （ <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.graph.users/get-mguser?view=graph-powershell-1.0">Get-MgUser</a> および <a href="https://docs.microsoft.com/ja-jp/graph/api/user-get?view=graph-rest-1.0&tabs=http">ユーザーの取得</a>）</td></tr></tbody></table><h2 id="新しいコマンドを探すためには"><a href="#新しいコマンドを探すためには" class="headerlink" title="新しいコマンドを探すためには"></a>新しいコマンドを探すためには</h2><p>今使用しているスクリプトに、今後廃止予定のコマンドがあることが確認できたら、まずは置き換え先となる新しいモジュールのコマンドを探します。<br>最も簡単な方法は、<a href="https://docs.microsoft.com/en-us/powershell/microsoftgraph/azuread-msoline-cmdlet-map?view=graph-powershell-1.0">この公開情報</a>を利用することです。</p><p>表形式でマッピング表があるため、現在使用しているコマンドを検索するだけで、簡単に対応コマンドを見つけることができます。</p><p>もし公開情報にコマンドがない場合、次に Graph API の公開情報があるか確認します。<br>たとえばユーザーの取得の場合、「ユーザー 取得 Graph API」などと検索し、<a href="https://docs.microsoft.com/ja-jp/graph/api/user-get?view=graph-rest-1.0&tabs=http">ユーザーの取得</a> のような公開情報を探します。</p><p>公開情報を見つけたら、 PowerShell 例文があるか確認します。</p><p><img src="/blog/azure-active-directory/azuread-module-retirement2/azuread-module-retirement2-image1.png"></p><p>PowerShell タブはないものの、HTTP タブにクエリの記載がある場合は、 Invoke-MgGraphRequest コマンドの -URL オプションにクエリを入れて実行することで、同様に実行することが可能です。</p><p>以上のような方法でも代替コマンドが確認できないものについては、技術サポートにお気軽にお問い合わせください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure ID チームの小出です。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement1/&quot;&gt;1_概要編&lt;/a&gt;の</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="PowerShell" scheme="https://jpazureid.github.io/blog/tags/PowerShell/"/>
    
  </entry>
  
  <entry>
    <title>MSOnline / AzureAD PowerShell から Graph PowerShell SDK への移行について 3_インストール・接続編</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement3/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement3/</id>
    <published>2022-09-20T00:00:00.000Z</published>
    <updated>2022-10-29T08:06:47.420Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure ID チームの小出です。<br>この記事は、MSOnline / AzureAD モジュール廃止について、<a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement1/">1_概要編</a>、 <a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement2/">2_移行導入編</a>の記事の続きとして連載しています。</p><p>今回は Microsoft Graph PowerShell SDK モジュールのインストール方法や、接続に関するよくある質問にお答えします。</p><h2 id="モジュールのインストール"><a href="#モジュールのインストール" class="headerlink" title="モジュールのインストール"></a>モジュールのインストール</h2><p>これまでのモジュールと同様に、 Install-Module コマンドでインストールします。<br>Graph PowerShell SDK のモジュールをインストールする場合、Install-Module Microsoft.Graph と実行します。</p><p>注意点としては、Install-Module Microsoft.Graph を実行すると、サブ モジュール 38 個をすべて含む形でインストールが行われるため少し時間がかかります。</p><p>特定のコマンドのみを使用したい場合、サブ モジュール単位でインストールすることもできますが、その場合は Microsoft.Graph.Authentication は必ずインストールしてください。</p><p><img src="/blog/azure-active-directory/azuread-module-retirement3/azuread-module-retirement3-image1.png"></p><p>モジュールのインストールについての公開情報は、<a href="https://docs.microsoft.com/ja-jp/graph/sdks/sdk-installation#install-the-microsoft-graph-powershell-sdk">Microsoft Graph SDK をインストールする</a> および <a href="https://docs.microsoft.com/ja-jp/powershell/microsoftgraph/installation?toc=/graph/toc.json&view=graph-powershell-1.0">Install the Microsoft Graph PowerShell SDK</a>（英語）をご覧ください。</p><blockquote><p>Installing the main module of the SDK, Microsoft.Graph, will install all 38 sub modules. Consider only installing the necessary modules, including Microsoft.Graph.Authentication which is installed by default when you opt to install the sub modules individually. For a list of available Microsoft Graph modules, use Find-Module Microsoft.Graph*. Only cmdlets for the installed modules will be available for use.</p></blockquote><blockquote><blockquote><p>（日本語：SDK のメインモジュールである Microsoft.Graph をインストールすると、38 個のサブモジュールがすべてインストールされます。サブモジュールを個別にインストールする場合は、デフォルトでインストールされる Microsoft.Graph.Authentication を含め、必要なモジュールのみをインストールすることを検討してください。利用可能な Microsoft Graph モジュールの一覧は、Find-Module Microsoft.Graph* を使用してください。インストールされたモジュールのコマンドレットのみが使用できるようになります。）</p></blockquote></blockquote><h2 id="接続手順"><a href="#接続手順" class="headerlink" title="接続手順"></a>接続手順</h2><p>これまでと同様に、 Connect コマンドを使用して接続します。<br>Connect-MsolService / Connect-AzureAD に対応する Microsoft Graph PowerShell SDK での接続コマンドは、 Connect-MgGraph / Connect-Graph コマンドです。</p><p>一例として、下記のように実行します。</p><p>実行例</p><p><code>Connect-MgGraph -Scopes User.Read.All</code></p><p>これまでのコマンドとは異なり、後ろに -Scopes オプションを使用して、権限を付与する必要があります。<br>-Scopes に指定する値は、必ずしも User.Read.All ではなく、接続後に使用するコマンドによって適宜変更が必要です。<br>たとえば、接続後にグループの削除のコマンドを実行する場合は、代わりに Group.ReadWrite.All を指定する必要があります。</p><p>API の公開情報には、組織アカウント、個人用アカウント、アプリケーションごとに、 API を呼び出すためのアクセス許可とサポート状況について記載されています。<br>事前に各 API の詳細（グループの削除の場合は <a href="https://docs.microsoft.com/ja-jp/graph/api/group-delete?view=graph-rest-1.0&tabs=http">グループの削除</a> など）を確認し、必要なアクセス許可を確認してください。</p><p><img src="/blog/azure-active-directory/azuread-module-retirement3/azuread-module-retirement3-image2.png"></p><p>なお、サインイン後、ユーザーが何の権限を持っているかを確認したい場合は、 (Get-MgContext).scopes コマンドをご利用ください。</p><h2 id="よくある質問"><a href="#よくある質問" class="headerlink" title="よくある質問"></a>よくある質問</h2><p>Q. Get-MgUser 等を使用した後、 Powershell プロンプトを閉じてから再度開くと、 Connect-Mggraph 実行時にパスワード入力画面にならずにサインインできてしまいます。動作の詳細をもう少し詳しく教えてください。</p><p>A. Connect-MgGraph コマンドを実行すると、実行した端末にキャッシュが保持されます。<br>具体的には、実行端末の C:\Users\＜User＞.graph 内に、以下のように .bin3 ファイルが作成されます。<br><img src="/blog/azure-active-directory/azuread-module-retirement3/azuread-module-retirement3-image3.png"></p><p>Connect-MsolService コマンドや、 Connect-AzureAD コマンドでは、一度 PowerShell を終了すれば、次回は再度サインイン画面が表示されますが、<br>Connect-MgGraph コマンドでは、PowerShell をいったん終了した場合でも、毎度サインイン画面は表示されません。</p><p>この場合、認証済みの資格情報を使用できてしまうため、一連のコマンドを実行した後は、 Disconect-MgGraph コマンドを実行ください。<br>なお、Disconect-MgGraph コマンドを実行すると、上記の .bin3 ファイルは表示されなくなります。（再度 Connect-MgGraph を実行してサインインすると、同じ場所にファイルが作成されます。）</p><p>また、Disconnect-MgGraph コマンドを実行しない場合、毎回サインイン画面が表示されないため、<br>認証済みの資格情報をそのまま使用できてしまうほかにも、たとえば異なるテナントに対し、意図しない操作を行ってしまう可能性も考えられます。</p><p>Get-Mgdomain コマンドや Get-MgOrganization コマンドを実行して、現在接続しているテナントを確認したり、 Get-MgContext コマンドを実行し、接続ユーザーの情報を確認したりすることも可能ですので、必要に応じてご利用ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure ID チームの小出です。&lt;br&gt;この記事は、MSOnline / AzureAD モジュール廃止について、&lt;a href=&quot;https://jpazureid.github.io/blog/azure-active-directory/azurea</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="PowerShell" scheme="https://jpazureid.github.io/blog/tags/PowerShell/"/>
    
  </entry>
  
  <entry>
    <title>Azure MFA Server 移行ツール</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/the-mfa-server-migration-utility/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/the-mfa-server-migration-utility/</id>
    <published>2022-09-04T15:00:00.000Z</published>
    <updated>2022-10-29T08:06:47.836Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 姚 (ヨウ) です。</p><p>本記事は、2022 年 8 月 31 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/one-step-closer-to-modernization-the-mfa-server-migration/ba-p/3614027">One step closer to modernization: The MFA Server Migration Utility - Microsoft Tech Community</a> を意訳したものになります。<br>ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは！</p><p>私たちは常に安全性と生産性を最大限に発揮でき、進化に合わせたソリューションを可能な限り容易に提供できるように努めています。<br>Azure AD の利用によって進化に合わせたセキュリティ対策を実施していく中、オンプレミス Azure MFA Server をクラウドベースの Azure MFA へ移行する際の支援が必要である旨を伺うことがあります。<br>クラウド ベースの MFA に移行することで構成上簡易化できるものがたくさん出てきます。例えば、オンプレミス Azure MFA Server と AD FS サーバーの撤去が挙げられます。<br>今回紹介します Azure MFA Server 移行ツールにより、移行作業の手助けができることを嬉しく思います。</p><p>2019 年 7 月からオンプレミス Azure MFA Server の新規ダウンロードを停止しました。<br>これはオンプレミス Azure MFA Server と比較した場合、クラウド ベースの Azure MFA が、コストの削減、展開の容易性、安全性の向上、機能の豊富さにおいて優位であることにも起因しています。<br>Azure MFA Server 移行ツールは管理者に簡単な作業でユーザーをオンプレミス MFA Server から Azure MFA に移行することによって、これらの利点を利用でき、インフラ環境の簡易化へ前進することができます。</p><p>このツールには以下の 2 つの特徴があります。</p><p>・Azure MFA Server 移行ツールは、エンドユーザーに再登録などの要求をすることなく、オンプレミスに保存時されているユーザーの認証データを Azure AD へ移行します。<br>このツールは最新バージョンの Azure MFA Server に含まれております。</p><p>・ Azure MFA の段階的ロールアウト機能は、フェデレーション設定を変更することなく、一部の対象ユーザーに対して Azure MFA への移行をテストできます。</p><p>はじめに</p><p>手順 1 : プライマリー Azure MFA Server をアップグレードします。<br>ここから最新版の Azure MFA Server をダウンロードし、プライマリー Azure MFA Server にインストールします。<br>もし、ほかにセカンダリ MFA Server が存在している場合、そのバージョンが 6.1.0 より新しいバージョンの場合、その他のサーバーについて追加のアップグレード作業は不要です。</p><p>手順 2 :移行対象のユーザーを選択します。<br>最新版の Azure MFA Server のインストール後、移行ツールを開きます。</p><p><img src="/blog/azure-active-directory/the-mfa-server-migration-utility/the-mfa-server-migration-utility-01.png"></p><p>ユーザーデータの移行は、移行対象ユーザーが含まれる Azure AD グループ (グループのネストも可能です) を選択し、Azure AD へ移行する対象の MFA 方法を定義し、”Migrate Users” をクリックするだけの簡単な手順です。</p><p>手順 3 : Azure MFA を利用するユーザーを定義します。<br>ユーザーデータの移行後、移行対象グループを基に Azure MFA 段階的ロールアウトを利用して Azure MFA を利用するユーザーを設定します。</p><p><img src="/blog/azure-active-directory/the-mfa-server-migration-utility/the-mfa-server-migration-utility-02.png"></p><p>テナントやフェデレーションの設定に対して変更を実施しないため、既存環境へ想定される影響は極めて低いです。また、テスト対象ユーザーについては、最低限のものを指定することができます。</p><p>テストおよび移行が完了しましたら、追加のインフラストラクチャーやメンテナンス費用の発生を抑止するために、即時 MFA Server を撤去できます。<br>移行ツールの詳細は<a href="https://docs.microsoft.com/en-us/azure/active-directory/authentication/how-to-mfa-server-migration-utility">公開情報</a>も参照ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 姚 (ヨウ) です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 8 月 31 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://te</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>2022 年 6 月末から「セキュリティの既定値群」の有効化が促されます (対象 : 一部のテナント)</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/security-default-2022/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/security-default-2022/</id>
    <published>2022-08-31T15:00:00.000Z</published>
    <updated>2022-10-29T08:06:47.824Z</updated>
    
    <content type="html"><![CDATA[<div class="alert is-info"><p class="alert-title">Note</p><p>2022 年 6 月 13 日更新: 有効にすることを促すポップアップが表示される頻度、14 日後にセキュリティの既定値が有効化されることについて情報を修正しました。</p><p>2022 年 6 月 15 日更新: 影響を受ける可能性があるテナントに関しての情報を更新しました。</p><p>2022 年 9 月  1 日更新: “ユーザーごとの Azure AD Multi-Factor を利用している” テナントも対象となるように方針が変更されたため情報を更新しました。</p><p>今後も情報が更新される可能性があります。情報の更新がありましたら本ブログの内容も更新します。</p></div><p>こんにちは。Azure &amp; Identity サポート チームの栗井です。</p><p>先日 2022 年 5 月 22 日に、グローバルの Azure Active Directory Identity Blog にて、下記記事が公開されました。</p><ul><li><a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/raising-the-baseline-security-for-all-organizations-in-the-world/ba-p/3299048">Raising the Baseline Security for all Organizations in the World</a></li></ul><p>上記の記事でアナウンスされた Azure Active Directory の新しい変更点について、本ブログ記事にて日本語で情報をおまとめいたしました。<br>なお分かりやすく読んでいただけるよう、英語記事の直訳ではなく、記事の構成など大幅に変更しております。</p><h2 id="この記事の要点は"><a href="#この記事の要点は" class="headerlink" title="この記事の要点は ?"></a>この記事の要点は ?</h2><p><strong>2019 年 10 月 22 日より前に作成された一部の Azure AD テナントにおいて、「セキュリティの既定値群」の有効化を促すポップアップが表示されるようになります。実施時期の目安は 2022 年 6 月末頃を予定しています。<span style="color: red; ">ポップアップが表示されたテナントでは 14 日経過したタイミングで 「セキュリティの既定値群」 が自動的に有効になる見込みです。自動的に有効になることを避ける必要がある場合、 「セキュリティの既定値群」を一度有効にし、再度無効にしてください (対処方法を後述しています)。</span></strong></p><ul><li>影響を受ける可能性があるテナント<ul><li>2019 年 10 月以前に作成された Azure AD テナントのうち、下記すべてに該当するテナント<ul><li>「条件付きアクセス ポリシー」を利用していない</li><li><del>ユーザーごとの Azure AD Multi-Factor を利用していない</del> <span style="color: red; ">(2022/9 追記: 当初は除外条件に含まれていましたが、条件から外れました)</span></li><li>Azure AD Premium (単体または Microsoft 365 E3 や EMS E3 等 Azure AD Premium を含む) ライセンスを 1 ライセンスも持たない</li><li>教育機関向け (EDU) のライセンスを 1 ライセンスも持たない</li><li>現在「セキュリティの既定値群」を利用していない、かつ過去にも利用が無い </li><li>レガシ認証の利用が無い (トラフィックが検出されていない) </li><li>CSP パートナー テナントではない</li></ul></li></ul></li></ul><p>上記の条件を 1 つでも満たしていないテナントには影響ありません。</p><h2 id="前提-1-そもそも「セキュリティの既定値群-セキュリティ-デフォルト-」とはどんな機能？"><a href="#前提-1-そもそも「セキュリティの既定値群-セキュリティ-デフォルト-」とはどんな機能？" class="headerlink" title="前提 1 : そもそも「セキュリティの既定値群 (セキュリティ デフォルト)」とはどんな機能？"></a>前提 1 : そもそも「セキュリティの既定値群 (セキュリティ デフォルト)」とはどんな機能？</h2><p>セキュリティの既定値群とは、2019 年 10 月にリリースされた、無料で利用できる Azure AD のセキュリティ機能です。</p><p>この機能を有効にすることで、下記のセキュリティ機能が一括で有効になります。</p><ol><li>すべてのユーザーに対して、Azure AD Multi-Factor Authentication への登録を必須にします。</li><li>管理者に多要素認証の実行を要求します。</li><li>必要に応じてユーザーに多要素認証を要求します。</li><li>レガシ認証プロトコルをブロックします。</li><li>Azure portal などへのアクセスに多要素認証を要求します。</li></ol><ul><li>参考 : <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/fundamentals/concept-fundamentals-security-defaults">Azure AD のセキュリティの既定値群</a></li></ul><p>機能の詳細については参考の公開情報をご覧ください。</p><h2 id="前提-2-自分のテナントでは、セキュリティの既定値群が有効化されている"><a href="#前提-2-自分のテナントでは、セキュリティの既定値群が有効化されている" class="headerlink" title="前提 2 : 自分のテナントでは、セキュリティの既定値群が有効化されている ?"></a>前提 2 : 自分のテナントでは、セキュリティの既定値群が有効化されている ?</h2><p>セキュリティの既定値群の現在の設定値は、Azure ポータルの下記画面にて確認できます。</p><ol><li>管理者ユーザーで Azure ポータル (<a href="https://portal.azure.com/">https://portal.azure.com</a>) にアクセスします。</li><li>Azure Active Directory &gt; プロパティ に進みます。<ul><li>直通リンク : <a href="https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Properties">https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Properties</a></li></ul></li><li>[セキュリティの既定値群の有効化] を押下いただくと、下記画面が表示されます。[はい / いいえ] によって現在の設定値が確認できます。<img src="/blog/azure-active-directory/security-default-2022/settings.png"></li></ol><p>なお 2019 年 10 月 22 日以降に作成された Azure AD テナントでは、テナントを作成した時点で、セキュリティの既定値群が有効にされています。</p><h2 id="本題-2019-年-10-月以前に作成された一部のテナントでは、管理者に対して「セキュリティの既定値群」の有効化を促すポップアップが表示されるようになる予定です。"><a href="#本題-2019-年-10-月以前に作成された一部のテナントでは、管理者に対して「セキュリティの既定値群」の有効化を促すポップアップが表示されるようになる予定です。" class="headerlink" title="本題 : 2019 年 10 月以前に作成された一部のテナントでは、管理者に対して「セキュリティの既定値群」の有効化を促すポップアップが表示されるようになる予定です。"></a>本題 : 2019 年 10 月以前に作成された一部のテナントでは、管理者に対して「セキュリティの既定値群」の有効化を促すポップアップが表示されるようになる予定です。</h2><p>既に多くのお客様環境において「セキュリティの既定値群」や「条件付きアクセス ポリシー」を利用した MFA をご活用いただいております。<br>しかしいずれも有効になっていないテナントの場合、セキュリティ観点では安全な状態とは言えません。このようなテナントを対象に、<strong>2022 年の 6 月末を目安に、セキュリティの既定値群の有効化を促し、その後設定を有効にする予定</strong>です。</p><h3 id="セキュリティの既定値群の有効化ポップアップが表示されるまでのステップ"><a href="#セキュリティの既定値群の有効化ポップアップが表示されるまでのステップ" class="headerlink" title="セキュリティの既定値群の有効化ポップアップが表示されるまでのステップ"></a>セキュリティの既定値群の有効化ポップアップが表示されるまでのステップ</h3><ol><li><p>セキュリティの既定値群のポップアップ表示の対象テナントには、まずグローバル管理者宛へのメール、ならびに Microsoft 365 管理センターのメッセージ センターでの通知が行われる予定です。</p></li><li><p>そして 6 月下旬頃から、グローバル管理者によるサインイン時に、下記のようなプロンプトが表示されるようになります。<br><img src="/blog/azure-active-directory/security-default-2022/prompt.png"></p></li><li><p>上記プロンプトで “Enable Security Defaults” を選択いただくと、即時にセキュリティの既定値群が有効にされます。</p></li><li><p>上記プロンプトで “Ask Later” を選択いただくと、2 日間上記通知は表示されなくなりますが、2 日後に再度表示されます (再度 Ask later が可能)。合計 14 日間 Ask later で先延ばしが可能です。</p></li></ol><h3 id="ポップアップが表示された場合どうなるか"><a href="#ポップアップが表示された場合どうなるか" class="headerlink" title="ポップアップが表示された場合どうなるか"></a>ポップアップが表示された場合どうなるか</h3><ul><li>後述する 「再無効化」 の対処をしない場合、14 日経過したタイミングで 「セキュリティの既定値群」 が自動的に有効になる予定です。(一部のテナントに対しては、自動的に有効にするのではなく、ポップアップでの選択肢としても引き続き無効としたままとするものを用意する予定ですが、無効のままとしたい場合には、再無効化の作業を事前に実施しておくことが確実です。)</li><li> 「セキュリティの既定値群」 を無効にしておく必要がある場合、 「セキュリティの既定値群」を一度有効にし、有効にした後で再度無効にすることで、「セキュリティの既定値群」の有効化を促すポップアップは表示されなくなり、また、セキュリティの既定群の自動的な有効化も避けることができます。(この手法を本ブログでは <strong>「再無効化」</strong> と呼称しています)</li><li>再無効化において、一度有効にしてから無効に再度変更するまでに特に間隔を空ける必要はありません。</li><li>再無効化はポップアップが表示される前に実施しても効果が見込めます。しかし、タイミング次第では再無効化を事前に実施していてもポップアップが表示される可能性があります。この場合は、ポップアップが表示されたのちに再度、再無効化を実施ください。</li></ul><h3 id="再無効化の実施方法"><a href="#再無効化の実施方法" class="headerlink" title="再無効化の実施方法"></a>再無効化の実施方法</h3><ol><li>Azure portal に、セキュリティ管理者、条件付きアクセス管理者、または全体管理者としてサインインします。</li><li>[Azure Active Directory]&gt;[プロパティ] の順に移動します。</li><li>[セキュリティの既定値群の管理] を選択します。</li><li>[セキュリティの既定値群の有効化] トグルを [はい] に設定します。</li><li>[保存] を選択します。</li><li>[セキュリティの既定値群の有効化] トグルを [いいえ] に設定します。</li><li>[保存] を選択します。</li></ol><h2 id="補足-1-セキュリティの既定値群を有効化すると、具体的にどうなるの？"><a href="#補足-1-セキュリティの既定値群を有効化すると、具体的にどうなるの？" class="headerlink" title="補足 1 : セキュリティの既定値群を有効化すると、具体的にどうなるの？"></a>補足 1 : セキュリティの既定値群を有効化すると、具体的にどうなるの？</h2><p>セキュリティの既定値群の機能については、前述の項目「前提 1 : そもそも「セキュリティの既定値群 (セキュリティ デフォルト)」とはどんな機能？」の通りですが、ユーザー / 管理者目線で発生する具体的な差異について、補足します。</p><h3 id="1-すべてのユーザー-Azure-MFA-への登録が必須になります。"><a href="#1-すべてのユーザー-Azure-MFA-への登録が必須になります。" class="headerlink" title="1. すべてのユーザー : Azure MFA への登録が必須になります。"></a>1. すべてのユーザー : Azure MFA への登録が必須になります。</h3><p>MFA の方法を一切登録していないユーザーに対して、登録が要求されます。具体的には、サインイン時に下記画面が表示され、Microsoft Authenticator のアプリによる MFA の登録が要求されます。<br><img src="/blog/azure-active-directory/security-default-2022/mysignins.png"></p><ul><li>Azure AD Premium (またはそれを含む) ライセンスが割り当てられたテナントでは、SMS や音声通話による MFA も選択できます。Azure AD Premium ライセンスが割り当てられていないテナントで一般ユーザーが利用できる多要素認証は Microsoft Authenticator のみです。</li><li>管理者ユーザーは MFA の方法として 2 つの登録が必要です。Microsoft Authenticator に加えて、SMS の番号の登録も要求されます。</li></ul><h3 id="2-すべてのユーザー-レガシ認証がブロックされます。"><a href="#2-すべてのユーザー-レガシ認証がブロックされます。" class="headerlink" title="2. すべてのユーザー : レガシ認証がブロックされます。"></a>2. すべてのユーザー : レガシ認証がブロックされます。</h3><p>一般的にレガシ認証と呼ばれる、古いプロトコルによる認証がすべてブロックされます。<br>レガシ認証には Exchange ActiveSync、POP、IMAP、SMTP、MAPI over HTTP などが含まれます。</p><p>レガシ認証のみ対応しているメールクライアント アプリ等を利用している場合、レガシ認証のブロックにより接続ができないなどの影響が生じる恐れがあります。</p><h3 id="3-管理者ユーザー-全てのサインイン時に-MFA-が要求されます。"><a href="#3-管理者ユーザー-全てのサインイン時に-MFA-が要求されます。" class="headerlink" title="3. 管理者ユーザー : 全てのサインイン時に MFA が要求されます。"></a>3. 管理者ユーザー : 全てのサインイン時に MFA が要求されます。</h3><p>すべてのユーザーに対して MFA の登録が必要となるほか、管理者ユーザーについては、サインインの度に毎回、登録した方法による MFA が要求される動作になります。</p><p>管理者ではない一般ユーザーについては、サインインの度に毎回 MFA が要求される動作にはなりません。Azure AD がユーザーの不審な操作を検知した際や、ユーザーが Azure ポータルや Azure CLI などの特権を必要とするアプリケーションにアクセスする際など、”必要に応じて” MFA が要求されるようになります。</p><h2 id="補足-2-上記変更に至った経緯"><a href="#補足-2-上記変更に至った経緯" class="headerlink" title="補足 2 : 上記変更に至った経緯"></a>補足 2 : 上記変更に至った経緯</h2><p>そもそもなぜ、セキュリティの既定値群の有効を進めるような施策が実施されるのに至ったのか？その経緯と背景については、冒頭に記載の「Raising the Baseline Security for all Organizations in the World」にてご紹介しております。以下はその抄訳です。</p><p>世界中のお客様にご利用いただいている Azure AD においては、日々何全件もの不審なサインインやアカウント攻撃が発生しています。しかし残念ながら現状は、その防御率は 100% ではありません。</p><p>もし不審なアクセスを防ぐことができずアカウントが侵害されると、お客様の業務影響や情報漏洩などに直結しうる大問題であることは、言うまでもありません。</p><p>少しでもこのような事態を回避するために、Azure AD の各種設定を活用して、セキュリティ性を高めることは重要です。中でも最も大事なのは、<strong>MFA を有効化すること、そしてレガシ認証を無効化してモダン認証 (先進認証) に完全移行すること</strong>です。</p><p>事実、弊社で報告を受けたアカウントの侵害事例のうち 99.9% 以上に対して、MFA が有効化されていませんでした。</p><p>MFA が有効化されていない場合、パスワードのみでサインインができてしまうということです。パスワードのみによるアカウントの保護は昨今においては非常に脆弱で、パスワード スプレー攻撃やパスワード リスト型攻撃、フィッシングといった脅威における格好のターゲットになります。レガシ認証も同様の理由 (= パスワードのみの認証) で、攻撃者にとってはとても都合のいいセキュリティ ホールです。</p><p>ただし残念ながら、全ての組織において IT セキュリティ専門のチームが存在している状況ではありません。そのため MFA という存在自体を知らなかったり、知っていても導入するきっかけが無い場合もあるかと存じます。</p><p>そのような状況を改善するために、2019 年 10 月以降に作成された Azure AD テナントに対しては、既定で「セキュリティの既定値群」の設定が有効にされています。この機能は 3000 万以上の組織にてご活用いただいています。これらの組織では、全体の Azure AD 利用者に比べ、80% ものアカウント侵害を防いでいる実績があります。</p><p>しかし 2019 年 10 月より前に作成された Azure AD テナントでは、「セキュリティの既定値群」は管理者が明示的に設定を変更しない限りは、有効にされておりません。そのため、別途条件付きアクセス ポリシー等の他の機能によってセキュリティ性を高めていただいている場合を除き、前述した「パスワードのみの認証」によるリスクに晒されている現状を懸念して、セキュリティの既定値群の有効に向けた施策を決定しました。</p><p>「セキュリティの既定値群」は組織のセキュリティ性を担保いただくにあたって優秀な機能ですが、無料のオプションであるため、カスタマイズ性が低いことがデメリットです。<br>Azure AD Premium のライセンスによってご利用いただける「条件付きアクセス」の機能であれば、アクセス パターンやユーザーに応じた制御をよりきめ細かく構成できますので、必要に応じて導入をご検討いただけますと幸いです。</p><p>ご不明な点がございましたら弊社サポートまでお気軽にお問い合わせください。上記内容が少しでも皆様の参考となりますと幸いです。</p><h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><hr><p>Q1. ポップアップは英語以外でも表示されますか？</p><p>A1. はい、日本語など各国の言語に翻訳され表示される見込みです。</p><hr><p>Q2. 事前通知はグローバル管理者へのメール、ならびに Microsoft 365 管理センターのメッセージ センター以外にも行われますか。</p><p>A2. はい。Azure ポータル上での表示も併せて行われる見込みです。</p><hr><p>Q3. CSP のパートナーのテナントでも表示されますか？</p><p>A3. いいえ、表示されません。 またこれらのテナントでは自動的にセキュリティの既定値群が有効になることもありません。</p><hr><h2 id="関連リンクまとめ"><a href="#関連リンクまとめ" class="headerlink" title="関連リンクまとめ"></a>関連リンクまとめ</h2><h3 id="記事内で引用・ご紹介した公開情報-再掲"><a href="#記事内で引用・ご紹介した公開情報-再掲" class="headerlink" title="記事内で引用・ご紹介した公開情報 (再掲)"></a>記事内で引用・ご紹介した公開情報 (再掲)</h3><ul><li><a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/raising-the-baseline-security-for-all-organizations-in-the-world/ba-p/3299048">Raising the Baseline Security for all Organizations in the World (英語記事) | Microsoft Tech Community</a></li><li><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/fundamentals/concept-fundamentals-security-defaults">Azure AD のセキュリティの既定値群 | Microsoft Docs</a></li></ul><h3 id="Azure-AD-MFA-についてもっと知りたい方へ"><a href="#Azure-AD-MFA-についてもっと知りたい方へ" class="headerlink" title="Azure AD MFA についてもっと知りたい方へ"></a>Azure AD MFA についてもっと知りたい方へ</h3><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/concept-mfa-howitworks">Azure AD Multi-Factor Authentication | Microsoft Docs</a>Azure AD MFA の動作の仕組みについてご紹介しています。</li><li><a href="https://jpazureid.github.io/blog/azure-active-directory/MFA_configuration_scenarios/">Azure MFA 導入パターンを網羅的にご紹介！ | Japan Azure Identity Support Blog</a>Azure AD MFA を有効化いただける各種機能を、セキュリティの規定値群や条件付きアクセスを含め、ご紹介しております。</li></ul><h3 id="条件付きアクセスについてもっと知りたい方へ"><a href="#条件付きアクセスについてもっと知りたい方へ" class="headerlink" title="条件付きアクセスについてもっと知りたい方へ"></a>条件付きアクセスについてもっと知りたい方へ</h3><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/overview">条件付きアクセスとは | Microsoft Docs</a>条件付きアクセスの概要をご紹介しております。</li><li><a href="https://www.youtube.com/watch?v=CTdQnnm9s_k">3-2: 詳説！Azure AD 条件付きアクセス - 動作の仕組みを理解する編 | youtube.com</a>Azure AD 開発チームがお届けするウェビナーです。条件付きアクセスの動作の仕組みをご紹介しております。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;alert is-info&quot;&gt;&lt;p class=&quot;alert-title&quot;&gt;Note&lt;/p&gt;&lt;p&gt;2022 年 6 月 13 日更新: 有効にすることを促すポップアップが表示される頻度、14 日後にセキュリティの既定値が有効化されることについて情報を修正し</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="MFA" scheme="https://jpazureid.github.io/blog/tags/MFA/"/>
    
    <category term="Security Default" scheme="https://jpazureid.github.io/blog/tags/Security-Default/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD Certificate-Based Authentication (CBA) の新しい機能拡張のご紹介</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/check-out-new-azure-ad-certificate-based-authentication-cba/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/check-out-new-azure-ad-certificate-based-authentication-cba/</id>
    <published>2022-08-30T00:00:00.000Z</published>
    <updated>2022-10-29T08:06:47.444Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの夏木です。</p><p>本記事は、2022 年 7 月 26 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/check-out-new-azure-ad-certificate-based-authentication-cba/ba-p/2365682">Check out new Azure AD Certificate-Based Authentication (CBA) enhancements</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>2022 年 2 月、私たちは Microsoft の「<a href="https://www.whitehouse.gov/briefing-room/presidential-actions/2021/05/12/executive-order-on-improving-the-nations-cybersecurity/">Executive Order 14028,Improving the Nation’s Cybersecurity</a>」へのコミットメントの一環として、<a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/azure-ad-certificate-based-authentication-now-in-public-preview/ba-p/2464390">Azure AD Certificate-Based Authentication</a> のパブリック プレビューを発表しました。</p><p>パブリック プレビューのプロセスにて、プライベート プレビューに参加しなかったお客様からも素晴らしいフィードバックを得ることができました。今回も、素晴らしいフィードバックをいただき、既存のパブリック プレビューにいくつかの重要な機能を追加しました。お客様からのフィードバックによって改善された Azure AD Certificate Based Authentication (CBA) の項目は以下のとおりです:</p><ul><li>Azure AD アプリケーションおよびリソースへのシングルサインオン (SSO) と Windows ログオンに対する Azure AD CBA のサポート </li><li>マネージド デバイスと非マネージド デバイスで Microsoft 製アプリケーションにアクセスするためのモバイル プラットフォーム (iOS、Android) に対する Azure AD CBA のサポート </li><li>信頼された証明機関の構成を Azure AD で管理するための管理機能の向上 </li><li>Active Directory Federated Server からの移行を容易にするための CBA の段階的展開のサポート</li></ul><p>以下では、Senir Product Manager である Vimala Renganathan より詳細をお知らせいたします。</p><p>Alex Weinert, Director of Identity Security, Microsoft<br>(Twitter: <a href="https://techcommunity.microsoft.com/t5/user/viewprofilepage/user-id/15847#profile">@Alex_t_weinert</a>)  </p><hr><p>みなさんこんにちは。</p><p>Identity PM チームの Vimala と申します。今回、Azure AD (CBA) のパブリック プレビューに対して追加された新機能をお話しできることをうれしく思います。</p><h2 id="Windows-ログオンのサポート"><a href="#Windows-ログオンのサポート" class="headerlink" title="Windows ログオンのサポート"></a>Windows ログオンのサポート</h2><p>Windows 11 (22H2) において、Azure AD ユーザーが、スマートカード上の X.509 証明書を使用して、Windows ログオン時に Azure AD に対して直接認証することができるようになりました。Azure AD 参加デバイスおよび Hybrid Azure AD 参加デバイスでは、ユーザーが証明書を使用して Windows にログインすると、Azure AD と統合されたすべてのアプリケーションに対し SSO の恩恵を得ることができるようになります。</p><p><img src="/blog/azure-active-directory/check-out-new-azure-ad-certificate-based-authentication-cba/win-logon.png"></p><p>今後、Windows 10 や Windows Server でもこの機能に対応する予定です。</p><h2 id="モバイル-デバイス-Android、iOS-のサポート"><a href="#モバイル-デバイス-Android、iOS-のサポート" class="headerlink" title="モバイル デバイス (Android、iOS) のサポート"></a>モバイル デバイス (Android、iOS) のサポート</h2><p>iOS および Android デバイスにおいて、ユーザーのデバイスにプロビジョニングされた証明書を使用して、Azure AD CBA をもちいて Azure AD に対する認証を行うことができるようになりました。ネイティブ ブラウザと Microsoft アプリケーション (下記一覧) の両方がサポートされています。企業は、Microsoft Intune などのモバイル デバイス管理 (MDM) ソリューションを使用して、管理するデバイスにクライアント証明書または派生する個人識別情報の検証 (PIV) をプロビジョニングすることができます。 </p><p>以下は、サポートされる Microsoft アプリケーションのリストです。 </p><table><thead><tr><th>アプリ名</th><th>対応状況</th></tr></thead><tbody><tr><td>Azure Information Protection app</td><td><img src="/blog/azure-active-directory/check-out-new-azure-ad-certificate-based-authentication-cba/check.png"></td></tr><tr><td>Intune Company Portal</td><td><img src="/blog/azure-active-directory/check-out-new-azure-ad-certificate-based-authentication-cba/check.png"></td></tr><tr><td>Microsoft Teams</td><td><img src="/blog/azure-active-directory/check-out-new-azure-ad-certificate-based-authentication-cba/check.png"></td></tr><tr><td>Office (mobile)</td><td><img src="/blog/azure-active-directory/check-out-new-azure-ad-certificate-based-authentication-cba/check.png"></td></tr><tr><td>OneNote</td><td><img src="/blog/azure-active-directory/check-out-new-azure-ad-certificate-based-authentication-cba/check.png"></td></tr><tr><td>OneDrive</td><td><img src="/blog/azure-active-directory/check-out-new-azure-ad-certificate-based-authentication-cba/check.png"></td></tr><tr><td>Outlook</td><td><img src="/blog/azure-active-directory/check-out-new-azure-ad-certificate-based-authentication-cba/check.png"></td></tr><tr><td>Power BI</td><td><img src="/blog/azure-active-directory/check-out-new-azure-ad-certificate-based-authentication-cba/check.png"></td></tr><tr><td>Skype for Business</td><td><img src="/blog/azure-active-directory/check-out-new-azure-ad-certificate-based-authentication-cba/check.png"></td></tr><tr><td>Word / Excel / PowerPoint</td><td><img src="/blog/azure-active-directory/check-out-new-azure-ad-certificate-based-authentication-cba/check.png"></td></tr><tr><td>Yammer</td><td><img src="/blog/azure-active-directory/check-out-new-azure-ad-certificate-based-authentication-cba/check.png"></td></tr></tbody></table><h2 id="管理者体験の向上"><a href="#管理者体験の向上" class="headerlink" title="管理者体験の向上"></a>管理者体験の向上</h2><p>お客様が CBA の設定を簡単に設定し、管理できるようにすることが何よりも重要です。これまでは、PowerShell コマンドを使用して認証局を Azure AD にアップロードする必要がありましたが、今後は Azure ポータルを使用してシームレスに認証局を設定できるようになりました。 </p><p>Azure ポータルを使って、以下のことができるようになりました：</p><ul><li>認証局 (ルート CA とすべての中間 CA) を Azure AD にアップロードする </li><li>Azure AD にアップロードされたすべての信頼された認証機関を表示する</li><li>CA が有効でない場合は削除する</li><li>証明書の有効期限に基づき、証明書の有効性を簡単に確認することができる</li></ul><p><img src="/blog/azure-active-directory/check-out-new-azure-ad-certificate-based-authentication-cba/cert-settings.png"></p><h2 id="今後の展開"><a href="#今後の展開" class="headerlink" title="今後の展開"></a>今後の展開</h2><p><a href="https://feedback.azure.com/d365community/forum/22920db1-ad25-ec11-b6e6-000d3a4f0789">Azure Active Directory Community</a> に引き続きご意見をお寄せください。第二認証要素としての CBA や、証明書失効リスト (CRL) の制限の撤廃、ルーティング不可能な UPN のサポート、モバイル デバイスでの外部スマートカード サポートなど、さらなる機能拡張を実現を目指しています。 </p><p>マイクロソフトの <a href="https://www.microsoft.com/en-us/federal/CyberEO.aspx">Executive Order 14028 here</a> に対するコミットメントについては、こちらをご覧ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの夏木です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 7 月 26 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcomm</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>セキュアなコラボレーションを実現するクロス テナント アクセス設定が一般公開されました！</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/cross-tenant-access-setting-ga/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/cross-tenant-access-setting-ga/</id>
    <published>2022-08-09T00:00:00.000Z</published>
    <updated>2022-10-29T08:06:47.508Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure Identity サポート チームの小出です。</p><p>本記事は、 2022 年 7 月 21 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/cross-tenant-access-settings-for-secure-collaboration-now/ba-p/3575844">Cross-tenant access settings for secure collaboration now generally available!</a> を意訳したものになります。ご不明点などございましたら、サポート チームまでお問い合わせください。</p><hr><p>みなさん、こんにちは。 </p><p>外部コラボレーションのためのクロス テナント アクセス設定が、一般利用可能になったことをお伝えしたいと思います。セキュアなコラボレーション ポリシーを実現するためにチームが行った作業を誇りに思うと同時に、<a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/collaborate-more-securely-with-new-cross-tenant-access-settings/ba-p/2147077">パブリック プレビュー</a> を実施した際に、お客様から得た知見を共有できることを嬉しく思います。</p><p>お客様からお聞きした採用事例やメインのシナリオについて、ここからはシニア プロダクト マネージャーの Josh Douglas を迎えて、話を聞きたいと思います。</p><hr><p>Robin、ありがとう! クロス テナント アクセス設定と一般提供までの道のりについて、皆さんに詳しくお話できることをうれしく思います。パブリック プレビューでは、多くのお客様がクロス テナント アクセス設定を採用し、以前は不可能だったシナリオや要件に対応されています。このことを説明するために、まずは以下の情報を紹介します。</p><ul><li>5,000 以上のテナントが、他の組織のために MFA の信頼を設定しました。</li><li>2,000 以上のテナントが、準拠済みもしくは Azure AD 参加デバイスの信頼関係を構成しました。</li></ul><p>これらの統計は、この機能によって、従来は不可能だった組織外のコラボレーションのセキュリティ確保が可能になるという、皆様からの素晴らしいフィードバックに沿うものです。</p><h2 id="セキュアなコラボレーションを実現しながら外部ユーザーとスムーズに連携する"><a href="#セキュアなコラボレーションを実現しながら外部ユーザーとスムーズに連携する" class="headerlink" title="セキュアなコラボレーションを実現しながら外部ユーザーとスムーズに連携する"></a>セキュアなコラボレーションを実現しながら外部ユーザーとスムーズに連携する</h2><p>外部ユーザーの MFA 登録を管理することで、追加作業が発生し、サポート コストが増加するという声が聞かれます。さらにユーザーは、コラボレーションする異なる組織間で、時には複数回、登録と MFA を実行しなければならず負担を感じていました。受信方向のクロス テナント アクセス設定では、外部の Azure AD 組織からの MFA のセキュリティ クレームを信頼し、条件付きアクセス ポリシーで MFA が要求された場合に、外部ユーザーがホーム テナントで MFA を実行するようにするお客様が多くなっています。これにより、ユーザーは別のテナントのリソースにアクセスする際に 2 回目の MFA を実行する必要がなくなり、ユーザーにとっての負担が大幅に軽減されます。これにより、組織で要求されるセキュリティ体制を維持しながら、外部ユーザーの MFA 登録を管理する必要がなくなり、サポート コストを削減することができます。また、組織で発生する MFA コストも削減できます。</p><p>さらに、外部ユーザーがアプリやリソースにアクセスするデバイスの種類を懸念しているお客様もいらっしゃいました。条件付きアクセス ポリシーを適用して、外部ユーザーが準拠済みデバイスまたはハイブリッド Azure AD 参加ドメインでリソースにアクセスすることを要求することが、受信方向のクロス テナント アクセス設定で可能になりました。外部 AD 組織からのデバイス クレームを信頼することで、管理されたデバイスで外部ユーザーがアプリやリソースにアクセスしていることがわかり、データをさらに保護することができます。 </p><p>詳細は <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/external-identities/authentication-conditional-access">External Identities の認証と条件付きアクセス</a> をご覧ください。</p><p><img src="/blog/azure-active-directory/cross-tenant-access-setting-ga/cross-tenant-access-setting-ga1.png" alt="特定の外部組織から、多要素認証、コンプライアンス、ハイブリッドAzure ADに参加したデバイスを信頼する。"></p><h2 id="ユーザーが承認した外部組織とのみコラボレートするようにする"><a href="#ユーザーが承認した外部組織とのみコラボレートするようにする" class="headerlink" title="ユーザーが承認した外部組織とのみコラボレートするようにする"></a>ユーザーが承認した外部組織とのみコラボレートするようにする</h2><p>アプリやリソースを外部からの不正アクセスから保護することが重要であるのと同様に、ユーザーが承認した組織としかコラボレーションしていないことを確認することも重要な場合があります。例えば、規制の強い業界に属し、データの流出について非常に敏感になっている組織があげられます。教育機関では、学生が学校のアカウントを使用して、許可されていない外部組織と Teams 上でチャットしている可能性もあります。このようなシナリオでは、ユーザーが未承認の外部テナントにアクセスするのをブロックする、送信方向のクロス テナント アクセス設定を導入することができます。教育業界のあるお客様は、ポリシーのテストと導入に 5 分もかからなかったそうです。これによりシンプルなセキュリティが実現できます。</p><p>詳細は <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/external-identities/cross-tenant-access-settings-b2b-collaboration#modify-outbound-access-settings">送信アクセス設定を変更する</a> ご覧ください。</p><p><img src="/blog/azure-active-directory/cross-tenant-access-setting-ga/cross-tenant-access-setting-ga2.png" alt="ユーザーのグループをターゲットにして、特定の組織への送信アクセスをブロックする。"></p><p><img src="/blog/azure-active-directory/cross-tenant-access-setting-ga/cross-tenant-access-setting-ga3.png" alt="同じグループのユーザーが、送信アクセス時に、どのアプリケーションにもアクセスできないようにブロックする。"></p><h2 id="Teams-の共有チャンネルでシームレスなコラボレーションを実現"><a href="#Teams-の共有チャンネルでシームレスなコラボレーションを実現" class="headerlink" title="Teams の共有チャンネルでシームレスなコラボレーションを実現"></a>Teams の共有チャンネルでシームレスなコラボレーションを実現</h2><p>Teams や SharePoint 上で、外部ユーザーとのコラボレーションを主に行っている場合、<a href="https://docs.microsoft.com/ja-jp/MicrosoftTeams/shared-channels">Teams 共有チャネル</a> にて、複数の組織のユーザーと同時にチャットやファイル共有、コラボレーションを行うことができるシームレスなコラボレーションが可能です。上記で説明した受信および送信方向のクロス テナント アクセス ポリシーは、Teams 共有チャネルの <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/external-identities/b2b-direct-connect-overview">B2B 直接接続</a> ユーザーにも適用されます。 </p><p><img src="/blog/azure-active-directory/cross-tenant-access-setting-ga/cross-tenant-access-setting-ga4.png" alt="共有チャネルは、ユーザーがテナントを切り替えることなく、シームレスなコラボレーションを実現する。"></p><h2 id="お客様の声"><a href="#お客様の声" class="headerlink" title="お客様の声"></a>お客様の声</h2><p>パブリック プレビュー期間中、多くのお客様が上記の機能を試され、次のような感想を述べられています。 </p><blockquote><p>“クロス テナント アクセス設定は、外部組織とのコラボレーションを確保するために必要なコントロールを提供し、自社の保有財産を超えた「ゼロ トラスト」の道のりをサポートしてくれます。”<br>– 保険業界のお客様からの声</p></blockquote><blockquote><p>“Azure AD B2B により、当社のビジネスとパートナーや顧客との連携、サービスや製品へのアクセスを提供する方法が変革されました。クロス テナント アクセス設定は、より詳細で相互に合意可能なレベルの制御を実装する機能を提供することで、ビジネスを次のレベルへと押し上げました。これは多くのお客様からの重要な要望であり、両者が妥協することなく、データ保護要件を満たすために必要な制御を実施することが可能になります。”<br>– プロフェッショナルサービス業界のお客様からの声</p></blockquote><blockquote><p>“これらの機能により、セキュリティ管理が強化されるとともに、管理されたエンドポイント デバイスから外部テナントへのログインを強制できるようになるため、クロス テナント アクセスに非常に期待しています。クロス テナント アクセスは、リスクを大幅に削減し、セキュリティを向上させ、外部テナントへのアクセスやコラボレーションのニーズに関して、ビジネスをより良くサポートするのに役立っています。セキュリティ部門、ビジネス、そして重要なことですが、監査役や規制当局もこの機能に満足しています。”<br>– 金融サービス業界のお客様 </p></blockquote><h2 id="これはほんの始まりに過ぎません…"><a href="#これはほんの始まりに過ぎません…" class="headerlink" title="これはほんの始まりに過ぎません…"></a>これはほんの始まりに過ぎません…</h2><p>みなさまもぜひクロス テナント アクセス設定をお使いいただければと思います。この設定を始める前に、外部組織とのコラボレーションを評価し、必要なコラボレーションを不注意で阻害することがないように、この <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/reports-monitoring/workbook-cross-tenant-access-activity">ワークブック</a> を活用ください。受信および送信方向のコラボレーション状況を把握できるよう、シンプルに構成されています。</p><p>この製品をどのように使用しているか、または今後どのようにすればより良くなるかについてのフィードバックをお待ちしています。Azure フォーラムや Twitter の @AzureAD タグでフィードバックを共有ください。 </p><p>Robin &amp; Josh<br>Twitter: RobinGo_MS, @joshkdouglas</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure Identity サポート チームの小出です。&lt;/p&gt;
&lt;p&gt;本記事は、 2022 年 7 月 21 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>パブリック プレビュー- My Apps の強化</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/publicpreview-myapps/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/publicpreview-myapps/</id>
    <published>2022-08-08T00:00:00.000Z</published>
    <updated>2022-10-29T08:06:47.768Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure Identity サポート チームの小出です。</p><p>本記事は、 2021 年 11 月15 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/public-preview-enhanced-quot-my-apps-quot-experience/ba-p/3118022">Public Preview: Enhanced “My Apps” experience</a> を意訳したものになります。ご不明点などございましたら、サポート チームまでお問い合わせください。</p><p>Microsoft Entra のエンド ツー エンドの機能を拡張し続けている私たちは、強力なアイデンティティとアクセス管理の実装が、組織とそのすべての人々の生産性を向上させるはずだと固く信じています。安全なアクセスは、ユーザーにとって、可能な限り摩擦のないものでなければなりません。</p><p>お客様のようなお客様からのフィードバックにより、私たちは <a href="https://myapps.microsoft.com/">My Apps ポータル</a> に大幅な機能強化を提供しています。今週、パブリックプレビューを開始し、すべての Azure Active Directory (Azure AD) ユーザーが <a href="https://myapps.microsoft.com/">myapps.microsoft.com</a> で利用できます。</p><h2 id="日常業務のスタート地点"><a href="#日常業務のスタート地点" class="headerlink" title="日常業務のスタート地点"></a>日常業務のスタート地点</h2><p>My Appsは、必要なアプリケーションに迅速かつ安全にアクセスできるようにします。ユーザーは、自分がアクセスできるアプリケーションを発見して起動できるため、このポータルは、あらゆるタスクの出発点となることでしょう。<br><img src="/blog/azure-active-directory/publicpreview-myapps/publicpreview-myapps1.png"></p><h2 id="より使いやすくなりました"><a href="#より使いやすくなりました" class="headerlink" title="より使いやすくなりました"></a>より使いやすくなりました</h2><p>新しいビューは、より使いやすく、レスポンシブで、アクセスしやすくなっています。同じスペースにより多くのアプリが表示され、コレクション（アプリのグループ）間を移動するために、クリックする代わりにスクロールすることができます。特に複数のコレクションを使用する場合、大型モニターからモバイル デバイスまで、より適切に拡大縮小されます。これらにより、My Apps がマウス、タッチ スクリーン、スクリーン リーダー、キーボードのいずれのナビゲーションで使用されている場合でも、ユーザーがアプリケーションを見つけて起動するのがより簡単かつ迅速になります。</p><p><img src="/blog/azure-active-directory/publicpreview-myapps/publicpreview-myapps2.png"></p><p><img src="/blog/azure-active-directory/publicpreview-myapps/publicpreview-myapps3.png"></p><p>さらに、各コレクションは個別に折りたたむことができ、ナビゲーションが容易になります。また、関連する設定ボタンがあり、コレクションの非表示など、関連するアクションを簡単に見つけることができます。</p><h2 id="パブリック-プレビューを今すぐ体験"><a href="#パブリック-プレビューを今すぐ体験" class="headerlink" title="パブリック プレビューを今すぐ体験"></a>パブリック プレビューを今すぐ体験</h2><p>ユーザーは、ヘッダーの「Try the preview」ボタンを選択することでプレビューに参加でき、「Return to previous view」ボタンを選択することで以前のビューに戻ることができます。なお、今回のプレビューでは、ドラッグ＆ドロップは使用できませんが、一般公開までに追加される予定です。</p><p><img src="/blog/azure-active-directory/publicpreview-myapps/publicpreview-myapps4.png"></p><p>改善された <a href="https://myapps.microsoft.com/">My Apps</a> の体験を今すぐお試しいただき、主要なステーク ホルダーやユーザーと共有してください。</p><h2 id="念のため、My-Appsにサイトを追加する手順"><a href="#念のため、My-Appsにサイトを追加する手順" class="headerlink" title="念のため、My Appsにサイトを追加する手順"></a>念のため、My Appsにサイトを追加する手順</h2><p>My Apps では、ユーザーが Web サイトへのリンクを作成できるようになったため、関連するすべてのアプリとサイトにアクセスできるようになりました。Azure AD とまだ統合されていない Web サイトを頻繁に訪問する場合、簡単なリンクを作成することで追加することができます。サイトを作成するには、「サイトの追加」をクリックし、名前と URL を入力します。</p><p><img src="/blog/azure-active-directory/publicpreview-myapps/publicpreview-myapps5.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure Identity サポート チームの小出です。&lt;/p&gt;
&lt;p&gt;本記事は、 2021 年 11 月15 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>外部コラボレーションの設定 (ゲスト ユーザーのアクセス制限) について</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/external-collaboration-setting-b2b-access/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/external-collaboration-setting-b2b-access/</id>
    <published>2022-08-01T00:00:00.000Z</published>
    <updated>2022-10-29T08:06:47.532Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure ID チームの小出です。</p><p>今回は、外部コラボレーションの設定で指定できる、ゲスト ユーザーのアクセス制限についてご紹介します。</p><p>Azure ポータルには、招待されたゲスト ユーザーがどのような情報にアクセスできるか・できないかを制御する設定項目があります。<br>具体的には、下記画面の [ゲスト ユーザーのアクセス制限] の 3 つの選択肢で、ゲストがアクセスできる範囲を指定できます。<br><img src="/blog/azure-active-directory/external-collaboration-setting-b2b-access/external-collaboration-setting-b2b-access1.png"></p><p>この設定については、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/external-identities/external-collaboration-settings-configure">外部コラボレーションの設定を構成する</a> にて詳細を確認することができますが、各選択肢について、具体的にどのような違いがあるのか分からない・詳細を教えてほしいというお問い合わせを多くいただいております。</p><p>そのため今回は、それぞれの選択肢を指定した際、ゲスト ユーザー側から見ると、どのような変化があるかを、画面ショット付きでご案内します。</p><h2 id="ゲスト-ユーザーは、メンバーと同じアクセス権を持ちます-制限が最も少ない-を選択した場合"><a href="#ゲスト-ユーザーは、メンバーと同じアクセス権を持ちます-制限が最も少ない-を選択した場合" class="headerlink" title="[ゲスト ユーザーは、メンバーと同じアクセス権を持ちます (制限が最も少ない)] を選択した場合"></a>[ゲスト ユーザーは、メンバーと同じアクセス権を持ちます (制限が最も少ない)] を選択した場合</h2><p>詳細は<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/fundamentals/users-default-permissions">公開情報</a>に記載の通り、ゲスト ユーザーとメンバー ユーザーでは、既定で持っているアクセス権が異なりますが、この設定に変更すると、ゲスト ユーザーは、テナントにいる「管理者ロールを持たないメンバー ユーザー」と同じアクセス権を持つようになります。</p><p>具体的には、ゲスト ユーザーはたとえば下記画面のように、[ロールと管理者]、[管理単位]、[ライセンス]、[Azure AD Connect] などの情報を確認することができます。</p><p>※[ユーザー]、[グループ] で確認できる情報については、「管理者ロールを持たないメンバー ユーザー」と同じアクセス権で確認できる情報と同じです。詳細な記載は省略しますが、ユーザー一覧・グループ一覧を確認できます。<br><img src="/blog/azure-active-directory/external-collaboration-setting-b2b-access/external-collaboration-setting-b2b-access2.png"></p><h2 id="ゲスト-ユーザーは、ディレクトリ-オブジェクトのプロパティとメンバーシップへのアクセスが制限されます-を選択した場合"><a href="#ゲスト-ユーザーは、ディレクトリ-オブジェクトのプロパティとメンバーシップへのアクセスが制限されます-を選択した場合" class="headerlink" title="[ゲスト ユーザーは、ディレクトリ オブジェクトのプロパティとメンバーシップへのアクセスが制限されます] を選択した場合"></a>[ゲスト ユーザーは、ディレクトリ オブジェクトのプロパティとメンバーシップへのアクセスが制限されます] を選択した場合</h2><p>既定の設定です。ゲスト ユーザーは、メンバー ユーザーと同じアクセス権を持たず、一部閲覧できない項目があります。</p><p>たとえば、メンバー ユーザーと異なり、[ユーザー] の画面にて、ユーザー一覧が表示されません。以下のようにメッセージが表示されます。<br><img src="/blog/azure-active-directory/external-collaboration-setting-b2b-access/external-collaboration-setting-b2b-access3.png"></p><p>ただし、任意のユーザーの ObjectID を入力することができれば、ほかのユーザーの詳細を確認することができます。<br><img src="/blog/azure-active-directory/external-collaboration-setting-b2b-access/external-collaboration-setting-b2b-access4.png"></p><p>グループにつきましては、ユーザー一覧のように検索ボックスは表示されず、以下のように “この操作を完了するのに十分な特権がありません。” とのエラー メッセージが表示されます。<br><img src="/blog/azure-active-directory/external-collaboration-setting-b2b-access/external-collaboration-setting-b2b-access5.png"></p><p>しかし、ユーザーと同様、Azure ポータル - [Azure Active Directory] - [グループ] のブレードにアクセスしたときの URL をもとに、グループの ObjectID を含む URL にアクセスすると、下記のグループ詳細画面にアクセスすることが可能です。</p><p>具体的には、以下のような URL を直接指定できれば、グループの詳細を閲覧することができます。</p><p>URL 例（GroupID/ の後ろに、グループの ObjectID を指定します。）<br><a href="https://portal.azure.com/#blade/Microsoft_AAD_IAM/GroupDetailsMenuBlade/Overview/groupId/4041df9f-a919-4e9c-b9de-9cdbb1cacc19">https://portal.azure.com/#blade/Microsoft_AAD_IAM/GroupDetailsMenuBlade/Overview/groupId/4041df9f-a919-4e9c-b9de-9cdbb1cacc19</a></p><p><img src="/blog/azure-active-directory/external-collaboration-setting-b2b-access/external-collaboration-setting-b2b-access6.png"></p><p>その他、[ロールと管理者] から、誰がどの管理者ロールを持っているか確認したり、テナントに紐づいているライセンス一覧を確認したりすることはできません。<br><img src="/blog/azure-active-directory/external-collaboration-setting-b2b-access/external-collaboration-setting-b2b-access7.png"></p><h2 id="ゲスト-ユーザーのアクセスは、各自のディレクトリ-オブジェクトのプロパティとメンバーシップに制限されます-最も制限が多い-を選択した場合"><a href="#ゲスト-ユーザーのアクセスは、各自のディレクトリ-オブジェクトのプロパティとメンバーシップに制限されます-最も制限が多い-を選択した場合" class="headerlink" title="[ゲスト ユーザーのアクセスは、各自のディレクトリ オブジェクトのプロパティとメンバーシップに制限されます (最も制限が多い)] を選択した場合"></a>[ゲスト ユーザーのアクセスは、各自のディレクトリ オブジェクトのプロパティとメンバーシップに制限されます (最も制限が多い)] を選択した場合</h2><p>ゲスト ユーザーは、自身のプロパティにアクセスすることができます。自分の名前や UPN を確認することが可能です。</p><p>しかしながら、その他のユーザーをユーザー一覧から検索したり、グループの詳細画面にアクセスしたりすることもできなくなります。（ほかのユーザーの ObjectID を入力しても検索できません。）<br><img src="/blog/azure-active-directory/external-collaboration-setting-b2b-access/external-collaboration-setting-b2b-access8.png"></p><p>ゲスト自身が、何らかのグループに所属しているかどうかは閲覧できますが、具体的にどのグループに所属しているのか、名前は表示されません。<br>（ObjectID のみ表示されますが、ObjectID をもとにグループを検索することもできません。）</p><p>下記画面でグループをクリックすると、”アクセス権がありません” の画面が表示されます。<br><img src="/blog/azure-active-directory/external-collaboration-setting-b2b-access/external-collaboration-setting-b2b-access9.png"></p><p>具体的には、上記の画面で対象グループをクリックしたり、 ObjectID を含む URL に直接アクセスしても、グループの詳細は閲覧できません。下記のようなエラーとなります。<br><img src="/blog/azure-active-directory/external-collaboration-setting-b2b-access/external-collaboration-setting-b2b-access10.png"></p><p>この設定に変更すると、ゲストがアクセスできる範囲は「ゲスト ユーザー自身に関する情報のみ」とご認識いただければと思います。</p><hr><p>今回は、ゲスト ユーザーのアクセス制限の項目を設定した時に、どのような見え方となるかをご案内させていただきました。</p><p>[外部コラボレーションの設定] のほかの項目につきましても、順次本ブログにてご案内できればと考えておりますので、その際は新しい記事も併せてご覧いただければと思います。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure ID チームの小出です。&lt;/p&gt;
&lt;p&gt;今回は、外部コラボレーションの設定で指定できる、ゲスト ユーザーのアクセス制限についてご紹介します。&lt;/p&gt;
&lt;p&gt;Azure ポータルには、招待されたゲスト ユーザーがどのような情報にアクセスできるか・でき</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="B2B" scheme="https://jpazureid.github.io/blog/tags/B2B/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD への認証が失敗する (エラー コード AADSTS1002016) 際の対処策について</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/howto-deal-with-aadsts1002016/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/howto-deal-with-aadsts1002016/</id>
    <published>2022-07-28T00:00:00.000Z</published>
    <updated>2022-10-29T08:06:47.608Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure Identity サポート チームの小出です。</p><p>現在 (2022 年 7 月現在) Azure AD の認証サービスにおける TLS 1.0 /1.1 の無効化の処理を進めています。TLS 1.0/1.1 による接続ができなくなることは、以前より Microsoft 365 のメッセージセンター、 Azure ポータルの Azure Active Directory ブレードでアナウンスをしており、 2022 年 1 月 31 日までに対策を実施するよう通知をしておりました。無効化の処理は段階的におこなわれており、 TLS1.0 /1.1 が利用されているために Azure AD の認証サービスが接続を受け付けない場合には Azure AD は AADSTS1002016 のエラーを返します。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AADSTS1002016: You are using TLS version 1.0, 1.1 and/or 3DES cipher which are deprecated to improve the security posture of Azure AD. Your TenantID is: XXXXXXXXX. Please refer to https://go.microsoft.com/fwlink/?linkid=2161187 and conduct needed actions to remediate the issue. For further questions, please contact your administrator.</span><br></pre></td></tr></table></figure><p>ここ最近、突然 Azure AD の認証ができなくなった、ただ何度かリトライすると接続できることもあるというケースでは、この措置に伴い生じている可能性があります (段階的に展開しているため、リトライで TLS 1.0 /1.1 無効化の措置が未適用のサーバーに接続した場合、エラーとならず接続できます)。</p><p>サポート窓口では特に PowerShell を利用した自動化処理で問題が発生するようになったというお問い合わせを多く受けていますが、それ以外でも発生する可能性があります。処理が複数のシステムを介して行われている場合には、AADSTS1002016 のエラーが見えないものもありますし、 PowerShell でも実行するコマンドによっては、AADSTS1002016 という情報は含まれずに、例えば Connect-MSolService では次のようなエラーが返されます。<br>  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Connect-MsolService : Authentication Error: Unexpected authentication failure.</span><br></pre></td></tr></table></figure></p><p>他には Web アプリケーションでこの措置の影響を受けて問題が発生している場合に次のようなエラーの発生が確認できています。<br>  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">IDX20803: Unable to create to obtain configuration from: &#x27;https://login.microsoftonline.com/&#123;Tenant-ID&#125;/.well-known/openid-configuration&#x27;</span><br></pre></td></tr></table></figure></p><p>PowerShell で TLS 1.2 が利用できる状態かは PowerShell を起動し、次のコマンドの実行により確認ができます。<br>  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[System.Net.ServicePointManager]::SecurityProtocol</span><br></pre></td></tr></table></figure><br>実行した結果、TLS12 が含まれている、あるいは SystemDefault となっている場合には PowerShell としては TLS 1.2 を利用できる状態と判断できます (OS でも利用できるように構成されていることが前提です)。実行結果として Ssl3, Tls のみなど TLS12 が含まれない場合には TLS 1.2 は利用されない状態のため、後述します 「PowerShell (.NET Framework) で TLS 1.2 が利用されるように設定する方法」 にしたがってレジストリ設定を実施ください。</p><p>IDX20803 が記録されているパターンなどでは問題が発生している Web アプリケーションが TLS 1.2 を利用するようになっているか確認を実施ください。</p><h2 id="技術資料"><a href="#技術資料" class="headerlink" title="技術資料"></a>技術資料</h2><p><a href="https://docs.microsoft.com/ja-jp/troubleshoot/azure/active-directory/enable-support-tls-environment?tabs=azure-monitor">Azure AD TLS 1.1 および 1.0 の非推奨の環境で TLS 1.2 のサポートを有効にする</a></p><p><a href="https://jpdsi.github.io/blog/internet-explorer-microsoft-edge/dotnet-framework-tls12/">.NET Framework で TLS 1.1 および TLS 1.2 を有効化する方法 - まとめ -</a></p><p><a href="https://docs.microsoft.com/ja-jp/dotnet/framework/migration-guide/versions-and-dependencies">.NET Framework のバージョンおよび依存関係</a></p><h2 id="対処策"><a href="#対処策" class="headerlink" title="対処策"></a>対処策</h2><p>TLS 1.2 にて通信を行われるように設定します。<br>確認ポイントとしては、以下の 2 点となります。</p><ul><li>OS が TLS 1.2 が有効 かつ 利用できる状態か</li><li>アプリ側で TLS 1.2 が有効でかつ利用できる状態か</li></ul><h3 id="OS-上の-TLS-1-2-設定を確認・変更する方法"><a href="#OS-上の-TLS-1-2-設定を確認・変更する方法" class="headerlink" title="OS 上の TLS 1.2 設定を確認・変更する方法"></a>OS 上の TLS 1.2 設定を確認・変更する方法</h3><p>現在サポートされているすべての Windows OS / Windows Server OS では、既定で TLS 1.2 が有効化されております。<br>そのため、サポート対象の Windows OS 観点では TLS 1.2 を利用できる状態です。</p><p>Windows 7 / Windows Server 2008 R2 の場合は、OS として TLS 1.2  を利用できますが有効化されていません。<br>以下のレジストリ値を設定し、 Windows OS として既定で利用できるよう設定を変更してください。</p><p>それ以降の OS ではレジストリ キーが存在していない場合も TLS 1.2 は有効化されています。DisabledByDefault = 1 または Enabled = 0 が設定されているときのみ設定変更を実施ください。</p><pre><code>キー : HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Client名前 : DisabledByDefault種類 : REG_DWORD値 : 0キー : HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Client名前 : Enabled種類 : REG_DWORD値 : 1キー : HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Server名前 : DisabledByDefault種類 : REG_DWORD値 : 0キー : HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Server名前 : Enabled種類 : REG_DWORD値 : 1</code></pre><h3 id="PowerShell-NET-Framework-で-TLS-1-2-が利用されるように設定する方法"><a href="#PowerShell-NET-Framework-で-TLS-1-2-が利用されるように設定する方法" class="headerlink" title="PowerShell (.NET Framework) で TLS 1.2 が利用されるように設定する方法"></a>PowerShell (.NET Framework) で TLS 1.2 が利用されるように設定する方法</h3><p>アプリケーションがどのようなフレーム ワークを使用して利用して作成されているかに依存しますが、主に本エラーが発生しているシナリオとして PowerShell で  Connect-AzureAD や Connect-Msolservice、 Connect-ExchangeOnline など、 Azure AD への接続コマンドを実施しているシナリオが多く見受けられます。PowerShell で TLS 1.2 を利用するためには .NET Framework で TLS 1.2 が利用されるように設定されている必要があります。</p><p>問題が生じた環境では、OS の設定に加えて、次のレジストリ設定を実施の上、再起動します。</p><pre><code>キー : HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework\v4.0.30319名前 : SchUseStrongCrypto種類 : REG_DWORD値 : 1キー : HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\.NETFramework\v4.0.30319名前 : SchUseStrongCrypto種類 : REG_DWORD値 : 1</code></pre><p>なお、 PowerShell を実行時に事前に以下のコマンドを実行すれば、明示的に TLS 1.2 を指定して接続ができますので、この方法でも構いません。<br>  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[System.Net.ServicePointManager]::SecurityProtocol = [System.Net.SecurityProtocolType]::Tls12</span><br></pre></td></tr></table></figure></p><h4 id="注意事項"><a href="#注意事項" class="headerlink" title="注意事項:"></a>注意事項:</h4><p>.NET Framework 4.6 以降であれば特にこのレジストリを設定しなくとも TLS 1.2 に対応しています。しかし、.Net Framework に依存するアプリケーション (Powershell もその 1 つです) と OS の組み合わせによっては 4.6 以降のバージョンを利用していても明示的にレジストリを設定しないと TLS 1.2 を利用してくれません。<br>具体的には Windows Server 2016 (およびそれ以前) 上で PowerShell を利用する場合には、 .Net Framework のバージョンに依らずレジストリ設定 (または PowerShell の場合事前にコマンドで明示的に TLS 1.2 を指定) が必要です。また、 ADAL ライブラリで Microsoft.IdentityModel.Clients.ActiveDirectory を利用している場合にも既定では TLS 1.0/1.1 が利用されるため、そのようなケースでもレジストリ設定を行います。 </p><h3 id="TLS-1-0-1-1-を利用した-Azure-AD-への認証要求の有無を確認する方法"><a href="#TLS-1-0-1-1-を利用した-Azure-AD-への認証要求の有無を確認する方法" class="headerlink" title="TLS 1.0/1.1 を利用した Azure AD への認証要求の有無を確認する方法"></a>TLS 1.0/1.1 を利用した Azure AD への認証要求の有無を確認する方法</h3><p>対処策の設定ををしても問題が解消しない場合には、 Azure AD への認証までの経路にあるプロキシ サーバーが TLS1.2 を利用していない、ご利用のシステムのバックエンドで TLS 1.0/1.1 を利用している可能性があります。TLS 1.0/1.1 を利用した認証要求が Azure AD に来ているかはサインインログで判断ができます。</p><ol><li>Azure portal (<a href="https://portal.azure.com/">https://portal.azure.com</a>) に全体管理者でサインインし、 [Azure Active Directory] を開きます。</li><li>[サインイン ログ] を選択します。</li><li>“ユーザーのサインイン (対話型)” を選択して、認証に失敗するアカウントのサインイン ログ エントリを選択します。</li><li>[追加の詳細情報] タブを選択します (このタブが表示されない場合は、最初に右隅の省略記号 (…) を選択して、タブの完全なリストを表示します)。</li><li>レガシ TLS (TLS 1.0, 1.1, 3DES) True という表示が含まれる場合は、TLS 1.0/1.1 を使用してサインインが行われています。 TLS 1.2 を使用している場合には何も表示されません。</li><li>同様に “ユーザーのサインイン (非対話型)” を選択して、同様に確認を実施します。PowerShell を利用して失敗しているケースでは (非対話型) のほうに “レガシ TLS (TLS 1.0, 1.1, 3DES)” で接続していることを示す情報が表示されます。</li></ol><h3 id="テナントでこの影響を受けて認証に失敗しているか確認する方法"><a href="#テナントでこの影響を受けて認証に失敗しているか確認する方法" class="headerlink" title="テナントでこの影響を受けて認証に失敗しているか確認する方法"></a>テナントでこの影響を受けて認証に失敗しているか確認する方法</h3><p>本影響を受けてサインインに失敗した場合、 Azure AD のサインイン ログにサインインのエラーコードとして 1002016 を含む失敗のエントリが記録されます。<br>サインイン ログを csv 形式でダウンロードし、サインインのエラーコードとして 1002016 が含まれているか確認することで TLS 1.0/1.1 無効化の影響を受け認証失敗しているか確認できます。</p><ol><li>Azure portal (<a href="https://portal.azure.com/">https://portal.azure.com</a>) に全体管理者でサインインし、 [Azure Active Directory] を開きます。</li><li>[サインイン ログ] を選択します。</li><li>フィルタとして “許可された時刻:過去 24 時間” が既定で設定されていますので適宜 “過去 7 日間” などに変更します。</li><li>[ダウンロード] - “CSV のダウンロード” をクリックします。</li><li>InteractiveSignIns_20xx-xx-xx_20xx-xx-xx、NonInteractiveSignIns_20xx-xx-xx_20xx-xx-xx、ApplicationSignIns_20xx-xx-xx_20xx-xx-xx、MSISignIns_20xx-xx-xx_20xx-xx-xx の 4 つをそれぞれダウンロードします。</li><li>ダウンロードした CSV ファイルを開き、”サインインのエラー コード” として 1002016 が含まれていないか確認します。</li></ol><h3 id="テナントでこの影響を受けて認証に失敗しているか確認する方法-PowerShell-を利用してサインインログを抽出"><a href="#テナントでこの影響を受けて認証に失敗しているか確認する方法-PowerShell-を利用してサインインログを抽出" class="headerlink" title="テナントでこの影響を受けて認証に失敗しているか確認する方法 (PowerShell を利用してサインインログを抽出)"></a>テナントでこの影響を受けて認証に失敗しているか確認する方法 (PowerShell を利用してサインインログを抽出)</h3><p>Azure AD Premium をテナントで利用されていることが前提ですが、 PowerShell コマンドを利用して TLS 1.0/1.1 が利用されたことを示すエントリのみをフィルタして CSV 形式でダウンロードするスクリプトを紹介します。</p><ol><li><p>[管理者として実行] オプションを使用して、[スタート] メニューから Windows PowerShell を開きます。</p></li><li><p>次のコマンドを実行して、Microsoft Graph SDK をインストールし、実行ポリシーを設定します。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Install-Module Microsoft.Graph -Scope AllUsers</span><br><span class="line">Set-ExecutionPolicy -ExecutionPolicy Unrestricted -Scope CurrentUser</span><br></pre></td></tr></table></figure></li><li><p>次のスクリプトを PowerShell スクリプト (.ps1) ファイルに保存します。最初の 3 行は、取得対象テナントのテナント ID、何日分のログを取得するかの日数 (例では 7 日になっています)、出力先のフォルダ名 (例では c:\temp) を環境に合わせて編集します。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$tId = &quot;テナント ID&quot;  # テナント ID を入れてください。テナント ID は Azure ポータルの Azure Active Directory の概要から取得できます。 </span><br><span class="line">$agoDays = 7  # 何日前からのログを取得するか日数を指定します。</span><br><span class="line">$pathForExport = &quot;c:\temp\&quot;  # CSV ファイルの出力先フォルダ名を入力します。</span><br><span class="line">$startDate = (Get-Date).AddDays(-($agoDays)).ToString(&#x27;yyyy-MM-dd&#x27;)  # $agoDays で指定した日数を元に取得対象の開始日を得ます</span><br><span class="line"></span><br><span class="line">Connect-MgGraph -Scopes &quot;AuditLog.Read.All&quot; -TenantId $tId </span><br><span class="line">Select-MgProfile &quot;beta&quot;  # ベータのエンドポイントへの接続が必要です</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$procDetailFunction = &quot;x: x/key eq &#x27;legacy tls (tls 1.0, 1.1, 3des)&#x27; and x/value eq &#x27;1&#x27;&quot;</span><br><span class="line">$clauses = (</span><br><span class="line">    &quot;createdDateTime ge $startDate&quot;,</span><br><span class="line">    &quot;signInEventTypes/any(t: t eq &#x27;nonInteractiveUser&#x27;)&quot;,</span><br><span class="line">    &quot;signInEventTypes/any(t: t eq &#x27;servicePrincipal&#x27;)&quot;,</span><br><span class="line">    &quot;(authenticationProcessingDetails/any($procDetailFunction))&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"># フィルタ条件に従って対話型、非対話型、 ServicePrincipal のそれぞれのログを取得します。</span><br><span class="line">$signInsInteractive = Get-MgAuditLogSignIn -Filter ($clauses[0,3] -Join &quot; and &quot;) -All</span><br><span class="line">$signInsNonInteractive = Get-MgAuditLogSignIn -Filter ($clauses[0,1,3] -Join &quot; and &quot;) -All</span><br><span class="line">$signInsWorkloadIdentities = Get-MgAuditLogSignIn -Filter ($clauses[0,2,3] -Join &quot; and &quot;) -All</span><br><span class="line"></span><br><span class="line">$columnList = @&#123;  # 対話型、非対話型の出力ファイルに含むカラムを定義しています</span><br><span class="line">    Property = &quot;CorrelationId&quot;, &quot;createdDateTime&quot;, &quot;userPrincipalName&quot;, &quot;userId&quot;,</span><br><span class="line">              &quot;UserDisplayName&quot;, &quot;AppDisplayName&quot;, &quot;AppId&quot;, &quot;IPAddress&quot;, &quot;isInteractive&quot;,</span><br><span class="line">              &quot;ResourceDisplayName&quot;, &quot;ResourceId&quot;, &quot;UserAgent&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$columnListWorkloadId = @&#123; # Service Principal の出力ファイルに含むカラムを定義しています</span><br><span class="line">    Property = &quot;CorrelationId&quot;, &quot;createdDateTime&quot;, &quot;AppDisplayName&quot;, &quot;AppId&quot;, &quot;IPAddress&quot;,</span><br><span class="line">              &quot;ResourceDisplayName&quot;, &quot;ResourceId&quot;, &quot;ServicePrincipalId&quot;, &quot;ServicePrincipalName&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$signInsInteractive | ForEach-Object &#123;</span><br><span class="line">    foreach ($authDetail in $_.AuthenticationProcessingDetails)</span><br><span class="line">    &#123;</span><br><span class="line">        if (($authDetail.Key -match &quot;Legacy TLS&quot;) -and ($authDetail.Value -eq &quot;True&quot;))</span><br><span class="line">        &#123;</span><br><span class="line">            $_ | Select-Object @columnList -ExpandProperty Status</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; | Export-Csv -Path ($pathForExport + &quot;Interactive_lowTls_$tId.csv&quot;) -NoTypeInformation</span><br><span class="line"></span><br><span class="line">$signInsNonInteractive | ForEach-Object &#123;</span><br><span class="line">    foreach ($authDetail in $_.AuthenticationProcessingDetails)</span><br><span class="line">    &#123;</span><br><span class="line">        if (($authDetail.Key -match &quot;Legacy TLS&quot;) -and ($authDetail.Value -eq &quot;True&quot;))</span><br><span class="line">        &#123;</span><br><span class="line">            $_ | Select-Object @columnList -ExpandProperty Status</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; | Export-Csv -Path ($pathForExport + &quot;NonInteractive_lowTls_$tId.csv&quot;) -NoTypeInformation</span><br><span class="line"></span><br><span class="line">$signInsWorkloadIdentities | ForEach-Object &#123;</span><br><span class="line">    foreach ($authDetail in $_.AuthenticationProcessingDetails)</span><br><span class="line">    &#123;</span><br><span class="line">        if (($authDetail.Key -match &quot;Legacy TLS&quot;) -and ($authDetail.Value -eq &quot;True&quot;))</span><br><span class="line">        &#123;</span><br><span class="line">            $_ | Select-Object @columnListWorkloadId -ExpandProperty Status</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; | Export-Csv -Path ($pathForExport + &quot;WorkloadIdentities_lowTls_$tId.csv&quot;) -NoTypeInformation</span><br></pre></td></tr></table></figure></li><li><p>スクリプトを保存して実行します。 スクリプトの実行時にメッセージが表示されたら、グローバル管理者としてサインインします。 次に、Microsoft Graph に監査ログ情報を読み取らせることに同意します。</p></li><li><p>指定したフォルダに Interactive_lowTls_&lt;テナント ID&gt;.csv、 NonInteractive_lowTls_&lt;テナント ID&gt;.csv、WorkloadIdentities_lowTls_&lt;テナント ID&gt;.csv の 3 ファイルが作成されます。このファイルには TLS 1.0/1.1 を利用したサインイン エントリのみが含まれます。認証が失敗した場合には ErrorCode のカラムに 1002016 が含まれますので、本問題が該当のテナントでいつから生じているかも確認が可能です。</p></li></ol><h3 id="TLS-1-0-を利用した-Azure-AD-への認証を試みる方法"><a href="#TLS-1-0-を利用した-Azure-AD-への認証を試みる方法" class="headerlink" title="TLS 1.0 を利用した Azure AD への認証を試みる方法"></a>TLS 1.0 を利用した Azure AD への認証を試みる方法</h3><p>TLS 1.0/1.1 の無効化は段階的に進められています。接続先のデータセンターによって事象が発生の有無が変わります (そのため事象が突然発生したり、発生しなくなったりもします)。すでに Azure AD PowerShell がインストールされている前提で、 TLS 1.0 での接続を試したい場合には、次のような方法で明示的に TLS 1.0 を利用した接続テストを行うことができます (TLS 1.0 を利用すること自体は推奨されません)。</p><ol><li>PowerShell を起動します。</li><li>次のコマンドを実行します。<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[System.Net.ServicePointManager]::SecurityProtocol = [System.Net.SecurityProtocolType]::Tls</span><br></pre></td></tr></table></figure></li><li>connect-azuread を実行して表示されるポップアップでユーザー名、パスワードを入力します。</li><li>TLS 1.0/1.1 が利用されているために接続できない場合にはエラー画面が表示され、そこにはエラーコード AADSTS1002016 が含まれます。 </li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure Identity サポート チームの小出です。&lt;/p&gt;
&lt;p&gt;現在 (2022 年 7 月現在) Azure AD の認証サービスにおける TLS 1.0 /1.1 の無効化の処理を進めています。TLS 1.0/1.1 による接続ができなくなること</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="PowerShell" scheme="https://jpazureid.github.io/blog/tags/PowerShell/"/>
    
    <category term="TLS 1.2" scheme="https://jpazureid.github.io/blog/tags/TLS-1-2/"/>
    
  </entry>
  
  <entry>
    <title>オンプレミス AD でクラウド上のグループを使用するグループ ライトバック機能のご紹介</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/use-cloud-groups-in-on-premises-active-directory-with-group/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/use-cloud-groups-in-on-premises-active-directory-with-group/</id>
    <published>2022-07-27T01:00:00.000Z</published>
    <updated>2022-10-29T08:06:47.840Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 村上 です。</p><p>本記事は、2022 年 7 月 6 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/use-cloud-groups-in-on-premises-active-directory-with-group/ba-p/3118023">Use cloud groups in on-premises Active Directory with group writeback</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>グループ ライトバックの大幅な機能強化がパブリック プレビューで発表でき、とても嬉しく思っています。Azure AD Connect を使用して、セキュリティ グループを含むクラウド グループをオンプレミスの Active Directory に書き戻すことができます。このプレビューにより、クラウドで管理されているグループを使用して、オンプレミスのリソースへのアクセスを管理することができます。</p><p>現在、M365 のグループをユニバーサル配布グループとして、オンプレミスの Active Directory に書き戻すことが可能です。今回のパブリック プレビューでは、ライトバックできるグループを拡大するとともに、MS Graph と Azure 管理ポータルでライトバック対象のグループを管理する機能を追加し、Azure AD Connect でオンプレミスのグループを見つけやすくする機能を追加しています。</p><h2 id="M365-グループの機能強化"><a href="#M365-グループの機能強化" class="headerlink" title="M365 グループの機能強化"></a>M365 グループの機能強化</h2><ul><li>PowerShell、MS Graph、または Azure 管理ポータルを使用して、M365 グループをユニバーサル配布グループ、セキュリティ グループ、メールが有効なセキュリティ グループのいずれかとして、オンプレミスの Active Directory に書き戻すことができるようになりました。</li><li>MS Graph を使用して、新しく作成された M365 グループを自動的に書き戻す設定をテナント全体で行うことができます。</li></ul><h2 id="グループ-ライトバックの新機能"><a href="#グループ-ライトバックの新機能" class="headerlink" title="グループ ライトバックの新機能"></a>グループ ライトバックの新機能</h2><ul><li>PowerShell、MS Graph、Microsoft Entra の管理センターを使って、Azure AD のセキュリティ グループをユニバーサル セキュリティ グループとしてオンプレミスの Active Directory に書き戻す設定もできるようになりました。</li><li>Azure AD Connect でグループのライトバックを設定する際、オンプレミスの識別名のコモン ネームをクラウド グループの表示名に置き換えるオプションがあり、Azure AD からライトバックされるグループの識別が容易になりました。</li><li>Active Directory に書き戻すグループは、MS Graph Explorer や Microsoft Entra の管理センターを使って管理することができます。</li></ul><p><img src="/blog/azure-active-directory/use-cloud-groups-in-on-premises-active-directory-with-group/image01.jpg"></p><p><img src="/blog/azure-active-directory/use-cloud-groups-in-on-premises-active-directory-with-group/image02.jpg"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 村上 です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 7 月 6 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcom</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>CSP プログラムにおけるパートナーセンターから顧客テナントにアクセスする際の条件付きアクセス ポリシーについて</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/capolicy-for-csp-account/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/capolicy-for-csp-account/</id>
    <published>2022-07-24T15:00:00.000Z</published>
    <updated>2022-10-29T08:06:47.440Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure &amp; Identity サポート チームの栗井です。<br>本記事では、クラウド ソリューション プロバイダー プログラム パートナー (以下 CSP パートナー) 様から多くいただくご相談について、情報をおまとめいたしました。</p><h2 id="よくある事例-パートナー-センターから顧客のテナントにアクセスすることができません。"><a href="#よくある事例-パートナー-センターから顧客のテナントにアクセスすることができません。" class="headerlink" title="よくある事例 : パートナー センターから顧客のテナントにアクセスすることができません。"></a>よくある事例 : パートナー センターから顧客のテナントにアクセスすることができません。</h2><p>CSP パートナー テナントに所属するアカウントは、代理管理者権限を持つ場合、パートナー センター (<a href="https://partner.microsoft.com/">https://partner.microsoft.com</a>) 経由で、リセラー関係を結ぶ顧客のテナントに対しての特権アクセス (グローバル管理者相当) が可能です。</p><div class="alert is-info"><p class="alert-title">Note</p><p>本記事内では、顧客テナントに対して代理管理者権限を持つ、CSP パートナー テナントのアカウントを、「CSP アカウント」と記載します。</p></div><p>さて、この「CSP アカウントによる顧客テナントへのアクセス」について、CSP パートナーの方から、下記のようなご相談をよく受けます。</p><ul><li>お問い合わせ内容 : ある時を境に、パートナーセンターを経由した顧客テナントへのアクセスが、下記画面によって、ブロックされるようになった。この事象は特定の顧客 (1 社) のみで発生しており、他の顧客テナントへのアクセスは問題なく可能です。<br><img src="/blog/azure-active-directory/capolicy-for-csp-account/blocked.png">  </li></ul><p>上記の画面は、<strong>条件付きアクセス ポリシー</strong>と呼ばれる Azure AD の機能によって、アクセスがブロックされたことを示します。</p><p>※ 条件付きアクセスは、多くのお客様にご利用いただいているセキュリティ機能です。機能の詳細については、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/overview">Azure Active Directory の条件付きアクセスとは - Microsoft Entra</a> をご参照ください。</p><p>顧客のほとんどは、自分のテナントで条件付きアクセス ポリシーを構成する際に、CSP アカウントによるアクセスへの影響を意識しません。そのため、作成したポリシーによって、意図せずに CSP アカウントによるアクセスをブロックしてしまう場合があります。</p><p>CSP アカウントに対してのポリシー適用は、通常のユーザーを制御する場合とは仕組みが異なります。留意点ならびに回避策について、本記事でご紹介します。</p><h2 id="CSP-アカウントに条件付きアクセス-ポリシーが適用される場合"><a href="#CSP-アカウントに条件付きアクセス-ポリシーが適用される場合" class="headerlink" title="CSP アカウントに条件付きアクセス ポリシーが適用される場合"></a>CSP アカウントに条件付きアクセス ポリシーが適用される場合</h2><p>顧客のテナント上で、条件付きアクセス ポリシーのユーザー 割り当て設定を開き、CSP アカウントを検索しても、結果には表示されません。なぜなら、<strong>CSP アカウントは、顧客のテナント上にユーザー オブジェクトが存在しない、特殊なアカウント</strong>であるためです。</p><p><img src="/blog/azure-active-directory/capolicy-for-csp-account/notfound.png">  </p><p>それではどのような設定をすると、CSP アカウントによるアクセスにポリシーが適用されるのか？それは、<strong>割り当て対象に “すべてのユーザー” もしくは “すべてのゲストと外部ユーザー” のいずれかを選択した場合</strong>です。</p><ul><li>“すべてのユーザー” を選択 : すべてのユーザーのサインインに対して、一律にポリシーの制御が適用されるため、CSP アカウントによるアクセスも制御対象となります。</li><li>“すべてのゲストと外部ユーザー” を選択 : Azure AD B2B で招待されたゲスト ユーザーに加え、 CSP アカウントによるアクセスが制御対象となります。</li></ul><p>上記の動作となるため、下記内容のお問い合わせを、CSP パートナーの方からいただきます。</p><h3 id="【よくある事例-CSP-アカウントがブロックされてしまう】"><a href="#【よくある事例-CSP-アカウントがブロックされてしまう】" class="headerlink" title="【よくある事例 : CSP アカウントがブロックされてしまう】"></a>【よくある事例 : CSP アカウントがブロックされてしまう】</h3><ul><li>お問い合わせ内容 (再掲) : ある時を境に、パートナーセンターを経由した顧客テナントへのアクセスが、ブロックされるようになった。この事象は特定の顧客 (1 社) のみで発生しており、他の顧客テナントへのアクセスは問題なく可能です。</li><li>原因 : 顧客のテナントで、下記のポリシーが有効化されたこと (ポリシー内容の一部が異なる場合にも発生する可能性があります)。<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">[名前] : &quot;社内 IP のみアクセス許可&quot;</span><br><span class="line"></span><br><span class="line">[割り当て] </span><br><span class="line"></span><br><span class="line">  [ユーザーとグループ] : すべてのユーザー</span><br><span class="line"></span><br><span class="line">  [クラウド アプリまたは操作] : すべてのクラウド アプリ</span><br><span class="line"></span><br><span class="line">[条件] </span><br><span class="line"></span><br><span class="line">  [場所] : すべての場所 (対象外 : 社内ネットワークのグローバル IP アドレス)</span><br><span class="line"></span><br><span class="line">[アクセス制御] </span><br><span class="line"></span><br><span class="line">  [許可] : アクセスのブロック</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h2 id="CSP-アカウントへの条件付きアクセス-ポリシーの適用を回避する方法"><a href="#CSP-アカウントへの条件付きアクセス-ポリシーの適用を回避する方法" class="headerlink" title="CSP アカウントへの条件付きアクセス ポリシーの適用を回避する方法"></a>CSP アカウントへの条件付きアクセス ポリシーの適用を回避する方法</h2><h3 id="前提-ユーザーとグループ-gt-対象外-の項目で-CSP-アカウントを指定して回避することはできません"><a href="#前提-ユーザーとグループ-gt-対象外-の項目で-CSP-アカウントを指定して回避することはできません" class="headerlink" title="前提 : [ユーザーとグループ] &gt; [対象外] の項目で CSP アカウントを指定して回避することはできません"></a>前提 : [ユーザーとグループ] &gt; [対象外] の項目で CSP アカウントを指定して回避することはできません</h3><p>条件付きアクセス ポリシーでは、割り当て対象ユーザーの設定画面において [対象外] の項目があります。通常であれば、特定のユーザーをポリシーの割り当て対象から除外したい場合は、[対象外] の項目で該当のユーザーを指定する方法が適切です。</p><p>しかし、CSP アカウントの場合は、この方法を利用できません。前述の通り、CSP アカウントは顧客のテナント上にユーザー オブジェクトが存在しない、特別なアカウントです。 そのため、[対象外] の項目で選択することができません。</p><p>したがって、割り当て対象ユーザーの設定では、CSP アカウントを明示的にポリシーの適用対象外に指定することはできません。以下で 3 通りの回避策を紹介します。</p><ol><li>CSP アカウントのアクセス元 IP アドレスを、ポリシーの割り当て対象外に指定</li><li>“ディレクトリ ロール : グローバル管理者” を、ポリシーの割り当て対象外に指定</li><li>“すべてのユーザー” または “すべてのゲストと外部ユーザー” を利用しない</li></ol><div class="alert is-info"><p class="alert-title">Note</p><p>いずれの回避策も、顧客テナント上で設定されている条件付きアクセス ポリシーの設定を変更します。そのため、操作は顧客テナントの Azure ポータル上で実施ください。</p></div><h3 id="回避策-1-CSP-アカウントのアクセス元-IP-アドレスを、ポリシーの割り当て対象外に指定"><a href="#回避策-1-CSP-アカウントのアクセス元-IP-アドレスを、ポリシーの割り当て対象外に指定" class="headerlink" title="回避策 1 : CSP アカウントのアクセス元 IP アドレスを、ポリシーの割り当て対象外に指定"></a>回避策 1 : CSP アカウントのアクセス元 IP アドレスを、ポリシーの割り当て対象外に指定</h3><p>CSP アカウントによるアクセス元 IP アドレスが特定のアドレス (範囲) になることが判明している場合に採用できます。アクセス元の IP アドレスを、ポリシーの適用対象外に指定ください。</p><ul><li><p><strong>【手順 1 : CSP アカウントによるアクセス元 IP を、ネームドロケーションに登録】</strong></p><ol><li><p>Azure ポータル &gt; Azure Active Directory &gt; セキュリティ &gt; 条件付きアクセス &gt; [ネームドロケーション] に進みます。</p></li><li><p>[+ 新しい場所] を選択して、下記のネームド ロケーションを登録します。</p><p> [名前] : 任意 (例 : CSP 接続ポイント)</p><p> [次を使用して場所を定義します] : IP 範囲</p><p> [IP 範囲] : &lt;CSP アカウントの事業所のグローバル IP アドレス範囲&gt;</p></li><li><p>[作成] を選択し、ネームド ロケーションを保存します。下記の【手順 2】に進みます。</p></li></ol></li><li><p><strong>【手順 2 : 登録したネームド ロケーションを、ポリシーの対象外に指定】</strong></p><ol start="4"><li>該当の条件付きアクセス ポリシーの設定画面を開きます。</li><li>[条件] &gt; [場所] に進み、[構成] を “はい” にします。</li><li>“対象” の構成で “すべての場所” を選択します。</li><li>“対象外” の構成で “選択された場所” を選択し、手順 2 で登録したネームド ロケーションを指定します。</li><li>ポリシーの変更を保存します。</li></ol></li></ul><p>上記の通り、ポリシーを変更することで、CSP アカウントが [IP 範囲] で指定したネットワーク ロケーションからアクセスする際には、ポリシーによる制御は行われなくなります。</p><h3 id="回避策-2-“ディレクトリ-ロール-グローバル管理者”-を、ポリシーの割り当て対象外に指定"><a href="#回避策-2-“ディレクトリ-ロール-グローバル管理者”-を、ポリシーの割り当て対象外に指定" class="headerlink" title="回避策 2 : “ディレクトリ ロール : グローバル管理者” を、ポリシーの割り当て対象外に指定"></a>回避策 2 : “ディレクトリ ロール : グローバル管理者” を、ポリシーの割り当て対象外に指定</h3><p>条件付きアクセス ポリシーの割り当て設定では、特定の Azure AD ロールを持つユーザーを、ポリシーの割り当て対象外に指定可能です。</p><p>グローバル管理者のロールを、ポリシーの割り当て対象外に指定することで、顧客テナント上でグローバル管理者ロールを持つアカウント、ならびに CSP アカウントに対しては、ポリシーが適用されなくなります。必要に応じて、このポリシーとは別にグローバル管理者ロールを持つアカウントを個別に対象とするポリシーを追加ください。</p><ul><li>設定箇所 : 割り当て &gt; ユーザーまたはワークロード ID &gt; 対象外“ディレクトリ ロール” にチェックを入れ、一覧から “グローバル管理者” を選択。</li></ul><h3 id="回避策-3-“すべてのユーザー”-または-“すべてのゲストと外部ユーザー”-を利用しない"><a href="#回避策-3-“すべてのユーザー”-または-“すべてのゲストと外部ユーザー”-を利用しない" class="headerlink" title="回避策 3 : “すべてのユーザー” または “すべてのゲストと外部ユーザー” を利用しない"></a>回避策 3 : “すべてのユーザー” または “すべてのゲストと外部ユーザー” を利用しない</h3><p>前述の通り、”すべてのユーザー” “すべてのゲストと外部ユーザー” を割り当て対象とするポリシーは、CSP アカウントによるアクセスに対しても一律に適用されます。</p><p>これらの割り当てオプションを利用せずに、<strong>ポリシーを適用するユーザーを個別に指定</strong>することで、CSP アカウントに対してのポリシー適用を回避が可能です。</p><p>「ポリシーを適用するユーザーを個別に指定」とは、[対象]  &gt; [ユーザーとグループ]  の項目において、ポリシー適用対象ユーザー (もしくはユーザー グループ) を、1 個ずつ指定する方法です。</p><p><img src="/blog/azure-active-directory/capolicy-for-csp-account/selectusers.png"> </p><p>しかし、テナント上に 1000 人単位のユーザーが登録されているような大規模な組織では、ユーザー アカウントを 1 個ずつ選択するという操作は、現実的ではないかもしれません。</p><p>このような場合は、次の項目でご紹介する “動的グループ” の機能によるユーザーグループの作成をご利用が便利です。</p><h3 id="動的グループを利用したユーザーグループの作成方法"><a href="#動的グループを利用したユーザーグループの作成方法" class="headerlink" title="動的グループを利用したユーザーグループの作成方法"></a>動的グループを利用したユーザーグループの作成方法</h3><p>“動的グループ” とは、ユーザーのプロパティ (属性値) に基づくルールを記述することで、ユーザー グループに自動でユーザーを追加する機能です。</p><p>動的グループの機能の詳細については、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/enterprise-users/groups-create-rule">Azure Active Directory で動的グループを作成または更新する | Microsoft Docs</a> をご覧ください。 </p><p>以下では、条件付きアクセス ポリシーにおける “すべてのユーザー” ならびに “すべてのゲストと外部ユーザー” の代わりとしてご利用可能な、動的グループ メンバーシップルールをご紹介します。いずれのグループも、CSP アカウントは含まれません。</p><ul><li><p>「すべてのユーザー (除外 : CSP アカウント)」 に該当する、動的メンバーシップ ルール<br><img src="/blog/azure-active-directory/capolicy-for-csp-account/allusers.png">  </p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(user.objectId -ne null)</span><br></pre></td></tr></table></figure></li><li><p>「すべてのゲストと外部ユーザー (除外 : CSP アカウント)」 に該当する、動的メンバーシップ ルール<br><img src="/blog/azure-active-directory/capolicy-for-csp-account/allguestusers.png"> </p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(user.objectId -ne null) and (user.userType -eq &quot;Guest&quot;)</span><br></pre></td></tr></table></figure></li></ul><p>上記 2 つのルールはいずれも「オブジェクト ID が null ではない」という条件を含みます。従って、ユーザー オブジェクト自体が存在しない CSP アカウントは、その条件を満たさず、グループのメンバーには含まれません。</p><p>上記の手順で作成したユーザー グループは、条件付きアクセス ポリシーの [ユーザーとグループの選択] において選択することができます。</p><h2 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h2><ul><li><p><strong><span style="color:blue">Q </span>.</strong> [対象外] に “すべてのゲストと外部ユーザー” を指定することで、CSP アカウントへのポリシー適用を回避できますか？</p><p><strong><span style="color:red">A </span>.</strong>  はい、回避可能です。</p></li><li><p><strong><span style="color:blue">Q </span>.</strong> “すべてのユーザー” に対して多要素認証 (MFA) を要求するポリシーを作成した場合、CSP アカウントは MFA 要求を満たすことができますか ? それともアクセスが失敗しますか ?</p><p><strong><span style="color:red">A </span>.</strong>  CSP アカウントは MFA 要求を満たすことができます。そのため、MFA を要求するポリシーを CSP アカウントに対して適用しても、CSP アカウントのアクセスがブロックされることはありません。</p></li><li><p><strong><span style="color:blue">Q </span>.</strong> “すべてのユーザー” に対して、アクセス許可条件として “準拠済みデバイス” “Hybrid Azure AD Join 済みデバイス” を要求するポリシーを作成した場合、CSP アカウントはこの条件を満たすことができますか？</p><p><img src="/blog/azure-active-directory/capolicy-for-csp-account/compliant-or-haadj.png">  </p><p><strong><span style="color:red">A </span>.</strong>  いいえ。”準拠済みデバイス” “Hybrid Azure AD Join 済みデバイス” の条件は、テナントに直接所属するユーザーのみが満たすことができる条件です。ゲストユーザーならびに外部ユーザー (CSP アカウント含む) に対してこの条件が適用された場合は、下記画面によって、アクセスがブロックされます。</p><p><img src="/blog/azure-active-directory/capolicy-for-csp-account/notcompliant.png">  </p></li><li><p><strong><span style="color:blue">Q </span>.</strong> CSP アカウントによる顧客テナントへのアクセスは、顧客テナントのサインイン ログに記録されますか ?</p><p><strong><span style="color:red">A </span>.</strong>  はい、記録されます。</p><p>CSP アカウントによるアクセスは、通常のテナント ユーザーと同様に、Azure ポータル &gt; Azure Active Directory &gt; サインイン ログ から確認可能です。</p><p>CSP アカウントによるアクセスをフィルターする場合、[+ フィルターの追加] から “クロス テナントの種類 : サービス プロバイダー” を指定ください。</p><p>各行を選択すると、サインイン ログの詳細が表示されます。[条件付きアクセス] タブから、適用されたポリシーと制御内容を確認できるので、トラブルシューティングの際にご活用ください。</p><ul><li>ユーザー名は “[パートナーテナント名] technician” という文字列が表示されます。</li><li>CSP アカウントによるアクセス元の IP アドレスは、下 3 桁がマスクされます。</li></ul></li></ul><p>上記内容が少しでも皆様の参考となりますと幸いです。ご不明な点がございましたら、弊社サポートまでお気軽にお問い合わせください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure &amp;amp; Identity サポート チームの栗井です。&lt;br&gt;本記事では、クラウド ソリューション プロバイダー プログラム パートナー (以下 CSP パートナー) 様から多くいただくご相談について、情報をおまとめいたしました。&lt;/p&gt;
&lt;h2</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Conditional Access" scheme="https://jpazureid.github.io/blog/tags/Conditional-Access/"/>
    
    <category term="条件付きアクセス" scheme="https://jpazureid.github.io/blog/tags/%E6%9D%A1%E4%BB%B6%E4%BB%98%E3%81%8D%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Entra Permissions Management が GA しました！</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/microsoft-entra-permissions-management-is-now-generally/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/microsoft-entra-permissions-management-is-now-generally/</id>
    <published>2022-07-24T01:00:00.000Z</published>
    <updated>2022-10-29T08:06:47.692Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 高田 です。</p><p>本記事は、2022 年 7 月 7 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/microsoft-entra-permissions-management-is-now-generally/ba-p/3290630">Microsoft Entra Permissions Management is now generally available!</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>当社は、企業のマルチクラウド戦略を支援するというミッションの一環として、<a href="https://blogs.microsoft.com/blog/2021/07/21/microsoft-acquires-cloudknox-security-to-offer-unified-privileged-access-and-cloud-entitlement-management/">昨年夏、Cloud Infrastructure Entitlement Management (CIEM) 分野のリーダーである CloudKnox Security 社を買収</a> しました。また、<a href="https://jpazureid.github.io/blog/azure-active-directory/cloudknox-permissions-management-is-now-in-public-preview/">2 月にはこのソリューションのパブリック プレビューを開始</a> しました。それ以来、GDPR 対応、ローカライゼーション、自動でのオンボーディングなどの機能拡張を行い、GA に向けて準備を進めてきました。  </p><p>本日、<a href="https://www.microsoft.com/security/blog/2022/05/31/secure-access-for-a-connected-worldmeet-microsoft-entra/">Microsoft Entra のポートフォリオ</a> の一部として、<a href="https://aka.ms/PermissionsManagement">Microsoft Entra Permissions Management</a> (旧 CloudKnox) の一般提供 (GA) を発表できることを嬉しく思います。Permissions Management は、スタンドアロンのソリューションとして、1 リソースあたり年間 125 ドルで本日より提供されます。対応するリソースは、Amazon Web Services、Microsoft Azure、Google Cloud Platform のコンピュート リソース、コンテナ クラスター、サーバーレス機能、およびデータベースです。それでは、製品の特長とアップデートの一部をご紹介します。</p><p><a href="https://www.microsoft.com/en-us/videoplayer/embed/RE50qYJ">Microsoft Entra Permissions Management の紹介動画</a></p><h2 id="1-つの統一プラットフォームであらゆるクラウドに存在するあらゆる-ID-のアクセス許可を管理"><a href="#1-つの統一プラットフォームであらゆるクラウドに存在するあらゆる-ID-のアクセス許可を管理" class="headerlink" title="1 つの統一プラットフォームであらゆるクラウドに存在するあらゆる ID のアクセス許可を管理"></a>1 つの統一プラットフォームであらゆるクラウドに存在するあらゆる ID のアクセス許可を管理</h2><p>Microsoft Entra Permissions Management は、マルチクラウド環境におけるすべての ID (人とワークロードの両方) とリソースのアクセス許可を検出、修復、監視します。アクセス許可の使用状況を継続的に監視し、履歴データを使用してクラウドの規模で最小特権の原則を適用することで、生産性を妨げることなくセキュリティ体制を強化することができます。</p><ul><li><strong>発見する</strong>: すべての ID がすべてのリソースで実行したすべてのアクションを詳細に可視化し、許可されたアクセス権と使用されたアクセス権を監視して、アクセス許可に関するリスクを評価します。</li><li><strong>修正する</strong>: 実際の使用状況に基づいて最小特権の原則を適用し、追加許可が必要な場合はアクセス許可をその時のみ付与するオンデマンドのワークフローを活用して、アクセス許可のギャップ (付与されているアクセス許可と実際に必要なアクセス許可の差) を解消します。</li><li><strong>監視する</strong>: すべてのアクティビティを継続的に監視し、異常なアクセス許可の使用を検出し、詳細なフォレンジック レポートを作成して、迅速な調査と修正をサポートします。</li></ul><p><img src="/blog/azure-active-directory/microsoft-entra-permissions-management-is-now-generally/Entra-Onboarding-GIF-v2A2.gif"></p><h2 id="オンボーディングと監視機能の機能強化"><a href="#オンボーディングと監視機能の機能強化" class="headerlink" title="オンボーディングと監視機能の機能強化"></a>オンボーディングと監視機能の機能強化</h2><p>GA リリースの一環として、AWS、Azure、GCP 環境を Permissions Management に取り込むための、新しい自動化されたアプローチを導入しています。シンプルなワークフローにより、数回クリックするだけで、クラウド全体のアクセス許可のデータを効率的に収集することができます。</p><p>Microsoft のポートフォリオとの統合を進めるため、ユーザーは Permission Creep Index を監視し、<a href="https://azure.microsoft.com/en-us/services/defender-for-cloud/">Defender for Cloud のダッシュボード</a> から直接 Permissions Management にアクセスすることも可能になりました。これにより、Defender for Cloud の保護を CIEM でさらに広げることができるようになりました。</p><p>これはまだ始まりに過ぎません。弊社では積極的に統合と機能を拡大しており、今年後半にそれらの展開を開始する予定です。GA リリースの詳細については、Permissions Management の <a href="https://aka.ms/CIEM">ドキュメント</a> をご覧ください。</p><h2 id="Microsoft-Entra-Permissions-Management-を今すぐお試しください"><a href="#Microsoft-Entra-Permissions-Management-を今すぐお試しください" class="headerlink" title="Microsoft Entra Permissions Management を今すぐお試しください"></a>Microsoft Entra Permissions Management を今すぐお試しください</h2><p>Microsoft Entra Permissions Management の 90 日間無料トライアルを提供しています。これにより、包括的なリスク評価を実施し、マルチクラウド基盤全体でアクセス許可のリスクを特定することが可能となります。</p><p>オンボーディングから数時間以内に、Permissions Management が包括的な Permissions Analytics Report を生成し、お客様の組織の最大のリスク領域を特定し、環境を改善および保護するための具体的なアドバイスを提供します。無料のリスク アセスメントは、<a href="https://aka.ms/TryPermissionsManagement">aka.ms/TryPermissionsManagement</a> からご用命ください。</p><p>Microsoft Entra Permissions Management の詳細については、<a href="https://aka.ms/PermissionsManagement">弊社の Web サイト</a> および <a href="https://aka.ms/CIEM">製品ドキュメント</a> をご覧ください。また、7 月 19 日午前 9 時 (太平洋標準時) に開催される <a href="https://aka.ms/PermissionsManagementAMA">Ask Me Anything セッション</a> に、当社のセキュリティ専門家が参加し、ご質問をお受けいたしますので、ぜひご参加ください。</p><p>Alex Simons (Twitter: <a href="https://twitter.com/Alex_A_Simons">@Alex_A_Simons</a>)<br>Corporate Vice President Product Management<br>Microsoft Identity Division  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 高田 です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 7 月 7 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcom</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>一時アクセス パスによるセキュアな認証方式の展開</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/secure-authentication-method-provisioning-with-temporary-access/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/secure-authentication-method-provisioning-with-temporary-access/</id>
    <published>2022-07-15T01:00:00.000Z</published>
    <updated>2022-10-29T08:06:47.820Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 村上 です。</p><p>本記事は、2022 年 6 月 22 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/secure-authentication-method-provisioning-with-temporary-access/ba-p/3290631">Secure authentication method provisioning with Temporary Access Pass</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>本日は、一時アクセス パス (Temporary Access Pass、以下 TAP) が一般提供となりましたことをお知らせします。TAP のパブリック プレビューを <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/temporary-access-pass-is-now-in-public-preview/ba-p/1994702">発表</a> して以来、マイクロソフトでは数多くの取り組みを進めていました。</p><p><strong><em>弊社ではパスワードレスでのサインインに MS Authenticator を使用しています。社員がリソースにアクセスするにはパスワードレスのみを許可しています。登録は TAP を用いて行われ、従来のようにパスワードをユーザーに渡す必要がなくなりました…” - EU のグローバル玩具メーカー</em></strong></p><p>このリリースを担当したプロダクト マネージャーの一人である Tim Larson に、これらのアップデートの概要、TAP を使用したパスワードレスのアカウント登録、そしてリカバリのシナリオについて解説してもらいます。Tim のブログは以下をご覧ください。</p><p>Alex Simons（Twitter: <a href="https://twitter.com/Alex_A_Simons">@alex_a_simons</a>)<br>マイクロソフト アイデンティティ部門<br>コーポレート バイスプレジデント、プロダクト マネジメント</p><hr><p>皆さん、こんにちは。</p><p>以下では、TAP に関する変更と改善、そしてパスワードレスを始めるために TAP をどのように活用できるかを紹介します。</p><h2 id="TAP-とは？"><a href="#TAP-とは？" class="headerlink" title="TAP とは？"></a>TAP とは？</h2><p>TAP は時間制限付きパスコードで、ユーザーがパスワードレスの認証方法を登録し、パスワードを使用せずともアカウントへのアクセスを回復するために使用できるものです。また、TAP を使用して Windows デバイスを設定することができます。ユーザーが直接自分のデバイスを設定したり、<a href="https://docs.microsoft.com/ja-jp/mem/autopilot/windows-autopilot">Windows AutoPilot</a> を使用してデバイスを <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/devices/concept-azure-ad-join">Azure AD に参加</a> させたり、<a href="https://docs.microsoft.com/ja-jp/windows/security/identity-protection/hello-for-business/hello-overview">Windows Hello for Business</a> の設定において、TAP を使用したりることも可能です。</p><h2 id="管理者体験"><a href="#管理者体験" class="headerlink" title="管理者体験"></a>管理者体験</h2><p>認証方法ポリシーで、組織向けに TAP を設定および構成することができます。例えば、TAP の割り当てを特定のユーザーやグループに限定したり、短期間の使用に限定したり、また、1 回限りの使用に設定したりすることができます。</p><p><img src="/blog/azure-active-directory/secure-authentication-method-provisioning-with-temporary-access/image01.jpg"></p><p><img src="/blog/azure-active-directory/secure-authentication-method-provisioning-with-temporary-access/image02.jpg" alt="一時アクセス パスの認証方法設定"></p><p>ポリシーによって認証方法が有効になると、特権認証管理者または認証管理者は、ユーザーの認証方法ブレードにアクセスするか、API でアクセスすることによって、そのユーザーに TAP を作成することができます。また、管理者が既存の TAP を上書きする機能も追加されました。以前に作成した TAP をユーザーが忘れたり紛失したりした場合、同じ手順で TAP をユーザーのアカウントに追加するだけで、古い TAP が削除されます。</p><p><img src="/blog/azure-active-directory/secure-authentication-method-provisioning-with-temporary-access/image03.jpg" alt="Azure Portal からユーザーへ新しい一時アクセス パスを作成"></p><h2 id="エンド-ユーザー体験"><a href="#エンド-ユーザー体験" class="headerlink" title="エンド ユーザー体験"></a>エンド ユーザー体験</h2><p>ユーザーが有効な TAP を取得すると、<a href="https://support.microsoft.com/ja-jp/account-billing/%E8%81%B7%E5%A0%B4%E3%81%BE%E3%81%9F%E3%81%AF%E5%AD%A6%E6%A0%A1%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%82%92microsoft-authenticator-%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AB%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B-43a73ab5-b4e8-446d-9e54-2a4cb8e4e93c">Authenticator アプリから直接パスワードなしの電話サインイン</a> や、<a href="https://aka.ms/mysecurityinfo">マイセキュリティ情報ページ</a> から FIDO2 キーの追加、さらには Azure AD 参加および Hybrid Azure AD 参加端末での Windows Hello for Business セットアップなど、サインインやセキュリティ情報の登録に使用することができます。MFA が必要なシナリオでは、TAP を追加要素として使用することもできます。</p><p><img src="/blog/azure-active-directory/secure-authentication-method-provisioning-with-temporary-access/image04.png"></p><h2 id="詳細について"><a href="#詳細について" class="headerlink" title="詳細について"></a>詳細について</h2><p>TAP の設定方法については、こちらの <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/howto-authentication-temporary-access-pass">ドキュメント</a> をご覧ください。</p><p>新入社員のオンボーディング体験は、組織ごとに異なる場合があります。TAP は Microsoft Graph API を通して利用できるため、既存のアプリケーションや <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/app-provisioning/what-is-hr-driven-provisioning">人事主導のプロビジョニング</a> プロセスに組み込むことができます。ニーズに合わせて TAP を構成するためのポリシー API については、<a href="https://docs.microsoft.com/ja-jp/graph/api/resources/temporaryaccesspassauthenticationmethodconfiguration?view=graph-rest-1.0">こちら</a> をご覧ください。</p><h2 id="皆様のご意見をお聞かせください"><a href="#皆様のご意見をお聞かせください" class="headerlink" title="皆様のご意見をお聞かせください"></a>皆様のご意見をお聞かせください</h2><p>TAP があなたのパスワードレスの導入に役立つことを願っています。お試しいただき、質問やフィードバックをお寄せください。</p><p>Tim Larson (<a href="https://twitter.com/tim_c_larson">@tim_c_larson</a>)<br>マイクロソフト アイデンティティ部門<br>シニア プロダクト マネージャー</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 村上 です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 6 月 22 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD Graph / MSOnline PowerShell モジュール利用状況の調べ方</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/how-to-determine-depreacated-azuread-msol/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/how-to-determine-depreacated-azuread-msol/</id>
    <published>2022-07-11T04:00:00.000Z</published>
    <updated>2022-10-29T08:06:47.592Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 埴山 です。</p><h2 id="Azure-AD-Graph-MSOnline-PowerShell-モジュールの廃止予定"><a href="#Azure-AD-Graph-MSOnline-PowerShell-モジュールの廃止予定" class="headerlink" title="Azure AD Graph / MSOnline PowerShell モジュールの廃止予定"></a>Azure AD Graph / MSOnline PowerShell モジュールの廃止予定</h2><p><a href="/blog/azure-active-directory/azure-ad-change-management-simplified/">Azure AD の変更管理を簡素化します</a> の記事でお伝えしております通り、 MSOnline および Azure AD for Graph (Preview 含む) は 2022 年 12 月 <strong>以降</strong> に廃止が予定されております。改めて廃止が予定されているモジュールは、以下の通りです。</p><table><thead><tr><th align="left">名前</th><th align="left">モジュール名</th><th align="left">プレフィックス</th><th align="left">コマンド例</th></tr></thead><tbody><tr><td align="left">MSOnline (Azure AD v1)</td><td align="left">MSOnline</td><td align="left">Msol</td><td align="left">Connect-MsolService, Get-MsolUser</td></tr><tr><td align="left">Azure AD for Graph (Azure AD v2)</td><td align="left">AzureAD</td><td align="left">AzureAD</td><td align="left">Connect-AzureAD, Get-AzureADUser</td></tr><tr><td align="left">Azure AD for Graph preview (Azure AD v2 preview)</td><td align="left">AzureADPreview</td><td align="left">AzureAD</td><td align="left">Connect-AzureAD, Get-AzureADUser</td></tr></tbody></table><p>これらのモジュールを利用しているすべてのお客様は、Microsoft Graph API への移行を検討いただく必要がございます。</p><h2 id="モジュールを利用しているかの確認方法"><a href="#モジュールを利用しているかの確認方法" class="headerlink" title="モジュールを利用しているかの確認方法"></a>モジュールを利用しているかの確認方法</h2><p>最近、廃止されるモジュールを利用しているか Azure AD のログから確認する方法はないかとのお問合せを多く頂きます。ただ、残念ながら Azure AD のログからすべての利用履歴を精査することはできません。</p><h3 id="スクリプトの内容を確認する"><a href="#スクリプトの内容を確認する" class="headerlink" title="スクリプトの内容を確認する"></a>スクリプトの内容を確認する</h3><p>モジュールを利用しているか正確に確認する唯一の方法は、実際に利用されておりますスクリプトの内容を精査する方法です。</p><p>MSOnline PowerShell (以下 Msol) モジュール, Azure AD for Graph (以下 AzureAD) モジュールの利用箇所についてはお客様環境で利用しているスクリプトなどの精査が必要です。<br>具体的には AzureAD および MSOL モジュール利用時には、必ず以下のいずれかのコマンドで Azure AD に認証を行います。(大文字小文字は区別しません)</p><p>Connect-MsolService<br>Connect-AzureAD</p><p>従って、これらのコマンドを業務で利用していないか、これらのコマンドが含まれているバッチファイルが存在しないかなどを精査することが有効です。</p><p>しかしながら、スクリプトの精査が難しい場合や、棚卸の補助として Azure AD に保存されたサインイン ログから一部の利用履歴や、該当する可能性のあるログを抽出することが可能です。<br>抽出されたログの IP アドレスや利用ユーザーなどから、利用元のマシンやシステムを推測することを検討ください。</p><h3 id="サインイン-ログからスクリプトが使われているか確認する"><a href="#サインイン-ログからスクリプトが使われているか確認する" class="headerlink" title="サインイン ログからスクリプトが使われているか確認する"></a>サインイン ログからスクリプトが使われているか確認する</h3><p>ユーザーの資格情報を利用しモジュールを利用する場合、利用履歴が Azure AD のログに記録されます。(例 1, 2)<br>これらのログは Azure AD のサインイン ログからアプリケーション Azure Active Directory PowerShell (AppId: 1b730954-1685-4b74-9bfd-dac224a7b894) を絞り込むことで確認が可能です。(AzureAD, MSOL のいずれも同じアプリとして表示され区別はつきません)</p><h4 id="例1-対話的な認証を実施しサインインしている場合"><a href="#例1-対話的な認証を実施しサインインしている場合" class="headerlink" title="例1. 対話的な認証を実施しサインインしている場合"></a>例1. 対話的な認証を実施しサインインしている場合</h4><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># オプションなしで実行</span></span><br><span class="line"><span class="built_in">Connect-AzureAD</span></span><br><span class="line"><span class="built_in">Connect-MsolService</span></span><br></pre></td></tr></table></figure><h4 id="例2-埋め込まれたユーザー名パスワードを利用してサインインしている場合"><a href="#例2-埋め込まれたユーザー名パスワードを利用してサインインしている場合" class="headerlink" title="例2. 埋め込まれたユーザー名パスワードを利用してサインインしている場合"></a>例2. 埋め込まれたユーザー名パスワードを利用してサインインしている場合</h4><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># UPN を含む Credential を指定</span></span><br><span class="line"><span class="variable">$password</span> = <span class="built_in">ConvertTo-SecureString</span> <span class="string">&#x27;SecurePassword&#x27;</span> <span class="literal">-AsPlainText</span> <span class="literal">-force</span>;</span><br><span class="line"><span class="variable">$cred</span> = <span class="built_in">New-Object</span> System.management.Automation.Pscredential(<span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Connect-MsolService</span> <span class="literal">-Credential</span> <span class="variable">$cred</span>;</span><br><span class="line"><span class="built_in">Connect-AzureAD</span> <span class="literal">-Credential</span> <span class="variable">$cred</span> <span class="literal">-TenantId</span> <span class="variable">$tenantId</span></span><br></pre></td></tr></table></figure><p>例 1, 2 の場合サインインログは “Azure Active Directory PowerShell” (AppId:<br>1b730954-1685-4b74-9bfd-dac224a7b894)  のアプリ名にて記録されます。</p><p>つまり Azure ポータルの<a href="https://portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/SignIns">サインイン ブレード</a> にて、フィルターにアプリケーションを追加後 <code>1b730954-1685-4b74-9bfd-dac224a7b894</code> のアプリ ID 入力し絞り込むことで、利用者の特定が可能です。</p><p><img src="/blog/azure-active-directory/how-to-determine-depreacated-azuread-msol/01_filtering.png" alt="アプリ名でフィルタリング"></p><p><img src="/blog/azure-active-directory/how-to-determine-depreacated-azuread-msol/02_interactive_signin.png" alt="サインイン ログの例"></p><div class="alert is-info"><p class="alert-title">Note</p><p>例 2 の場合はユーザーのサインイン (非対話) に記録される場合があります。</p></div><p><img src="/blog/azure-active-directory/how-to-determine-depreacated-azuread-msol/03_noninteractive_signin.png" alt="非対話型ログの例"></p><div class="alert is-info"><p class="alert-title">Note</p><p>バッチ処理に組み込まれたシステムユーザーの場合、どのマシンで実行しているかの情報は残念ながら確認できないので、IP アドレスや時間などから、利用されているマシンやシステムを特定できないか検討ください。</p></div><h4 id="例3-サービス-プリンシパルの資格情報を利用"><a href="#例3-サービス-プリンシパルの資格情報を利用" class="headerlink" title="例3. サービス プリンシパルの資格情報を利用"></a>例3. サービス プリンシパルの資格情報を利用</h4><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Connect-AzureAD</span> <span class="literal">-TenantId</span> <span class="variable">$tenantId</span> <span class="literal">-ApplicationId</span> <span class="variable">$appId</span> <span class="literal">-CertificateThumbprint</span> <span class="variable">$thumb</span></span><br></pre></td></tr></table></figure><p>AzureAD モジュールではアプリの資格情報を利用する例もあり、バッチ処理では一般にこちらの方式をお勧めしておりました。</p><p>例 3 のようにアプリケーション ID を指定したサインインでは、お客様が登録したアプリの ID で認証が実施され、サインイン ログ上は認証に利用したアプリケーションの情報のみが記録されます。結果、モジュールを利用していない認証と区別がつきませんので、Azure AD 側のログからは特定が困難です。</p><p>例えば、以下のようなコマンドにて Azure AD に接続を実施したとします。(07e819fe-9ab3-4dc5-9e9a-89ecd77b828e はアプリケーション ID です)</p><p>Connect-AzureAD -ApplicationId 07e819fe-9ab3-4dc5-9e9a-89ecd77b828e -TenantId $tenantId -CertificateThumbprint $certThumb</p><p>この場合、サインイン ログは [Azure Active Directory] &gt; [サインイン ログ] &gt; [サービス プリンシパルのサインイン] に記録されます。</p><p>具体例は以下の通りで、アプリケーション ID は Connect-AzureAD コマンドで指定したものが、アプリケーション名は、お客様が登録したアプリ名で記録されます。(下記例では Connect-AzureAD as app というアプリ名のアプリを作成しています)</p><p><img src="/blog/azure-active-directory/how-to-determine-depreacated-azuread-msol/04_serviceprincipal_signin.png" alt="サービス プリンシパルでのサインイン"></p><p>唯一、見分け方として、Connect-AzureAD での接続時に記録されるサインインログの “リソース” プロパティ は Windows Azure Active Directory となる点が挙げられます。<br>ただ Connect-AzureAD 以外でもこの値が記録される可能性があるため、上記ログが必ずしも Connect-AzureAD での利用とは限らない点にご留意ください。</p><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>Msol, Azure AD モジュールは、2022 年 12 月以降に廃止予定です。モジュールが利用されているかを特定するには、Connect-MsolService, Connect-AzureAD コマンドを実行しているか、バッチ処理に含まれるかを精査することが最も有効です。</p><p>サインインログから調査する場合、Connect-MsolService と Connect-AzureAD コマンドの認証ログは</p><ul><li>対話的なサインイン ログと非対話型のサインインログではアプリケーション “Azure Active Directory PowerShell” のログが該当する</li><li>サービス プリンシパルでのサインイン ログでは リソース プロパティが “Windows Azure Active Directory” のログに含まれる <strong>可能性がある</strong></li></ul><p>これらのログから、利用ユーザーやバッチ処理の特定を検討ください。</p><p>引き続き、本ブログでは廃止予定のモジュールの移行方法に関して発信していきます。<br>ご不明な点等ございましたら、是非弊社サポートサービスをご利用ください。</p><h2 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q &amp; A"></a>Q &amp; A</h2><h3 id="Connect-AzureAD-の-AadAccessToken-オプションまたは-MsAccessToken-を利用して接続しているログを特定する方法はないでしょうか"><a href="#Connect-AzureAD-の-AadAccessToken-オプションまたは-MsAccessToken-を利用して接続しているログを特定する方法はないでしょうか" class="headerlink" title="Connect-AzureAD の -AadAccessToken オプションまたは -MsAccessToken を利用して接続しているログを特定する方法はないでしょうか"></a>Connect-AzureAD の -AadAccessToken オプションまたは -MsAccessToken を利用して接続しているログを特定する方法はないでしょうか</h3><p>それぞれのオプションでは Azure AD Graph API, Microsoft Graph API に対するアクセス トークンを指定します。アクセス トークンの取得方法によりログの出力が異なりますので、サインインログから特定することは困難です</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 埴山 です。&lt;/p&gt;
&lt;h2 id=&quot;Azure-AD-Graph-MSOnline-PowerShell-モジュールの廃止予定&quot;&gt;&lt;a href=&quot;#Azure-AD-Graph-MSOnline-PowerS</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="PowerShell" scheme="https://jpazureid.github.io/blog/tags/PowerShell/"/>
    
  </entry>
  
</feed>
