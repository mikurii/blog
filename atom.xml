<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan Azure Identity Support Blog</title>
  
  <subtitle>日本マイクロソフトの Azure Active Directory と AD FS に関するサポート情報のブログです。</subtitle>
  <link href="https://jpazureid.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpazureid.github.io/blog/"/>
  <updated>2023-02-26T07:56:55.799Z</updated>
  <id>https://jpazureid.github.io/blog/</id>
  
  <author>
    <name>Azure Identity Support Japan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>よくわかるアカウント ロックアウトとよくある質問</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/comprehend-account-lockout/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/comprehend-account-lockout/</id>
    <published>2023-02-22T00:00:00.000Z</published>
    <updated>2023-02-26T07:56:55.799Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure Identity サポート チームの小出です。</p><p>今回は、スマート ロックアウトの機能とアカウントがロックアウトしてしまったときの対処策について、シナリオ別にご案内します。</p><h2 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h2><p>Azure AD や Microsoft 365 サービスをご利用いただくなかで、利用者様より、”サインインできません” や “アカウントがロックアウトされてしまいました” といった連絡をもらうことがあると思います。これは Azure AD では総当たり攻撃などを防ぐために、パスワードを一定の回数連続して間違えると、しばらくの間アカウントがロックされる機能があるためです。これによりサインインできない状況が考えられます。</p><p>マイクロソフトではパスワードレスへの移行を推奨していますが、ほとんどのお客様はパスワードを使用してサインインしている状況かと思います。そのような中、パスワードの設定や機能について、どのようなことができるのかについてお問い合わせいただくことがあります。Azure AD ではパスワードに対する保護機能として、スマート ロックアウトと呼ばれるものが提供されています。今回は、以前ブログとして公開しました <a href="https://jpazureid.github.io/blog/azure-active-directory/comprehend-password-policy/">パスワード ポリシーの機能</a> と併せて、Azure AD のスマート ロックアウトに関する内容についてご案内します。</p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ol><li><p><a href="#idx1">ロックアウトの概要</a></p></li><li><p><a href="#idx2">スマート ロックアウトの確認方法</a></p></li><li><p><a href="#idx3">シナリオ別の対処方法</a></p><ul><li><a href="#idx3-1">同期ユーザーがオンプレミス側でロックアウトしたとき</a></li><li><a href="#idx3-2">パスワード ハッシュ同期環境で、同期ユーザーが Azure AD 側でロックアウトしたとき</a></li><li><a href="#idx3-3">パススルー認証環境の同期ユーザーが、 Azure AD 側でロックアウトした時</a></li><li><a href="#idx3-4">AD FS 環境の同期ユーザーが、 Azure AD 側でロックアウトした時</a></li><li><a href="#idx3-5">クラウド ユーザーがロックアウトしたとき</a></li><li><a href="#idx3-6">ゲスト ユーザーからロックアウトの連絡があったとき</a></li></ul></li><li><p><a href="#idx4">攻撃されていると思ったら</a></p></li><li><p><a href="#idx5">補足情報（よくある質問）</a></p></li></ol><hr><h2 id="idx2">1. ロックアウトの概要</h2><p>サインイン時にパスワードを複数回間違えると、アカウントを一時的にロックする機能が用意されています。オンプレミス AD 環境でコンピューターにサインインするときには、以下のようなメッセージを目にすることがあると思います。</p><p><img src="/blog/azure-active-directory/comprehend-account-lockout/comprehend-account-lockout1.png"></p><p>このメッセージが表示されたときは、一般的にヘルプデスクなどに依頼し、オンプレミス AD からロックアウトを解除してもらう、または ロックアウトが解除されるまで待つといった対処となりますが、Azure AD にも同様の機能が用意されており、Azure AD ではスマート ロックアウトと呼ばれています。</p><p>スマート ロックアウトの機能は、オンプレミス AD のロックアウト機能と似たものと考えていただいてよいですが、いくつかの点でより改善されています。例えば、攻撃者と正規ユーザーを分別し、ロックアウト ウンターを別々に管理することで、仮にアカウントが攻撃を受けたとしても、正規ユーザーがロックアウトされないようにするなど、より賢くロックアウトを行うよう改善されています。その他にもポリシーとしてマイクロソフトのセキュリティのベストプラクティスが適用されています。</p><p>一方で、オンプレミス AD のロックアウト機能のように、”ロックアウトされたら必ず管理者が解除する” ように構成することはできないなど、オンプレミス AD と比べてカスタマイズ可能な点が限られている部分はあります。しかし、これはマイクロソフトのベストプラクティスを適用し、お客様独自のカスタマイズを行うことで逆にセキュリティが低下することを防ぐことにもつながっています。</p><h2 id="idx1">2. スマート ロックアウトの確認方法</h2><p>次に、スマート ロックアウトの機能でアカウントがロックされると、どのような動作となるかご案内します。</p><p>通常、間違ったパスワードを入力すると、以下のようなメッセージが表示されます。</p><p><img src="/blog/azure-active-directory/comprehend-account-lockout/comprehend-account-lockout2.png"></p><p>このときのサインイン ログには、上記のメッセージと同様に、誤ったユーザー名もしくはパスワードが使用されているエラーであることが分かります。</p><p><img src="/blog/azure-active-directory/comprehend-account-lockout/comprehend-account-lockout3.png"></p><p>一方、スマート ロックアウトによって一時的にロックアウトされているときは、以下のようなメッセージに変わります。ロックアウトされている間は、正しいパスワードを入力してもサインインできません。</p><p><img src="/blog/azure-active-directory/comprehend-account-lockout/comprehend-account-lockout4.png"></p><p>このとき、サインイン ログには、エラーの理由に “The account is locked (アカウントがロックされています)” と記載されます。</p><p><img src="/blog/azure-active-directory/comprehend-account-lockout/comprehend-account-lockout5.png"></p><h2 id="idx3">3. シナリオ別の対処方法</h2><p>テナントには同期ユーザーおよびクラウド ユーザー、ゲスト ユーザーなど様々な種類のユーザーが存在するため、ロックアウトしたときの対処策はそれぞれ異なります。特に、Azure AD 側とオンプレミス AD 側のどちらでロックアウトされているかという点は混乱しやすい点です。</p><p>対処策を確認する際には、”ユーザーがどこにサインインしようとしていて、その認証はどこで行われるか” という点が重要です。それぞれシナリオごとに対処方法を記載しておりますのでご確認ください。</p><h3 id="idx3-1">シナリオ 1: 同期ユーザーがオンプレミス AD 側でロックアウトされた場合</h3><p>ユーザーがドメイン コントローラーやオンプレミスのコンピューターにサインインする際にロックアウトされるシナリオです。この場合、オンプレミス AD 側のロックアウト ポリシーでアカウントがロックアウトされています。そして通常、このシナリオの場合は、ヘルプデスクなどに依頼してオンプレミス側でアカウント ロックを解除してもらうことも多いと思います。このシナリオの場合、オンプレミス環境内での認証のため、Azure AD のスマート ロックアウトは動作しません。</p><p>管理者はドメイン コントローラーにサインインし、以下の手順にてアカウント ロックを解除できます。</p><ol><li><p>ドメイン コントローラーにサインインします。</p></li><li><p>[Active Directory ユーザーとコンピューター] を開きます。</p></li><li><p>ロックアウト状態を解除させたいユーザーを検索し、右クリック - [プロパティ] を選択します。</p></li><li><p>[アカウント] タブ内、下記アカウント ロックアウトを解除するためのチェックをオンにして、変更を反映させます。</p><p> <img src="/blog/azure-active-directory/comprehend-account-lockout/comprehend-account-lockout6.png"></p></li></ol><p>管理者は、例えば Default Domain Policy 内、 [アカウント ポリシー] - [アカウント ロックアウトのポリシー] にて、アカウントのロックアウトのしきい値やロックアウト期間を設定することができます。</p><p><img src="/blog/azure-active-directory/comprehend-account-lockout/comprehend-account-lockout7.png"></p><h3 id="idx3-2">シナリオ 2: パスワード ハッシュ同期環境の同期ユーザーが Azure AD 側でロックアウトされた場合</h3><p>パスワード ハッシュ同期の環境では、 Azure ポータルや Microsoft 365 サービスにサインインする際、同期ユーザーであっても Azure AD 側で認証されます。そのため、この場合は、スマート ロックアウトの機能でアカウントがロックアウトされます。既定ではロックアウト時間は 1 分のため、オンプレミス AD のロックアウトのように管理者に依頼する間もなく、ロックアウト状態が解除されます。</p><p>なお、公開情報にも記載がありますが、ロックアウトの最中に管理者がロックアウトを解除することはできません。代わりに、ユーザーが SSPR にてパスワードをリセットすることでロックを解除することが可能ですので、以下に手順を記載します。</p><ol><li><p><a href="http://aka.ms/sspr">http://aka.ms/sspr</a> へアクセスします。</p></li><li><p><a href="https://passwordreset.microsoftonline.com/">https://passwordreset.microsoftonline.com/</a> の画面に遷移し、下記の画面が表示されるので、UPN と文字列を入力します。</p><p> <img src="/blog/azure-active-directory/comprehend-account-lockout/comprehend-account-lockout8.png"></p></li><li><p>パスワード リセットを行うために、事前に登録した電話番号などを入力して認証します。</p><p> <img src="/blog/azure-active-directory/comprehend-account-lockout/comprehend-account-lockout9.png"></p></li><li><p>新しいパスワードを入力します。</p><p> <img src="/blog/azure-active-directory/comprehend-account-lockout/comprehend-account-lockout10.png"></p></li><li><p>下記画面が表示されたら、パスワードのリセットは完了です。</p><p> <img src="/blog/azure-active-directory/comprehend-account-lockout/comprehend-account-lockout11.png"></p></li></ol><p>なお、時間が経過してロックアウトが解除された場合（既定では、ロックアウトから 1 分経過した場合）、次のサインイン時にもパスワードを間違えると、アカウントは即座にロックアウトされます。<br>このときは、1 分より長い時間アカウントがロックアウトされるような動作となります。具体的に何分ロックアウトされるかなどの詳細はセキュリティ上公開しておりませんが、ロックアウト回数が増加するたびにロックアウト時間を延長するため、攻撃者がパスワードの総当たりを行うことを抑止することに役立ちます。</p><h3 id="idx3-3">シナリオ 3: パススルー認証環境の同期ユーザーが Azure AD 側でロックアウトされた場合</h3><p>パススルー認証 (PTA) をご利用いただいている場合、Azure AD 側とオンプレミス AD 側のロックアウト ポリシーの両方を考慮する必要があります。これは、このシナリオでサインインしようとする場合、下記のようなフローを辿るためです。</p><ol><li>利用者がユーザー名とパスワードを入力します。</li><li>Azure AD は「今 Azure AD 側でロックアウトしているのか？」を判断します。</li><li>Azure AD が「今 Azure AD 側でロックアウトしている」と判断した場合、オンプレミス AD 側に認証を要求せず、Azure AD 側でロックアウトされている旨が表示され、以降の処理が行われません。</li><li>Azure AD が「今 Azure AD 側でロックアウトしていない」と判断した場合、オンプレミス AD 側に認証要求を転送します。</li><li>オンプレミス AD 側のロックアウト ポリシーに抵触していなければ、 認証結果が Azure AD に返されます。</li><li>認証結果に応じて Azure AD へのサインインの可否が判断されます。</li></ol><p>上記のようなフローを辿るため、Azure AD のスマート ロックアウトの機能と、オンプレミス AD のロックアウトの機能が両方関連します。パススルー認証をご利用の場合、スマート ロックアウトを構成するときの「ロックアウト回数のしきい値」に着目ください。</p><p>具体的には、 Azure AD のスマート ロックアウトのしきい値が 10 回、オンプレミス AD のアカウントのロックアウトのしきい値が 20 回など、オンプレミス AD の回数の方が 2 から 3 倍程度多くなるように設定します。これは、仮にクラウド側で攻撃を受けた場合に、同じ回数でロックアウトしてしまうと、利用者がオンプレミス AD 側のリソースへもアクセスできなくなってしまうことを防ぐためです。</p><p>攻撃を受けた場合に先に Azure  AD 側のアカウントをロックアウトしておけば、上記 3 にて「今 AzureAD 側でロックアウトしている」と判断されるため、オンプレミス AD 側に認証が要求されず、オンプレミス AD 側の影響を少なくすることができます。</p><h3 id="idx3-4">シナリオ 4: フェデレーション (AD FS) 環境の同期ユーザーが AD FS 側でロックアウトされた場合</h3><p>AD FS を利用している場合、Azure AD へサインインしようとすると、AD FS に誘導され、AD FS を介してオンプレミス AD に対して認証が行われます。</p><p>例えばこの場合、AD FS の認証画面でパスワードを 10 回間違えると、オンプレミス AD 側のロックアウトカウンターが 10 上昇します。このため、オンプレミス AD 側のロックアウト ポリシーを適用することが可能ですが、攻撃を受けて繰り返しサインインに失敗すると、オンプレミス AD 側でロックアウトが発生し、オンプレミスのリソースへもアクセスできなくなってしまう可能性があります。</p><p>一般的な要望として「クラウド側から攻撃を受けたとしても、オンプレミス AD 側はロックアウトさせたくない」という場合、パススルー認証の場合と同様にロックアウトのしきい値の考慮が必要です。AD FS の場合、下記 AD FS エクストラネット スマートロックアウトの機能を利用することになります。エクストラネット スマートロックアウトは、外部から (WAP 経由) のサインインに対してロックアウトを行う機能です。外部から (WAP 経由) のサインインを AD FS が判別して、必要に応じてロックアウトを行います。</p><p><a href="https://learn.microsoft.com/ja-jp/windows-server/identity/ad-fs/operations/configure-ad-fs-extranet-smart-lockout-protection">https://learn.microsoft.com/ja-jp/windows-server/identity/ad-fs/operations/configure-ad-fs-extranet-smart-lockout-protection</a></p><p>事前に AD FS のエクストラネット スマートロックアウトのしきい値を 10 回、オンプレミス AD 側のロックアウトのしきい値は 20 回などと設定しておくと、アカウントが外部から (WAP 経由で) 攻撃された場合でも、先に AD FS 側でアカウントをロックアウト (それ以上のオンプレミス AD への認証をブロック) することが可能です。先に AD FS 側でロックアウトさせることができると、「AD FS 側はロックアウトされてしまったが、オンプレミス AD 側のリソースにはアクセスできる」状態となるため、攻撃によりオンプレミス AD 側のリソースへもアクセスできなくなることを防ぐことが可能です。 </p><h3 id="idx3-5">シナリオ 5: Azure AD に直接作成したクラウド ユーザーがロックアウトされた場合</h3><p>同期ユーザーと異なり、クラウド ユーザーはオンプレミス AD 側にアカウントがないため、オンプレミス AD 側でロックアウトされることはありません。そのため、このシナリオの場合、 シナリオ 2 のパスワード ハッシュ同期のユーザーと同様に、Azure AD のスマート ロックアウトの機能でロックアウトされます。対処策もシナリオ 2 と同様です。</p><p>なお、ロックアウトのしきい値やロックアウト期間は、 Azure ポータル上より、以下の手順で変更することができます。カスタマイズには Azure AD Premium P1 ライセンス以上が必要です。</p><ol><li>Azure ポータルにサインインします。</li><li>[Azure Active Directory] - [セキュリティ] - [認証方法] - [パスワード保護] を選択します。</li><li>以下のような画面が表示されることを確認します。 <img src="/blog/azure-active-directory/comprehend-account-lockout/comprehend-account-lockout12.png"></li><li>“ロックアウトのしきい値” と、 “ロックアウト期間（秒単位）” の値をカスタマイズします。</li></ol><table><thead><tr><th>項目</th><th>設定可能な値</th><th>説明</th></tr></thead><tbody><tr><td>ロックアウトのしきい値</td><td>1 - 50 (回数)</td><td>何回パスワードを間違えたときにロックアウトするか設定します。上記では、 3 回パスワードを間違えるとロックアウトするよう設定しています。</td></tr><tr><td>ロックアウト時間 (秒単位)</td><td>5-18000 (秒単位)</td><td>ロックアウトされたときに、どれくらいの時間ロックアウトを行うのか秒単位で指定します。上記では 60 秒 (= 1 分) ロックアウトされる設定となります。</td></tr></tbody></table><h3 id="idx3-6">シナリオ 6: ゲスト ユーザーからアカウントがロックアウトされた旨の連絡が来た場合</h3><p>ゲスト ユーザーのパスワード管理や認証は、ゲストがもともと登録されているホーム テナント側で行われています。そのため、ゲスト ユーザーの場合は、そのユーザーがメンバーとして登録されているテナントの管理者に別途対応を依頼ください。</p><h2 id="idx4">5. 攻撃されていると思ったら</h2><p>Azure AD のスマートロックアウトでは、正規ユーザーと攻撃者用に二つのロックアウト カウンターが用意されています。サインインの場所などを考慮してスマートロックアウトはこれらのカウンターを使い分け、仮に攻撃者がアカウントに繰り返し認証を仕掛けても、攻撃者のみをロックアウトし正規ユーザーは影響を受けないよう、その名のとおりスマートにロックアウト動作を行います。この場合、ユーザーは攻撃されていたとしても、通常どおりサインインが行えますので、利便性とセキュリティの両方が確保できるという状態になります。</p><p>しかしながら、このロックアウト動作も完ぺきではないため、Azure AD 側で攻撃者と正規ユーザーの見分けがつかない場合は、攻撃を受けた正規ユーザーがロックアウトされ、一時的にサインインできなくなる可能性もあります。管理者の皆様におかれましては、まずは Azure AD のサインインログを確認し、攻撃がどの程度の頻度で行われているか、通常使用していない場所からのサインインが成功となっていないかなどを確認ください。</p><p>また、スマート ロックアウトは、攻撃からアカウントを保護するための 1 つの方法でしかありません。攻撃を受け続けている場合、パスワードのみの保護ではいつか突破される可能性もありますので、下記のような対処を実施いただければと思います。</p><ul><li>推測されやすいパスワードであれば、パスワードを推測されにくいものに変更またはリセットする</li><li>MFA を設定し、パスワードのみではサインインできないようにする</li><li>いったんアカウント自体を無効化し、パスワードが合っていてもサインインできないようにする（攻撃を受け続けている場合の一時的な対応です）</li><li>パスワードそのものを利用しない、より安全なパスワードレス認証に移行する。</li></ul><h2 id="idx5">6. 補足情報（よくある質問）</h2><p>最近よくお問い合わせいただく内容を以下に補足します。</p><p><strong>Q. 設定されたしきい値以上に連続でパスワードを間違えました。 10 回連続で間違えたのに、11 回目でロックアウトされません。</strong></p><p>A. 間違ったパスワードを入力する際、同一のパスワードを複数回入力していると、カウントが増えません。毎回異なる誤ったパスワードを入力した場合にカウントが増えます。なお、毎回異なる誤ったパスワードを入力してもロックアウトされない場合は、以下もご確認ください。</p><p><strong>Q. ロックアウトの検証をしています。実行するタイミングによって、ロックアウトされたりされなかったりします。確実にロックアウトされないのはなぜですか。</strong></p><p>A. ロックアウトのカウントは、以前は各データーセンターごとに個別に管理していたため、別のデータセンターでカウントされた分はロックアウト状態に反映されませんでした。現在はデータセンター間でロックアウトのカウントが同期が行われるようになっていますが、サインインのタイミングによってはロックアウトに時間を要することがあります。これは Azure AD のデータセンターが世界中に分散しており、世界中で一瞬にロックアウトカウントを同期することが論理的に難しいためです。そのため、 10 回でロックアウトするよう設定していても、必ず 11 回目にロックアウトするとは限りません。数回程度のズレについては許容くださいますようお願い申し上げます。</p><p><strong>Q. 上記の動作は確認しましたが、どうしても 10 回で確実にロックアウトする必要があります。方法はありませんか？</strong></p><p>A. いいえ、確実に 10 回でロックアウトするという方法はありません。スマート ロックアウトの機能は、ユーザーがパスワード入力を間違えたシナリオよりも、「攻撃から保護する」ことに重点を置いて実装された機能であるため、例えば同じパスワードで間違えたときはカウントしないなど、厳密な回数を重視するよりもアカウントを保護することに重点を置いています。スマート ロックアウトはアカウントを保護するための 1 つの機能でしかないため、セキュリティをより高めたい場合は回数のカウントよりも MFA を併用ください。</p><p><strong>Q. ロックアウトのしきい値を 10 回に設定しています。 5 回パスワードを間違えました。時間をおいて再度サインインを試行した際は、 6 回目のカウントとなりますか？それとも時間をおくと、試行回数がリセットされて 1 回目のカウントになりますか？</strong></p><p>A. 誠に恐れ入りますが、セキュリティの観点より詳細な情報をお伝えすることができません。仮にこのような動作をお伝えすると、「特定の時間を置いてから再度攻撃しよう」などと、攻撃者への参考情報となってしまいます。スマート ロックアウトは、攻撃者に対してのセキュリティ保護の機能となりますため、詳細な情報を公開していない点をご了承ください。</p><p><strong>Q. スマート ロックアウト機能を無効にしたいです。可能ですか？</strong></p><p>A. いいえ、スマート ロックアウト機能を無効にすることはできません。</p><p><strong>Q. スマート ロックアウトのしきい値やロックアウト期間をカスタマイズしたいです。設定がグレーアウトされてしまっています。</strong></p><p>A. スマート ロックアウト設定のカスタマイズを行いたい場合、 Azure AD Premium P1 以上のライセンスが必要です。対象テナントのライセンスの保有状況をご確認ください。なお、カスタマイズする場合、テナントに存在する全員分のライセンスが必要となるためご留意ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure Identity サポート チームの小出です。&lt;/p&gt;
&lt;p&gt;今回は、スマート ロックアウトの機能とアカウントがロックアウトしてしまったときの対処策について、シナリオ別にご案内します。&lt;/p&gt;
&lt;h2 id=&quot;はじめに&quot;&gt;&lt;a href=&quot;#はじめ</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Authenticator の MFA 疲労攻撃対策 - 数値の一致による MFA が 有効化されます</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/defend-your-users-from-mfa-fatigue-attacks/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/defend-your-users-from-mfa-fatigue-attacks/</id>
    <published>2023-02-15T15:00:00.000Z</published>
    <updated>2023-02-26T07:56:55.851Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Azure Identity サポート チームの栗井です。</p><p>Microsoft Identity Security のディレクター Alex Weinert によって、昨今脅威が指摘されている MFA 疲労攻撃と、対策としての Microsoft Authenticator の強化機能についての下記ブログ記事が公開されました。</p><p><a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/defend-your-users-from-mfa-fatigue-attacks/ba-p/2365677">Defend your users from MFA fatigue attacks - Microsoft Tech Community</a></p><p>上記記事に記載の一部内容と、私共日本側のサポート チーム宛にお客様からお問い合わせいただく内容等をふまえ、本記事を執筆しました。</p><div class="alert is-info"><p class="alert-title">Note</p><p>下記でご紹介する機能のうち「プッシュ通知に番号の一致が必要」の機能は、2023 年の 5 月 8 日以降、すべてのユーザーに自動で有効化することを予定しています。(元々 2023 年 2 月 27 日以降を予定していましたが、2023 年 2 月 16 日段階で延期されました)</p><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/how-to-mfa-number-match">公開情報: 多要素認証 (MFA) 通知で数値の一致を使用する方法 - 認証方法ポリシー</a></p></div><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>昨今は多くのお客様の環境において、パスワード “のみ” による認証は十分にセキュアではないという認識が高まり、多要素認証 (MFA) などの導入による認証の強化が行われています。この動向に伴って、<strong>MFA の疲労攻撃 (別名、MFA スパム)</strong> の報告が増えています。</p><p><img src="/blog/azure-active-directory/defend-your-users-from-mfa-fatigue-attacks/Karen_Walker_1-1664319621345.png"></p><p>MFA 疲労攻撃とは、攻撃者が繰り返し何度も MFA 要求を発生させ、その要求を受け取ったユーザーが誤って MFA 要求を承認することを狙った手口です。</p><p>なぜこのような手口が通用するのかというと、音声通話への応答やプッシュ通知の承諾といった単純な MFA 承認方法では、ユーザーが一連の認証の流れ (コンテキスト) の中にいなくても、承諾を完了できてしまえるからです。突然、何の脈絡もなくスマートフォンにプッシュ通知が来たとして、ユーザーが承諾ボタンを押してしまうと攻撃者に侵入を許してしまうことになります。</p><p>例えば私の Microsoft Authenticator に、突然 MFA のプッシュ通知が発生したと仮定します。アプリには「サインインを承認しますか ? (拒否 / 承認)」という選択肢が表示されます。私はこのサインインに身に覚えがないので「拒否」を押下しますが、まだ IT リテラシーの高くない利用者や、たまたまそのタイミングでクラウド アプリにサインインを試行している人であれば、誤って「承認」を選択してしまう可能性もあります。また、攻撃者が繰り返しサインインを試行してプッシュ通知を行うと、ユーザーには複数の通知が届き、どれが自身の意図したプッシュ通知か判断できなくなります。MFA 疲労攻撃は、このような「ユーザーの誤操作」を狙った攻撃です。</p><p>この攻撃が成り立つのは、一連の認証操作において、認証の流れ (コンテキスト) が考慮されていないためです。実際に画面の前でサインインをしていなくても、Microsoft Authenticator 上で「承認」を押すことが “できてしまう” という点が問題です。音声通話 MFA も仕組みは同様です (自身が認証操作をしているか否かにかかわらず、認証要求の電話に対して、シャープ “#” ボタンを押下してしまえば承認できてしまう)。</p><p>本記事ではこのような「MFA の誤承認」からユーザーを保護するための、Microsoft Authenticator における MFA 強化の機能についてご紹介します。</p><h2 id="1-「プッシュ通知に番号の一致が必要」機能によって-MFA-の誤承認発生を防止"><a href="#1-「プッシュ通知に番号の一致が必要」機能によって-MFA-の誤承認発生を防止" class="headerlink" title="1. 「プッシュ通知に番号の一致が必要」機能によって MFA の誤承認発生を防止"></a>1. 「プッシュ通知に番号の一致が必要」機能によって MFA の誤承認発生を防止</h2><p>Microsoft Authenticator の「プッシュ通知に番号の一致が必要」を有効化すると、MFA の際に、「サインイン画面に表示される 2 桁の数字を、Microsoft Authenticator の画面に入力する」という操作が要求されます。</p><p>仮にユーザーの手元の Microsoft Authenticator に、見知らぬ MFA 要求が通知された場合であっても、ユーザーはこれを許可することができません。なぜならユーザーは画面の前におらず、Microsoft Authenticator に入力するための正しい数字を知りようがないからです。この仕組みによって、ユーザーが MFA 要求を誤承認するリスクを大幅に抑えることができます。</p><p><img src="/blog/azure-active-directory/defend-your-users-from-mfa-fatigue-attacks/number-matching.png">  </p><p>「プッシュ通知に番号の一致が必要」の機能は、当ブログ公開時 (2022/10/19) 時点でプレビュー機能でしたが、現在は一般機能として公開済みです。</p><p><a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/advanced-microsoft-authenticator-security-features-are-now/ba-p/2365673">公開情報 : Advanced Microsoft Authenticator security features are now generally available!</a></p><div class="alert is-info"><p class="alert-title">Note</p><p>Update: 本機能は 2023 年の 5 月 8 日以降、すべてのユーザーに自動で有効化することを予定しています。</p></div><p>本機能は 2021 年 11 月にリリースされ、すでに 1 万近くの組織に導入されています。また「番号の一致」は、Microsoft Authenticator を利用したパスワードレス サインインの手段としてもご利用いただくことができます。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/how-to-mfa-number-match">公開情報: 多要素認証 (MFA) 通知で数値の一致を使用する方法 - 認証方法ポリシー</a></p><h2 id="2-ユーザーが不正アクセスを判断できるように、MFA-要求にサインイン情報を表示"><a href="#2-ユーザーが不正アクセスを判断できるように、MFA-要求にサインイン情報を表示" class="headerlink" title="2. ユーザーが不正アクセスを判断できるように、MFA 要求にサインイン情報を表示"></a>2. ユーザーが不正アクセスを判断できるように、MFA 要求にサインイン情報を表示</h2><p>「プッシュ通知とパスワードレス通知に地理的な場所を表示する」の機能を有効化すると、サインインの発生元の IP アドレスに基づいた位置情報が Microsoft Authenticator の画面に表示されます。また「プッシュ通知とパスワードレス通知にアプリケーション名を表示する」の機能を有効化すると、サインイン先のアプリケーションの名前も表示されます。</p><p>例えば、ユーザー自身が名古屋にいるのに、サインイン元の位置情報が「ブラジル / リオデジャネイロ」と表示された場合、ユーザーは「この MFA 要求はおかしいかも？」と、一瞬手を止めて不正アクセスを疑うきっかけになることが期待されます。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/how-to-mfa-additional-context">公開情報: Microsoft Authenticator 通知で追加のコンテキストを使用する方法 - 認証方法ポリシー</a></p><p>なお、上記の機能がすべて有効化の対象となっているユーザーでは、Authenticator 宛の MFA 要求は、下記画像のようになります。</p><ul><li>アクセス先のアプリケーションが表示されます。下記例では “App: Azure Portal” と表示されています。</li><li>アクセス元の位置情報が “Location : Tokyo Japan” と、地図と合わせて表示されます。</li><li>MFA 要求の承認のため、数字の入力が要求されます。</li></ul><p><img src="/blog/azure-active-directory/defend-your-users-from-mfa-fatigue-attacks/mfarequest.png">  </p><h2 id="3-Azure-AD-Identity-Protection-の機能もぜひご活用を"><a href="#3-Azure-AD-Identity-Protection-の機能もぜひご活用を" class="headerlink" title="3. Azure AD Identity Protection の機能もぜひご活用を"></a>3. Azure AD Identity Protection の機能もぜひご活用を</h2><p>上記の各種 Microsoft Authenticator の強化機能をすぐに導入することが難しい場合は、Azure AD Identity Protection の機能もぜひご活用ください。Azure AD Identity Protection の導入によって、リスクのあるサインイン パターンや侵害された可能性のあるユーザーが検知され、不正アクセスを防止することができます。</p><p>例えば攻撃者が、馴染みのない場所からのサインインを試み、MFA の実施に失敗した場合、攻撃対象のユーザーのアカウントは「ユーザー リスク有り」と判定されます。不正な MFA 要求を繰り返し発生させる攻撃者は、すでにユーザーのパスワードを把握しています。漏洩したパスワードを継続的に利用することは望ましくないので、まずはパスワードの変更が必要です。</p><p>管理者はユーザー リスクの検知を Azure ポータルから確認し、ユーザーにパスワード変更を要求することができます。パスワードをリセットすることで、攻撃者は古いパスワードを利用した攻撃ができなくなります。また、ユーザー リスクの評価値は自動で低減されます。</p><p>管理者によるリスクの確認およびパスワード変更の手間を省略したい場合、Azure AD Identity Protection の「ユーザー リスク ポリシー」を構成いただくことで、リスクのあるユーザーを自動でセルフサービス パスワード リセット (SSPR) に遷移させることもできます。</p><ul><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/identity-protection/howto-identity-protection-configure-risk-policies">公開情報: リスク ポリシーを構成して有効にする - Azure Active Directory Identity Protection</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/howto-conditional-access-policy-risk-user">公開情報: 条件付きアクセス - 危険なユーザーに対してパスワード変更を必須にする</a></li></ul><h2 id="強化された-Microsoft-Authenticator-の機能を試してみよう"><a href="#強化された-Microsoft-Authenticator-の機能を試してみよう" class="headerlink" title="強化された Microsoft Authenticator の機能を試してみよう"></a>強化された Microsoft Authenticator の機能を試してみよう</h2><p>以下では、Azure ポータルで強化された Microsoft Authenticator の機能を有効化 + 検証する手順をご紹介します。</p><ol><li><p>セキュリティ グループを作成</p><ul><li>管理者のアカウントで Azure ポータルにアクセスし、[Azure Active Directory] &gt; [グループ] から、新しいグループを作成します。グループの種類は “セキュリティ” を選択ください。</li><li>「数字の一致」機能を構成する対象のユーザーをグループのメンバーとして追加します。検証段階では、検証用ユーザーのみをグループに追加ください。<br>本説明内では “Number matching test” という表示名のセキュリティ グループを仮定します。</li></ul></li><li><p>Microsoft Authenticator の認証方法ポリシーを構成</p><ul><li><p>管理者のアカウントで Azure ポータルにアクセスし、下記に進みます。</p><p>  [Azure Active Directory] &gt; [セキュリティ] &gt; [認証方法] &gt; [ポリシー]</p></li><li><p>認証メソッド一覧から “Microsoft Authenticator” を選択します。[基本] タブの “有効にする” の現在の設定値が “いいえ” となっていることをご確認の上、以降の手順にお進みください。</p></li><li><p>[基本] タブの “有効にする” の設定値を “はい” にします。</p><p>  “ターゲット” では “ユーザーの選択” を選択し、”ユーザーとグループの追加” から “Number matching test” を選択します。</p></li><li><p>[構成] タブを開きます。</p></li><li><p>[プッシュ通知に番号の一致が必要] と [プッシュ通知とパスワードレス通知にアプリケーション名を表示する] と [プッシュ通知とパスワードレス通知に地理的な場所を表示する] それぞれの設定項目で、下記のように構成します。</p><ul><li>状態 : 有効</li><li>ターゲット - 含める : “Number matching test” グループを追加</li></ul></li></ul></li><li><p>該当のユーザーに対して MFA を有効化</p><p> 上記の Microsoft Authenticator の認証方法ポリシー設定は、MFA が要求された際のアプリ上での動作をカスタマイズする項目です。ユーザーに対しての MFA 要求の有効化は、別途構成する必要があります。MFA の有効化方法は複数ありますが、本記事では条件付きアクセス ポリシーによる有効化の手順を記載します。</p><ul><li><p> [Azure Active Directory] &gt; [セキュリティ] に進みます </p></li><li><p> [条件付きアクセス] &gt; [ポリシー] に進みます</p></li><li><p>[+ 新しいポリシー] を押下し、以下の内容でポリシーを構成します</p><ul><li><p>[名前] : 任意のポリシーの名前をご入力ください</p></li><li><p>[割り当て] : </p><ul><li>[ユーザーまたはワークロード ID] : “Number matching test” グループを指定</li><li>[クラウド アプリまたは操作] : “すべてのクラウド アプリ” もしくは何らかの特定のアプリケーションを指定</li></ul></li><li><p>[アクセス制御] :</p><ul><li>[許可] : アクセス権の付与 – “多要素認証を要求する” を選択</li></ul></li></ul></li><li><p>[ポリシーの有効化] を [オン] にし、[保存] を押して設定を反映します</p></li></ul><p> 上記を設定後、 “Number matching test” に所属するユーザーによって何らかのアプリケーションにアクセスいただくことで、強化された Microsoft Authenticator の MFA 機能が動作することをご確認ください。設定にあたってのご不明点やご相談事項などございましたら、弊社サポート チームまでお問い合わせください。</p></li></ol><h2 id="Q-amp-A-随時追記予定"><a href="#Q-amp-A-随時追記予定" class="headerlink" title="Q &amp; A (随時追記予定)"></a>Q &amp; A (随時追記予定)</h2><p>Q1. Microsoft Authenticator のアプリ上で発生したサインインで「数字の一致」による MFA を実施する際に、数字の表示画面 / 数字の入力プロンプト が重なってしまい、サインインの完了ができません。</p><p>A1. 一番下の “番号が表示されません” を選択ください。3 秒間のみ数字の入力プロンプトが非表示となり、MFA 認証用の数字が表示されます。<br><img src="/blog/azure-active-directory/defend-your-users-from-mfa-fatigue-attacks/cannotseethenumber.png">  </p><h2 id="おわりに"><a href="#おわりに" class="headerlink" title="おわりに"></a>おわりに</h2><p>Microsoft Authenticator の優れた点の 1 つは、今後もさらなる進化および多様化が懸念されるセキュリティ攻撃に対して、いち早く対応できるよう継続的に開発および投資を行っていることです。 Microsoft Authenticator が企業にとって、最も安全かつ便利で費用対効果の高い認証方法であり続けるために、今後もさらに多くの機能強化を続けて参ります。</p><p>各種 MFA 強化の機能の一般公開 (GA) にあたって、利用者の皆様の生のご意見やフィードバックはとても重要です。MFA 疲労攻撃に関する英語記事 (後述)、もしくは <a href="https://feedback.azure.com/d365community/forum/22920db1-ad25-ec11-b6e6-000d3a4f0789">Azure フィードバック サイト</a> まで、ぜひご意見をお寄せいただけますと幸いです。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>Microsoft Tech Community の記事は、新 -&gt; 古 の順で記載しております。</p><ul><li><a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/advanced-microsoft-authenticator-security-features-are-now/ba-p/2365673">(再掲) Advanced Microsoft Authenticator security features are now generally available! - Microsoft Tech Community | Published Oct 25 2022</a></li><li><a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/defend-your-users-from-mfa-fatigue-attacks/ba-p/2365677">(再掲) Defend your users from MFA fatigue attacks - Microsoft Tech Community | Published Sep 28 2022</a></li><li><a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/new-microsoft-authenticator-security-features-are-now-available/ba-p/2464386">New Microsoft Authenticator security features are now available! - Microsoft Tech Community | Published Nov 18 2021</a></li></ul><ul><li><a href="https://feedback.azure.com/d365community/forum/22920db1-ad25-ec11-b6e6-000d3a4f0789">Microsoft Azure  |  Share your Ideas - Azure Active Directory</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。Azure Identity サポート チームの栗井です。&lt;/p&gt;
&lt;p&gt;Microsoft Identity Security のディレクター Alex Weinert によって、昨今脅威が指摘されている MFA 疲労攻撃と、対策としての Microsoft </summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure Active Directory における危険なサインインへの対策</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/combatting-risky-sign-ins/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/combatting-risky-sign-ins/</id>
    <published>2023-02-13T00:00:00.000Z</published>
    <updated>2023-02-26T07:56:55.799Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 星野です。</p><p>本記事は、2023 年 1 月 30 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/combatting-risky-sign-ins-in-azure-active-directory/ba-p/3724786">Combatting Risky Sign-ins in Azure Active Directory</a>  を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>クラウドの利用が進む現代において、貴社のクラウド アプリケーションが悪意あるサインイン試行の標的となるのは、ほぼ避けられないことでしょう。従業員が業務用アカウントで使用したパスワードを個人アカウントでも使用しているケースはよくあります。仮に自社と関係のない組織からパスワードが漏えいした場合、E メール アドレスや UPN が異なっていても、貴社の従業員がパスワードの漏洩したアプリで同じパスワードを使用している場合は、脅威となりえます。より多くのアプリがクラウドに移行する中、このような悪意のあるサインイン試行を見逃さず、正しい対処をすることは必要不可欠となっています。Azure の ID 管理とアクセス制御のベストプラクティスについては、<a href="https://learn.microsoft.com/ja-jp/azure/security/fundamentals/identity-management-best-practices">こちらのリンク</a> を参照ください。</p><h2 id="リスク-レベルの把握"><a href="#リスク-レベルの把握" class="headerlink" title="リスク レベルの把握"></a>リスク レベルの把握</h2><p><a href="https://www.microsoft.com/ja-jp/security/business/identity-access/azure-active-directory-identity-protection">Azure AD Identity Protection</a> は、Azure AD P2 ライセンスを使用しているテナントの Azure AD で追加構成なく利用できるサービスです。<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/identity-protection/overview-identity-protection#required-roles">Azure AD P2 ライセンスがない場合</a>、Identity Protection の機能は制限付きで動作します。Azure AD Identity Protection は、匿名 IP アドレスの使用、特殊な移動、マルウェアにリンクされた IP アドレス、通常とは異なるサインイン プロパティ、漏洩した資格情報、パスワード スプレーなどのリスクを検出することができます。  </p><p>Identity Protection は、リスクのあるサインインごとに、低、中、高のいずれかのリスク レベルを割り当てます。リスク レベルが高いほど、Identity Protection はこのユーザーまたはサインインが侵害されている可能性が高いと判断します。</p><p>Identity Protection が作成するレポートは以下の 4 種類があります:</p><ul><li>危険なユーザー - リスクのあるユーザー、ユーザーのリスク履歴を集計。</li><li>危険なワークロード ID - サービス プリンシパルのリスク レベルを集計。</li><li>危険なサインイン - サインインのリスク レベル、サインイン情報 (デバイス、アプリケーション、場所など)、検出の種類を集計。  </li><li>リスク検出 - 過去 90 日間のリスク検出と検出の種類およびその他の詳細を集計。</li></ul><p>これらのレポートは、Azure Active Directoryの [セキュリティ] タブで確認することができます。図 1 は、危険なサインインのレポートです。サインインの一つをクリックすると、リスク レベルとそのサインインがリスクありと判断された理由の詳細が表示されます。図 2 では、このサインインのリスク レベルは「低」で、匿名の IP アドレスが使用されているため危険と分類されたことがわかります。</p><p><img src="/blog/azure-active-directory/combatting-risky-sign-ins/figure1.png" alt="図 1: リスクの高いサインイン レポート"></p><p><img src="/blog/azure-active-directory/combatting-risky-sign-ins/figure2.png" alt="図 2: リスクの高いサインインの詳細"></p><p>危険なユーザーのレポートは、危険と分類されたユーザーを表示します。図 3 は危険なユーザーのレポートで、図 4 はそのユーザーに関連する危険なサインインを示しています。危険なユーザーのレポートでユーザーをクリックすることで、ユーザーのパスワード リセット、危険なユーザーとしてのマーク、ユーザーのサインインのブロック、リスクの無視が可能です。ユーザーを危険とマークすると、そのユーザーのリスク レベルは「高」になり、Azure AD はそのユーザーを危険度「高」として扱います。これは、ユーザーのリスク レベルを条件として自動化を構成しているか、条件付きアクセス ポリシーを使用している場合に便利です。逆に、ユーザー リスクを無視すると、そのユーザーに関連するすべてのリスク レベルが削除されます。どちらのアクションも元に戻すことはできません。</p><p><img src="/blog/azure-active-directory/combatting-risky-sign-ins/figure3.png" alt="図 3: リスクのあるユーザー レポート"></p><p><img src="/blog/azure-active-directory/combatting-risky-sign-ins/figure4.png" alt="図 4: ユーザーに関連するリスクのあるサインイン"></p><p>Identity Protection がユーザーとサインインに設定するリスク レベルは、自動化されたアクションを実行する際にも活用できます。これを行うには、ユーザーとサインインに設定されたリスク レベル基づく条件付きアクセス ポリシーを作成します。たとえば、サインインしたユーザーのリスクレベルが「高」の場合、パスワードのリセットを強制的に実行するといったポリシーです。リスク レベルに基づく条件付きアクセス ポリシーに関する推奨事項については、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/identity-protection/howto-identity-protection-configure-risk-policies#microsofts-recommendation">こちら</a> を参照ください。</p><h2 id="危険なサインインを調査する"><a href="#危険なサインインを調査する" class="headerlink" title="危険なサインインを調査する"></a>危険なサインインを調査する</h2><p>危険なサインインを調査する際には、リスクのレベルを決定するいくつかの要素に注目ください。そのユーザーの過去のサインインに基づいて、サインインに異常な属性があるかどうかを理解することが重要です。たとえば以前のサインインを見ると、サインインしたアプリケーション、場所、デバイス、IP アドレス、ユーザー エージェントが同じような値になっているかどうかをご確認いただけます。サインインに使用されたデバイスが <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/devices/concept-azure-ad-join">Azure AD 参加済みデバイス</a> の場合や、 <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/devices/concept-azure-ad-join-hybrid">ハイブリッド Azure AD 参加済みデバイス</a> の場合は、デバイスを特定する情報も確認可能です。以下の事項を確認ください:</p><ul><li>このユーザーは、以前にもこの場所と IP アドレスからサインインしたことがあるか？</li><li>このユーザーは、以前にもこのアプリケーションにサインインしたことがあるか？</li><li>デバイスは Azure AD に登録されているか？</li><li>そのデバイスは「準拠済み」とマークされているか？</li></ul><p>サインインの詳細を調査することで、サインインの真のリスク レベルが明確になり、どのような対応を取るべきかがわかります。例えば、ロンドンに住む 1 名ユーザーから 2 種類のサインインが成功したとします。どちらのサインインも、匿名 IP アドレスを使用しているため、リスクレベルは「低」と認定されました。</p><table><thead><tr><th>属性</th><th>シナリオ 1</th><th>シナリオ 2</th></tr></thead><tbody><tr><td>サインインしたアプリケーション</td><td>Outlook モバイル</td><td>Azure ポータル</td></tr><tr><td>デバイス</td><td>iPhone</td><td>Windows 10</td></tr><tr><td>場所</td><td>スペイン マドリード</td><td>米国 コネチカット州</td></tr><tr><td>ユーザー エージェント</td><td>Mozilla/5.0 (iPhone; CPU iPhone OS 16_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148</td><td>Mozilla/5.0 (Windows NT 10.0; Microsoft Windows 10.0.9200; ja-US) PowerShell/7.1.0</td></tr><tr><td>Azure AD の状態</td><td>Azure AD登録済み</td><td>未参加</td></tr><tr><td>準拠済みデバイス</td><td>準拠済み</td><td>N/A</td></tr></tbody></table><p><strong>上記シナリオ 1</strong> より、ユーザーが iPhone から Outlook Mobile にサインインしたことがわかります。ユーザー エージェントは OS のバージョンに関する詳細な情報を提供します。この情報をより読みやすい形式に変換するツールがオンライン上で数多く提供されていますので、必要に応じご使用ください。また、このデバイスは Azure AD に登録されている、かつ準拠済みデバイスとわかります。匿名の IP アドレスが使用されているのは、Outlook Mobile へのサインイン時にユーザーがモバイルで VPN を使用していたためと思われます。おそらく危険なサインインではありませんが、念のためユーザーに確認を行うことが必要です。</p><p><strong>シナリオ 2</strong> では、Azure ポータルへのサインインが発生したことを示しています。このユーザーの仕事として Azure ポータルでの管理作業が含まれない限り、Azure ポータルへのサインインは疑わしいと判断できます。また、このデバイスは Azure AD に参加していません。ユーザー エージェントは、PowerShell を使用してサインインしたことを示しています。このサインインの真のリスク レベルを判断する前に、このユーザーが本当に侵害されているかどうか、さらに調査する必要があります。このユーザーが侵害されている場合、そのユーザーのセッションを失効させ、パスワードをリセットする必要があります。攻撃者が MFA 設定 (電話番号、アプリ登録、セカンダリの E メールなど) を変更した場合は、これらを削除し、ユーザー自身に MFA を再登録させるようにします。</p><h2 id="リスクの高いサインインの監視"><a href="#リスクの高いサインインの監視" class="headerlink" title="リスクの高いサインインの監視"></a>リスクの高いサインインの監視</h2><p>Azure AD のサインイン ログを <a href="https://learn.microsoft.com/ja-jp/azure/azure-monitor/logs/log-analytics-overview">Log Analytics</a> ワークスペースまたは <a href="https://learn.microsoft.com/ja-jp/azure/sentinel/overview">Microsoft Sentinel</a> に転送すると、<a href="https://learn.microsoft.com/ja-jp/azure/azure-monitor/logs/queries">ログを検索する</a> ことで更なる調査を行い、攻撃を追跡することができます。Sentinel の <strong>SigninLogs</strong> テーブルには、サインインのリスク レベルに関するデータが格納されています。次のクエリを実行すると、どのリスク検出の種類が最も多かったかを確認できます。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SigninLogs  </span><br><span class="line">| where RiskLevelDuringSignIn != &quot;none&quot;  </span><br><span class="line">| mv-expand todynamic(RiskEventTypes)  </span><br><span class="line">| summarize [&quot;Type Count&quot;] = count() by tostring(RiskEventTypes)  </span><br><span class="line">| sort by [&#x27;Type Count&#x27;] desc  </span><br><span class="line">| render columnchart with(title=&quot;Count of Risk Detection Type&quot;) </span><br></pre></td></tr></table></figure><p>リスクのあるサインインをレベルに基づいて分類し、サインインが成功したかどうかを確認するには、次のクエリを実行します。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SigninLogs  </span><br><span class="line">| where RiskLevelDuringSignIn != &quot;none&quot;  </span><br><span class="line">| extend ResultType = iif(ResultType == &quot;0&quot;, &quot;Successfull Logon&quot;, &quot;Failed Logon&quot;)  </span><br><span class="line">| summarize Count = count() by ResultType, RiskLevelDuringSignIn  </span><br><span class="line">| render columnchart with(title = &quot;Risk Levels Count per Successfull and Failed Sign-ins&quot;)  </span><br></pre></td></tr></table></figure><p>貴社においても上記のような悪意のあるサインインに直面することがあるでしょう。Azure AD Identity Protection を利用することで、ユーザーおよびサインインにリスク レベルを割り当て、悪意のあるサインインに対処することができます。さらに、改善のためのアクションを自動化し、収集されたリスクの詳細に関するデータを調査に生かすことが可能です。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 星野です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 1 月 30 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcom</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>MSOnline / AzureAD PowerShell から Graph PowerShell SDK への移行について 4_ユーザー管理</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement4/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement4/</id>
    <published>2023-02-12T00:00:00.000Z</published>
    <updated>2023-02-26T07:56:55.751Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure Identity サポート チームの小出です。</p><p>この記事は、この記事は、MSOnline / AzureAD モジュール廃止について、<a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement1/">1. 概要編</a>、<a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement2/">2. 移行導入編</a>、<a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement3/">3. インストール・接続編</a> の続きとして連載しています。</p><p>4 回目となる今回からは、具体的に、新しい Microsoft Graph PowerShell SDK を使用したユーザーの管理方法についてご案内します。以前、<a href="https://jpazureid.github.io/blog/azure-active-directory/operating-license-with-microsoft-graph/">こちらの記事</a> にて、ライセンス管理についてご案内させていただきましたが、今回はユーザー管理に特化してご紹介します。まだモジュールをインストールしていない場合や、 Connect-MgGraph コマンドを使用した接続方法が分からない場合などは、本シリーズの 2 と 3 をご確認ください。</p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ol><li><a href="#idx1">ユーザーの取得</a><ul><li><a href="#idx1-1">テナントの全ユーザーを取得したい</a></li><li><a href="#idx1-2">特定のユーザーを取得したい</a></li><li><a href="#idx1-3">ゲスト ユーザーのみを取得したい)</a></li><li><a href="#idx1-4">アカウントが有効なゲスト ユーザーのみを取得したい)</a></li><li><a href="#idx1-5">特定のユーザーの extensionAttribute の値を取得したい</a></li><li><a href="#idx1-6">削除済みユーザーを取得したい</a></li></ul></li><li><a href="#idx2">ユーザーの作成</a></li><li><a href="#idx3">ユーザーの削除</a></li><li><a href="#idx4">削除済みユーザーの完全削除と復元</a></li><li><a href="#idx5">ユーザーの属性を更新する</a></li><li><a href="#idx6">よくある質問</a></li></ol><hr><h2 id="idx1">1. ユーザーの取得</h2><p>これまでユーザー情報の取得にし使用していた Get-MsolUser や Get-AzureADUser コマンドは、 Get-MgUser コマンドに置き換えられます。ここでは様々なシナリオでユーザーを取得する方法についてご紹介します。</p><h3 id="idx1-1">テナントの全ユーザーを取得したい</h3><p>全てのユーザーを取得するには、-All オプションを使用します。Get-AzureADUser コマンドでは、-All $true とする必要がありましたが、新しいコマンドでは -All のみで動作します。-All を指定しない場合は、100 ユーザーなど一部の結果のみが返されます。 ユーザー数の非常に多い環境では -All オプションをつけると大量の結果が表示されますのでご注意ください。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgUser -All</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-1.png"></p><h3 id="idx1-2">特定のユーザーを取得したい</h3><p>これまでのコマンドと同様に、 ObjectID や UPN を指定することで取得が可能です。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgUser -UserId admin@m365x219253.onmicrosoft.com</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-2.png"></p><p>上記で気になった方もいると思いますが、Usertype の中身が空になっていることにお気づきでしょうか。Get-MsolUser コマンドや Get-AzureADUser コマンドでは、何も指定しなくても、すべての属性の情報が一括で出力されていました。</p><p> Microsoft Graph Powershell SDK では、属性によって下記のような特徴がある点を理解しておくと、「入れたはずの値が表示されない」といった混乱を避けることができます。</p><ul><li>Microsoft Graph PowerShell SDK にはバージョンがあり、v1.0 で取得できる属性値 beta でしか取得できない属性値がある</li><li>Property オプションを使用して明示的に指定しないと、結果に表示されないものがある</li></ul><p>そのため、たとえば下記のように実行すると、Usertype 属性が取得できるようになります。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgUser -UserId admin@m365x219253.onmicrosoft.com -Property Id,Displayname,Mail,UserPrincipalName,Usertype</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-3.png"></p><p>これは、| format-list を利用したときも同様で、| format-list 自体は新しいモジュールでも機能しますが、下記のように、必要な情報が出てこないことがあります。</p><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-4.png"></p><p>AccountEnabled に値が入っていない！と疑問に思うかもしれませんが、Usertype と同様に下記のように実行すると、AccountEnabled の値も取得することが可能です。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgUser -UserId 30a4a94b-9bca-4141-94d2-2dd0e2cc341b -Property Id,Displayname,Mail,UserPrincipalName,Usertype,AccountEnabled | fl</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-5.png"></p><p>もしくは、上記にて紹介した -Property オプションを使用したうえで、さらに Select を使用すると、表示される属性と値をカスタマイズできます。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgUser -UserId 2e7c8a97-ab50-4e53-b193-be3ff9ddc6aa -Property Id,Displayname,Mail,UserPrincipalName,Usertype,AccountEnabled | select displayname,accountenabled</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-6.png"></p><p>次に、-Filter オプションをはじめとするオプションを活用できます。よくお問い合わせをいただく取得方法についてご案内します。</p><h3 id="idx1-3">ゲスト ユーザーのみを取得したい</h3><p>特定の条件を満たすユーザーのみを取得したい場合は -Filter オプションを使用します。usertype が Guest となっているユーザーをフィルターして表示しています。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgUser -All  -Filter &quot;usertype eq &#x27;Guest&#x27;&quot; -Property Id,displayname,Mail,Userprincipalname,Usertype</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-7.png"></p><h3 id="idx1-4">アカウントが有効なゲスト ユーザーのみを取得したい</h3><p>-Filter の条件を 2 つ以上記載したいときは and でつなげると利用できます。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgUser -Filter &quot;accountEnabled eq true and usertype eq &#x27;Guest&#x27;&quot;</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-8.png"></p><h3 id="idx1-5">特定のユーザーの extensionAttribute の値を取得したい</h3><p>ExtensionAttribute1 などの属性は、ユーザーの onpremisesExtensionAttributes の配下に用意されているので、下記のように実行して取得します。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(get-mguser -UserId 4e6bc6e4-d6e7-4bd8-9079-3393e12dcec3).onpremisesExtensionAttributes | fl</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-9.png"></p><p>こちらは beta のみ対応しておりますので、Connect-MgGraph での接続後、本コマンド実行前に Select-Mgprofile -name beta にてベータに切り替えを実施ください。</p><h3 id="idx1-6">削除済みユーザーを取得したい</h3><p>削除済みのオブジェクトを取得するコマンドは、Get-MgDirectoryDeletedItem です。-DirectoryObjectID オプションに microsoft.graph.user と記載すると、削除されたユーザー オブジェクトが返されます (これらは、いわゆるごみ箱にある状態のユーザーで、30 日後に完全に削除されると参照できなくなります)。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(Get-MgDirectoryDeletedItem -DirectoryObjectId microsoft.graph.user).AdditionalProperties.value</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-10.png"></p><p>利用可能なパラメーターは Filter 以外にもありますが、各属性によってサポートされるオプションが異なります。下記のような公開情報を確認いただき、使用したい属性とオプションがサポートされているか、あらかじめご確認ください。</p><ul><li><a href="https://learn.microsoft.com/ja-jp/graph/api/resources/user?view=graph-rest-1.0#properties">user リソースの種類 - プロパティ</a></li><li><a href="https://learn.microsoft.com/ja-jp/graph/api/user-list?view=graph-rest-1.0&tabs=powershell#optional-query-parameters">ユーザーを一覧表示する - オプションのクエリ パラメーター</a></li></ul><h2 id="idx2">2. ユーザーの作成</h2><p>下記のように必要なパラメーターを記載して、 New-Mguser を使用すると新しいユーザーを作成できます。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$params = @&#123;</span><br><span class="line">AccountEnabled = $true</span><br><span class="line">DisplayName = &quot;Adele Vance22&quot;</span><br><span class="line">MailNickname = &quot;AdeleV22&quot;</span><br><span class="line">UserPrincipalName = &quot;AdeleV22@m365x61971868.onmicrosoft.com&quot;</span><br><span class="line">PasswordProfile = @&#123;</span><br><span class="line">ForceChangePasswordNextSignIn = $true</span><br><span class="line">Password = &quot;xWwvJ]6NMw+bWH-d11&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">New-MgUser -BodyParameter $params</span><br></pre></td></tr></table></figure><p>もしくは、下記のように直接 New-Mguser コマンド内で必要な情報を記載することも可能です。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$PasswordProfile = @&#123;</span><br><span class="line">  Password = &#x27;Passw0rd&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">New-MgUser -DisplayName &#x27;Rene Magi&#x27; -PasswordProfile $PasswordProfile -AccountEnabled -MailNickName &#x27;ReneMagi&#x27; -UserPrincipalName &#x27;ReneMagi@m365x61971868.onmicrosoft.com&#x27;</span><br></pre></td></tr></table></figure><p>以下の公開情報も併せてご確認ください。</p><ul><li><a href="https://learn.microsoft.com/ja-jp/powershell/module/microsoft.graph.users/new-mguser?view=graph-powershell-1.0">New-MgUser</a></li><li><a href="https://learn.microsoft.com/ja-jp/graph/api/user-post-users?view=graph-rest-1.0&tabs=http">ユーザーを作成する</a></li></ul><h2 id="idx3">3. ユーザーの削除</h2><p>Remove-MgUser コマンドにて削除可能です。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Remove-MgUser -UserId 282f0fb7-06a6-4a86-b3d5-01569d7393a1</span><br></pre></td></tr></table></figure><h2 id="idx4">4. 削除済みユーザーの完全削除と復元</h2><p>削除されたユーザーは、30 日間の間、削除済みユーザーとして一時的に保存されます。30 日以内であれば、誤って削除してしまった場合でもこれらのユーザーを復元することが可能です。復元したい場合、 Restore-MgDirectoryDeletedItem コマンドを使用します。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Restore-MgDirectoryDeletedItem -DirectoryObjectId 282f0fb7-06a6-4a86-b3d5-01569d7393a1</span><br></pre></td></tr></table></figure><p><a href="https://learn.microsoft.com/ja-jp/graph/api/directory-deleteditems-restore?view=graph-rest-1.0&tabs=http">削除済みアイテムを復元する</a> の公開情報も併せてご確認ください。</p><p>完全に削除したい場合、Remove-MgDirectoryDeletedItem コマンドを使用します。こちらのコマンドを実行すると、オブジェクトは完全に削除され復元できなくなるためご留意ください。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Remove-MgDirectoryDeletedItem -DirectoryObjectId 282f0fb7-06a6-4a86-b3d5-01569d7393a1</span><br></pre></td></tr></table></figure><p><a href="https://learn.microsoft.com/ja-jp/graph/api/directory-deleteditems-delete?view=graph-rest-1.0&tabs=powershell">アイテムを完全に削除する</a> の公開情報も併せてご確認ください。</p><h2 id="idx5">5. ユーザーの属性を更新する</h2><p>Update-Mguser コマンドを利用して更新が可能です。たとえばユーザーの displayname とその他のメール (Othermails) を更新したい場合は下記のように実行します。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Update-MgUser -UserId 2e7c8a97-ab50-4e53-b193-be3ff9ddc6aa -DisplayName test1228a -OtherMails @(&quot;bob@contoso.com&quot;, &quot;admin@m365x219253.onmicrosoft.com&quot;)</span><br></pre></td></tr></table></figure><p>一般的には上記のように、変更したい属性を指定して、新しい値を指定すれば更新できます。</p><p>時折ご質問をいただくものとして、extensionattribute 関連の属性を更新したいといったお問い合わせがよくあるため、以下に手順を例として案内します。 Extensionattribute の値を更新したい場合、事前に beta に切り替えてからコマンドを実行ください。</p><ol><li><p>Connect-MgGraph にて接続します。</p></li><li><p>beta バージョンへ切り替えます。</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Select-MgProfile -Name &quot;beta&quot;</span><br></pre></td></tr></table></figure></li><li><p>Get-Mguser コマンドを実行して、ユーザーの情報を取得します。</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(Get-MgUser -UserId 4e6bc6e4-d6e7-4bd8-9079-3393e12dcec3).onpremisesExtensionAttributes | fl</span><br></pre></td></tr></table></figure><p> 以下の画面では、ユーザーの ExtensionAttribute1 の値に test という文字列が入っていることが確認できます。</p><p> <img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-11.png"></p></li><li><p>以下のコマンドを実行して、たとえば ExtensionAttribute1 の値を test2 に更新します。</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Update-MgUser -UserId 4e6bc6e4-d6e7-4bd8-9079-3393e12dcec3 -OnPremisesExtensionAttributes @&#123;&quot;ExtensionAttribute1&quot;=&#x27;test2&#x27;&#125;</span><br></pre></td></tr></table></figure></li><li><p>値が test2 に更新されたことを確認します。</p><p> <img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-12.png"></p></li></ol><h2 id="idx6">6. よくある質問</h3><p>Q. Set-MsolUser コマンドで実施できた StrongAuthenticationRequirements の有効化や、StrongAuthenticationMethod を無効化する代替案はありますか？</p><p>A. いいえ、現状新しい Microsoft Graph PowerShell SDK では対応していません。<a href="https://learn.microsoft.com/ja-jp/graph/api/resources/authenticationmethods-overview?view=graph-rest-1.0">公開情報</a> にも記載があります。</p><blockquote><p>この機能は現在、StrongAuthenticationMethods プロパティを使用して、MSOLSet-MsolUser コマンドレットを使用してのみサポートされています。</p></blockquote><p>StrongAuthenticationMethod については <a href="https://learn.microsoft.com/en-us/graph/api/resources/authenticationmethods-overview?view=graph-rest-1.0">公開情報 (英語)</a> に記載があり、Microsoft Graph API (PowerShell SDK) を利用して、利用可能なすべての認証方法を個別に削除するというのが今後の正しい代替方法となります。</p><p>基本的なユーザー管理コマンドについて案内していますが、もし利用方法が不明なコマンドがございましたらお気軽にお問い合わせを起票ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure Identity サポート チームの小出です。&lt;/p&gt;
&lt;p&gt;この記事は、この記事は、MSOnline / AzureAD モジュール廃止について、&lt;a href=&quot;https://jpazureid.github.io/blog/azure-ac</summary>
      
    
    
    
    
    <category term="PowerShell" scheme="https://jpazureid.github.io/blog/tags/PowerShell/"/>
    
    <category term="Microsoft Graph" scheme="https://jpazureid.github.io/blog/tags/Microsoft-Graph/"/>
    
  </entry>
  
  <entry>
    <title>マルチテナントの Azure AD 組織におけるシームレスなアプリケーション アクセスおよびライフ サイクル管理</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/cross-tenant-sync-publicpreview/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/cross-tenant-sync-publicpreview/</id>
    <published>2023-02-05T15:00:00.000Z</published>
    <updated>2023-02-26T07:56:55.847Z</updated>
    
    <content type="html"><![CDATA[<div class="alert is-info"><p class="alert-title">Note</p><p>本記事は、2023 年 1 月 31 日に米国の Microsoft Entra (Azure AD) Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/seamless-application-access-and-lifecycle-management-for-multi/ba-p/3728752">Seamless Application Access and Lifecycle Management for Multi-tenant Azure AD Organizations</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p></div><p>こんにちは。</p><p>今日は、<strong>テナント間同期</strong> が <strong>パブリック プレビュー</strong> になったことをお知らせします。 </p><p>組織によっては、最近、新しい会社を買収したり、他の会社と合併したり、新しく設立された事業単位に基づき再編成されたりということがあるかと思います。組織が発展するにつれて、IT 部門は変化するニーズに対応するために適応が求められます。これには、既存の Azure Active Directory（Azure AD）テナントとの統合や、新しいテナントの作成も含まれるはずです。ID 基盤の管理方法にかかわらず、エンドユーザーがテナント間でリソースへのアクセスやコラボレーションをシームレスに体験できることがいかに重要であるかを弊社では認識しています。テナント間同期の機能により、マルチテナント環境においてシームレスなアクセスおよびコラボレーション体験を提供することができます。</p><p>現在では、カスタム スクリプトやオンプレミスのソリューションを使用してテナントをつなぎ合わせ、テナント間でシームレスなユーザー体験を提供しているかもしれません。あるお客様からは、組織内でコラボレーションを行う場合、次のようなことを望んでいるとお聞きしました。</p><ol><li><p>アプリケーションを組織内の異なるテナントでホストしている場合でも、ユーザーがアプリケーションにシームレスにアクセスできるようにしたい。</p></li><li><p>管理者がユーザーに代わって組織内のテナント間でデータを共有することに同意することで、ユーザーの目的を妨げるアクションを最小限に抑えたい。</p></li><li><p>カスタム スクリプトや自社開発ソリューションを使用せずに、テナント間で自動的にアカウントの同期を維持し、ユーザーが組織を離れた場合は、自動的にアカウントの削除をしたい。</p></li></ol><p>このようなシナリオを、Azure AD に組み込まれた機能で実現できるようになりました。テナント間同期を有効にすることで、組織内のテナント間でユーザー アカウントの作成を自動化できます。同期プロセスによって作成されたユーザーは、プライマリ テナントと同じように認証でき、各アプリケーションには、必要に応じて条件付きアクセス ポリシーを割り当てることもできます。これにより、組織全体のユーザーは、Microsoft アプリケーションや <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/saas-apps/servicenow-provisioning-tutorial">ServiceNow</a>、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/saas-apps/adobe-identity-management-provisioning-tutorial">Adobe</a> などの Microsoft 以外のアプリケーション、その他何百もの SaaS アプリケーションなど、それらがホストされているテナントに関係なくアプリケーションにアクセスできるようになりました。 </p><p>この同期プロセスは、堅牢な <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/external-identities/what-is-b2b">Azure AD B2B</a> 機能を活用し、条件付きアクセス、クロステナント アクセス設定、エンタイトルメント管理などの Azure AD のセキュリティおよびガバナンス機能と完全に統合されており、裏側でユーザーに対して透過的に実行されます。</p><h2 id="簡単な-3-ステップでテナント間同期を開始する"><a href="#簡単な-3-ステップでテナント間同期を開始する" class="headerlink" title="簡単な 3 ステップでテナント間同期を開始する"></a>簡単な 3 ステップでテナント間同期を開始する</h2><p>組織内でのテナントをまたがるアプリケーションへのアクセスをユーザーに提供するために、テナント間同期をどのように使用しているか、Contoso 社の例を挙げて説明します。</p><p>Contoso 社は、米国に拠点を置く製造業の会社です。最近、グローバル展開を図るため、ヨーロッパとアジアの企業を買収しました。それぞれの会社は、既存の Azure AD テナントを持っています。<br>Contoso US のユーザーは、新しく買収した Contoso EMEA とContoso APAC のテナントと統合されたアプリケーションにアクセスする必要があります。そのため、Contoso の IT 管理者は、コラボレーションを促進するために、テナント間の B2B ユーザーの作成を自動化するカスタム スクリプトを手作業で作成していました。しかし、残念ながら、このスクリプトはエラーが発生しやすく、Contoso の担当者一人だけがその仕組みを知っていました。</p><p>Contoso の IT 管理者は、テナント間同期の機能を知り、午後には同期を有効にし、カスタム スクリプトを廃止することができました。以下は、その方法です。</p><p><img src="/blog/azure-active-directory/cross-tenant-sync-publicpreview/cts1.jpg"></p><h3 id="ステップ-1-ターゲットテナントにおけるテナント間同期の有効化"><a href="#ステップ-1-ターゲットテナントにおけるテナント間同期の有効化" class="headerlink" title="ステップ 1 - ターゲットテナントにおけるテナント間同期の有効化"></a>ステップ 1 - ターゲットテナントにおけるテナント間同期の有効化</h3><p>Contoso APAC と Contoso EMEA の管理者は、すでにクロステナントのアクセス ポリシーを作成し、Contoso US のテナントからの多要素認証 (MFA) を信頼しています。管理者は、クロステナント アクセス ポリシーの画面に移動し、チェックボックスをクリックするだけで、テナント間同期を有効にすることができます。チェックボックスをクリックするだけで、ターゲット テナントの管理者は完了です。 </p><p>これまでカスタム スクリプトで行っていたアプリの認証情報やシークレットのローテーション管理は、もう必要ありません。</p><p><img src="/blog/azure-active-directory/cross-tenant-sync-publicpreview/cts2.jpg"></p><p><img src="/blog/azure-active-directory/cross-tenant-sync-publicpreview/cts3.jpg"></p><h3 id="ステップ-2-ソーステナントでテナント間同期を有効化する"><a href="#ステップ-2-ソーステナントでテナント間同期を有効化する" class="headerlink" title="ステップ 2 - ソーステナントでテナント間同期を有効化する"></a>ステップ 2 - ソーステナントでテナント間同期を有効化する</h3><p>Contoso US の管理者は、テナント間同期を有効にし、以下を指定します。 </p><ul><li>同期するユーザー (グループ メンバーシップに基づく)。</li><li>同期する属性 (名前、部署、ディレクトリの拡張属性など)。</li><li>表示名の末尾にドメインを追加するなど、必要な変換を行う。</li></ul><p>新規ユーザーは、テナント間で自動的にプロビジョニングされ、必要なアプリケーションにアクセスできるようになり、新しいテナントのリソースに初めてアクセスする際に同意のプロンプトが表示されることはありません。古いスクリプトで作成された既存の B2B ユーザーは、上記で指定されたルールに従って更新されます。 </p><h3 id="ステップ-3-テナント間同期を監視する"><a href="#ステップ-3-テナント間同期を監視する" class="headerlink" title="ステップ 3 - テナント間同期を監視する"></a>ステップ 3 - テナント間同期を監視する</h3><p>Contoso US の管理者は、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/reports-monitoring/concept-provisioning-logs">プロビジョニング ログ</a> を使用して、組織内のテナント間で作成されたすべてのユーザーを監視できます。さらに <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/app-provisioning/application-provisioning-log-analytics">Azure Monitor</a> を使用してデータを視覚化するためのカスタム ダッシュボードを作成することも可能です。以下のダッシュボードでは、Contoso US の管理者は、Contoso US テナントのユーザー Nestor がアクセス可能なすべてのテナントを確認できます。Nestorは、2 つのテナント (Contoso EMEA と Contoso APAC) と、彼が以前にプロビジョニングされたいくつかのアプリケーション (ServiceNow と Zscaler Two) へのアクセス権を持っています。Contoso の管理者は、テナント間同期が機能していることを確認できたので、カスタム スクリプトを廃止することができます。</p><p><img src="/blog/azure-active-directory/cross-tenant-sync-publicpreview/cts4.jpg">  </p><h2 id="お客様の声"><a href="#お客様の声" class="headerlink" title="お客様の声"></a>お客様の声</h2><p>DB Systel は、ドイツ国鉄の IT 子会社であり、デジタル パートナーとして、DB AG の全企業のデジタル化を推進しています。同社は、最高の IT 標準と革新的なトピックに基づいて、最適なソリューションとコンサルティング サービスを開発しています。これを実現するために、DB Systel は鉄道と IT に関する豊富な専門知識を活用しています。</p><p><strong>“テナント間同期により、当社のさまざまなテナントを接続し、すべてのマイクロソフト製品で従業員がよりシームレスに対話できるようになりました。また、オンプレミスでの専用アカウントが不要なため、運用コストの削減やテナントのセキュリティの向上にもつながります。弊社は、Azure AD のマルチテナント コラボレーション機能に全面的に信頼を寄せています。”</strong></p><p>組織内のテナント間でユーザー アカウントの作成を自動化することで、組織を改善するための他の方法の検討に時間を費やせることになります。パブリック プレビュー版では、テナント間の同期をさらに向上させるためのフィードバックをお待ちしています。</p><p>ぜひ今すぐテナント間同期をお試しください。これらの新機能に関するご意見は、<a href="https://aka.ms/AzureADFeedback">Azure フォーラム</a> または Twitter で <a href="https://twitter.com/azuread">@AzureAD</a> のタグを付けてお寄せください。  </p><p>Joseph Dadzie, Partner Director of Product Management<br>Linkedin: @joedadzie<br>Twitter: @joe_dadzie</p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;alert is-info&quot;&gt;&lt;p class=&quot;alert-title&quot;&gt;Note&lt;/p&gt;&lt;p&gt;本記事は、2023 年 1 月 31 日に米国の Microsoft Entra (Azure AD) Blog で公開された &lt;a href=&quot;https:</summary>
      
    
    
    
    
    <category term="B2B" scheme="https://jpazureid.github.io/blog/tags/B2B/"/>
    
    <category term="Azure AD B2B" scheme="https://jpazureid.github.io/blog/tags/Azure-AD-B2B/"/>
    
    <category term="Cross-Tenat Synchronization" scheme="https://jpazureid.github.io/blog/tags/Cross-Tenat-Synchronization/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD に IPv6 が導入されます</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/ipv6-coming-to-azuread/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/ipv6-coming-to-azuread/</id>
    <published>2023-01-22T01:00:00.000Z</published>
    <updated>2023-02-26T07:56:55.995Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 五十嵐 です。</p><p>本記事は、2023 年 1 月 10 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/ipv6-coming-to-azure-ad/ba-p/2967451">IPv6 Coming to Azure AD</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>企業ネットワーク、サービス プロバイダー、デバイスの間で IPv6 の導入とサポートが進む中、多くのお客様が、ユーザーが IPv6 クライアントや IPv6 ネットワークから自社のサービスやアプリケーションに引き続きアクセスできるのかどうか、疑問に思われていることでしょう。</p><p>本日、Microsoft Azure Active Directory (Azure AD) に IPv6 のサポートを導入する計画を発表することができ、大変うれしく思います。これにより、お客様は IPv4、IPv6、またはデュアル スタックのエンドポイントを介して Azure AD サービスにアクセスできるようになります。 </p><p>ほとんどのお客様にとって、IPv4 が IT 環境から完全に消えることはないと思われます。そのため、<strong>Azure AD の機能やサービスにおいて IPv6 を必須としたり、IPv4 の優先順位を下げたりすることは計画していません</strong>。しかし、このブログの推奨事項にのっとり、<a href="https://aka.ms/azureadipv6">こちらのリンク</a> から最新のガイダンスを確認することで、IPv6 サポートにむけた計画および準備を始めることが重要です。</p><p>Azure AD サービスへの IPv6 サポートの導入は、<strong>2023 年 3 月 31 日</strong> から段階的に開始される予定です。 </p><p>IPv6 アドレスを使用していることに加え、条件付きアクセス ポリシーでネームド ロケーションを使用している Azure AD のお客様に向けたガイダンスを以下に記載します。 </p><p><strong>組織内の特定のネットワーク境界を識別するために <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/location-condition">ネームド ロケーション</a> を使用しているお客様は、以下のことを行う必要があります。</strong></p><ol><li>既存のネームド ロケーションの監査を実施し、潜在的な影響を予測する。</li><li>ネットワーク パートナーと協力して、お客様の環境で使用されている外向きの IPv6 アドレスを特定する。</li><li>既存の <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/location-condition#ip-address-ranges">ネームド ロケーション</a> を見直して、確認した IPv6 範囲を含める。</li></ol><p><strong>特定のネットワークからのアプリへのアクセスを制限し、保護するために、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/location-condition">場所に基づく条件付きアクセス ポリシー</a> を使用しているお客様は、以下のことを行う必要があります。</strong></p><ol><li>既存の条件付きアクセス ポリシーの監査を実施し、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/location-condition">ネームド ロケーション</a> を使用している場合は、潜在的な影響がないかを確認する。</li><li>既存の <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/location-condition">場所に基づく条件付きアクセス ポリシー</a> を見直して、組織のセキュリティ要件を引き続き満たすようにする。</li></ol><p>Azure AD における IPv6 の有効化に関する追加のガイダンスを引き続き共有するために、覚えやすいリンクを作成しました。これらの詳細については、こちら (<a href="https://aka.ms/azureadipv6">https://aka.ms/azureadipv6</a>) にアクセスください。なお、日本語の情報は <a href="https://learn.microsoft.com/ja-jp/troubleshoot/azure/active-directory/azure-ad-ipv6-support">こちら</a> をご確認ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 五十嵐 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 1 月 10 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techc</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>ゲスト ユーザーの棚卸をする方法</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/GuestUser-Inventory/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/GuestUser-Inventory/</id>
    <published>2023-01-22T00:00:00.000Z</published>
    <updated>2023-02-26T07:56:55.647Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure ID チームの小出です。今日は、ゲスト ユーザーの棚卸をする方法について紹介します。</p><h2 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h2><p>多くの企業のテナントでは、外部のユーザーと一緒に Teams 会議をしたり、外部のユーザーがプロジェクトで使用するリソースにアクセスしたりできるよう、外部のユーザーをテナントにゲスト ユーザーとして招待していると思います。ゲスト ユーザーは、一般ユーザーでも Azure ポータル上から簡単に招待することができますが、ゲスト ユーザーが増えるにつれて、こんな不安をお持ちのテナント管理者もいらっしゃると思います。  </p><ul><li>不要なゲスト ユーザーを削除したいが、誰を削除したらいいかわからない。</li><li>一定期間サインインのないゲスト ユーザーを棚卸したいが、最終サインイン日時がわからない。</li><li>ゲスト ユーザーが大量にいるため、確認に工数がかかっている。棚卸を自動化したい。</li></ul><p>上記のような不安を解消するために、今回は、ゲスト ユーザーを棚卸するための機能として、アクセス レビューとゲスト ユーザーの最終サインイン日時を取得する方法の 2 つを紹介します。</p><p>なお、アクセス レビューをご利用いただくためには、Azure AD Premium P2 ライセンスが必要となります。少なくとも、レビュー担当者として割り当てられているユーザーに P2 ライセンスの割り当てが必要です。詳細については、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/governance/access-reviews-overview#how-many-licenses-must-you-have">こちらの資料</a> をご覧ください。</p><span id="more"></span><h3 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h3><ol><li><a href="#idx1">A. アクセス レビューを使用して一定期間サインインのないユーザー アカウントを自動的に棚卸する方法</a><ul><li><a href="#idx1-1">アクセス レビューの作成手順</a></li><li><a href="#idx1-2">アクセス レビューの実施 (セルフ レビュー編)</a></li><li><a href="#idx1-3">アクセス レビューの実施 (管理者編)</a></li></ul></li><li><a href="#idx2">B. ゲスト ユーザーの最終サインイン日時を取得する方法</a></li></ol><h2 id="idx1">A. アクセス レビューを使用して一定期間サインインのないユーザー アカウントを自動的に棚卸する方法</h2><p>アクセス レビューは、特定のグループやアプリケーションに割り当てられたユーザーを対象に、グループのメンバーシップやアプリケーションの割り当てに問題がないか (不要なユーザーに割り当てが行われていないか) を定期的に確認できる機能です。</p><p>1 回もしくは定期的に行われるレビューでは、レビューを行う管理者ユーザー (以下、レビュー担当者) が、レビュー内で各ユーザーに対し、[許可] もしくは [拒否] を設定します。詳細は後述しますが、レビュー担当者はレビュー内で各対象ユーザーの最終サインイン日時 (=最終利用日時) を確認することが可能ですので、そちらをもとに割り当ての「許可」「拒否」を選択します。</p><p>レビューで拒否が選択された場合、たとえばグループから自動的にユーザーを削除したり、アプリケーションから割り当てを自動的に削除したりすることができます。さらには 30 日間アカウントを無効化 (サインインをブロック) したのちにユーザーを自動的に削除することも可能です。</p><p>このアクセスレビュー機能を応用してゲスト ユーザーの棚卸を行いますが、実際のところレビューを行う管理者は不特定多数のゲスト ユーザーについて 1 人 1 人アクセスの要否を判断することは困難です。そのため、今回はゲスト ユーザー自身にセルフレビューを依頼し、アクセス権の継続が必要な場合のみ [許可] してもらいます。アクセス権が不要になったゲスト ユーザーは自ら [拒否] を選択することも、レビュー自体を無視することも可能です。(レビューを無視した場合は [拒否] 扱いとすることが可能です。)</p><p>以下の手順にてレビューを作成すると、レビューで拒否が設定されたゲスト ユーザーは自動的に無効化され、 30 日後にテナントから自動的に削除されます。</p><h3 id="idx1-1">アクセス レビューの作成手順</h3><ol><li><p>Azure ポータルにサインインし、 [Azure Active Directory] - [Identity Governance] を開きます。もしくは、ポータル上の検索ボックスより、[Identity Governance] を開きます。</p><p> <img src="/blog/azure-active-directory/GuestUser-Inventory/1_access_IdentityGovernance.png"></p></li><li><p>左ペインにて [アクセス レビュー] をクリックし、 [+ 新しいアクセス レビュー] を選択します。</p><p> <img src="/blog/azure-active-directory/GuestUser-Inventory/2_select_AccessReview.png"></p></li><li><p>レビュー対象を指定します。たとえば、 特定のグループを対象にゲスト ユーザーのレビューを行いたい場合は、以下のように指定します。</p><p> 手順1: [チームとグループ] を選択します。<br> 手順2: [チームとグループの選択] を選択し、ゲスト ユーザーが所属しているグループを選択します。<br> 手順3: [ゲスト ユーザーのみ] を選択します。  </p><p> <img src="/blog/azure-active-directory/GuestUser-Inventory/3_create_review1.png"></p><p> 手順 2 ではレビュー対象のグループを指定します。ゲスト ユーザーは既存の業務用セキュリティ グループ (例: プロジェクト A グループ) に参加させることが一般的かと思います。この場合、既存の業務用セキュリティ グループを手順 2 で選択しつつ、手順 3 では [ゲスト ユーザーのみ] を選択すればレビュー対象をゲスト ユーザーのみに限定することが可能です。</p><div class="alert is-warning"><p class="alert-title">警告</p><p>なお、手順 2 で[ゲスト ユーザーを含むすべての Mcirosoft 365 グループ] を選択すると、後述の手順にて [拒否されたゲスト ユーザーに適用するアクション] が構成できません。そのためこの項目では [チームとグループの選択] を使用します。</p></div><div class="alert is-success"><p class="alert-title">ヒント</p><p>ゲスト ユーザーを既存の業務用セキュリティグループに参加させていない場合は、ゲスト ユーザー全員を含む動的グループを利用する方法もあります。具体的には <code>(user.userType -eq &quot;Guest&quot;)</code> のルールで動的グループを作成すると、ゲスト ユーザー全員がメンバーに含まれるグループが作成されます。以下では本グループを手順 2 で指定します。  </p></div><p> 動的グループの作成方法の詳細は、本記事では省略しております。以下の公開情報をご確認ください。</p><p> <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/enterprise-users/groups-create-rule#to-create-a-group-membership-rule">グループ メンバーシップ ルールを作成するには</a></p><p> <img src="/blog/azure-active-directory/GuestUser-Inventory/4_DynamicGroup_forGuest.png"></p><div class="alert is-success"><p class="alert-title">ヒント</p><p> 非アクティブなユーザーのみを、アクセス レビューの対象とすることもできるようになりました。新機能を利用したい場合は、下記チェックをオンにしたうえで、どれくらいサインインのないユーザーをレビューの対象とするか、日付を指定します。</p><p><img src="/blog/azure-active-directory/GuestUser-Inventory/15_inactiveuser_available.png"></p></div></li><li><p>必要に応じて、レビュー担当者と繰り返しの設定を行います。以下の画面では、半年ごとに、ゲスト ユーザー自身がレビューを行うよう設定しています。</p><p> <img src="/blog/azure-active-directory/GuestUser-Inventory/5_create_review2.png"></p><ul><li>管理者のレビューへの負担を最小限にしたい場合は、本手順のように [レビュー担当者を選択する] にて [ユーザーによる自分のアクセスのレビュー] を選択し、 ゲスト自身がセルフ レビューを行うよう構成します。</li><li>ゲスト自身ではなく、特定のユーザーが一括でレビューを管理したい場合は、 [ユーザーまたはグループが選択済み] を選択してレビュー担当者を個別に指定することも可能です。また、[グループの所有者] を選択して、グループの所有者をレビュー担当者とする構成も実現できます。</li><li>上記の設定では、14 日間有効なレビューが半年ごとに繰り返し実行されます。レビューの依頼をうけたゲスト ユーザーは 14 日間 (2 週間) 以内にレビューに対して応答する必要があります。</li></ul><div class="alert is-success"><p class="alert-title">ヒント</p><p>複数ステージのアクセス レビューも実施できるようになりました。最大 3 段階のステージでレビューを行うことができます。たとえば第 1 ステージでセルフ レビューを行い、第 2 ステージ以降で所有者および管理者によるレビューを行うことも可能です。</p><p><img src="/blog/azure-active-directory/GuestUser-Inventory/16_multistage_available.png"></p></div></li><li><p>アクセス レビューの設定を行います。</p><p> <img src="/blog/azure-active-directory/GuestUser-Inventory/6_create_review3.png"></p><p> 自動的に棚卸を行うために、 [リソースへの結果の自動適用] を [有効] に設定します。また、[レビュー担当者が応答しない場合] の設定を [アクセスの削除] に設定します (管理者がレビューを行う場合は、 [アクセスの削除] もしくは  [推奨事項の実行] に設定します。)</p><p> レビューで拒否されたゲスト ユーザーをブロックし、30 日後にテナントから削除されるようにするためには、[拒否されたゲスト ユーザーに適用するアクション] の項目で、[ユーザーのサインインを 30 日間ブロックした後、テナントからユーザーを削除します] を選択します。</p><p> 主な設定項目の説明と、指定する際の判断基準は以下の通りです。</p><table><thead><tr><th>項目</th><th>説明</th></tr></thead><tbody><tr><td>[リソースへの結果の自動適用]</td><td>レビュー完了後、自動で結果を反映させたい場合は [有効] にします。</td></tr><tr><td>[レビュー担当者が応答しない場合]</td><td>レビュー担当者がレビューを行わなかったユーザーに対し、どのような処理を行うか指定します。</td></tr><tr><td>[拒否されたゲスト ユーザーに対するアクション]</td><td>ゲスト ユーザーが拒否された場合の動作を指定します。</td></tr></tbody></table><table><thead><tr><th>[レビュー担当者が応答しない場合] の選択肢</th><th>説明</th></tr></thead><tbody><tr><td>[変更なし]</td><td>レビュー担当者が応答しない場合、特に何も実行されません。</td></tr><tr><td>[アクセスの削除]</td><td>レビュー担当者が [拒否] を設定した時と同様の処理が行われます。実際に行われる処理は、以下の [拒否されたゲスト ユーザーに対するアクション] によって決定されます。</td></tr><tr><td>[アクセスを承認する]</td><td>レビュー担当者が [許可] を設定した時と同様の処理が行われます。そのため、引き続きグループのメンバーシップが維持されます。</td></tr><tr><td>[推奨事項の実行]</td><td>システム上で算出される推奨事項が実行されます。具体的には、 30 日以内にサインインがあれば [許可] 、 30 日以内にサインインがなければ [拒否] が選択される動作となります。    また、 [拒否] が選択されたユーザーに対して行われる処理は、[拒否されたゲスト ユーザーに対するアクション] によって決定されます。</td></tr></tbody></table><table><thead><tr><th>[拒否されたゲスト ユーザーに対するアクション] の選択肢</th><th>説明</th></tr></thead><tbody><tr><td>[リソースからユーザーのメンバーシップを削除]</td><td>レビュー対象のグループから、メンバーが削除されます。またはアプリケーションへのアクセス権が削除されます。ユーザー自体は特に影響を受けないため、テナントには引き続きサインインできます。</td></tr><tr><td>[ユーザーが 30 日間サインインできないようにしてから、テナントからユーザーを削除する]</td><td>他のリソースへのアクセス権を持っているかどうかに関係なく、拒否されたユーザーによるテナントへのサインインがブロックされます。    また、 30 日後にテナントからゲスト ユーザーが削除されます。</td></tr></tbody></table></li><li><p>レビュー名と説明を記入し、アクセスレビューを作成します。</p><p> <img src="/blog/azure-active-directory/GuestUser-Inventory/7_create_review4.png"></p></li></ol><h3 id="idx1-2">アクセス レビューの実施 (セルフ レビュー編)</h2><ol><li><p>アクセス レビューが開始されると、レビュー対象者の元に <a href="mailto:&#97;&#122;&#x75;&#x72;&#101;&#x2d;&#110;&#111;&#x72;&#101;&#112;&#108;&#x79;&#64;&#109;&#105;&#99;&#x72;&#111;&#115;&#111;&#102;&#116;&#46;&#99;&#x6f;&#109;">&#97;&#122;&#x75;&#x72;&#101;&#x2d;&#110;&#111;&#x72;&#101;&#112;&#108;&#x79;&#64;&#109;&#105;&#99;&#x72;&#111;&#115;&#111;&#102;&#116;&#46;&#99;&#x6f;&#109;</a> からメールが届くので、[レビューを開始する（Review Access）] をクリックします。  </p><p> <img src="/blog/azure-active-directory/GuestUser-Inventory/8_selfReview1.png"></p></li><li><p>以下のような画面が表示されるので、セルフ レビューを実施します。  </p><p> <img src="/blog/azure-active-directory/GuestUser-Inventory/9_selfReview2.png"></p></li><li><p>画面が以下のように遷移します。 Progress の項目が 1/1 と表示されていることを確認します。  </p><p> <img src="/blog/azure-active-directory/GuestUser-Inventory/10_selfReview3.png"></p></li><li><p>指定した日付が経過するなどしてレビューが完了すると、[自動適用] が有効な場合は、自動的に [拒否されたゲスト ユーザーに対するアクション] が実行されます。</p></li></ol><p>たとえば、[ユーザーが 30 日間サインインできないようにしてから、テナントからユーザーを削除する] を設定した場合、拒否したユーザーの [サインインのブロック] が [はい] になります。この状態では、まだユーザーは削除されませんが、ユーザーはポータル上にサインインできない状態となります。また、このあと 30 日経過すると、そのゲスト ユーザーはテナントから削除されます。</p><h3 id="idx1-3">アクセス レビューの実施 (管理者編)</h2><p>上記まではゲスト ユーザー自身にレビューを実施してもらう手順となりますが、もしゲスト ユーザーの数が少ない場合などは管理者が代表してレビューを行うことも可能です。この場合の手順を後述します。</p><ol><li><p>アクセス レビューが開始されると、レビュー対象者の元に <a href="mailto:&#97;&#122;&#x75;&#114;&#x65;&#45;&#x6e;&#111;&#x72;&#x65;&#x70;&#x6c;&#x79;&#x40;&#x6d;&#105;&#x63;&#114;&#111;&#x73;&#x6f;&#x66;&#x74;&#x2e;&#x63;&#x6f;&#x6d;">&#97;&#122;&#x75;&#114;&#x65;&#45;&#x6e;&#111;&#x72;&#x65;&#x70;&#x6c;&#x79;&#x40;&#x6d;&#105;&#x63;&#114;&#111;&#x73;&#x6f;&#x66;&#x74;&#x2e;&#x63;&#x6f;&#x6d;</a> からメールが届くので、[レビューを開始する] をクリックします。</p><p> <img src="/blog/azure-active-directory/GuestUser-Inventory/11_adminreview1.png"></p></li><li><p>ユーザーの状況を確認します。各ユーザーを選択すると、 [承認する] と [拒否] がクリックできるようになるので、承認もしくは拒否を指定します。</p></li><li><p>[決定] の項目に、レビューを行った際の承認・拒否の値が表示されることを確認します。</p><p> <img src="/blog/azure-active-directory/GuestUser-Inventory/12_adminreview2.png"></p></li><li><p>指定した日付が経過するなどしてレビューが完了すると、[自動適用] が有効な場合は、自動的に [拒否されたゲスト ユーザーに対するアクション] が実行されます。</p></li></ol><p>アクセス レビューに関する以下の公開情報も、併せてご確認ください。  </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/governance/access-reviews-external-users#disable-and-delete-external-identities-with-azure-ad-access-reviews">Azure AD アクセス レビューを使用して外部 ID の無効化および削除を行う</a>  </li><li><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/governance/create-access-review">アクセスレビュー作成手順</a></li></ul><h2 id="idx2">B. ゲスト ユーザーの最終サインイン日時を取得する方法</h2><p>アクセス レビューを使用した棚卸についてご案内しましたが、この機能を利用するためには、 Azure AD Premium P2 ライセンスが必要です。そのため、 Azure AD Premium P1 ライセンスまでのみお持ちの環境では、上記の機能を利用することができません。</p><p>棚卸を完全に自動化したい場合は、Azure AD Premium P2 ライセンスの購入を検討する必要がありますが、一定期間サインインのないユーザーを抽出するのみであれば、以下の Github リポジトリに記載のスクリプトを使用することで、ユーザーの最終サインイン日時を取得することが可能です。</p><p><a href="https://jpazureid.github.io/blog/azure-active-directory/azure-ad-get-lastSignInDateTime/">最終サインイン日時を一括で取得する方法</a></p><p>このスクリプトを利用するためには、アプリケーションの登録などの事前準備が必要です。必要な手順につきましては、以下にて詳細をご案内しておりますので、こちらも併せてご参照ください。</p><p><a href="https://github.com/jpazureid/get-last-signin-reports/tree/use-signin-activity-beta-api">アプリケーションの登録手順</a></p><p>スクリプトを実行すると CSV ファイルが出力され、以下のように、ユーザーの ID、UPN、最終サインイン日時、アプリケーション情報を順に確認できます。LastSingInDateUTC は、対話型の最終サインイン日時です。LastNonInteractiveSigninDateUTC は、非対話型の最終サインイン日時となります。</p><p>実行結果:</p><p><img src="/blog/azure-active-directory/GuestUser-Inventory/13_lastsignin1.png"></p><p>なお、上記にてダウンロードしたスクリプトでは、ゲスト ユーザーのみならず、テナントに登録されているすべてのユーザーの情報が取得されます。そのため、取得対象をゲスト ユーザーのみにしたい場合は、Get-LastSignIn.ps1 のスクリプトの 48 行目を、以下のように修正してから実行ください。  </p><p>修正箇所:</p><p><img src="/blog/azure-active-directory/GuestUser-Inventory/14_lastsignin2.png"></p><p>修正前:</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = <span class="built_in">Get-MgUser</span> <span class="literal">-All</span> <span class="literal">-Property</span> id, userPrincipalName, signInActivity</span><br></pre></td></tr></table></figure><p>修正後:</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = <span class="built_in">Get-MgUser</span> <span class="literal">-All</span> <span class="literal">-Property</span> id, userPrincipalName, signInActivity <span class="literal">-Filter</span> <span class="string">&quot;usertype eq &#x27;Guest&#x27;&quot;</span></span><br></pre></td></tr></table></figure><p>上記手順で 30 日以上サインインしていないゲスト ユーザーを手動で抽出し、必要に応じて、削除処理などを実施いただければと思います。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは、 Azure ID チームの小出です。今日は、ゲスト ユーザーの棚卸をする方法について紹介します。&lt;/p&gt;
&lt;h2 id=&quot;はじめに&quot;&gt;&lt;a href=&quot;#はじめに&quot; class=&quot;headerlink&quot; title=&quot;はじめに&quot;&gt;&lt;/a&gt;はじめに&lt;/h2&gt;&lt;p&gt;多くの企業のテナントでは、外部のユーザーと一緒に Teams 会議をしたり、外部のユーザーがプロジェクトで使用するリソースにアクセスしたりできるよう、外部のユーザーをテナントにゲスト ユーザーとして招待していると思います。ゲスト ユーザーは、一般ユーザーでも Azure ポータル上から簡単に招待することができますが、ゲスト ユーザーが増えるにつれて、こんな不安をお持ちのテナント管理者もいらっしゃると思います。  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;不要なゲスト ユーザーを削除したいが、誰を削除したらいいかわからない。&lt;/li&gt;
&lt;li&gt;一定期間サインインのないゲスト ユーザーを棚卸したいが、最終サインイン日時がわからない。&lt;/li&gt;
&lt;li&gt;ゲスト ユーザーが大量にいるため、確認に工数がかかっている。棚卸を自動化したい。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;上記のような不安を解消するために、今回は、ゲスト ユーザーを棚卸するための機能として、アクセス レビューとゲスト ユーザーの最終サインイン日時を取得する方法の 2 つを紹介します。&lt;/p&gt;
&lt;p&gt;なお、アクセス レビューをご利用いただくためには、Azure AD Premium P2 ライセンスが必要となります。少なくとも、レビュー担当者として割り当てられているユーザーに P2 ライセンスの割り当てが必要です。詳細については、&lt;a href=&quot;https://learn.microsoft.com/ja-jp/azure/active-directory/governance/access-reviews-overview#how-many-licenses-must-you-have&quot;&gt;こちらの資料&lt;/a&gt; をご覧ください。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="B2B" scheme="https://jpazureid.github.io/blog/tags/B2B/"/>
    
    <category term="Access review" scheme="https://jpazureid.github.io/blog/tags/Access-review/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD が提供するパスワードレスのユーザー体験</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/end-user-passwordless-utopia/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/end-user-passwordless-utopia/</id>
    <published>2023-01-07T03:00:00.000Z</published>
    <updated>2023-02-26T07:56:55.859Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 竜 です。</p><p>本記事は、2022 年 12 月 15 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/end-user-passwordless-utopia/ba-p/2144517">End user passwordless utopia</a> を意訳したものになります。</p><hr><p>Azure と Azure Active Directory (Azure AD) で利用できる技術はたくさんありますが、全体像を把握し、それらがどのようにエンドユーザーのユーザー体験に作用するという全体像については見逃しがちです。</p><p>Azure AD で利用できる技術には以下があります: </p><ul><li>Azure AD</li><li>多要素認証 (MFA: multi-factor authentication)</li><li>パスワードレス認証</li><li>条件付きアクセスおよび認証強度</li><li>デバイス登録</li><li>プライマリ更新トークン (PRT: Primary Refresh Token)</li><li>エンタープライズ アプリ / シングル サインオン (SSO)</li><li>Intune</li><li>Autopilot</li><li>一時アクセス パス</li></ul><p>上記の中には、利便性を促進する機能もあればセキュリティを強化する機能もあります。これらの技術を使用することで、ユーザーの認証負担を軽減し、セキュリティを強化することができます。 </p><p>弊社の目標は、パスワードや資格情報のプロンプトや従来の MFA プロンプト無しに、安全性を維持しながらデバイスを使用し、企業のアプリケーションやデータにアクセスする方法を示すことです。</p><p>まずは、弊社が取り組んでいる 2 つの問題からお話しします。</p><p><strong>1. 認証疲労</strong></p><p>私たちは、ユーザーとして、20 年以上にわたり、デバイスがユーザー名とパスワードの入力プロンプトを表示する度に、それらを入力するよう促されてきました。これは、まさに攻撃者がユーザーをフィッシングするのに利用している手法です。攻撃者は、偽のサインイン ページに誘導するリンクをユーザーに送り、そこでユーザーが認証情報を入力するよう促します。</p><p><strong>2. MFA 疲労</strong>  </p><p>Microsoft の <a href="https://www.microsoft.com/en-us/security/blog/2019/08/20/one-simple-action-you-can-take-to-prevent-99-9-percent-of-account-attacks/">統計</a> によると、Azure AD で侵害されたアカウントの 99.9% は、MFA を強制していないアカウントでした。</p><p>MFA が構成されているエンド ユーザーであっても侵害するため、攻撃者はその手法を変更せざるを得なくなりました。ユーザーは、携帯電話に表示された MFA プロンプトに従って行動することが想定されます。攻撃者は、この行動を悪用してアカウントを侵害しようとします。ユーザーの認証情報が漏洩し、攻撃者が狙いすましたタイミングで多数の MFA プロンプトをユーザーに送信すると、ユーザーが誤って「承認」をクリックしてしまう可能性があります。これは、MFA フィッシングとして知られています。</p><p>Microsoft Authenticator の <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/how-to-mfa-number-match">番号の一致機能</a> により、この問題を軽減することができます。MFA プロンプトが表示されたら、ユーザーはコンピュータの画面に表示された番号を認証アプリのプロンプトに入力します。コンピューターの認証画面上にプロンプトが表示されていないのにも関わらず、Authenticator アプリ上でこのプロンプトが表示された場合、ユーザーは番号を入力できないため、ユーザーが誤って「承認」することとはできず、MFA フィッシングに遭う可能性は大幅に減少します。</p><h2 id="解決方法"><a href="#解決方法" class="headerlink" title="解決方法"></a>解決方法</h2><p>Azure AD に登録されたクラウド アプリや、アプリケーション プロキシを経由したオンプレミス アプリの利用に、パスワードレス認証を組み合わせて使用することで、これらの問題に対処できます。 </p><p>企業が管理するデバイスからであれば、ユーザーはユーザー名やパスワードの入力やを求められたり、携帯電話で MFA のプロンプトや電話、SMS による認証を行うことなく、これらのアプリケーションにアクセスすることができます。 </p><p>詳細の説明の前に、このシナリオを図で表したものが以下です。「ハイブリッド Azure AD 参加」および「Azure AD 参加」したデバイスのどちらでも同じ流れとなります。</p><p>注: 今回の説明では、ドメイン コントローラーへの認証フローは省略します。</p><p>クラウド アプリケーションにアクセスする際の SSO フローの概要:</p><p><img src="/blog/azure-active-directory/end-user-passwordless-utopia/1.png"></p><table><thead><tr><th>ステップ</th><th>説明</th></tr></thead><tbody><tr><td>A</td><td>ユーザーが Windows Hello for Business を使用して、PIN、生体認証、または FIDO2 キーを使用し、デスクトップまたはノート PC にサインインします。</td></tr><tr><td>B</td><td>コンピューターがユーザーを認証すると、次に Azure AD へのサインインを試みます。デバイスがハイブリッド Azure AD 参加しているか、Azure AD 参加しているかにより、この順序は異なります。Azure AD がユーザーを認証すると、MFA クレームを含むプライマリ更新トークンが発行されます。</td></tr><tr><td>C</td><td>ユーザーが、Azure AD を IDP (ID プロバイダー) として使用しているアプリケーションにアクセスすると、Azure AD に誘導されます。この誘導処理では、ユーザーは特段の操作を必要とせず、動作も透過的なものになります。デバイスは既に Azure AD に登録されているため、サインイン時に使用する Microsoft Online の URL がレジストリに保存されています。これらの URL が、SSO の際に誘導される Azure AD の URL と一致するため、ブラウザーこれをもって SSO を開始し、PRT の使用を試みます。</td></tr><tr><td>D</td><td>次に、条件付きアクセスがサインインを評価します。このアプリケーションを MFA で保護するポリシーが適用されている場合、PRT にすでに MFA クレームが含まれているため、ユーザーは MFA を行う必要はありません。</td></tr><tr><td>E</td><td>ここで、Azure AD は、アプリにアクセスする際に必要となるトークンをユーザーに発行します。このトークンは、アプリケーションの構成に応じて、SAML または OAuth のトークンとして発行されます。</td></tr><tr><td>F</td><td>ユーザーは、これらのトークンをアプリケーションに提示し、アプリケーションにサインインします。</td></tr></tbody></table><p>ステップ B の詳細: <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/devices/concept-primary-refresh-token#prt-issuance-during-first-sign-in">初回サインイン中の PRT 発行</a></p><p>ステップ C の詳細: <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/devices/concept-primary-refresh-token#browser-sso-using-prt">PRT を使用したブラウザー SSO</a>  </p><h2 id="動作の詳細"><a href="#動作の詳細" class="headerlink" title="動作の詳細"></a>動作の詳細</h2><h3 id="デバイスの登録"><a href="#デバイスの登録" class="headerlink" title="デバイスの登録"></a>デバイスの登録</h3><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/devices/device-registration-how-it-works">ハイブリッド Azure AD 参加または Azure AD 参加 (デバイス登録)</a> が、Windows Hello for Business または FIDO キーを使用するための前提条件です。デバイスを Azure AD に登録するのに、様々な方法で登録プロセスを開始するようにポリシーを適用することができます。</p><h3 id="パスワードレス-MFA"><a href="#パスワードレス-MFA" class="headerlink" title="パスワードレス/MFA"></a>パスワードレス/MFA</h3><p>Windows Hello for Business や FIDO2 キーは、パスワードの代わりに、デバイス上で強力な二要素認証を行います。この認証は、デバイスに紐づけられたユーザーの資格情報で構成されており、生体認証または PIN が使用されます。Windows Hello for Business の詳細については <a href="https://learn.microsoft.com/ja-jp/windows/security/identity-protection/hello-for-business/hello-overview#how-windows-hello-for-business-works-key-points">このリンク</a> を、FIDO2 のログオンについては <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/howto-authentication-passwordless-security-key-windows">このリンク</a> をご参照ください。</p><p>ログオンを完了するためには、キーのデータを含む実際のデバイスと、そのキーへのアクセスを解除するための PIN または生体認証の 2 つの要素が必要です。この処理には、私たちが持っているもの (コンピューター)、私たちが知っているもの (PIN) または私たち自身 (生体認証) という複数要素が必要となります。なぜパスワードより PIN の方が優れているかについては、詳しくは <a href="https://learn.microsoft.com/ja-jp/windows/security/identity-protection/hello-for-business/hello-why-pin-is-better-than-password">こちらの公開情報</a> をご覧ください。</p><h3 id="エンタープライズ-アプリ-SSO"><a href="#エンタープライズ-アプリ-SSO" class="headerlink" title="エンタープライズ アプリ/SSO"></a>エンタープライズ アプリ/SSO</h3><p>デバイスが Azure AD に参加すると、いくつかの URL がレジストリに追加されます。これらの Azure AD の URL がサインインの際に使用されます。ブラウザーから Azure AD に登録されたアプリケーションにアクセスし、<strong>さらに</strong> そのブラウザーが Azure AD SSO をサポートしており (Edge、Office 用の拡張機能付きの Chrome, Firefox v91 以上)、<strong>かつ</strong> 誘導された Azure AD の URL がレジストリ内の URL と一致する場合、ブラウザ－はデバイスへのサインイン時に取得したプライマリ更新トークンを使用して、ユーザー操作を必要とせずに認証を試行します。これについては、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/devices/concept-primary-refresh-token#browser-sso-using-prt">PRT を使用したブラウザー SSO</a> で詳しく説明しています。</p><p>この場合、ユーザーには、サインイン時にプロンプトは表示され<strong>ません</strong>。</p><p>ユーザーが Azure AD に似た偽のウェブサイトに誘導され、ユーザー名とパスワードの入力プロンプトが表示されたとしても、この URL はレジストリに保存されている URL とは異なるため、SSO の処理は開始されません。偽のウェブページには SSO を受け入れるために必要なエンドポイントがないため、SSO の処理が開始されることはありません。本物の Azure AD のサインイン ページでは、パスワード プロンプトは表示されません。</p><h3 id="条件付きアクセス"><a href="#条件付きアクセス" class="headerlink" title="条件付きアクセス"></a>条件付きアクセス</h3><p>次に、条件付きアクセスが認可の要求を評価します。ユーザーやアプリに対して構成された条件付きアクセス ポリシーのアクセス制御に従って、MFA、ハイブリッド Azure AD 参加、および準拠しているデバイスなど、複数のアクセス権付与の要件 (コントロール) を設定することができます。MFA やハイブリッド Azure AD 参加など、 1 つまたは複数のコントロールを必要とすることもできます。Azure AD に登録されているデバイスは、ハイブリッド Azure AD 参加の条件を満たし、プライマリ更新トークンに存在する MFA クレームは MFA の条件を満たすことができます。</p><p>また、<a href="https://jpazureid.github.io/blog/azure-active-directory/authentication-strength-choose-the-right-auth-method-for-your/">認証強度</a> という条件付きアクセスの新しいプレビュー機能を使って、会社のデータおよびアプリにアクセスする際に、Windows Hello for Business のようなパスワードレスの認証や FIDO2 のようなフィッシング耐性のある MFA を要求することも可能です。 </p><p>これらの技術を用いることで、以下のようなことが実現可能となります:</p><ul><li>ユーザーがアカウントの正当な保持者であり、複数の認証要素を用いてコンピューターにログオンしたことを証明する。</li><li>管理されたデバイスにサインインする。 </li><li>同じアプリに、普段から使われる場所からアクセスする。</li><li>ユーザーのセキュリティ状態が変更されていないことを確認する (アカウントが無効になっていない、パスワードがリセットされていない状態)。</li><li>流出した資格情報にそのユーザーの情報が含まれていないことを確認する。</li></ul><p>ここまでのことから、ユーザーに頻繁に再認証させる必要性はないというのがお分かりいただけると思います。</p><p>注: 上記の議論は、企業が管理するデバイスにのみ当てはまります。BYOD や、その他のサポートされているデバイスでは引き続き条件付きアクセス ポリシーがトリガーされるため、MFA やその他のコントロールを満たす必要があります。</p><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>既に多くのお客様がこれらの技術を利用しています。恐らく、皆さまの組織でも、気付かないうちにこれらの構成によってもたらされるセキュリティ強化の恩恵を受けています。上記の情報を理解したうえで、ユーザーに対して、会社のデバイスから会社のアプリケーションやサービス、データにアクセスする際に、限られた状況を除き、パスワードが要求されることはほとんどないということができます。ユーザーがパスワードを使用しなければ、パスワードが漏えいする可能性は大幅に減少します。</p><p>サイバー セキュリティのトレーニングでは、エンド ユーザーに対し、ユーザーが資格情報を入力するたびに、使用しているサイトが本物であるか、URL に疑わしいものがないか、有効な証明書などでサイトが安全であるかを確認する責任を常に課しています。MFA のプロンプトが表示された場合にも、ユーザーが自ら開始した MFA であることを確認する責任を課しています。</p><p>ユーザーがこれらの複雑さから解放され、よりシンプルな確認で済むよう共に取り組んでいきましょう。もしユーザーが自身の資格情報を入力させるようなプロンプトを見かけたら、認証を行わず、社内の IT に報告するように依頼しましょう。もし MFA のプロンプトが突然表示されたとしたら、おそらくユーザーが開始した MFA ではないので、認証を行わず社内 IT に報告するように依頼しましょう。すべてのサインインの試行とすべての MFA を確認するよりも、このような方法の方が簡単なはずです。</p><p>これらの技術により、私たちのセキュリティが向上します。ユーザーがフィッシングの被害者になる可能性を減らすことができるのです。Intune、Autopilot、Temporary Access Pass または FIDO2 キーを組み合わせれば、ユーザーは会社から支給された新しいノートパソコンを箱から取り出し、デスクトップを開いて、パスワードを知ることなく会社のアプリケーションやデータにアクセスし始めることができるようになります。これでパスワードのない世界が実現できます。</p><p>Tarek Dawoud<br>Principal Program Manager, Product Management<br>Twitter: @cybertarek</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 竜 です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 12 月 15 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Authenticator が FIPS 140 に準拠しました</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/microsoft-brings-fips-140-compliance/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/microsoft-brings-fips-140-compliance/</id>
    <published>2023-01-01T00:00:00.000Z</published>
    <updated>2023-02-26T07:56:56.031Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの小出です。</p><p>本記事は、2022 年 12 月 8 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/microsoft-brings-fips-140-compliance-to-authenticator-supporting/ba-p/2365671">Microsoft brings FIPS 140 Compliance to Authenticator supporting Federal Agencies</a> を意訳したものになります。日本語での情報は、下記でも用意されております。併せてご確認ください。</p><ul><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/whats-new#general-availability---authenticator-on-ios-is-fips-140-compliant">新機能 リリース ノート - Azure Active Directory - Microsoft Entra | Microsoft Learn</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/concept-authentication-authenticator-app#fips-140-compliant-for-azure-ad-authentication">Microsoft Authenticator の認証方法 - Azure Active Directory - Microsoft Entra | Microsoft Learn</a></li></ul><hr><p>多くのお客様が、セキュリティやコンプライアンスに配慮し、認証機能には連邦情報処理標準 (FIPS) 140 (参考: NIST SP 800-63B) で検証済みの暗号を使用する必要のある環境で業務を行っています。この度、iOS 版の Microsoft Authenticator が FIPS 140 に準拠したことをお知らせいたします (Android 版の対応は近日公開予定です)。iOS 版 Authenticator のバージョン 6.6.8 以降は、プッシュ型多要素認証 (MFA)、パスワードレス電話サインイン (PSI)、時間ベースのワンタイム パスコード (TOTP) を用いた Azure Active Directory (Azure AD) のすべての認証において FIPS 140 に準拠しています。</p><p>Authenticator が FIPS 140 に準拠したことで、連邦政府機関が <a href="https://www.whitehouse.gov/briefing-room/presidential-actions/2021/05/12/executive-order-on-improving-the-nations-cybersecurity/">大統領令 (EO) 14028 “国家のサイバー セキュリティの改善”</a> の要件を満たすこと、ならびに医療機関が <a href="https://learn.microsoft.com/en-us/azure/compliance/offerings/offering-epcs-us">EPCS (Electronic Prescriptions for Controlled Substances</a> の要件を満たす事がより容易となります。</p><p>この機能を有効にするために、Authenticator アプリや Azure ポータルで設定を変更する必要はありません。iOS の Authenticator バージョン 6.6.8 以降のユーザーは、Azure AD 認証において既定で FIPS 140 に準拠した状態になります。</p><p>Authenticator は、Apple のネイティブ暗号機能を活用し、Apple iOS デバイスで FIPS 140 (Security Level 1) への準拠を実現します。使用されている認証の詳細については、<a href="https://support.apple.com/guide/certifications/ios-security-certifications-apc3fa917cb49/1/web/1.0">Apple CoreCrypto モジュール</a> を参照ください。</p><p>皆様からのご意見をお待ちしています。コメントをお寄せいただくか、aka.ms/AzureADFeedback までお気軽にご連絡ください。</p><p>Alex Weinert (<a href="https://twitter.com/Alex_T_Weinert">@Alex_T_Weinert</a>)<br>VP Director of Identity Security, Microsoft</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの小出です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 12 月 8 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcomm</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD における新しい &quot;会社のブランド&quot; 機能の紹介</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/introducing-enhanced-company-branding-for-sign-in-experiences/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/introducing-enhanced-company-branding-for-sign-in-experiences/</id>
    <published>2022-12-25T00:00:00.000Z</published>
    <updated>2023-02-26T07:56:55.987Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの高田です。</p><p>本記事は、2022 年 12 月 12 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/introducing-enhanced-company-branding-for-sign-in-experiences-in/ba-p/3094110">Introducing enhanced company branding for sign-in experiences in Azure AD</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さんんにちは。</p><p>この度、Azure AD と Microsoft 365 アプリで用いられている既定の認証フローをより柔軟かつユーザー中心的にカスタマイズできるよう、会社のブランド機能を再デザインしましたのでお知らせします。新しいユーザー体験は、Azure AD 上で動作する B2B、B2E、ファースト パーティ アプリケーションのユースケースを含む、ディレクトリ内のユーザーと外部ユーザーへのサインインに適用されます。パブリック プレビューは、本日より試用できます。</p><h2 id="あなたのお客様にあなただけの体験を"><a href="#あなたのお客様にあなただけの体験を" class="headerlink" title="あなたのお客様にあなただけの体験を"></a>あなたのお客様にあなただけの体験を</h2><p>これらのカスタマイズの機能は、ユーザーの体験をより詳細に制御したいというお客様のフィードバックに基づいて追加されました。顧客向けアプリケーションを構築する場合、B2C プラットフォームでの経験から、信頼関係を構築する上で美しくブランディングされたユーザー体験が重要です。</p><p>会社のブランド機能の強化により、既定のサインイン ページや、特定のブラウザ言語を対象にしたページのデザインをカスタマイズできるようになりました。さらに、セルフ サービス パスワード リセット (SSPR)、フッターのハイパーリンク、ブラウザ アイコンのカスタマイズ、スタイル シート (CSS) によるサインイン体験の設定、事前に定義されたテンプレートを使用してヘッダーとフッターを有効にすることも可能になりました。</p><h2 id="サインイン体験を構成する"><a href="#サインイン体験を構成する" class="headerlink" title="サインイン体験を構成する"></a>サインイン体験を構成する</h2><p>新しいカスタマイズ機能は、テナントの Azure ポータルで「会社のブランド」ブレードを使用して構成できます。この画面では、ユーザーが組織のサインイン ページにアクセスしたときに表示されるカスタマイズ結果を設定することができます。これは特定のブラウザー言語ごとに構成することも可能です。</p><p>会社のブランドのブレードで利用可能なすべての新しい設定は以下のとおりです。</p><h3 id="レイアウトの構成"><a href="#レイアウトの構成" class="headerlink" title="レイアウトの構成"></a>レイアウトの構成</h3><p>サインイン ページでウェブページの各要素の配置を指定することができます。</p><p><img src="/blog/azure-active-directory/introducing-enhanced-company-branding-for-sign-in-experiences/pic1.png"></p><h3 id="カスタムのセルフ-サービス-パスワード-リセットのハイパーリンク"><a href="#カスタムのセルフ-サービス-パスワード-リセットのハイパーリンク" class="headerlink" title="カスタムのセルフ サービス パスワード リセットのハイパーリンク"></a>カスタムのセルフ サービス パスワード リセットのハイパーリンク</h3><p>この機能により、サインイン ページでのセルフ サービス パスワード リセットのリンクを表示したり、隠したり、カスタマイズすることが可能です。</p><p><img src="/blog/azure-active-directory/introducing-enhanced-company-branding-for-sign-in-experiences/pic2.png"></p><h3 id="フッターのハイパーリンクのカスタマイズ"><a href="#フッターのハイパーリンクのカスタマイズ" class="headerlink" title="フッターのハイパーリンクのカスタマイズ"></a>フッターのハイパーリンクのカスタマイズ</h3><p>サインイン ページのフッターに表示されるプライバシーと利用規約の URL および表示文字列をカスタマイズいただけます。</p><p><img src="/blog/azure-active-directory/introducing-enhanced-company-branding-for-sign-in-experiences/pic3.png"></p><h3 id="Favicon-の設定"><a href="#Favicon-の設定" class="headerlink" title="Favicon の設定"></a>Favicon の設定</h3><p>ウェブ ブラウザーのタブに表示されるアイコンを設定いただけます。</p><p><img src="/blog/azure-active-directory/introducing-enhanced-company-branding-for-sign-in-experiences/pic4.png"></p><p>設定がアップロードされると、最終的なユーザー体験をご覧いただくことができます。</p><p><img src="/blog/azure-active-directory/introducing-enhanced-company-branding-for-sign-in-experiences/pic5.png"></p><p>Azue AD Premium もしくは Office 365 を利用して、会社のブランド機能をぜひ利用ください。</p><p>会社のブランド機能については <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/how-to-customize-branding">こちら</a> もご参照ください。</p><p>いつものように、皆様からのフィードバックをお待ちしております。</p><p>Robin Goldstein<br>Director of Product Management, Microsoft identity</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの高田です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 12 月 12 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcom</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Entra ワークロード ID の一般提供</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/microsoft-entra-workload-id-ga/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/microsoft-entra-workload-id-ga/</id>
    <published>2022-12-24T00:00:00.000Z</published>
    <updated>2023-02-26T07:56:56.039Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 三輪 です。 </p><p>本記事は、2022 年 11 月 28 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/microsoft-entra-workload-identities-now-generally-available/ba-p/3402815">Microsoft Entra Workload Identities now generally available - Microsoft Community Hub</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。 </p><hr><p>クラウドの普及に伴い、より多くのワークロードがクラウドに移行し、新しいエンタープライズ ソフトウェアのソリューションがクラウド上で直接展開されるようになっています。その結果、ワークロード用の ID が大量に増加しており、これらの ID に関連するデータやリソースへのアクセス許可が爆発的に増加しました。組織やセキュリティ プロバイダーは、これまで人間の ID についてのセキュリティに注力してきたため、こうした新たに増加している ID を管理するためのアクセス制御やセキュリティ機能は限定的でした。このため、ID セキュリティの担当者の負担はますます大きくなっています。 </p><p>ゼロ トラストとは、すべての人 (およびすべてのもの) が確実かつ継続的に認証と認可を受けるようにすることです。ワークロードのような新しい要素が組織の環境に導入されるとき、それらの要素もゼロ トラスト戦略に組み込まれなければなりません。このため、マイクロソフトでは、すべての人とすべてのものをサポートするというミッションの一環として、サポートする ID の種類を拡大し、ワークロード ID をサポートの対象に加えました。</p><p>本日、<a href="https://www.microsoft.com/ja-jp/security/business/microsoft-entra">Microsoft Entra</a> ポートフォリオの新機能として、<a href="https://www.microsoft.com/ja-jp/security/business/identity-access/microsoft-entra-workload-identities">Microsoft Entra ワークロード ID</a> の一般提供 (GA) を発表します。Microsoft Entra ワークロード ID は、独立したソリューションとして、1 ワークロード ID あたり月額 3 ドルで本日より提供されます。</p><h2 id="人間の-ID-以外の-ID-に高度な機能を拡張する"><a href="#人間の-ID-以外の-ID-に高度な機能を拡張する" class="headerlink" title="人間の ID 以外の ID に高度な機能を拡張する"></a>人間の ID 以外の ID に高度な機能を拡張する</h2><p>現在 Microsoft Entra で扱われている、ワークロード ID の数は 2019 年の 3 倍以上に増えています。Evaluserve が今年実施した調査では、68% のワークロードが機密データや資産にアクセスできることが判明しています。しかしながら、組織もセキュリティ プロバイダーも、人間の ID のセキュリティばかりに注力しがちです。結果として人間の ID のセキュリティが向上し続けているため、最近のサイバー攻撃では、ワークロード ID が標的環境への侵入口として使われ始めています。そのため、ワークロード ID を管理し保護することは、組織、ユーザー、およびデータを保護するために非常に重要です。Microsoft Entra ワークロード ID を使用すると、条件付きアクセスの実装、脅威の未然防止、ワークロード ID のライフサイクルの把握により、ワークロード ID のセキュリティを強化することができます。 </p><p>主な機能:</p><ul><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/workload-identity">条件付きアクセス</a>: 業界で最も強力なアクセス制御の 1 つである条件付きアクセスをワークロード ID に導入することができます。条件付きアクセスは、ワークロード ID の場所ベースまたはリスク ベースのポリシーをサポートします。組織は信頼できる場所以外からのサインイン試行や、Identity Protection によって検出された危険なアプリやサービスによるサインイン試行をブロックすることができます。 </li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/identity-protection/concept-workload-identity-risk">Identity Protection</a>: 人間の ID とは異なり、ワークロード ID のライフサイクルは十分に定義されていないことが多く、そのため管理が困難です。この問題に対処するため、マイクロソフトではワークロード ID のライフサイクルを横断的に調査し、怪しい兆候がないかを監視しています。Identity Protection は、資格情報の侵害、異常なサインイン、アカウント情報の不審な変更に関するレポートを提供します。危険なユーザーと同様に、危険なワークロード ID のリスク レポートは、ポータル、Microsoft Graph、または、診断設定を使用してデータをエクスポートした先のツールなど、お好みのフォーマットで表示することができます。 </li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/privileged-identity-management/pim-create-azure-ad-roles-and-resource-roles-review">アクセス レビュー</a>: 特権ロールの割り当てに関連するリスクを軽減するために、定期的なアクセス レビューが必要です。この機能により、ワークロード ID に対してアクセス レビューを作成し、最小特権アクセスを強制することができます。 </li></ul><p>これは、ワークロード ID を使用して組織の生産性と安全性を維持するという弊社の取り組みの始まりにすぎません。未使用のアプリ、期限切れの資格情報、未使用の資格情報などのアプリケーションに関する推奨事項を提供する新機能である <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/reports-monitoring/overview-recommendations">Azure Active Directory の推奨事項</a>の App Health Recommendations は、11 月末までにパブリック プレビューを開始する予定です。 </p><h2 id="Microsoft-Entra-Workload-Identities-を今すぐお試しください"><a href="#Microsoft-Entra-Workload-Identities-を今すぐお試しください" class="headerlink" title="Microsoft Entra Workload Identities を今すぐお試しください"></a>Microsoft Entra Workload Identities を今すぐお試しください</h2><p>Microsoft Entra Workload Identities の <a href="https://ms.portal.azure.com/?feature.canmodifyextensions=true&feature.canmodifystamps=true&Microsoft_Azure_ManagedServiceIdentity=test3&Microsoft_AAD_IAM_isWorkloadIdentitiesFreeTrialEnabled=true&Microsoft_Azure_ManagedServiceIdentity_isWorkloadIdentitiesUpsellBannerEnabled=true&Microsoft_Azure_ManagedServiceIdentity_isWorkloadIdentitiesPlaceHolderBannerEnabled=false#view/Microsoft_Azure_ManagedServiceIdentity/WorkloadIdentitiesBlade">90 日間無料試用版</a> では、新しい条件付きアクセス ポリシーを設定し、検出されたリスクのレポートを確認し、最小特権アクセスを適用することができます。 </p><p>Microsoft Entra ワークロード ID の詳細については、<a href="https://www.microsoft.com/ja-jp/security/business/identity-access/microsoft-entra-workload-identities">弊社の Web サイト</a> で <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/develop/workload-identities-overview">製品ドキュメント</a> をご覧ください。この体験をお客様と共にすることを楽しみにしており、お客様からのご連絡をお待ちしております。 </p><p>Ilana Smith<br>Group Product Manager<br>Azure Active Directory<br>@ilanas</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 三輪 です。 &lt;/p&gt;
&lt;p&gt;本記事は、2022 年 11 月 28 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://tech</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>新しい管理センターにおける Azure AD および他の ID とアクセス製品の統合</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/new-admin-center-unifies-azure-ad-with-other-identity-and-access-product/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/new-admin-center-unifies-azure-ad-with-other-identity-and-access-product/</id>
    <published>2022-12-18T03:00:00.000Z</published>
    <updated>2023-02-26T07:56:56.051Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 竜 です。</p><p>本記事は、2022 年 12 月 1 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/new-admin-center-unifies-azure-ad-with-other-identity-and-access/ba-p/2792595">New Admin Center Unifies Azure AD with Other Identity and Access Products</a> を意訳したものになります。</p><hr><p>Microsoft の ID に関するビジョンは、従来の ID 管理を超えて、マルチクラウドやマルチプラットフォーム環境におけるすべての人、すべてのものへのアクセスを保護するツールセットをお客様に提供することです。今年初めには、<a href="https://www.microsoft.com/ja-jp/security/business/microsoft-entra">Microsoft Entra</a> と新しい <a href="https://entra.microsoft.com/">Microsoft Entra 管理センター</a>を発表し、このビジョンを大幅に前進させました。</p><p>Microsoft 365 および Azure Active Directory (Azure AD) のお客様を対象とした Entra 管理センターの段階的なロールアウトをお知らせします。今月から、多くのお客様の手元でも、Azure AD 管理センター (<a href="https://aad.portal.azure.com/">aad.portal.azure.com</a>) に代わり、Microsoft 365 から <a href="https://entra.microsoft.com/">entra.microsoft.com</a> に自動的に遷移され始めるようになります。</p><p><img src="/blog/azure-active-directory/new-admin-center-unifies-azure-ad-with-other-identity-and-access-product/01.png"></p><h2 id="Microsoft-Entra-の管理センターを知る"><a href="#Microsoft-Entra-の管理センターを知る" class="headerlink" title="Microsoft Entra の管理センターを知る"></a>Microsoft Entra の管理センターを知る</h2><p><a href="(https://entra.microsoft.com/#home)">Microsoft Entra の管理センター</a> は、以下のような <a href="https://www.microsoft.com/ja-jp/security/business/microsoft-entra">Microsoft Entra</a> の ID とアクセス ソリューションの全体像を可視化し管理機能を統合します。  </p><p>  <strong>Azure AD</strong></p><p>  30 万以上の組織で使用されているマルチクラウドの ID およびアクセス管理ソリューションで、人々をアプリケーション、デバイス、データに結び付け、組織を保護します。</p><p>  <strong>Microsoft Entra Permissions Management</strong></p><p>  クラウド基盤のエンタイトルメント管理 (CIEM: Cloud Infrastructure Entitlement Management) ソリューションにより、マルチクラウド インフラ全体の権限リスクを発見し、修復し、監視することができます。</p><p>  <strong>Microsoft Entra Verified ID</strong></p><p>  プライバシーを尊重した非中央集権的な ID 資格情報の作成、発行および検証を行う ID 検証ソリューションで、あらゆる人や物事に対して、より安全なやり取りを実現することができます。</p><p>  <strong>Microsoft Entra ワークロード ID</strong></p><p>  アプリケーションやサービスなどのデジタル ワークロードの ID を管理し、保護することができます。リスクベースのポリシーと最小特権アクセスの実施により、クラウド リソースへのアクセスを制御します。</p><p>  <strong>Microsoft Entra Identity Governance</strong></p><p>  オンプレミスおよびクラウド ベースのユーザー ディレクトリにまたがる完全なソリューションにより、運用を簡素化すること、規制要件を満たすこと、および複数の個別ソリューション (特定の個別事象を解消するための機能) を統合することを実現します。</p><p>2023 年には、Microsoft Entra 管理センターを通じて、さらに多くの機能が提供される予定です。</p><h2 id="Azure-AD-はどうなるのでしょうか？"><a href="#Azure-AD-はどうなるのでしょうか？" class="headerlink" title="Azure AD はどうなるのでしょうか？"></a>Azure AD はどうなるのでしょうか？</h2><p>Microsoft Entra の管理センターから、Azure AD の管理タスクをすべて完了させることができます。Azure AD 管理センターにある機能は、すべて、Entra 管理センターの左パネル内の [Azure AD] タブから引き続き利用できます。また、Entra 管理センターにあるリンクから、Azure AD 管理センターに戻ることができます。</p><p>Azure AD は、Azure AD アプリケーション ギャラリー、多要素認証、パスワードレスなどご好評いただいている機能により、従業員、顧客、パートナーのアクセスを保護するための基本的なソリューションを提供し続けています。<a href="https://www.microsoft.com/en-us/security/blog/?p=124436">Microsoft は、2022 年に Gartner® Magic Quadrant™ for Access Management にて 6 年連続でリーダーに選ばれており</a>、認証、回復性、条件付きアクセスの分野で <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/bg-p/Identity">日々進化を続けて</a> います。</p><h2 id="Microsoft-Entra-管理センターへの移行を準備する"><a href="#Microsoft-Entra-管理センターへの移行を準備する" class="headerlink" title="Microsoft Entra 管理センターへの移行を準備する"></a>Microsoft Entra 管理センターへの移行を準備する</h2><p>管理画面に継続してアクセスできるよう、組織は必要に応じて、ファイアウォール ルールを更新する必要があります。</p><p>Microsoft Entra の管理センターは、本日より <a href="https://entra.microsoft.com/">entra.microsoft.com</a> で利用できますので、完全移行に向けてぜひご活用ください。</p><p><a href="https://entra.microsoft.com/">管理センター</a> から、ご意見をお寄せいただけるのをお待ちしております。</p><p>Kristina Hotz, Principal Manager of Product Management</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 竜 です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 12 月 1 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcom</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>機械学習による推奨事項（ピア外れ値）をアクセス レビューに導入する方法について</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/machine-learning-recommendations-in-access-review/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/machine-learning-recommendations-in-access-review/</id>
    <published>2022-12-14T00:00:00.000Z</published>
    <updated>2023-02-26T07:56:55.995Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。 Azure ID チームの小出です。</p><p>この記事では、2022 年 12 月 1 日に公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/introducing-machine-learning-based-recommendations-in-azure-ad/ba-p/2466923">Introducing Machine Learning based recommendations in Azure AD Access reviews</a> の記事の抄訳をもとに、新しいアクセス レビューの機能について紹介します。</p><hr><p>従業員やゲスト、ワークロード ID のアクセスを管理できる Azure AD のアクセス レビューの機能は、すでに多くのお客様にご利用いただいております。一方、これまでに「レビューのプロセスを簡単にしてほしい」、「もう少し迅速に決定を下せるようにしたい」とのご要望をいただいていました。</p><p>今回は、「ピア外れ値」を活用した、新しいアクセス レビューの「推奨事項」についてご紹介します。</p><p>この機能は、高度な機械学習モデルを使用し、組織のレポート構造 (組織図) に基づいて、レビュー対象グループへのユーザーの所属状況を判断します。この機能が「推奨事項」に追加されたことにより、レビュー担当者は、レビューを簡単に行うことができるようになりました。</p><p><img src="/blog/azure-active-directory/machine-learning-recommendations-in-access-review/machine-learning-recommendations-in-access-review1.png"></p><h2 id="User-to-Group-Affiliation-ピア外れ値-とは何ですか？"><a href="#User-to-Group-Affiliation-ピア外れ値-とは何ですか？" class="headerlink" title="User-to-Group Affiliation (ピア外れ値) とは何ですか？"></a>User-to-Group Affiliation (ピア外れ値) とは何ですか？</h2><p>User-to-Group Affiliation (ピア外れ値) は、組織のレポート構造 (組織図) に基づいて、グループ内の他のユーザーとユーザーの相対的な所属を比較するものです。機械学習ベースで点数をつけるメカニズムにより、組織階層内のユーザー間の距離を識別する仕組みです。これにより、グループ内の他のユーザー (ピア) と非常に離れているユーザー、つまり「所属度合いが低い」外れ値のユーザーを検出し、システムは「拒否」の推奨事項を表示します。</p><p>具体例を用いて紹介しますと、レビュー対象としているグループの中に、下記赤丸の 4 名のユーザーがいたとします。3 名は組織図上同じ部門に所属していますが、 1 名だけ違う部門に所属しており、ほかの 3 名と比べて違和感があります。</p><p>このような場合、1人だけ所属から離れたユーザーは「グループに所属すべきではない」と機械学習で判断し、「拒否」の推奨事項を画面に表示します (あくまでも推奨事項のため、推奨事項と異なる決定をすること自体は可能です)。</p><p><img src="/blog/azure-active-directory/machine-learning-recommendations-in-access-review/machine-learning-recommendations-in-access-review2.png"></p><h2 id="User-to-Group-Affiliation-ピア外れ値-の設定方法"><a href="#User-to-Group-Affiliation-ピア外れ値-の設定方法" class="headerlink" title="User-to-Group Affiliation (ピア外れ値) の設定方法"></a>User-to-Group Affiliation (ピア外れ値) の設定方法</h2><p>アクセス レビュー作成時の画面で簡単に設定できます。User-to-Group Affiliation (ピア外れ値) のチェックをオンにするだけで、そのほかは通常のレビューと変更ありません。</p><p><img src="/blog/azure-active-directory/machine-learning-recommendations-in-access-review/machine-learning-recommendations-in-access-review3.png"></p><h2 id="レビュー担当者がどのように推奨事項を活用できるか？"><a href="#レビュー担当者がどのように推奨事項を活用できるか？" class="headerlink" title="レビュー担当者がどのように推奨事項を活用できるか？"></a>レビュー担当者がどのように推奨事項を活用できるか？</h2><p>アクセス レビューのレビュー担当者は、そのユーザーがグループ内の他のユーザーと「関係度合いが低い」場合、既存の非アクティブ ユーザーの推奨事項と同様に、推奨事項の情報を見ることができます。レビュー担当者は、「推奨事項を承認する」をクリックして推奨事項を承認するか、推奨事項に表示された情報に基づいて、手動でアクセスを「承認」または「拒否」することができます (あくまでも推奨事項のため、推奨事項と異なる決定をすること自体は可能です)。</p><p><img src="/blog/azure-active-directory/machine-learning-recommendations-in-access-review/machine-learning-recommendations-in-access-review4.png"></p><h2 id="承認および拒否の決定を判断するための追加情報について"><a href="#承認および拒否の決定を判断するための追加情報について" class="headerlink" title="承認および拒否の決定を判断するための追加情報について"></a>承認および拒否の決定を判断するための追加情報について</h2><p>アクセス判断のために追加情報が必要なレビュー担当者は、追加情報を確認することもできます。「詳細」をクリックすると、アクセスを「許可」または「拒否」するオプションが表示され、推奨事項の理由も表示できます。</p><p>レビュー担当者が推奨されるオプションを選択した場合、決定は直接送信されます。一方、レビュー担当者が推奨されるオプションとは異なる決定を行う場合、理由が必要となります。 </p><p><img src="/blog/azure-active-directory/machine-learning-recommendations-in-access-review/machine-learning-recommendations-in-access-review5.png"></p><h2 id="リソースとフィードバック"><a href="#リソースとフィードバック" class="headerlink" title="リソースとフィードバック"></a>リソースとフィードバック</h2><p>詳細については、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/governance/review-recommendations-access-reviews#user-to-group-affiliation-preview">本公開情報</a> を併せてご覧ください。また、本プレビューについてのフィードバックを募集しています。aka.ms/AzureADFeedback までお気軽にコメントをお寄せください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。 Azure ID チームの小出です。&lt;/p&gt;
&lt;p&gt;この記事では、2022 年 12 月 1 日に公開された &lt;a href=&quot;https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-bl</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
    <category term="Access Review" scheme="https://jpazureid.github.io/blog/tags/Access-Review/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Entra の変更管理のアナウンス (2022 年 11 月の状況)</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/Microsoft-Entra-change-announcements-November-2022-train/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/Microsoft-Entra-change-announcements-November-2022-train/</id>
    <published>2022-12-04T03:00:00.000Z</published>
    <updated>2023-02-26T07:56:55.659Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 竜 です。</p><p>本記事は、2022 年 11 月 30 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/microsoft-entra-change-announcements-november-2022-train/ba-p/2967452">MMicrosoft Entra Change Announcements – November 2022 Train</a> を意訳したものになります。</p><hr><p>皆さん、こんにちは。</p><p>Microsoft Entra の変更管理に関するアナウンスは、<a href="https://www.microsoft.com/en-us/security/blog/2022/05/31/secure-access-for-a-connected-worldmeet-microsoft-entra/">Microsoft Entra</a> のすべての変更を含めて、半年に一度の製品廃止のお知らせと、四半期に一度の機能変更のお知らせをお伝えしています。これらのアナウンスの合間には、新製品や新機能のリリースに関するブログ記事を公開しています。たとえば、<a href="https://jpazureid.github.io/blog/azure-active-directory/Microsoft-Entra-change-announcements-September-2022-train/">9 月の変更管理のブログ記事</a> では、<a href="https://jpazureid.github.io/blog/azure-active-directory/Announcing-a-New-Azure-AD-part-of-Microsoft-Entra-region-in-Japan/">日本での新しいリージョンの一般提供</a> を開始したことを発表しました。</p><p>本日は、機能変更との既存の動作に影響を与える 11 月分の変更についてお知らせします。これらの変更は、リリース ノートや電子メールでもお知らせしています。また、お客様が新しい <a href="https://entra.microsoft.com/">Entra 管理センター</a> で、ライフサイクルの変更 (廃止、サポート終了、サービスの破壊的な変更) を管理しやすくなるよう、引き続き取り組んでいます。</p><p>以下に、2022 年 11 月分として発表された機能変更の一覧をご紹介します。    </p><h2 id="Microsoft-Authenticator-における番号の一致機能"><a href="#Microsoft-Authenticator-における番号の一致機能" class="headerlink" title="Microsoft Authenticator における番号の一致機能"></a>Microsoft Authenticator における番号の一致機能</h2><p>Microsoft Authenticator で <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/how-to-mfa-number-match">「番号の一致 (Number Matching)」機能</a> と <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/how-to-mfa-additional-context">「追加のコンテキスト (Additional Context)」機能</a> の一般提供を開始しました (2022 年 10 月 24 日現在)。番号の一致機能では、Authenticator アプリで多要素認証を承認する際に、サインイン画面に表示される数値の入力をユーザーに求めることで、誤って通知を承認するのを防ぐことができます。また、Authenticator の通知でユーザーに追加のコンテキストを表示することで、誤って承認するのを減らすことも可能です。管理者は以下の機能の有効化を選択できるようになりました。</p><ol><li>アプリケーションのコンテキスト: ユーザーがどのアプリケーションにサインインしているかを表示します。</li><li>地理的な位置のコンテキスト: サインインしているデバイスの IP アドレスに基づき、ユーザーのサインイン場所を表示します。</li></ol><p><a href="https://jpazureid.github.io/blog/azure-active-directory/defend-your-users-from-mfa-fatigue-attacks/">MFA 疲労攻撃が増加している</a> 中、これらの機能は組織を守るために非常に重要です。Azure ポータルの管理者画面と Microsoft Graph API を活用することで、これらの重要なセキュリティ機能を組織でスムーズに導入することができますので、ぜひご検討ください。</p><p>Microsoft は、2023 年 2 月 27 日より、Microsoft Authenticator アプリを利用するすべてのユーザーを対象に、番号の一致機能を有効化する予定です。 詳しくは、<a href="https://jpazureid.github.io/blog/azure-active-directory/defend-your-users-from-mfa-fatigue-attacks/">Microsoft Authenticator の MFA 疲労攻撃対策</a> をご参照ください。</p><h2 id="Azure-AD-への-IPv6-の導入"><a href="#Azure-AD-への-IPv6-の導入" class="headerlink" title="Azure AD への IPv6 の導入"></a>Azure AD への IPv6 の導入</h2><p>企業ネットワーク、サービス プロバイダー、およびデバイスにおける IPv6 の普及とサポートが進む中、ユーザーが IPv6 クライアントや IPv6 ネットワークを使用して自社のサービスやアプリケーションに引き続きアクセスできるかどうか気にされているお客様も多くいらっしゃいます。</p><p>本日、Azure AD (Microsoft Entra) に IPv6 のサポートを導入する計画を発表しました。この変更により、お客様は IPv4 と IPv6 の両方のネットワーク プロトコル (デュアルスタック) で Azure AD のサービスにアクセスすることができるようになります。</p><p>ほとんどのお客様において、IPv4 が完全に利用されなくなることはないと想定しているため、Azure AD の機能やサービスにおいて、<strong>IPv6 を必須としたり、IPv4 の優先順位を下げたりすることは予定していません</strong>。</p><p><strong>2023 年 3 月 31 日</strong> から、段階的に、Azure AD のサービスに IPv6 対応を導入していく予定です。 </p><div class="alert is-info"><p class="alert-title">Note</p><p>サポート部門による注釈: 一部の Azure AD のサービスでは、IPv6 はすでにサポートされています。上記発表は今後、より多くのサービスにおいて、IPv6 がサポートされることを示しています。</p></div><p>IPv6 アドレスおよび条件付きアクセス ポリシーで <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/location-condition#named-locations">ネームド ロケーション</a> を使用している Azure AD のお客様向けに、以下のガイダンスを用意しました。</p><p>組織内で、特定のネットワーク境界を識別するためにネームド ロケーションを使用しているお客様は、以下の作業が必要となります: </p><ol><li>既存の <strong>ネームド ロケーション</strong> の確認を行い潜在的な影響を予期すること</li><li>ネットワーク パートナーと協力してお客様の環境で使用されている外部向けの IPv6 アドレスを特定すること</li><li>既存の <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/location-condition#ip-address-ranges">ネームド ロケーション</a> の見直しと変更を行い確認した IPv6 の範囲を含めること</li></ol><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/location-condition">条件付きアクセス ポリシーにおける場所の条件</a> を使用して特定のネットワークからのアクセスのみを許可するよう制限しているお客様は、以下の作業が必要となります: </p><ol><li>既存の条件付アクセス ポリシーの確認を行いネームド ロケーションの利用による想定される影響を確認すること</li><li>場所の条件を使用した既存の条件付きアクセス ポリシーの見直しと更新を行いそれらが組織のセキュリティ要件を引き続き満たしているかどうかを確認すること</li></ol><p>Azure AD における IPv6 の有効化に関する追加のガイダンスは、こちらの覚えやすい URL (<a href="https://aka.ms/azureadipv6">https://aka.ms/azureadipv6</a>) にて引き続き共有していく予定です。</p><h2 id="Azure-AD-Domain-Services-のクラシック仮想ネットワーク-サポート"><a href="#Azure-AD-Domain-Services-のクラシック仮想ネットワーク-サポート" class="headerlink" title="Azure AD Domain Services のクラシック仮想ネットワーク サポート"></a>Azure AD Domain Services のクラシック仮想ネットワーク サポート</h2><p>以前発表したように、2017 年に Azure AD Domain Services (Azure AD DS) が Azure Resource Manager ネットワークでホスト可能になりました。それ以降、弊社は Azure Resource Manager の最新の機能を使用して、より安全なサービスを構築してきました。今後クラシック デプロイは Azure Resource manager デプロイに完全に移行するため、Azure AD DS クラシック仮想ネットワークのデプロイは 2023 年 3 月 1 日に廃止される予定です。クラシック仮想ネットワークからの Azure AD DS の移行についての詳細は <a href="https://learn.microsoft.com/ja-jp/azure/active-directory-domain-services/migrate-from-classic-vnet">クラシック仮想ネットワーク モデルから Resource Manager への Azure Active Directory Domain Services の移行</a> をご参照ください。</p><p>以下は、弊社からの Microsoft Entra の変更管理についての連絡予定の概要です。</p><table><thead><tr><th><strong>カテゴリ</strong></th><th><strong>定義</strong></th><th><strong>連絡の予定</strong></th></tr></thead><tbody><tr><td>製品の廃止の連絡</td><td><strong>機能、性能、または製品を特定の期間後に廃止</strong>することを指します。これは、一般的に、新たなお客様に対してサービスや機能の提供を停止し、廃止予定の機能に対して技術的面での投資が削減されることを意味します。最終的には、EOL (end-of-life) の状態に至り、すべてのお客様に対してサービスや機能の提供が停止されます。</td><td>年に 2 回 (3 月、9 月)</td></tr><tr><td>製品の機能変更および既存の動作に影響を与える変更のお知らせ</td><td><strong>既存の動作に影響を与える変更</strong>: 継続的な運用のためにお客様が何らかの操作や変更を行わない場合、既存のユーザーおよびパートナー体験に影響が生じると想定される変更です。<br><strong>機能の変更</strong>: 既存の ID の機能に対する変更であり、お客様側での作業は必要はありませんが、ユーザー体験に変化が生じます。多くは、UI/UX (ユーザー インターフェイスおよびユーザー体験) への変更です。<br><br>これらの変更は一般的に頻繁に発生するため、より頻繁に弊社からの通知が必要となります。</td><td>年に 4 回 (3 月、6 月、9 月、11 月)</td></tr></tbody></table><p>毎月の更新については、リリースノートのページでご確認ください: <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/whats-new">Azure Active Directory の新着情報</a></p><p>いつものように、フィードバックや提案をお待ちしています。以下のコメントまたは <a href="https://feedback.azure.com/d365community/forum/22920db1-ad25-ec11-b6e6-000d3a4f0789">Azure AD feedback forum</a> でご意見をお聞かせください。</p><p>また、Microsoft Q&amp;A で、質問、未解決の問題や機能に関するご要望を #AzureADChangeManagementNov2022Train のタグを使用して送信することも可能です。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 竜 です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 11 月 30 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>アプリの条件付きアクセス フィルターがパブリック プレビューになりました</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/ca-filter-for-apps/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/ca-filter-for-apps/</id>
    <published>2022-11-19T15:00:00.000Z</published>
    <updated>2023-02-26T07:56:55.767Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure ID チームの小出です。</p><p>本記事は、 2022 年 10 月 26 日に公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/public-preview-conditional-access-filters-for-apps/ba-p/2365680">Public Preview: Conditional Access filters for apps</a> の意訳をもとに、新しくパブリック プレビューになりましたアプリ用の条件付きアクセス フィルターの機能と、実際の操作方法について紹介します。</p><h2 id="新しい機能の概要"><a href="#新しい機能の概要" class="headerlink" title="新しい機能の概要"></a>新しい機能の概要</h2><p>これまで条件付きアクセス ポリシーを構成するときには、下記のように「どのアプリケーションに対してポリシーを適用するか」 を個別に指定する必要がありました。たとえば Office 365 にアクセスした時にポリシーを適用させたい場合、下記のように設定しますが、適用させたいアプリケーションがたくさんある場合、この画面でアプリを 1 つずつ選択してリストアップしていたと思います。</p><p><img src="/blog/azure-active-directory/ca-filter-for-apps/ca-filter-for-apps1.png"></p><p>新しいパブリック プレビューの機能を使うと、上記画面で 1 つずつアプリケーションを選択しなくても、条件に基づいたアプリをポリシーの対象に含めてくれるようになります。</p><p>この機能では、[カスタム セキュリティ属性] を使用してアプリケーションにタグ付けを行います。このタグをもとに、特定のカスタム セキュリティ属性の値が含まれているアプリを、自動的にポリシーへ追加します。対象となるアプリケーション数に制限はありません。</p><p><img src="/blog/azure-active-directory/ca-filter-for-apps/ca-filter-for-apps2.png"></p><h2 id="どのような利点があるか"><a href="#どのような利点があるか" class="headerlink" title="どのような利点があるか"></a>どのような利点があるか</h2><p>この機能により以下のようなメリットを得ることができます。</p><h3 id="ポリシーの数を減らすことができる"><a href="#ポリシーの数を減らすことができる" class="headerlink" title="ポリシーの数を減らすことができる"></a>ポリシーの数を減らすことができる</h3><p>これまで新しいアプリを作成するごとにポリシーを作成していたなど、類似構成のポリシーが多くある場合には、この機能を使用することでポリシーの数を減らすことが可能です。</p><h3 id="新しいアプリを追加した時の負担軽減と作業ミスの可能性の低減"><a href="#新しいアプリを追加した時の負担軽減と作業ミスの可能性の低減" class="headerlink" title="新しいアプリを追加した時の負担軽減と作業ミスの可能性の低減"></a>新しいアプリを追加した時の負担軽減と作業ミスの可能性の低減</h3><p>新しいアプリをポリシーに追加したい場合、以前はポリシーを編集し、対象となるアプリケーションを追加する必要がありました。このアプリ フィルター機能を使用すれば、新しいアプリを追加しても、それにタグ付けすることで自動的にポリシーの対象となり、ポリシーを編集する必要がなくなります。</p><p>また、新しいアプリをポリシーの対象に追加する際に、たとえばポリシー編集時に誤った項目を設定したり、ポリシー自体を削除してしまったりすることもあり得ると思います。しかしながらこのアプリ フィルターの機能を用いると、アプリ自体のカスタム セキュリティ属性をもとに対象アプリが自動的にポリシーの対象として構成されるため、ポリシーを一度構成すれば、新しいアプリケーションが追加されてもポリシーを編集する必要はなく、操作ミスをなくすことができます。</p><h3 id="権限の委任範囲を明確に切り離すことができる"><a href="#権限の委任範囲を明確に切り離すことができる" class="headerlink" title="権限の委任範囲を明確に切り離すことができる"></a>権限の委任範囲を明確に切り離すことができる</h3><p>カスタム セキュリティ属性は、属性管理者や属性割り当て管理者といった、一部のロールを持つユーザーしか閲覧および編集することができず、グローバル管理者でも操作を行うことはできません。このため、一部のユーザーにのみカスタム セキュリティ属性の管理を委任することで、属性の管理者とポリシーの管理者を分けることができるようになります。役割を分けることで、属性の変更操作を行ったユーザーの特定や監査も容易になります。</p><p>また、この属性の変更権限を持つユーザーには条件付きアクセス ポリシーを編集する権限はないため、条件付きアクセスの管理者と、カスタム セキュリティ属性の管理者で職務の分離を確実に行うことが可能です。 </p><h2 id="構成方法"><a href="#構成方法" class="headerlink" title="構成方法"></a>構成方法</h2><p>条件付きアクセス ポリシーでアプリ フィルターを選択する前に、事前にカスタム セキュリティ属性を構成し、アプリケーションに値を割り当てる必要があります。そのため、詳細な手順を下記にてご紹介します。</p><h3 id="事前準備"><a href="#事前準備" class="headerlink" title="事前準備"></a>事前準備</h3><p>カスタム セキュリティ属性を管理するためには、属性定義管理者および属性割り当て管理者が必要です。まずは操作ユーザーにこれらのロールを付与します。グローバル管理者や特権ロール管理者であれば、自身に対してロールを追加することも可能です。</p><h3 id="カスタム-セキュリティ属性の作成"><a href="#カスタム-セキュリティ属性の作成" class="headerlink" title="カスタム セキュリティ属性の作成"></a>カスタム セキュリティ属性の作成</h3><ol><li><p>[Azure Active Directory] - [Custom Security Attributes] を開き、 [属性セットを追加する] をクリックします。</p></li><li><p>“属性セット名” を指定し、任意で説明や属性の最大数を決定します。属性セットは、属性をまとめた「箱」のようなものです。</p><p> <img src="/blog/azure-active-directory/ca-filter-for-apps/ca-filter-for-apps3.png"></p></li><li><p>作成した属性セットを選択します。</p></li><li><p>下記の画面が表示されるので [属性の追加] を選択します。</p><p> <img src="/blog/azure-active-directory/ca-filter-for-apps/ca-filter-for-apps4.png"></p></li><li><p>属性は、実際にアプリ フィルターで条件付けに使う属性名です。データ型や複数の値が入れられるか、値はどのようにするか（定義済みのものから選ぶ or 自由に指定）を決めることができます。</p><p> <img src="/blog/azure-active-directory/ca-filter-for-apps/ca-filter-for-apps5.png"></p></li></ol><div class="alert is-warning"><p class="alert-title">警告</p><p>条件付きアクセス ポリシーのアプリ フィルターでは、文字列型のデータのみが使用できるため、データ型は String を選択ください。</p></div><ol start="6"><li><p>下記のように属性が作成されることを確認します。</p><p> <img src="/blog/azure-active-directory/ca-filter-for-apps/ca-filter-for-apps6.png"></p></li></ol><h3 id="カスタム-セキュリティ属性の割り当て"><a href="#カスタム-セキュリティ属性の割り当て" class="headerlink" title="カスタム セキュリティ属性の割り当て"></a>カスタム セキュリティ属性の割り当て</h3><ol><li><p>作成したカスタム セキュリティ属性を、実際にアプリケーションに割り当てます。 [エンタープライズ アプリケーション] - [カスタム セキュリティ属性] - [割り当ての追加] を選択します。</p><p> <img src="/blog/azure-active-directory/ca-filter-for-apps/ca-filter-for-apps7.png"></p></li><li><p>属性セット、属性名、値をそれぞれ選択、もしくは入力して保存します。</p><p> <img src="/blog/azure-active-directory/ca-filter-for-apps/ca-filter-for-apps8.png"></p></li></ol><h3 id="条件付きアクセス-ポリシーの構成"><a href="#条件付きアクセス-ポリシーの構成" class="headerlink" title="条件付きアクセス ポリシーの構成"></a>条件付きアクセス ポリシーの構成</h3><ol><li><p>Azure ポータルから [条件付きアクセス] を選択し、ポリシーの作成画面に遷移します。</p></li><li><p>[クラウド アプリまたは操作] をクリックし、 [アプリを選択] - [フィルターの編集（プレビュー）] を選択します。</p></li><li><p>下記のような画面が表示されるので、 [構成] を “はい” に設定し、このポリシーに適用させたいアプリケーションの条件を指定して保存します。</p><p> たとえばここでは、 CAPolicyforAppsTag というカスタム セキュリティ属性の値が “Department1” となっているアプリケーションを対象にしています。</p><p> <img src="/blog/azure-active-directory/ca-filter-for-apps/ca-filter-for-apps9.png"></p></li><li><p>ポリシーの名前や条件など、ほかに必要な項目を入力してポリシーを作成すれば完了です。</p></li></ol><h2 id="フィードバックをお寄せください"><a href="#フィードバックをお寄せください" class="headerlink" title="フィードバックをお寄せください"></a>フィードバックをお寄せください</h2><p>今回は、条件付きアクセス ポリシーにて新しく利用できるようになったアプリ フィルターについて紹介しました。新しいプレビュー機能を利用して気づいたこと、フィードバックがある場合には、下記画面の [フィードバックがある場合] からご意見、ご要望をお寄せください。</p><p>  <img src="/blog/azure-active-directory/ca-filter-for-apps/ca-filter-for-apps10.png"></p><h2 id="参考となる公開情報"><a href="#参考となる公開情報" class="headerlink" title="参考となる公開情報"></a>参考となる公開情報</h2><ul><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-filter-for-applications">条件付きアクセス ポリシーでのアプリケーションのフィルター (プレビュー)</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/custom-security-attributes-overview">Azure AD のカスタム セキュリティ属性とは (プレビュー)</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-condition-filters-for-devices">条件付きアクセス ポリシーの条件としてのデバイスのフィルター</a></li><li><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/workload-identity">ワークロード ID 用の Azure Active Directory の条件付きアクセス (プレビュー)</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure ID チームの小出です。&lt;/p&gt;
&lt;p&gt;本記事は、 2022 年 10 月 26 日に公開された &lt;a href=&quot;https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-bl</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>自動割り当てポリシーを活用してアクセス パッケージを動的に割り当てる</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/dynamic-automated-access-with-entitlment-management/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/dynamic-automated-access-with-entitlment-management/</id>
    <published>2022-11-18T15:00:00.000Z</published>
    <updated>2023-02-26T07:56:55.855Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。 Azure ID チームの小出です。</p><p>この記事では、2022 年 8 月 29 日に公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/dynamic-automated-access-with-azure-ad-entitlement-management/ba-p/2466937">Dynamic automated access with Azure AD entitlement management</a> の記事の抄訳をもとに、アクセス パッケージの活用方法やポイントなどを紹介します。</p><hr><p>最近弊社では、Azure Active Directory (Azure AD) Identity Governance の機能を継続的に強化しています。たとえば最新機能では、多段階のアクセス レビューや、Azure Logic App と連携したエンタイトルメント管理の機能などがリリースされました。</p><p>今回ご紹介するのは、エンタイトルメント管理において新しくプレビューになりました「自動割り当てポリシー」の機能です。</p><p>基本的なアクセス パッケージの機能については、こちらのブログでご案内しておりますので、事前に基礎的な機能および使い方について確認されたい方は <a href="https://jpazureid.github.io/blog/azure-active-directory/access-management-with-access-package/">こちら</a> をご覧ください。</p><h2 id="何ができるのか？"><a href="#何ができるのか？" class="headerlink" title="何ができるのか？"></a>何ができるのか？</h2><p>アクセス パッケージ ポリシーに事前に設定した条件に応じて、対象となるユーザーにパッケージが自動的に割り当てられるようになります。これにより、管理者の手作業なく、アプリケーションへのアクセス許可などを、条件に応じて自動的に適用したり剥奪したりすることが可能となります。動的グループのアクセス パッケージ版のように理解いただくとわかりやすいです。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/governance/entitlement-management-access-package-auto-assignment-policy">こちらの公開情報</a> も併せてご活用ください。</p><p>アクセス パッケージは、グループやチーム、アプリケーション、SharePoint サイトなどを一括してユーザーに割り当てることができる機能です。この機能を使用しない場合、管理者が手動で各リソースにユーザーのアクセス許可を付与する必要があり、管理者には大きな負担となっていました。アクセス パッケージを活用することで負担を大きく下げることが期待できる一方、「パッケージを割り当てたいユーザーを追加する」もしくは「ユーザーがパッケージを要求する」という手作業が必要だったため、管理者もしくはユーザー側で操作する必要がありました。</p><p>これは具体的には、例えば管理者がアクセス パッケージを割り当てる場合、まず以下の画面で [新しい割り当て] をクリックしていました。</p><p><img src="/blog/azure-active-directory/dynamic-automated-access-with-entitlment-management/dynamic-automated-access-with-entitlment-management1.png"></p><p>次に、どのユーザーにどのポリシーを使用してパッケージを割り当てるかなどを個別に指定する必要がありました。</p><p><img src="/blog/azure-active-directory/dynamic-automated-access-with-entitlment-management/dynamic-automated-access-with-entitlment-management2.png"></p><p>管理者が手動で割り当てたり、ユーザーが自身で要求したりできるポリシーももちろん活用できますが、新機能を使うと「表示名が test から始まるユーザー」や「JobTitle 属性に “一般社員” と登録されているユーザー」といった条件をもとに、自動的にアクセス パッケージを割り当てることができるようになります。また、 1 つのアクセス パッケージには複数のポリシーを追加することができるので、自動で追加されないユーザーに手動でパッケージを割り当てることも可能です。</p><h2 id="設定の仕方"><a href="#設定の仕方" class="headerlink" title="設定の仕方"></a>設定の仕方</h2><ol><li><p>Azure ポータルにサインインします。</p></li><li><p>[Identity Governance] - [アクセス パッケージ] をクリックし、ポリシーを作成したいアクセス パッケージを選択します。</p></li><li><p>[ポリシー] タブを開き、下記のように [自動割り当てポリシーの追加] を選択します。</p><p> <img src="/blog/azure-active-directory/dynamic-automated-access-with-entitlment-management/dynamic-automated-access-with-entitlment-management3.png"></p></li><li><p>[自動割り当てポリシーの作成] 画面が開き、[ルールの構文] ボックスが表示されるので、右端の “編集” をクリックします。</p></li><li><p>下記のような設定画面が開きます。</p><p> <img src="/blog/azure-active-directory/dynamic-automated-access-with-entitlment-management/dynamic-automated-access-with-entitlment-management4.png"></p></li><li><p>ルール ビルダーを活用するか、直接構文を入力して条件を記載します。</p></li><li><p>設定を保存し、自動割り当てポリシーを作成します。</p></li></ol><p>動的グループを活用されているお客様のなかには、5 の画面には見覚えがあると思います。アクセス パッケージの自動割り当てポリシーでも同じように設定いただければ問題ございませんので、初めて利用される方でも簡単に設定できます。</p><h2 id="活用ポイント"><a href="#活用ポイント" class="headerlink" title="活用ポイント"></a>活用ポイント</h2><p>動的グループは、ライセンスの割り当てやアクセス許可の自動設定に加え、さらにパッケージの静的な割り当てにも活用できますが、自動割り当てポリシーによるエンタイトルメント管理では、さらに以下のようなことも実現可能できます。</p><h3 id="複数のリソースにまたがるアクセスを一括で管理する"><a href="#複数のリソースにまたがるアクセスを一括で管理する" class="headerlink" title="複数のリソースにまたがるアクセスを一括で管理する"></a>複数のリソースにまたがるアクセスを一括で管理する</h3><p>アプリケーション、SharePoint Online サイト、既存の Azure AD グループと Teams、オンプレミス AD にプロビジョニングされたグループなど、アクセス パッケージには複数のリソースを追加することができます。</p><p>上記で設定したポリシーを併せて確認することで、どんなユーザーにどのようなリソースへのロールが割り当てられているのかをすぐに確認できます。動的グループでも割り当てを行うことはできますが、どのパッケージに何の権限が割り当たっているのかを一目で確認することができる点は、アクセス パッケージの利点です。</p><p><img src="/blog/azure-active-directory/dynamic-automated-access-with-entitlment-management/dynamic-automated-access-with-entitlment-management5.png"></p><h3 id="複雑な条件でパッケージを割り当てたい場合"><a href="#複雑な条件でパッケージを割り当てたい場合" class="headerlink" title="複雑な条件でパッケージを割り当てたい場合"></a>複雑な条件でパッケージを割り当てたい場合</h3><p>静的なポリシーでは、内部向けの場合は特定のユーザーやグループ、ゲストあり or なしのメンバー ユーザーなど、パッケージを要求できるユーザーを大まかにしか指定できませんでした。新機能では、動的グループのような条件でポリシーを作成できるため、より複雑な構成 (例外となるユーザーを指定するなど) を行うこともできるようになりました。</p><h3 id="カスタム拡張機能との連携"><a href="#カスタム拡張機能との連携" class="headerlink" title="カスタム拡張機能との連携"></a>カスタム拡張機能との連携</h3><p>エンタイトルメント管理のカスタム拡張機能により、Microsoft や 3rd パーティー アプリケーションでのタスクをさらに自動化できます。ユーザーにパッケージが割り当てられたり、失ったりしたときに、事前に設定したワークフローを実行するよう構成できます。</p><h2 id="よくある質問"><a href="#よくある質問" class="headerlink" title="よくある質問"></a>よくある質問</h2><p>Q. 動的割り当てポリシーを作成したら、自動的に動的グループが作成されました。どうしたらいいですか？</p><p>A. 動的割り当てポリシーでは、メンバーを評価するために自動的に動的グループが作成されます。AutoAssignment_ から始まる名前であれば、動的割り当てポリシーで使用されているとご判断ください。<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/governance/entitlement-management-access-package-auto-assignment-policy">公開情報</a> にも記載がありますが、このグループはエンタイトルメント管理で使用されているため、ほかの目的やサービスで指定しないでください。</p><blockquote><p>該当箇所:</p><p>このプレビューでは、エンタイトルメント管理によって、スコープ内のユーザーを評価するために、各ポリシーに対応する動的セキュリティ グループが自動的に作成されます。 このグループは、エンタイトルメント管理自体以外は変更しないでください。 また、このグループはエンタイトルメント管理によって自動的に変更または削除される可能性があるため、他のアプリケーションやシナリオではこのグループを使用しないでください。</p></blockquote><p>Q. アクセス パッケージに複数の自動割り当てポリシーを含めてもいいのでしょうか？</p><p>A. 動作を確認する限りでは、複数の自動割り当てポリシーを作成できる動作となっています。ただし、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/governance/entitlement-management-access-package-auto-assignment-policy">公開情報</a> には最大 1 つと記載されているほか、多くの自動割り当てポリシーを作成すると管理が難しくなるため、 1 つのパッケージに 1 つの割り当てポリシーを設定することをお勧めします。</p><blockquote><p>該当箇所:</p><p>このプレビュー期間中は、アクセス パッケージに含められる自動割り当てポリシーは最大 1 つです。</p></blockquote><p>Q. 動作を確認しようと、検証目的で作成した自動割り当てポリシーが削除できません。</p><p>A. すでにパッケージにアクティブな割り当てがあると、ポリシーを削除するときにエラーになります。まずはポリシーを編集し、アクティブに割り当てられることのないような条件に変更してください。たとえば、 ObjectID が Null であるといった条件が利用できます。次に、 [割り当て] 画面から、すでに割り当てられてしまったアクセス権を選択して削除します。その後、自動割り当てポリシー自体も削除することが可能になります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。 Azure ID チームの小出です。&lt;/p&gt;
&lt;p&gt;この記事では、2022 年 8 月 29 日に公開された &lt;a href=&quot;https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-bl</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
    <category term="Entitlement Management" scheme="https://jpazureid.github.io/blog/tags/Entitlement-Management/"/>
    
  </entry>
  
  <entry>
    <title>グローバル管理者ロールを持つユーザーでサインインできない！</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/ga-is-locked-out/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/ga-is-locked-out/</id>
    <published>2022-11-13T00:00:00.000Z</published>
    <updated>2023-02-26T07:56:55.879Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 高田 です。</p><p>本日は、よく弊社にお問い合わせいただく以下のような内容について、改めて注意喚起もかねて記事を執筆いたしました。</p><ul><li>テナントを作成したユーザーが退職してしまい、グローバル管理者ロールを持つユーザーが分からない。</li><li>ゲスト ユーザーがグローバル管理者ロールを保持しているが、そのゲスト ユーザーの大元のユーザーにアクセスできない。</li><li>グローバル管理者ロールをもつユーザーがスマホをなくした、もしくは機種変更したので MFA を突破できない。</li><li>条件付きアクセスでグローバル管理者ロールを持つ全てのユーザーがブロックされ Azure ポータルに入れない。</li><li>1 人しかいないグローバル管理者のユーザーにリスクが検出されてしまいサインインできない。</li></ul><p>弊社サポートには連日上記のようなお問い合わせを多くいただきます。このような状況に陥った場合、弊社にお問い合わせをいただいても本人確認などを含め非常に多くのやり取りが発生するため、回復にお時間を要すことが一般的です。場合によっては弊社からでもテナントの回復が行えない場合もございます。</p><p>マイクロソフト側で対処することが可能なシナリオもありますが、可能な限り未然に上記のような状況を防ぐことが重要です。</p><p>そこで本記事では、テナントへのアクセスが失われないようマイクロソフトとして推奨する Azure AD テナント運用のベスト プラクティスを紹介いたします。</p><h2 id="まず確認すること"><a href="#まず確認すること" class="headerlink" title="まず確認すること"></a>まず確認すること</h2><p>まずは、このような事態を未然に防ぐために、Azure AD 管理者が確認しておくべきことを以下におまとめしました。</p><h3 id="社内にグローバル管理者ロールを持つ管理者を複数名確保する"><a href="#社内にグローバル管理者ロールを持つ管理者を複数名確保する" class="headerlink" title="社内にグローバル管理者ロールを持つ管理者を複数名確保する"></a>社内にグローバル管理者ロールを持つ管理者を複数名確保する</h3><p>Office 365 や Azure AD の利用を開始した直後のタイミングでは、そのテナントにはグローバル管理者ロールを持つアカウントが 1 つのみ存在しています。このため、引き継ぎなくそのアカウントの管理者が退職するなどすると、だれもそのテナントを管理できなくなります。</p><p>このような事態を防ぐため、社内の IT 部門において、必ず 2-3 名の信頼できるテナント管理者を任命し、それぞれの管理者ごとに Azure AD のユーザー (ゲスト ユーザーではなくテナント内のメンバーであり <a href="mailto:&#x78;&#x78;&#x78;&#x40;&#99;&#111;&#x6e;&#x74;&#x6f;&#x73;&#111;&#x2e;&#x6f;&#110;&#x6d;&#x69;&#x63;&#x72;&#x6f;&#115;&#x6f;&#x66;&#x74;&#46;&#99;&#x6f;&#109;">&#x78;&#x78;&#x78;&#x40;&#99;&#111;&#x6e;&#x74;&#x6f;&#x73;&#111;&#x2e;&#x6f;&#110;&#x6d;&#x69;&#x63;&#x72;&#x6f;&#115;&#x6f;&#x66;&#x74;&#46;&#99;&#x6f;&#109;</a> のような UPN を持つクラウド ユーザー) を発行することをお勧めします。ここで、一つの管理者アカウント (Azure AD ユーザー) を複数名で使いまわすことはお勧めしません。これは、アカウントが使いまわされることで、どの管理者がいつサインインし、どのような操作を行ったかの監査が困難となるためです。必ず異なる UPN と異なるパスワードで、管理者の数だけ、管理専用の Azure AD ユーザーを発行ください。グローバル管理者のロールを持つユーザーの数は、テナント全体で 5 人未満がおすすめです。</p><p>その他の推奨事項 (特に MFA の構成など) については、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/roles/best-practices">Azure AD ロールのベスト プラクティス</a> もご覧ください。</p><p>なお、いわゆる一人情シスなど、グローバル管理者ロールを持つユーザーが一名しか確保できない場合は、後述の緊急アクセス アカウントを必ず作成ください。2-3 名のテナント管理者を任命できる場合でも、緊急アクセスアカウントの準備を極力お勧めいたします。</p><p>また、Azure AD の管理者アカウントとして Microsoft アカウントを使用しているお客様は、上記のとおり管理者アカウントとして Azure AD のユーザーを利用することを特にご検討ください。Microsoft アカウントはコンシューマー向けの無料アカウントであり、その復旧を Azure 技術サポートで支援することはできません。Azure 技術サポートから支援を受けるには、Microsoft アカウントではなく、Azure AD の組織アカウントをご利用ください。</p><h3 id="緊急アクセス用の管理アカウントを作成する"><a href="#緊急アクセス用の管理アカウントを作成する" class="headerlink" title="緊急アクセス用の管理アカウントを作成する"></a>緊急アクセス用の管理アカウントを作成する</h3><p>緊急アクセス用の管理アカウントは、グローバル管理者ロールを持つユーザーが誰もテナントにアクセスできなくなってしまった場合に、最後の手段として利用する緊急用アカウントのことです。緊急時にガラス窓を割って脱出するような状況に例えられるため、Break glass account とも呼ばれます。</p><p>緊急アクセス用の管理アカウントはどの管理者にも割り当てず、非常時にだけ利用します。緊急アクセス用の管理アカウントの ID とパスワードを発行したら、多要素認証の方法として FIDO2 セキュリティ キーを構成することをおすすめします。多要素認証の方法として電話を利用することはお勧めしません。電話キャリアに障害が発生したり、電話番号の契約が切れたりすると、重要な時にアカウントにサインインできなくなるためです。緊急アクセス用の管理アカウントは条件付きアクセスの対象からも除外ください。</p><p>アカウントの準備ができたら、ID とパスワード、多要素認証の構成に使用した FIDO2 セキュリティ キーを、Azure AD との複数の通信手段がある安全な場所 (社内の金庫など) に保管いただければと思います。緊急アクセス用の管理アカウントの詳細については、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/roles/security-emergency-access">こちらのページ</a> もご覧ください。</p><h3 id="会社や学校の住所およびその他のプロファイル情報を登録する"><a href="#会社や学校の住所およびその他のプロファイル情報を登録する" class="headerlink" title="会社や学校の住所およびその他のプロファイル情報を登録する"></a>会社や学校の住所およびその他のプロファイル情報を登録する</h3><p>テナントへのアクセスができなくなり、弊社へお問い合わせいただいた際には、お客様の会社名や連絡先を確認することで、お客様がテナントの正当な保持者であるかを弊社サポートが確認します。この時に、テナントに事前に登録された住所や会社名、技術連絡先などを利用します。このため、これらの登録情報を事前に登録するとともに、既に登録済みであれば正確な情報であることをご確認ください。</p><p>情報の登録や確認については、<a href="https://docs.microsoft.com/ja-JP/microsoft-365/admin/manage/change-address-contact-and-more">こちらのページ</a> をご覧ください。</p><p><img src="/blog/azure-active-directory/ga-is-locked-out/companyinfo.png" alt="組織の情報の入力例"></p><p>なお、弊社にお問い合わせをいただいても、上記情報が登録されていない場合や正確でない場合は、テナントの回復ができなくなりますので十分ご注意ください。</p><h2 id="普段の運用時に確認すること"><a href="#普段の運用時に確認すること" class="headerlink" title="普段の運用時に確認すること"></a>普段の運用時に確認すること</h2><h3 id="認証用のスマホを変更するときは-MFA-の登録情報の変更を忘れない"><a href="#認証用のスマホを変更するときは-MFA-の登録情報の変更を忘れない" class="headerlink" title="認証用のスマホを変更するときは MFA の登録情報の変更を忘れない"></a>認証用のスマホを変更するときは MFA の登録情報の変更を忘れない</h3><p>グローバル管理者ロールを持つユーザーを含め、すべてのユーザーで MFA の登録を推奨しています。管理者に限らず、一般ユーザーにおいても、多要素認証に使用するスマホを買い替える際は、併せて MFA の登録情報の変更を忘れないようご注意ください。</p><p>詳細は、別途公開しているサポート チーム ブログの <a href="https://jpazureid.github.io/blog/azure-active-directory/move-authenticator-to-new-phone/">スマホを替える時は、Microsoft Authenticator の移行を忘れないでください！</a> を参照ください。</p><h3 id="条件付きアクセス-ポリシーを構成するときは管理者ロールを持つユーザーを除外する"><a href="#条件付きアクセス-ポリシーを構成するときは管理者ロールを持つユーザーを除外する" class="headerlink" title="条件付きアクセス ポリシーを構成するときは管理者ロールを持つユーザーを除外する"></a>条件付きアクセス ポリシーを構成するときは管理者ロールを持つユーザーを除外する</h3><p>条件付きアクセス ポリシーを構成するときは、緊急アクセス用のアカウントや最低一名のグローバル管理者ロールを持つユーザーを除外することをお勧めします。条件付きアクセスポリシーを構成および変更する際には、十分ご注意ください。</p><p>条件付きアクセス ポリシーの詳細については、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/governance/conditional-access-exclusion#create-a-conditional-access-policy-that-excludes-the-group">こちらのページ</a> もご覧ください。</p><h2 id="テナントやリソースにアクセスできなってしまった場合に確認すること"><a href="#テナントやリソースにアクセスできなってしまった場合に確認すること" class="headerlink" title="テナントやリソースにアクセスできなってしまった場合に確認すること"></a>テナントやリソースにアクセスできなってしまった場合に確認すること</h2><p>上記の対応を行っておけば、テナントやリソースにアクセスできず、ロックアウトされることはありません。しかしながら、万が一、何らかの理由により管理者がテナントやリソースにアクセスできなってしまった場合には以下の点をご確認ください。</p><h3 id="Azure-サブスクリプションに対して-Azure-AD-のグローバル管理者のアクセス権を昇格する"><a href="#Azure-サブスクリプションに対して-Azure-AD-のグローバル管理者のアクセス権を昇格する" class="headerlink" title="Azure サブスクリプションに対して Azure AD のグローバル管理者のアクセス権を昇格する"></a>Azure サブスクリプションに対して Azure AD のグローバル管理者のアクセス権を昇格する</h3><p>これは、何らかの理由により、Azure サブスクリプションのリソースにその所有者がアクセスできなくなってしまったが、Azure AD のグローバル管理者ロールを持つユーザーは Azure ポータルにサインインができる場合のシナリオです。</p><p>サブスクリプションの所有者が Azure AD にサインインできなくなっても、Azure AD のグローバル管理者ロールを持つユーザーをサブスクリプションの所有者に昇格させることが可能です。これにより、一時的にグローバル管理者ロールを持つユーザーでリソースを管理可能となります。</p><p>詳細については、<a href="https://docs.microsoft.com/ja-jp/azure/role-based-access-control/elevate-access-global-admin">Azure のすべてのサブスクリプションと管理グループを管理する目的でアクセス権限を昇格させる</a> のページをご覧ください。</p><h3 id="他の管理者ユーザーでアクセスが可能か確認する"><a href="#他の管理者ユーザーでアクセスが可能か確認する" class="headerlink" title="他の管理者ユーザーでアクセスが可能か確認する"></a>他の管理者ユーザーでアクセスが可能か確認する</h3><p>グローバル管理者ロールを持つユーザーでサインインができなくなってしまった場合、念のため、一般ユーザーであればサインインが可能か、サインインできる場合は、Azure ポータルの [ロールと管理者] から誰がグローバル管理者ロールを持っているか確認ください。確認できたグローバル管理者ロールを持つユーザー全員に対してサインインをお試しください。</p><p><img src="/blog/azure-active-directory/ga-is-locked-out/globaladmin.png" alt="グローバル管理者ロールを持つユーザーの確認方法"></p><p>条件付きアクセスで社外からのアクセスを制限している場合には、社内ネットワークからのサインインが可能かどうかなど、アクセス時の条件を変えてサインインが可能かも確認くださいますようお願い申し上げます。</p><h3 id="マイクロソフト-サポートに問い合わせる"><a href="#マイクロソフト-サポートに問い合わせる" class="headerlink" title="マイクロソフト サポートに問い合わせる"></a>マイクロソフト サポートに問い合わせる</h3><p>どの管理者ユーザーでもテナントにアクセスできない場合は、最後の手段として弊社サポートチームまでお問い合わせください。この時、問題はサポートにお問い合わせを行おうにも、Azure ポータルに管理者アカウントがアクセスができず、自社のテナントからサポートを上げられない状況にあるということです。</p><p>この場合、<a href="https://aka.ms/AzurePortalHelp">https://aka.ms/AzurePortalHelp</a> にアクセスし、日本の窓口電話番号まで連絡してお問い合わせを発行ください。Azure ポータルにアクセスできない場合に、サポート リクエストを発行する方法については、<a href="https://azure.microsoft.com/ja-jp/support/legal/faq/">Azure サポート プランに関する FAQ</a> も参考となりますのでご参照ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 高田 です。&lt;/p&gt;
&lt;p&gt;本日は、よく弊社にお問い合わせいただく以下のような内容について、改めて注意喚起もかねて記事を執筆いたしました。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;テナントを作成したユーザーが退職してしまい、グ</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
  </entry>
  
  <entry>
    <title>モバイル端末での Azure AD 証明書ベース認証 (CBA)</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile/</id>
    <published>2022-11-06T00:00:00.000Z</published>
    <updated>2023-02-26T07:56:55.707Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 高田 です。</p><p>本記事は、2022 年 11 月 2 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/azure-ad-certificate-based-authentication-cba-on-mobile/ba-p/2365672">Azure AD Certificate-based Authentication (CBA) on Mobile</a> を意訳したものになります。</p><hr><p>Ignite 2022 では、大統領令 14028 (Improving the Nation’s Cybersecurity) への Microsoft のコミットメントの一環として、Azure Active Directory (Azure AD) の証明書ベース認証 (CBA) の一般提供を開始することを発表しました。今回、ハードウェア セキュリティキー (YubiKey) 上の証明書を使用した iOS および Android デバイスでの Azure AD CBA のサポートについてパブリック プレビューを発表することができ、大変うれしく思っています。</p><p>BYOD (Bring Your Own Device) が増加する中、この機能により、ユーザーのモバイル デバイスに証明書をプロビジョニングすることなく、モバイルにおいてフィッシング耐性のある MFA を要求することができるようになります。今回は、モバイルでの Azure AD CBA のサポートについて、Microsoft Entra のプロダクト マネージャーである Vimala Ranganathan を招き、モバイルでのフィッシング耐性 MFA の詳細について解説します。</p><p>皆様のご意見をお待ちしております。</p><p>Alex Weinert (twitter: <a href="https://twitter.com/alex_t_weinert">@Alex_t_weinert</a>)</p><hr><p>皆様こんにちは。</p><p>ハードウェア セキュリティ キー上の証明書を使用した iOS および Android デバイス上の <strong>Azure AD CBA</strong> のパブリック プレビューについて、詳しくご紹介します。</p><p><img src="/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile/SHDriggers_0-1667344126894.png"></p><p>米国のサイバー セキュリティに関する <a href="https://www.whitehouse.gov/briefing-room/presidential-actions/2021/05/12/executive-order-on-improving-the-nations-cybersecurity/">大統領令 14028</a> は、すべてのデバイス プラットフォームでフィッシング耐性のある MFA を使用することを要求しています。モバイルでは、顧客が個人のモバイル デバイスにユーザー証明書をプロビジョニングして認証に使用することができますが、これは主に管理されたモバイル デバイスで実現可能なものです。しかし、今回のパブリック プレビューでは、BYOD のサポートが可能になりました。お客様は、ハードウェア セキュリティ キーに証明書をプロビジョニングし、iOS および Android デバイスの Azure AD による認証に使用できるようになりました。</p><p>Microsoft のモバイルにおける証明書ベースのソリューションは、ハードウェア セキュリティ キーと併せて利用することで、シンプルで便利、なおかつ FIPS (Federal Information Processing Standards) 認定のフィッシング耐性のある MFA 方式です。</p><p>すべてのブラウザベースの Web アプリとネイティブ アプリ (最新の <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/develop/msal-overview">Microsoft Authentication Library</a> (MSAL) を使用する Microsoft 製ファーストパーティ アプリを含む) において、モバイル デバイス上で <a href="https://www.yubico.com/products/">YubiKey</a> を用いた Azure AD CBA がサポートされます。また、最新の MSAL を利用していないすべてのアプリにおいても、最新の Microsoft Authenticator (<a href="https://play.google.com/store/apps/details?id=com.azure.authenticator&gl=US">Android</a> または <a href="https://apps.apple.com/app/microsoft-authenticator/id983156458">iOS/iPadOS</a>) を利用したブローカー認証フローで Yubikey を用いた Azure AD CBA がサポートされます。</p><h2 id="Yubikey-を用いた-iOS-上での-Azure-AD-CBA-の動作"><a href="#Yubikey-を用いた-iOS-上での-Azure-AD-CBA-の動作" class="headerlink" title="Yubikey を用いた iOS 上での Azure AD CBA の動作"></a>Yubikey を用いた iOS 上での Azure AD CBA の動作</h2><p>使用に当たり、最初の登録として、ユーザーは <a href="https://apps.apple.com/us/app/yubico-authenticator/id1476679808">Yubico Authenticator for iOS</a> アプリを使用して YubiKey の公開証明書を iOS キーチェーンにコピーする必要があります (スマートカード証明書の秘密情報が YubiKey の外に漏れることはありません)。</p><p>サインインするには、ユーザーは証明書の選択画面から YubiKey の証明書を選択し、YubiKey を挿入するか NFC 対応の YubiKey をタップし、YubiKey Authenticator 経由で PIN を入力して、認証フローを終了します。</p><p><img src="/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile/SHDriggers_1-1667344126898.png"></p><p><img src="/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile/SHDriggers_2-1667344126900.png"></p><h2 id="Yubikey-を用いた-Android-上での-Azure-AD-CBA-の動作"><a href="#Yubikey-を用いた-Android-上での-Azure-AD-CBA-の動作" class="headerlink" title="Yubikey を用いた Android 上での Azure AD CBA の動作"></a>Yubikey を用いた Android 上での Azure AD CBA の動作</h2><p>Android のモバイル デバイスでの YubiKey による Azure AD CBA サポートは、最新の MSAL によって有効化されるため、YubiKey Authenticator アプリは Android では必須ではありません。</p><p>ユーザーは YubiKey を USB 経由で接続し、Azure AD CBA を開始します。YubiKey から証明書を選び、PIN を入力してアプリケーションで認証を受けることができます。</p><p><img src="/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile/SHDriggers_4-1667344126905.png"></p><p><img src="/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile/SHDriggers_5-1667344126908.png"></p><p>このパブリック プレビューについて詳細をご要望の場合は、Yubico が 11 月 3 日 9 AM (PST) から提供予定のウェビナー “New solutions to prevent phishing with Azure AD and YubiKeys” にご参加ください。<a href="https://www.brighttalk.com/webcast/15793/562225?utm_source=brighttalk-portal&utm_medium=web&utm_campaign=channel-page&utm_content=upcoming">こちら</a> から参加登録いただけます。</p><p>Azure AD CBA と Yubikey についての詳細はこちらもどうぞ:</p><ul><li>Azure AD CAB: <a href="http://aka.ms/aadcba">http://aka.ms/aadcba</a> </li><li>iOS における Azure AD CBA: <a href="https://learn.microsoft.com/en-us/azure/active-directory/authentication/concept-certificate-based-authentication-mobile-ios">Azure Active Directory certificate-based authentication on iOS devices</a></li><li>Android における Azure AD CBA: <a href="https://learn.microsoft.com/en-us/azure/active-directory/authentication/concept-certificate-based-authentication-mobile-android">Azure Active Directory certificate-based authentication on Android devices</a></li><li>Yubikey: Meet the YubiKey - <a href="https://www.yubico.com/why-yubico/">Strong Two-Factor Authentication Solution</a></li></ul><h2 id="今後について"><a href="#今後について" class="headerlink" title="今後について"></a>今後について</h2><p>引き続き <a href="https://feedback.azure.com/d365community/forum/22920db1-ad25-ec11-b6e6-000d3a4f0789">Azure Active Directory コミュニティ</a> までフィードバックをお寄せください。弊社では継続して Yubikey に対する NFC のサポートに取り組んでおり、モバイル上での Azure AD CBA に他のスマートカード提供元を統合すべく取り組んでおります。大統領令 14028 への弊社のコミットメントについては <a href="https://www.microsoft.com/en-us/federal/CyberEO.aspx">こちら</a> もご覧ください。</p><p>Vimala</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 高田 です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 11 月 2 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD の耐障害性を高める取り組み</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/advances-in-azure-ad-resilience/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/advances-in-azure-ad-resilience/</id>
    <published>2022-11-04T01:00:00.000Z</published>
    <updated>2023-02-26T07:56:55.679Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 高田 です。</p><p>本記事は、2022 年 10 月 28 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/advances-in-azure-ad-resilience/ba-p/2147048">Advances in Azure AD resilience</a> を意訳したものになります。</p><hr><p>現在、<a href="https://www.microsoft.com/ja-jp/security/business/microsoft-entra">Microsoft Entra</a> に含まれる Azure Active Directory (Azure AD) のようなエンタープライズ レベルのソリューションでは、耐障害性とセキュリティが基本の要件となっています。Microsoft では、Azure AD の耐障害性とエンタープライズ レベルのセキュリティを最も重要視しており、お客様の期待に確実に応えるために継続的に開発を進めています。</p><p>弊社では、これまで定期的に耐障害性への投資に関する情報をお届けしてきました。これら一連のお知らせでは当初、<a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/99-99-uptime-for-azure-active-directory/ba-p/1999628">99.99% の SLA</a> について説明し、当社の耐障害性のロードマップの <a href="https://azure.microsoft.com/ja-jp/blog/advancing-azure-active-directory-availability/">基本原則とアーキテクチャの基礎</a> を紹介するとともに、システムに組み込まれた完全自動の <a href="https://azure.microsoft.com/en-us/blog/advancing-service-resilience-in-azure-active-directory-with-its-backup-authentication-service/">バックアップ認証サービス</a> など、高度に差別化された耐障害性の機能について紹介してきました。本日は、最新の進捗状況、主な成果、およびさらなる改善のための計画について紹介します。</p><h2 id="これまでの成果"><a href="#これまでの成果" class="headerlink" title="これまでの成果"></a>これまでの成果</h2><p>弊社の耐障害性に対するアプローチは、複数の階層にまたがるものです。Azure AD サービスは、Microsoft クラウド全体で採用されているエンタープライズ レベルのセキュリティとベストプラクティスに基づいて構築されています。これは、次のことを意味します:</p><ul><li>このサービスは、VM やネットワーク スイッチからデータセンター全体に至るまで、あらゆる障害に耐えられるよう、何層もの内部冗長性を持つように設計されています。データセンター全体の障害からの復帰を含め、定期的に運用環境でこの点を検証しています。</li><li>サービスおよび依存関係の全ての場所で単一障害点がないか確認し、それらを取り除くよう継続的に取り組んでいます。外部への依存関係の例として、Azure AD では MFA 用の SMS と音声通知の配信に通信事業者を使用していることがあげられます。メッセージ配信の耐障害性を確保するために、複数の (各国で最大 5 つの) 通信事業者を完全にアクティブ/アクティブな状態で使用しています。</li><li>すべての変更は、完全に自動化された非常に厳格な Safe Deployment プロセス (SDP) を使用して適用されます。これは、変更に関連して生じる問題をできるだけ早く、理想的にはお客様に影響が及ぶ前に捉え、その影響を食い止めるためのものです。Safe Deployment プロセスには、何層もの内部自動テスト、本番環境へのゆっくりとした段階的ロールアウト、予期せぬ影響をもたらしている変更を自動的に停止しロールバックできるテレメトリ (正常性確認の監視) の層が含まれています。</li></ul><p>この 1 年間は、これらの核となる取り組みに加えて、障害耐性を高める層をより厚くするために、以下を実施しました。</p><ul><li>潜在的な障害の可能性と影響を低減するためのさらなる取り組み (バックアップ認証システムおよび地域ごとに独立した認証エンドポイントの導入)。</li><li>100 以上の区画を持つセルベース アーキテクチャ (障害やサービス劣化の影響範囲を構造的に縮小するよう設計) への移行完了。</li><li>アプリケーションに耐障害性を持たせるための Continuous Access Evaluation (CAE: 継続的アクセス評価) などの技術を開発し提供。</li></ul><p>これらの投資を組み合わせることで、耐障害性の高いコアサービスを提供するとともに、SDK やアプリケーションに組み込まれた耐障害性の層により、他のすべての耐障害性の層に障害が発生しても、影響を受けずに動作を継続することができるように設計されています。</p><p>これらの耐障害性機能は、Microsoft のアプリだけでなく、Azure AD と統合する <strong>すべての</strong> アプリケーションで利用いただけます。お客様のアプリケーションでは <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/develop/msal-overview">Microsoft Authentication Library</a> (MSAL SDK) を活用することで、これらの耐障害性の機能を最大限に活用することが可能です。</p><p>以下に、昨年度提供した耐障害性に関する主な技術革新をまとめます。</p><h3 id="バックアップ認証システム"><a href="#バックアップ認証システム" class="headerlink" title="バックアップ認証システム"></a>バックアップ認証システム</h3><p>航空機のシステムや宇宙船などのミッション クリティカルなシステムには、複数の冗長化されたシステムの概念が長年存在しています。弊社では 1 年以上前に、Azure AD を保護するために、同様のコンセプトであるバックアップ認証サービスを導入しました。  </p><p>現在、マイクロソフトとサードパーティーのアプリケーションの両方を保護するため、このシステムの運用環境への展開が完了し、稼働状態となっています。万が一、このバックアップ システムが必要になった場合に備えて、全トラフィックの一部を使って常に稼働確認が行われており、Microsoft 社内では定期的にバックアップ システムに通信を切り替えてその効果を測定しています。弊社は、システムが提供する保護領域と、バックアップ認証システムがカバーする認証シナリオの数を常に増やしています。</p><h3 id="継続的なアクセス評価-アプリの継続的な動作にむけて"><a href="#継続的なアクセス評価-アプリの継続的な動作にむけて" class="headerlink" title="継続的なアクセス評価 - アプリの継続的な動作にむけて"></a>継続的なアクセス評価 - アプリの継続的な動作にむけて</h3><p>現在の先進的な認証は、Outlook などのクライアントが、Exchange Online などのリソースに定期的 (通常は 1 時間) にアクセスし、ユーザーのアクセス状態を更新するという仕組みに基づいています。今年初めには、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-continuous-access-evaluation">Continuous Access Evaluation (CAE: 継続的アクセス評価)</a> の仕組みを導入し、セキュリティ上のイベントが検出された場合に、Azure AD がプロアクティブかつ即座にアクセスを取り消すことが可能になりました。この技術革新により、セキュリティを向上させると同時に、サポートされるリソースに対しては更新間隔を 1 時間から 24 時間に引き上げることができました。この更新間隔の延長により、既存のセッションは Azure AD のコアサービスにおけるいかなる問題にも影響されることなく、大幅に長く (平均 12 時間もしくは 24 時間のアクセス持続時間の半分) 運用を継続することが可能になりました。</p><p>現在、ユーザー セッションの 30％ が CAE の強化されたセキュリティと拡張された耐障害性の恩恵を受けています。2023 年中に、さらに多くのリソースを統合して、このカバー率を高める予定です。</p><h3 id="セルベースのアーキテクチャ"><a href="#セルベースのアーキテクチャ" class="headerlink" title="セルベースのアーキテクチャ"></a>セルベースのアーキテクチャ</h3><p>セルベースのアーキテクチャは、サービスを独立したパーティションに厳格に分離し、あらゆる障害の影響をそのセルの外に及ばせないよう設計されています。これは例えるなら、船において一部が浸水したとしても、浸水が他の区画や船全体の完全性に影響を与えないようになっている隔壁を持つ船のようなものです。Azure AD は昨年、117 のセルに移行し、どのセルもサービス全体のトラフィックの 2% 以上を含まないようになりました。セル自体には、複数のレベルの耐障害性が組み込まれています。例えば、複数の独立した Azure リージョンからのトラフィックを処理し、これまでに解説した耐障害性の原則に完全に則っています。</p><p>このように細かい粒度で分離されているため、セル内に存在しているどのテナントも、他のテナントの障害の大部分から非常に強く隔離されていることになります。</p><h3 id="地域ごとに分離された認証エンドポイント"><a href="#地域ごとに分離された認証エンドポイント" class="headerlink" title="地域ごとに分離された認証エンドポイント"></a>地域ごとに分離された認証エンドポイント</h3><p>Azure AD は、ユーザーのための ID システムであるだけでなく、Azure 上に構築されたアプリやサービスのための ID およびアクセス管理 (IAM) システムでもあります。例えば、Azure AD は、VM 自体がストレージに対して認証するような、すべての基盤の認証に使用されます。このように何重もの耐障害性を確保するために、私たちはほとんどの Azure リージョンで地域ごとに分離された認証エンドポイントを導入しています。地域別エンドポイントは、バックアップ認証システムに加えて、第 3 の耐障害性レイヤーを追加し、その地域内の認証を完全に処理することが可能です。</p><p>現在、Azure リソース用の <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/managed-identities-azure-resources/overview">Managed ID</a> の 95% は、地域のエンドポイントによって提供および保護されています。これにより、プライマリの Azure AD 認証サービスに問題が生じた場合でも、Azure 上に構築されたお客様のワークロードに影響を与えないようになっています。</p><h2 id="これらを総合した主な結果"><a href="#これらを総合した主な結果" class="headerlink" title="これらを総合した主な結果"></a>これらを総合した主な結果</h2><p>過去 12 カ月では、2021 年 12 月を除くすべての月で、<a href="https://review.learn.microsoft.com/ja-jp/azure/active-directory/reports-monitoring/reference-azure-ad-sla-performance?branch=main">Azure AD の稼働率</a> 99.99% の SLA を達成したことをお知らせします。12 月については、一部のバック エンドシステムに影響を与えたサービス劣化により、SLA がスリー ナイン レベル、つまり 99.978% まで低下しました。この問題は、ユーザーの 1% 未満に影響し、90 分以内に解決されました。</p><p>このサービス劣化は、弊社の多層的な耐障害性対策の価値を実際に示すもので、多層的な耐障害性対策が功を奏し、ほとんどのユーザーがまったく影響を受けずに済みました。</p><h2 id="今後の取り組み"><a href="#今後の取り組み" class="headerlink" title="今後の取り組み"></a>今後の取り組み</h2><p>私たちの目標は、耐障害性に対するハードルを常に上げ、より多くのツールや機能をお客様の手に届けることです。この連載では、上記のようなロードマップの進捗状況や、サービスの耐障害性を支える弊社のアーキテクチャやシステムの仕組みについて深く掘り下げた内容を定期的にお伝えしていく予定です。併せて <a href="https://azure.microsoft.com/ja-jp/support/legal/sla/active-directory/v1_1/">SLA の詳細</a> と <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/resilience-in-infrastructure">稼働時間の月次情報</a> をチェックすることもお勧めします。</p><p>Nadim Abdo<br>CVP, Engineering</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 高田 です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 10 月 28 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techc</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>B2B コラボレーション用の非管理アカウントが作成されなくなりました</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/say-goodbye-to-unmanaged-azuread-account-for-b2b/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/say-goodbye-to-unmanaged-azuread-account-for-b2b/</id>
    <published>2022-11-04T00:00:00.000Z</published>
    <updated>2023-02-26T07:56:56.151Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure ID チームの小出です。</p><p>本記事は、2022/9/2 の <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/say-goodbye-to-unmanaged-azure-ad-accounts-for-b2b-collaboration/ba-p/3094111">Say goodbye to unmanaged Azure AD accounts for B2B collaboration</a> の記事の抄訳を元に Azure AD B2B コラボレーションの動作変更と、対処策についてお知らせします。</p><h2 id="変更内容の概要"><a href="#変更内容の概要" class="headerlink" title="変更内容の概要"></a>変更内容の概要</h2><p>Azure Active Directory (Azure AD) において、B2B コラボレーション用の非管理 (バイラル) アカウントが廃止されました。B2B コラボレーション用の非管理 (バイラル) アカウントは、「いつのまにか自動で作成されている」、「削除すると、ゲストがリソース テナントにアクセスできなくなる」など、管理や運用が難しいという課題を抱えていました。また、「アカウントを誰が作成したのか分からない」、「消していいのか」など、弊社サポートでもお問い合わせをいただいていました。</p><p>以前 <a href="https://jpazureid.github.io/blog/azure-active-directory/announcement-of-otp/">2021 年 10 月に予定されるゲスト ユーザー招待時の動作変更について</a> の弊社ブログでは、非管理アカウントがサポートされなくなる旨と、代替案として OTP の仕様についてご案内しておりました。今回の変更では、サポートされなくなった非管理アカウントが、今後の動作としても新しく作成されなくなりました。</p><p>なお、以前に招待され、非管理型の Azure AD アカウントとして引き換えされたアカウントは、引き続き機能します。 </p><h2 id="以前の動作"><a href="#以前の動作" class="headerlink" title="以前の動作"></a>以前の動作</h2><p>具体的には、以前の承諾フローにて、⑧ から ⑨ に遷移することがなくなりました。</p><p><img src="/blog/azure-active-directory/say-goodbye-to-unmanaged-azuread-account-for-b2b/say-goodbye-to-unmanaged-azuread-account-for-b2b1.png"></p><p>⑧ から ⑨ に遷移した時には、以下のような Set up your account with Microsoft というメッセージとパスワードの設定画面が表示されていましたが、<br>今回の変更によりこの画面からアカウントが自動作成されることがなくなりました。</p><p><img src="/blog/azure-active-directory/say-goodbye-to-unmanaged-azuread-account-for-b2b/say-goodbye-to-unmanaged-azuread-account-for-b2b2.png"></p><h2 id="現在の動作"><a href="#現在の動作" class="headerlink" title="現在の動作"></a>現在の動作</h2><p>現在の新しい承諾フローは、下記のようになります。 ⑥ のフローで OTP が無効な場合、 個人用 Microsoft アカウントを作成するよう求められます。<br>承諾フローの数が減り、よりシンプルで分かりやすい形になりました。 </p><p><img src="/blog/azure-active-directory/say-goodbye-to-unmanaged-azuread-account-for-b2b/say-goodbye-to-unmanaged-azuread-account-for-b2b3.png"></p><p>以前のブログにて、 OTP の機能を有効化することをご案内しております。</p><p>⑥ のフローで Yes に遷移した場合、下記のような画面に遷移します。パスワードを入力する画面が一度もない場合は、 OTP のフローに入ったと判断できます。</p><p><img src="/blog/azure-active-directory/say-goodbye-to-unmanaged-azuread-account-for-b2b/say-goodbye-to-unmanaged-azuread-account-for-b2b4.png"></p><p>OTP が無効なシナリオで ⑦ に遷移した場合には、下記のように Microsoft アカウント作成画面が表示されます。</p><p><img src="/blog/azure-active-directory/say-goodbye-to-unmanaged-azuread-account-for-b2b/say-goodbye-to-unmanaged-azuread-account-for-b2b5.png"></p><p>Microsoft アカウントには、パスワードを設定する必要があるため、 [次へ] をクリックしたときにパスワード入力画面が表示されるのが特徴です。</p><p><img src="/blog/azure-active-directory/say-goodbye-to-unmanaged-azuread-account-for-b2b/say-goodbye-to-unmanaged-azuread-account-for-b2b6.png"></p><h2 id="既存の非管理アカウントのクリーンアップ方法"><a href="#既存の非管理アカウントのクリーンアップ方法" class="headerlink" title="既存の非管理アカウントのクリーンアップ方法"></a>既存の非管理アカウントのクリーンアップ方法</h2><p>上記変更により、今後非管理アカウントは新しく作成されなくなりましたが、テナントにすでに登録されている非管理 (バイラル) アカウントは、そのまま残ってしまいます。<br>そのため、「組織に非管理 (バイラル) アカウントがあるか」を確認し、「今後どのような対応をとるか」を検討いただくことをお勧めいたします。</p><p>確認と棚卸を進めていただく方法として、以下 2 種類の方法を提供しています。</p><ul><li>MSIdentity Tools PowerShell Module  を使用して、 PowerShell コマンドで管理・棚卸を行う</li><li>下記の<a href="https://github.com/Azure-Samples/Remove-Unmanaged-Guests">サンプル アプリケーション</a>を利用する</li></ul><p>今回はコマンドやアプリになじみがないお客さまでも実施できるよう、コマンドで簡単に非管理アカウントを抽出・管理する方法について案内します。詳細は、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/enterprise-users/clean-up-unmanaged-azure-ad-accounts">アンマネージド Azure Active Directory アカウントをクリーンアップする</a> の公開情報も併せてご覧ください。</p><h3 id="事前準備"><a href="#事前準備" class="headerlink" title="事前準備"></a>事前準備</h3><p>下記に記載の手順を利用するためには、MSIdentityTools PowerShell モジュールが必要です。まずは以下のコマンドを使用して、モジュールをインストールします。</p><p>注意点は、 PowerShell を管理者特権で開く必要がある点です。 PowerShell を開いたときに、左上に「管理者」と表示されていれば問題ありません。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Install-Module MSIdentityTools</span><br><span class="line">Install-Module Microsoft.Graph</span><br></pre></td></tr></table></figure><h3 id="実施手順"><a href="#実施手順" class="headerlink" title="実施手順"></a>実施手順</h3><p>モジュールがインストールできたら、 Azure AD に接続します。接続には Connect-MgGraph コマンドを使用します。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Connect-MgGraph --Scope User.Readwrite.All</span><br></pre></td></tr></table></figure><p>サインイン画面が表示されたら、ユーザー名とパスワードを入力してサインインします。Welcome To Microsoft Graph! のメッセージが表示されたら、サインインは完了です。</p><p>次に、テナントに非管理 (バイラル) アカウントがあるか確認します。下記のコマンドを実行します。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MsIdUnmanagedExternalUser</span><br></pre></td></tr></table></figure><p>このコマンドでは、非管理 (バイラル) アカウントの外部ユーザーを取得しています。ユーザー名など、もし何も応答が返されなければ、組織に非管理 (バイラル) アカウントはないため、この先の対処策を実行する必要はありません。</p><p>もしユーザーが表示された場合には、非管理 (バイラル) アカウントに対し、下記いずれかの対処を行うことをお勧めいたします。</p><ul><li>ゲストの招待状況をリセットする</li><li>アカウントを削除する</li></ul><p>招待をリセットすると、ユーザーは再度招待を承諾する必要があります。招待されたユーザーが組織アカウントなのか、個人アカウントなのかなどは、管理者が招待したタイミングではなく、ユーザーが承諾したタイミングで決まるため、招待状況をリセットすると、改めて上記画像に記載のフローが適用されます。</p><p>改めて招待を承諾する際には、現在のフローが適用されるため、非管理 (バイラル) アカウントとして承諾することはできません。組織アカウント、 Microsoft アカウントのほか、 OTP のユーザーとして招待を承諾することができます。</p><p>アカウントの削除については、非管理 (バイラル) アカウントがもう必要ない場合にご選択ください。もし該当のゲストが引き続きテナントにアクセスしたい場合は、改めて管理者が招待を行い、ユーザーが承諾を行う必要があります。</p><p>対応方針が決まったら、下記いずれかのコマンドを実行して、リセットもしくはアカウントを削除します。</p><p>リセットする場合:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MsIdUnmanagedExternalUser | Reset-MsIdExternalUser</span><br></pre></td></tr></table></figure><p>削除する場合:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MsIdUnmanagedExternalUser | Remove-MgUser</span><br></pre></td></tr></table></figure><p>最後に、 下記のコマンドを実行して接続を終了すれば完了です。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Disconnect-MgGraph</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure ID チームの小出です。&lt;/p&gt;
&lt;p&gt;本記事は、2022/9/2 の &lt;a href=&quot;https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/say-goodby</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
</feed>
